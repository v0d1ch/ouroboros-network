<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_4MbtqshNo4h3Ayp2VDYMdI"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds      #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds            #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE EmptyCase            #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs                #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase           #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds            #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes           #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving   #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications     #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies         #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators        #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Intended for qualified import</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &gt; import qualified Ouroboros.Consensus.HardFork.Combinator.Util.Telescope as Telescope</span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Telescope</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Telescope</span></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier">Telescope</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#sequence"><span class="hs-identifier">sequence</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Utilities</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier">tip</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTip"><span class="hs-identifier">fromTip</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#toAtMost"><span class="hs-identifier">toAtMost</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTZ"><span class="hs-identifier">fromTZ</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Bifunctor analogues of SOP functions</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier">bihap</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihmap"><span class="hs-identifier">bihmap</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihzipWith"><span class="hs-identifier">bihzipWith</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihczipWith"><span class="hs-identifier">bihczipWith</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Extension, retraction, alignment</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier">Extend</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extend"><span class="hs-identifier">extend</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier">Retract</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retract"><span class="hs-identifier">retract</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#align"><span class="hs-identifier">align</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Simplified API</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extendIf"><span class="hs-identifier">extendIf</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractIf"><span class="hs-identifier">retractIf</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtend"><span class="hs-identifier">alignExtend</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtendNS"><span class="hs-identifier">alignExtendNS</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Additional API</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier">SimpleTelescope</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#ScanNext"><span class="hs-identifier">ScanNext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#scanl"><span class="hs-identifier">scanl</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">scanl</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sequence</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Functor.Product</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.SOP.Strict.html"><span class="hs-identifier">Data.SOP.Strict</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">allNoThunks</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Counting</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html"><span class="hs-identifier">Ouroboros.Consensus.Util.SOP</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span>
</span><span id="line-62"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier">Requiring</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InPairs</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#Tails"><span class="hs-identifier">Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Tails</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tails</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Telescope
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Telescope</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- A telescope is an extension of an 'NS', where every time we &quot;go right&quot; in the</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- sum we have an additional value.</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Blockchain intuition: think of @g@ as representing some kind of past state,</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- and @f@ some kind of current state. Then depending on how many hard fork</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- transitions we have had, we might either have, say</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- &gt; TZ currentByronState</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- &gt; TS pastByronState $ TZ currentShelleyState</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- &gt; TS pastByronState $ TS pastShelleyState $ TZ currentGoguenState</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- The 'Telescope' API mostly follows @sop-core@ conventions, supporting</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- functor ('hmap', 'hcmap'), applicative ('hap', 'hpure'), foldable</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- ('hcollapse') and traversable ('hsequence''). However, since 'Telescope'</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- is a bi-functor, it cannot reuse the @sop-core@ classes. The naming scheme</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- of the functions is adopted from @sop-core@ though; for example:</span><span>
</span><span id="line-89"></span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- &gt; bi h (c) zipWith</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- &gt; |  |  |    |</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- &gt; |  |  |    \ zipWith: the name from base</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- &gt; |  |  |</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- &gt; |  |  \ constrained: version of the function with a constraint parameter</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- &gt; |  |</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- &gt; |  \ higher order: 'Telescope' (like 'NS'/'NP') is a /higher order/ functor</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- &gt; |</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- &gt; \ bifunctor: 'Telescope' (unlike 'NS'/'NP') is a higher order /bifunctor/</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- In addition to the standard SOP operators, the new operators that make</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- a 'Telescope' a telescope are 'extend', 'retract' and 'align'; see their</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- documentation for details.</span><span>
</span><span id="line-103"></span><span class="hs-keyword">data</span><span> </span><span id="Telescope"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-var">Telescope</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006411"><span class="annot"><a href="#local-6989586621680006411"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621680006410"><span class="annot"><a href="#local-6989586621680006410"><span class="hs-identifier hs-type hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006409"><span class="annot"><a href="#local-6989586621680006409"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680006410"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006408"><span class="annot"><a href="#local-6989586621680006408"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680006410"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621680006406"><span id="local-6989586621680006407"><span id="local-6989586621680007180"><span id="local-6989586621680007182"><span id="TZ"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007182"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006407"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>                        </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007180"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007182"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006407"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006406"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621680006403"><span id="local-6989586621680006404"><span id="local-6989586621680007167"><span id="local-6989586621680007169"><span id="TS"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007169"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006404"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007169"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007167"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006403"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007169"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007167"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006404"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006403"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  SOP class instances for 'Telescope'
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Prod"><span class="annot"><span class="hs-identifier hs-var">Prod</span></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span id="local-6989586621680006401"><span class="annot"><a href="#local-6989586621680006401"><span class="hs-identifier hs-type hs-type">g</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="SListIN"><span class="annot"><span class="hs-identifier hs-var">SListIN</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span id="local-6989586621680006400"><span class="annot"><a href="#local-6989586621680006400"><span class="hs-identifier hs-type hs-type">g</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="AllN"><span class="annot"><span class="hs-identifier hs-var">AllN</span></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span id="local-6989586621680006399"><span class="annot"><a href="#local-6989586621680006399"><span class="hs-identifier hs-type hs-type">g</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680006398"><span class="annot"><a href="#local-6989586621680006398"><span class="hs-identifier hs-type hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680006398"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span id="local-6989586621680006397"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HAp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006397"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621680006392"><span class="annot"><span class="annottext">hap :: Prod (Telescope g) (f -.-&gt; g) xs
-&gt; Telescope g f xs -&gt; Telescope g g xs
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">hap</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Telescope g f xs -&gt; NP (f -.-&gt; g) xs -&gt; Telescope g g xs)
-&gt; NP (f -.-&gt; g) xs -&gt; Telescope g f xs -&gt; Telescope g g xs
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs -&gt; NP (f -.-&gt; g) xs -&gt; Telescope g g xs
forall (f :: k -&gt; *) (xs :: [k]) (f' :: k -&gt; *).
Telescope g f xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f' xs
</span><a href="#local-6989586621680006389"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- We could define this in terms of 'bihap' but we lack 'SListI'</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621680007191"><span id="local-6989586621680007192"><span id="local-6989586621680007193"><span class="annot"><a href="#local-6989586621680006389"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006397"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007193"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007192"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007193"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680007191"><span class="hs-identifier hs-type">f'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680007192"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006397"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007191"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007192"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621680006389"><span class="annot"><span class="annottext">go :: Telescope g f xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f' xs
</span><a href="#local-6989586621680006389"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006388"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006388"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span id="local-6989586621680006387"><span class="annot"><span class="annottext">(-.-&gt;) f f' x
</span><a href="#local-6989586621680006387"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f' x -&gt; Telescope g f' (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f f' x -&gt; f x -&gt; f' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f f' x
</span><a href="#local-6989586621680006387"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006388"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><a href="#local-6989586621680006389"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006384"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006384"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006383"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006383"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f f' x
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006382"><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
</span><a href="#local-6989586621680006382"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f' xs -&gt; Telescope g f' (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006384"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope g f xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f' xs
forall (f :: k -&gt; *) (xs :: [k]) (f' :: k -&gt; *).
Telescope g f xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f' xs
</span><a href="#local-6989586621680006389"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006383"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
NP (f -.-&gt; f') xs
</span><a href="#local-6989586621680006382"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621680006381"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTraverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006381"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621680006377"><span class="annot"><span class="annottext">hctraverse_ :: proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g ())
-&gt; Telescope g f xs
-&gt; g ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">hctraverse_</span></span></span><span> </span><span id="local-6989586621680006375"><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006375"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; g ())
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g ())
-&gt; Telescope g f xs
-&gt; g ()
forall k (proxy :: (k -&gt; Constraint) -&gt; *) (c :: k -&gt; Constraint)
       (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *).
(All c xs, Applicative m) =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m ())
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m ())
-&gt; Telescope g f xs
-&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse_"><span class="hs-identifier hs-var">bihctraverse_</span></a></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006375"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">g x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; g ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621680006373"><span class="annot"><span class="annottext">htraverse_ :: (forall (a :: k). f a -&gt; g ()) -&gt; Telescope g f xs -&gt; g ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">htraverse_</span></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (x :: k). g x -&gt; g ())
-&gt; (forall (a :: k). f a -&gt; g ()) -&gt; Telescope g f xs -&gt; g ()
forall k (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *).
(SListI xs, Applicative m) =&gt;
(forall (x :: k). g x -&gt; m ())
-&gt; (forall (x :: k). f x -&gt; m ()) -&gt; Telescope g f xs -&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse_"><span class="hs-identifier hs-var">bihtraverse_</span></a></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">g x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; g ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span id="local-6989586621680006370"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HSequence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006370"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621680006364"><span class="annot"><span class="annottext">hsequence' :: Telescope g (f :.: g) xs -&gt; f (Telescope g g xs)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">hsequence'</span></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope (f :.: g) (f :.: g) xs -&gt; f (Telescope g g xs)
forall k (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
(SListI xs, Applicative m) =&gt;
Telescope (m :.: g) (m :.: f) xs -&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihsequence%27"><span class="hs-identifier hs-var">bihsequence'</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (f :.: g) (f :.: g) xs -&gt; f (Telescope g g xs))
-&gt; (Telescope g (f :.: g) xs -&gt; Telescope (f :.: g) (f :.: g) xs)
-&gt; Telescope g (f :.: g) xs
-&gt; f (Telescope g g xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall (x :: k). g x -&gt; (:.:) f g x)
-&gt; (forall (x :: k). (:.:) f g x -&gt; (:.:) f g x)
-&gt; Telescope g (f :.: g) xs
-&gt; Telescope (f :.: g) (f :.: g) xs
forall k (xs :: [k]) (g :: k -&gt; *) (g' :: k -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *).
SListI xs =&gt;
(forall (x :: k). g x -&gt; g' x)
-&gt; (forall (x :: k). f x -&gt; f' x)
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihmap"><span class="hs-identifier hs-var">bihmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (g x) -&gt; (:.:) f g x
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(f (g x) -&gt; (:.:) f g x) -&gt; (g x -&gt; f (g x)) -&gt; g x -&gt; (:.:) f g x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">g x -&gt; f (g x)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (x :: k). (:.:) f g x -&gt; (:.:) f g x
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621680006358"><span class="annot"><span class="annottext">hctraverse' :: proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g (f' a))
-&gt; Telescope g f xs
-&gt; g (Telescope g f' xs)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">hctraverse'</span></span></span><span> </span><span id="local-6989586621680006356"><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006356"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; g (g x))
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g (f' a))
-&gt; Telescope g f xs
-&gt; g (Telescope g f' xs)
forall k (proxy :: (k -&gt; Constraint) -&gt; *) (c :: k -&gt; Constraint)
       (m :: * -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (xs :: [k]).
(All c xs, Applicative m) =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m (g' x))
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse%27"><span class="hs-identifier hs-var">bihctraverse'</span></a></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006356"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; g x -&gt; g (g x)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621680006354"><span class="annot"><span class="annottext">htraverse' :: (forall (a :: k). f a -&gt; g (f' a))
-&gt; Telescope g f xs -&gt; g (Telescope g f' xs)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">htraverse'</span></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (x :: k). g x -&gt; g (g x))
-&gt; (forall (a :: k). f a -&gt; g (f' a))
-&gt; Telescope g f xs
-&gt; g (Telescope g f' xs)
forall k (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *)
       (f :: k -&gt; *) (f' :: k -&gt; *).
(SListI xs, Applicative m) =&gt;
(forall (x :: k). g x -&gt; m (g' x))
-&gt; (forall (x :: k). f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse%27"><span class="hs-identifier hs-var">bihtraverse'</span></a></span><span>    </span><span class="annot"><span class="annottext">forall (x :: k). g x -&gt; g (g x)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Specialization of 'hsequence'' with weaker constraints</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- ('Functor' rather than 'Applicative')</span><span>
</span><span id="line-134"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#sequence"><span class="hs-identifier hs-type">sequence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006351"><span class="annot"><a href="#local-6989586621680006351"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680006350"><span class="annot"><a href="#local-6989586621680006350"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006349"><span class="annot"><a href="#local-6989586621680006349"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006348"><span class="annot"><a href="#local-6989586621680006348"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621680006351"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-135"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006350"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006351"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680006349"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006348"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006351"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006350"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006349"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006348"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span id="sequence"><span class="annot"><span class="annottext">sequence :: Telescope g (m :.: f) xs -&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#sequence"><span class="hs-identifier hs-var hs-var">sequence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope g (m :.: f) xs -&gt; m (Telescope g f xs)
forall (xs' :: [k]).
Telescope g (m :.: f) xs' -&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006347"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621680007034"><span class="annot"><a href="#local-6989586621680006347"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006350"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006351"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680006349"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680007034"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006351"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006350"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006349"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007034"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621680006347"><span class="annot"><span class="annottext">go :: Telescope g (m :.: f) xs' -&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006347"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680006346"><span class="annot"><span class="annottext">m (f x)
</span><a href="#local-6989586621680006346"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; Telescope g f (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">(f x -&gt; Telescope g f (x : xs))
-&gt; m (f x) -&gt; m (Telescope g f (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (f x)
</span><a href="#local-6989586621680006346"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="#local-6989586621680006347"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006344"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006344"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006343"><span class="annot"><span class="annottext">Telescope g (m :.: f) xs
</span><a href="#local-6989586621680006343"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006344"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g f xs -&gt; Telescope g f (x : xs))
-&gt; m (Telescope g f xs) -&gt; m (Telescope g f (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Telescope g (m :.: f) xs -&gt; m (Telescope g f xs)
forall (xs' :: [k]).
Telescope g (m :.: f) xs' -&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006347"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g (m :.: f) xs
</span><a href="#local-6989586621680006343"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Bifunctor analogues of class methods
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Bifunctor analogue of 'hap'</span><span>
</span><span id="line-147"></span><span id="local-6989586621680006911"><span id="local-6989586621680006912"><span id="local-6989586621680006913"><span id="local-6989586621680006914"><span id="local-6989586621680006915"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier hs-type">bihap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006915"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006914"><span class="hs-identifier hs-type">g'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006913"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006912"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006911"><span class="hs-identifier hs-type">f'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006913"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006915"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006912"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006913"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006914"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006911"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006913"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span></span></span><span>
</span><span id="line-150"></span><span id="bihap"><span class="annot"><span class="annottext">bihap :: NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier hs-var hs-var">bihap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680006342"><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
</span><a href="#local-6989586621680006342"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span id="local-6989586621680006341"><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
</span><a href="#local-6989586621680006341"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621680006340"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006340"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
-&gt; NP (g -.-&gt; g') xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g' f' xs
forall k (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]) (g' :: k -&gt; *)
       (f' :: k -&gt; *).
Telescope g f xs
-&gt; NP (g -.-&gt; g') xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g' f' xs
</span><a href="#local-6989586621680006339"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006340"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
</span><a href="#local-6989586621680006342"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
</span><a href="#local-6989586621680006341"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621680007014"><span id="local-6989586621680007015"><span id="local-6989586621680007016"><span id="local-6989586621680007017"><span id="local-6989586621680007018"><span class="annot"><a href="#local-6989586621680006339"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007018"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007017"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007016"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-153"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007018"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680007015"><span class="hs-identifier hs-type">g'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680007016"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-154"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007017"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680007014"><span class="hs-identifier hs-type">f'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680007016"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-155"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007015"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007014"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007016"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span></span></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621680006339"><span class="annot"><span class="annottext">go :: Telescope g f xs
-&gt; NP (g -.-&gt; g') xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g' f' xs
</span><a href="#local-6989586621680006339"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006338"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006338"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621680006337"><span class="annot"><span class="annottext">(-.-&gt;) f f' x
</span><a href="#local-6989586621680006337"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f' x -&gt; Telescope g' f' (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f f' x -&gt; f x -&gt; f' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f f' x
</span><a href="#local-6989586621680006337"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006338"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621680006339"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006336"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006336"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006335"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006335"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006334"><span class="annot"><span class="annottext">(-.-&gt;) g g' x
</span><a href="#local-6989586621680006334"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006333"><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
</span><a href="#local-6989586621680006333"><span class="hs-identifier hs-var">gs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f f' x
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006332"><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
</span><a href="#local-6989586621680006332"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">g' x -&gt; Telescope g' f' xs -&gt; Telescope g' f' (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) g g' x -&gt; g x -&gt; g' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) g g' x
</span><a href="#local-6989586621680006334"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">g x
g x
</span><a href="#local-6989586621680006336"><span class="hs-identifier hs-var">gx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope g f xs
-&gt; NP (g -.-&gt; g') xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g' f' xs
forall k (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]) (g' :: k -&gt; *)
       (f' :: k -&gt; *).
Telescope g f xs
-&gt; NP (g -.-&gt; g') xs -&gt; NP (f -.-&gt; f') xs -&gt; Telescope g' f' xs
</span><a href="#local-6989586621680006339"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006335"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
NP (g -.-&gt; g') xs
</span><a href="#local-6989586621680006333"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; f') xs
NP (f -.-&gt; f') xs
</span><a href="#local-6989586621680006332"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Bifunctor analogue of 'hctraverse''</span><span>
</span><span id="line-160"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse%27"><span class="hs-identifier hs-type">bihctraverse'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007058"><span class="annot"><a href="#local-6989586621680007058"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span id="local-6989586621680007061"><span class="annot"><a href="#local-6989586621680007061"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span id="local-6989586621680007059"><span class="annot"><a href="#local-6989586621680007059"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680007057"><span class="annot"><a href="#local-6989586621680007057"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680007056"><span class="annot"><a href="#local-6989586621680007056"><span class="hs-identifier hs-type">g'</span></a></span></span><span> </span><span id="local-6989586621680007054"><span class="annot"><a href="#local-6989586621680007054"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680007053"><span class="annot"><a href="#local-6989586621680007053"><span class="hs-identifier hs-type">f'</span></a></span></span><span> </span><span id="local-6989586621680007060"><span class="annot"><a href="#local-6989586621680007060"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680007061"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007060"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621680007059"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007058"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007061"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-162"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007063"><span class="annot"><a href="#local-6989586621680007063"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007061"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007063"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007057"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007063"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007056"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007063"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007055"><span class="annot"><a href="#local-6989586621680007055"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007061"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007055"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007054"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007055"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007053"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007055"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007057"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007054"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007060"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007056"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007053"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007060"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span id="bihctraverse%27"><span class="annot"><span class="annottext">bihctraverse' :: proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m (g' x))
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse%27"><span class="hs-identifier hs-var hs-var">bihctraverse'</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006331"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; g x -&gt; m (g' x)
</span><a href="#local-6989586621680006331"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680006330"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; f x -&gt; m (f' x)
</span><a href="#local-6989586621680006330"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope g f xs -&gt; m (Telescope g' f' xs)
forall (xs' :: [k]).
All c xs' =&gt;
Telescope g f xs' -&gt; m (Telescope g' f' xs')
</span><a href="#local-6989586621680006329"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621680006988"><span class="annot"><a href="#local-6989586621680006329"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680007061"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006988"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007057"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007054"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006988"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007056"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007053"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006988"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621680006329"><span class="annot"><span class="annottext">go :: Telescope g f xs' -&gt; m (Telescope g' f' xs')
</span><a href="#local-6989586621680006329"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006328"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006328"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f' x -&gt; Telescope g' f' (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">(f' x -&gt; Telescope g' f' (x : xs))
-&gt; m (f' x) -&gt; m (Telescope g' f' (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f x -&gt; m (f' x)
forall (x :: k). c x =&gt; f x -&gt; m (f' x)
</span><a href="#local-6989586621680006330"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006328"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><a href="#local-6989586621680006329"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006327"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006327"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006326"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006326"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">g' x -&gt; Telescope g' f' xs -&gt; Telescope g' f' (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">(g' x -&gt; Telescope g' f' xs -&gt; Telescope g' f' (x : xs))
-&gt; m (g' x) -&gt; m (Telescope g' f' xs -&gt; Telescope g' f' (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">g x -&gt; m (g' x)
forall (x :: k). c x =&gt; g x -&gt; m (g' x)
</span><a href="#local-6989586621680006331"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006327"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">m (Telescope g' f' xs -&gt; Telescope g' f' (x : xs))
-&gt; m (Telescope g' f' xs) -&gt; m (Telescope g' f' (x : xs))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs -&gt; m (Telescope g' f' xs)
forall (xs' :: [k]).
All c xs' =&gt;
Telescope g f xs' -&gt; m (Telescope g' f' xs')
</span><a href="#local-6989586621680006329"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006326"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | Bifunctor analogue of 'htraverse''</span><span>
</span><span id="line-172"></span><span id="local-6989586621680007040"><span id="local-6989586621680007042"><span id="local-6989586621680007043"><span id="local-6989586621680007044"><span id="local-6989586621680007045"><span id="local-6989586621680007046"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse%27"><span class="hs-identifier hs-type">bihtraverse'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680007046"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621680007045"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007048"><span class="annot"><a href="#local-6989586621680007048"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007044"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007048"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007045"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007043"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007048"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007041"><span class="annot"><a href="#local-6989586621680007041"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007042"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007041"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007045"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007040"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007041"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007044"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007042"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007046"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007045"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007043"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007040"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007046"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-176"></span><span id="bihtraverse%27"><span class="annot"><span class="annottext">bihtraverse' :: (forall (x :: k). g x -&gt; m (g' x))
-&gt; (forall (x :: k). f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse%27"><span class="hs-identifier hs-var hs-var">bihtraverse'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy Top
-&gt; (forall (x :: k). Top x =&gt; g x -&gt; m (g' x))
-&gt; (forall (x :: k). Top x =&gt; f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
forall k (proxy :: (k -&gt; Constraint) -&gt; *) (c :: k -&gt; Constraint)
       (m :: * -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (xs :: [k]).
(All c xs, Applicative m) =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m (g' x))
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse%27"><span class="hs-identifier hs-var">bihctraverse'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy Top
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Top</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Bifunctor analogue of 'hsequence''</span><span>
</span><span id="line-179"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihsequence%27"><span class="hs-identifier hs-type">bihsequence'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007090"><span class="annot"><a href="#local-6989586621680007090"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680007089"><span class="annot"><a href="#local-6989586621680007089"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680007088"><span class="annot"><a href="#local-6989586621680007088"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680007091"><span class="annot"><a href="#local-6989586621680007091"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680007091"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621680007090"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007090"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680007089"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680007090"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680007088"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680007091"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007090"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007089"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007088"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007091"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span id="bihsequence%27"><span class="annot"><span class="annottext">bihsequence' :: Telescope (m :.: g) (m :.: f) xs -&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihsequence%27"><span class="hs-identifier hs-var hs-var">bihsequence'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (x :: k). (:.:) m g x -&gt; m (g x))
-&gt; (forall (x :: k). (:.:) m f x -&gt; m (f x))
-&gt; Telescope (m :.: g) (m :.: f) xs
-&gt; m (Telescope g f xs)
forall k (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *)
       (f :: k -&gt; *) (f' :: k -&gt; *).
(SListI xs, Applicative m) =&gt;
(forall (x :: k). g x -&gt; m (g' x))
-&gt; (forall (x :: k). f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse%27"><span class="hs-identifier hs-var">bihtraverse'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (x :: k). (:.:) m g x -&gt; m (g x)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">forall (x :: k). (:.:) m f x -&gt; m (f x)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Bifunctor analogue of 'hctraverse_'</span><span>
</span><span id="line-184"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse_"><span class="hs-identifier hs-type">bihctraverse_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007136"><span class="annot"><a href="#local-6989586621680007136"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span id="local-6989586621680007140"><span class="annot"><a href="#local-6989586621680007140"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span id="local-6989586621680007139"><span class="annot"><a href="#local-6989586621680007139"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span id="local-6989586621680007137"><span class="annot"><a href="#local-6989586621680007137"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680007135"><span class="annot"><a href="#local-6989586621680007135"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680007133"><span class="annot"><a href="#local-6989586621680007133"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680007140"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007139"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621680007137"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007136"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007140"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-186"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007142"><span class="annot"><a href="#local-6989586621680007142"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007140"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007142"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007135"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007142"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007137"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007134"><span class="annot"><a href="#local-6989586621680007134"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007140"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007134"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007133"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007134"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007137"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007135"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007133"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007139"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007137"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span id="bihctraverse_"><span class="annot"><span class="annottext">bihctraverse_ :: proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m ())
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m ())
-&gt; Telescope g f xs
-&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse_"><span class="hs-identifier hs-var hs-var">bihctraverse_</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006323"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; g x -&gt; m ()
</span><a href="#local-6989586621680006323"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680006322"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; f x -&gt; m ()
</span><a href="#local-6989586621680006322"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope g f xs -&gt; m ()
forall (xs' :: [k]). All c xs' =&gt; Telescope g f xs' -&gt; m ()
</span><a href="#local-6989586621680006321"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621680006952"><span class="annot"><a href="#local-6989586621680006321"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680007140"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006952"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007135"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007133"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006952"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007137"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621680006321"><span class="annot"><span class="annottext">go :: Telescope g f xs' -&gt; m ()
</span><a href="#local-6989586621680006321"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006320"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006320"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; m ()
forall (x :: k). c x =&gt; f x -&gt; m ()
</span><a href="#local-6989586621680006322"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006320"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><a href="#local-6989586621680006321"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006319"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006319"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006318"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006318"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">g x -&gt; m ()
forall (x :: k). c x =&gt; g x -&gt; m ()
</span><a href="#local-6989586621680006323"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006319"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs -&gt; m ()
forall (xs' :: [k]). All c xs' =&gt; Telescope g f xs' -&gt; m ()
</span><a href="#local-6989586621680006321"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006318"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span id="local-6989586621680007120"><span id="local-6989586621680007121"><span id="local-6989586621680007122"><span id="local-6989586621680007124"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse_"><span class="hs-identifier hs-type">bihtraverse_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680007124"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621680007122"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007126"><span class="annot"><a href="#local-6989586621680007126"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007121"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007126"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007122"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007119"><span class="annot"><a href="#local-6989586621680007119"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007120"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007119"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007122"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007121"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007120"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007124"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007122"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-199"></span><span id="bihtraverse_"><span class="annot"><span class="annottext">bihtraverse_ :: (forall (x :: k). g x -&gt; m ())
-&gt; (forall (x :: k). f x -&gt; m ()) -&gt; Telescope g f xs -&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse_"><span class="hs-identifier hs-var hs-var">bihtraverse_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy Top
-&gt; (forall (x :: k). Top x =&gt; g x -&gt; m ())
-&gt; (forall (x :: k). Top x =&gt; f x -&gt; m ())
-&gt; Telescope g f xs
-&gt; m ()
forall k (proxy :: (k -&gt; Constraint) -&gt; *) (c :: k -&gt; Constraint)
       (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *).
(All c xs, Applicative m) =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m ())
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m ())
-&gt; Telescope g f xs
-&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse_"><span class="hs-identifier hs-var">bihctraverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy Top
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Top</span></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Bifunctor analogues of derived functions
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Bifunctor analogue of 'hmap'</span><span>
</span><span id="line-206"></span><span id="local-6989586621680007077"><span id="local-6989586621680007078"><span id="local-6989586621680007079"><span id="local-6989586621680007080"><span id="local-6989586621680007081"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihmap"><span class="hs-identifier hs-type">bihmap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680007081"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-207"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007084"><span class="annot"><a href="#local-6989586621680007084"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007080"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007084"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007079"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007084"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680007083"><span class="annot"><a href="#local-6989586621680007083"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680007078"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007083"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680007077"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007083"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007080"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007078"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007081"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007079"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007077"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680007081"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span></span></span><span>
</span><span id="line-210"></span><span id="bihmap"><span class="annot"><span class="annottext">bihmap :: (forall (x :: k). g x -&gt; g' x)
-&gt; (forall (x :: k). f x -&gt; f' x)
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihmap"><span class="hs-identifier hs-var hs-var">bihmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy Top
-&gt; (forall (x :: k). Top x =&gt; g x -&gt; g' x)
-&gt; (forall (x :: k). Top x =&gt; f x -&gt; f' x)
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
forall k (c :: k -&gt; Constraint) (xs :: [k])
       (proxy :: (k -&gt; Constraint) -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *)
       (f :: k -&gt; *) (f' :: k -&gt; *).
All c xs =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; g' x)
-&gt; (forall (x :: k). c x =&gt; f x -&gt; f' x)
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihcmap"><span class="hs-identifier hs-var">bihcmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy Top
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Top</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | Bifunctor analogue of 'hcmap'</span><span>
</span><span id="line-213"></span><span id="local-6989586621680006925"><span id="local-6989586621680006926"><span id="local-6989586621680006927"><span id="local-6989586621680006928"><span id="local-6989586621680006929"><span id="local-6989586621680006930"><span id="local-6989586621680006931"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihcmap"><span class="hs-identifier hs-type">bihcmap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680006931"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006930"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006929"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006931"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006934"><span class="annot"><a href="#local-6989586621680006934"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680006931"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006934"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006928"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006934"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006927"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006934"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006933"><span class="annot"><a href="#local-6989586621680006933"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680006931"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006933"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006926"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006933"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006925"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006933"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006928"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006926"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006930"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006927"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006925"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006930"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-218"></span><span id="bihcmap"><span class="annot"><span class="annottext">bihcmap :: proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; g' x)
-&gt; (forall (x :: k). c x =&gt; f x -&gt; f' x)
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihcmap"><span class="hs-identifier hs-var hs-var">bihcmap</span></a></span></span><span> </span><span id="local-6989586621680006316"><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006316"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680006315"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; g x -&gt; g' x
</span><a href="#local-6989586621680006315"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680006314"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; f x -&gt; f' x
</span><a href="#local-6989586621680006314"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
forall k (g :: k -&gt; *) (g' :: k -&gt; *) (xs :: [k]) (f :: k -&gt; *)
       (f' :: k -&gt; *).
NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier hs-var">bihap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (a :: k). c a =&gt; (-.-&gt;) g g' a) -&gt; NP (g -.-&gt; g') xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *).
(HPure h, AllN h c xs) =&gt;
proxy c -&gt; (forall (a :: k). c a =&gt; f a) -&gt; h f xs
</span><span class="hs-identifier hs-var">hcpure</span></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006316"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g a -&gt; g' a) -&gt; (-.-&gt;) g g' a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">g a -&gt; g' a
forall (x :: k). c x =&gt; g x -&gt; g' x
</span><a href="#local-6989586621680006315"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (a :: k). c a =&gt; (-.-&gt;) f f' a) -&gt; NP (f -.-&gt; f') xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *).
(HPure h, AllN h c xs) =&gt;
proxy c -&gt; (forall (a :: k). c a =&gt; f a) -&gt; h f xs
</span><span class="hs-identifier hs-var">hcpure</span></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006316"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">f a -&gt; f' a
forall (x :: k). c x =&gt; f x -&gt; f' x
</span><a href="#local-6989586621680006314"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Bifunctor equivalent of 'hzipWith'</span><span>
</span><span id="line-221"></span><span id="local-6989586621680006306"><span id="local-6989586621680006307"><span id="local-6989586621680006308"><span id="local-6989586621680006309"><span id="local-6989586621680006310"><span id="local-6989586621680006311"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihzipWith"><span class="hs-identifier hs-type">bihzipWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680006311"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-222"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006894"><span class="annot"><a href="#local-6989586621680006894"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680006310"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006894"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006309"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006894"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006308"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006894"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006891"><span class="annot"><a href="#local-6989586621680006891"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680006310"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006891"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006307"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006891"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006306"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006891"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006310"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006311"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006309"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006307"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006311"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006308"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006306"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006311"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-225"></span><span id="bihzipWith"><span class="annot"><span class="annottext">bihzipWith :: (forall (x :: k). h x -&gt; g x -&gt; g' x)
-&gt; (forall (x :: k). h x -&gt; f x -&gt; f' x)
-&gt; NP h xs
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihzipWith"><span class="hs-identifier hs-var hs-var">bihzipWith</span></a></span></span><span> </span><span id="local-6989586621680006305"><span class="annot"><span class="annottext">forall (x :: k). h x -&gt; g x -&gt; g' x
</span><a href="#local-6989586621680006305"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680006304"><span class="annot"><span class="annottext">forall (x :: k). h x -&gt; f x -&gt; f' x
</span><a href="#local-6989586621680006304"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680006303"><span class="annot"><span class="annottext">NP h xs
</span><a href="#local-6989586621680006303"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
forall k (g :: k -&gt; *) (g' :: k -&gt; *) (xs :: [k]) (f :: k -&gt; *)
       (f' :: k -&gt; *).
NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier hs-var">bihap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (a :: k). h a -&gt; (-.-&gt;) g g' a)
-&gt; NP h xs -&gt; NP (g -.-&gt; g') xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g a -&gt; g' a) -&gt; (-.-&gt;) g g' a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">((g a -&gt; g' a) -&gt; (-.-&gt;) g g' a)
-&gt; (h a -&gt; g a -&gt; g' a) -&gt; h a -&gt; (-.-&gt;) g g' a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">h a -&gt; g a -&gt; g' a
forall (x :: k). h x -&gt; g x -&gt; g' x
</span><a href="#local-6989586621680006305"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP h xs
</span><a href="#local-6989586621680006303"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (a :: k). h a -&gt; (-.-&gt;) f f' a)
-&gt; NP h xs -&gt; NP (f -.-&gt; f') xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">((f a -&gt; f' a) -&gt; (-.-&gt;) f f' a)
-&gt; (h a -&gt; f a -&gt; f' a) -&gt; h a -&gt; (-.-&gt;) f f' a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">h a -&gt; f a -&gt; f' a
forall (x :: k). h x -&gt; f x -&gt; f' x
</span><a href="#local-6989586621680006304"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP h xs
</span><a href="#local-6989586621680006303"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- | Bifunctor equivalent of 'hczipWith'</span><span>
</span><span id="line-228"></span><span id="local-6989586621680006294"><span id="local-6989586621680006295"><span id="local-6989586621680006296"><span id="local-6989586621680006297"><span id="local-6989586621680006298"><span id="local-6989586621680006299"><span id="local-6989586621680006300"><span id="local-6989586621680006301"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihczipWith"><span class="hs-identifier hs-type">bihczipWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680006301"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006300"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006299"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006301"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006875"><span class="annot"><a href="#local-6989586621680006875"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680006301"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006875"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006298"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006875"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006297"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006875"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006296"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006875"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006871"><span class="annot"><a href="#local-6989586621680006871"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680006301"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006871"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006298"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006871"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006295"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006871"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006294"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006871"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006298"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006300"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006297"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006295"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006300"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006296"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006294"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006300"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-233"></span><span id="bihczipWith"><span class="annot"><span class="annottext">bihczipWith :: proxy c
-&gt; (forall (x :: k). c x =&gt; h x -&gt; g x -&gt; g' x)
-&gt; (forall (x :: k). c x =&gt; h x -&gt; f x -&gt; f' x)
-&gt; NP h xs
-&gt; Telescope g f xs
-&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihczipWith"><span class="hs-identifier hs-var hs-var">bihczipWith</span></a></span></span><span> </span><span id="local-6989586621680006293"><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006293"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680006292"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; h x -&gt; g x -&gt; g' x
</span><a href="#local-6989586621680006292"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680006291"><span class="annot"><span class="annottext">forall (x :: k). c x =&gt; h x -&gt; f x -&gt; f' x
</span><a href="#local-6989586621680006291"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680006290"><span class="annot"><span class="annottext">NP h xs
</span><a href="#local-6989586621680006290"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
forall k (g :: k -&gt; *) (g' :: k -&gt; *) (xs :: [k]) (f :: k -&gt; *)
       (f' :: k -&gt; *).
NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier hs-var">bihap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (a :: k). c a =&gt; h a -&gt; (-.-&gt;) g g' a)
-&gt; NP h xs
-&gt; NP (g -.-&gt; g') xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hcmap</span></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006293"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g a -&gt; g' a) -&gt; (-.-&gt;) g g' a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">((g a -&gt; g' a) -&gt; (-.-&gt;) g g' a)
-&gt; (h a -&gt; g a -&gt; g' a) -&gt; h a -&gt; (-.-&gt;) g g' a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">h a -&gt; g a -&gt; g' a
forall (x :: k). c x =&gt; h x -&gt; g x -&gt; g' x
</span><a href="#local-6989586621680006292"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP h xs
</span><a href="#local-6989586621680006290"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (a :: k). c a =&gt; h a -&gt; (-.-&gt;) f f' a)
-&gt; NP h xs
-&gt; NP (f -.-&gt; f') xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hcmap</span></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006293"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">((f a -&gt; f' a) -&gt; (-.-&gt;) f f' a)
-&gt; (h a -&gt; f a -&gt; f' a) -&gt; h a -&gt; (-.-&gt;) f f' a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">h a -&gt; f a -&gt; f' a
forall (x :: k). c x =&gt; h x -&gt; f x -&gt; f' x
</span><a href="#local-6989586621680006291"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP h xs
</span><a href="#local-6989586621680006290"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Simple telescope

  This is an internal type that is useful primarily useful as a sanity check
  of our bifunctor generalizations.
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | 'Telescope' with both functors set to the same @f@</span><span>
</span><span id="line-243"></span><span class="hs-keyword">newtype</span><span> </span><span id="SimpleTelescope"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-var">SimpleTelescope</span></a></span></span><span> </span><span id="local-6989586621680006847"><span class="annot"><a href="#local-6989586621680006847"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006846"><span class="annot"><a href="#local-6989586621680006846"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SimpleTelescope"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-var">SimpleTelescope</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-244"></span><span>      </span><span id="getSimpleTelescope"><span class="annot"><span class="annottext">SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006847"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006847"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006846"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Prod"><span class="annot"><span class="hs-identifier hs-var">Prod</span></span></span><span>       </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span>
</span><span id="line-248"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="SListIN"><span class="annot"><span class="hs-identifier hs-var">SListIN</span></span></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span>
</span><span id="line-249"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="AllN"><span class="annot"><span class="hs-identifier hs-var">AllN</span></span></span><span>       </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span id="local-6989586621680006286"><span class="annot"><a href="#local-6989586621680006286"><span class="hs-identifier hs-type hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="#local-6989586621680006286"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-250"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="CollapseTo"><span class="annot"><span class="hs-identifier hs-var">CollapseTo</span></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span id="local-6989586621680006285"><span class="annot"><a href="#local-6989586621680006285"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680006285"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HAp</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>  </span><span id="local-6989586621680006281"><span class="annot"><span class="annottext">hap :: Prod SimpleTelescope (f -.-&gt; g) xs
-&gt; SimpleTelescope f xs -&gt; SimpleTelescope g xs
</span><a href="#local-6989586621680006281"><span class="hs-identifier hs-var hs-var hs-var hs-var">hap</span></a></span></span><span> </span><span id="local-6989586621680006280"><span class="annot"><span class="annottext">Prod SimpleTelescope (f -.-&gt; g) xs
</span><a href="#local-6989586621680006280"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope g g xs -&gt; SimpleTelescope g xs
forall k (f :: k -&gt; *) (xs :: [k]).
Telescope f f xs -&gt; SimpleTelescope f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-var">SimpleTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g g xs -&gt; SimpleTelescope g xs)
-&gt; (SimpleTelescope f xs -&gt; Telescope g g xs)
-&gt; SimpleTelescope f xs
-&gt; SimpleTelescope g xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; g) xs
-&gt; NP (f -.-&gt; g) xs -&gt; Telescope f f xs -&gt; Telescope g g xs
forall k (g :: k -&gt; *) (g' :: k -&gt; *) (xs :: [k]) (f :: k -&gt; *)
       (f' :: k -&gt; *).
NP (g -.-&gt; g') xs
-&gt; NP (f -.-&gt; f') xs -&gt; Telescope g f xs -&gt; Telescope g' f' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihap"><span class="hs-identifier hs-var">bihap</span></a></span><span> </span><span class="annot"><span class="annottext">Prod SimpleTelescope (f -.-&gt; g) xs
NP (f -.-&gt; g) xs
</span><a href="#local-6989586621680006280"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Prod SimpleTelescope (f -.-&gt; g) xs
NP (f -.-&gt; g) xs
</span><a href="#local-6989586621680006280"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope f f xs -&gt; Telescope g g xs)
-&gt; (SimpleTelescope f xs -&gt; Telescope f f xs)
-&gt; SimpleTelescope f xs
-&gt; Telescope g g xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleTelescope f xs -&gt; Telescope f f xs
forall k (f :: k -&gt; *) (xs :: [k]).
SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTraverse_</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621680006277"><span class="annot"><span class="annottext">hctraverse_ :: proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g ())
-&gt; SimpleTelescope f xs
-&gt; g ()
</span><a href="#local-6989586621680006277"><span class="hs-identifier hs-var hs-var hs-var hs-var">hctraverse_</span></a></span></span><span> </span><span id="local-6989586621680006276"><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006276"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680006275"><span class="annot"><span class="annottext">forall (a :: k). c a =&gt; f a -&gt; g ()
</span><a href="#local-6989586621680006275"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g ())
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g ())
-&gt; Telescope f f xs
-&gt; g ()
forall k (proxy :: (k -&gt; Constraint) -&gt; *) (c :: k -&gt; Constraint)
       (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *).
(All c xs, Applicative m) =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m ())
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m ())
-&gt; Telescope g f xs
-&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse_"><span class="hs-identifier hs-var">bihctraverse_</span></a></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006276"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: k). c a =&gt; f a -&gt; g ()
</span><a href="#local-6989586621680006275"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: k). c a =&gt; f a -&gt; g ()
</span><a href="#local-6989586621680006275"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope f f xs -&gt; g ())
-&gt; (SimpleTelescope f xs -&gt; Telescope f f xs)
-&gt; SimpleTelescope f xs
-&gt; g ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleTelescope f xs -&gt; Telescope f f xs
forall k (f :: k -&gt; *) (xs :: [k]).
SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621680006274"><span class="annot"><span class="annottext">htraverse_ :: (forall (a :: k). f a -&gt; g ()) -&gt; SimpleTelescope f xs -&gt; g ()
</span><a href="#local-6989586621680006274"><span class="hs-identifier hs-var hs-var hs-var hs-var">htraverse_</span></a></span></span><span>    </span><span id="local-6989586621680006273"><span class="annot"><span class="annottext">forall (a :: k). f a -&gt; g ()
</span><a href="#local-6989586621680006273"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (a :: k). f a -&gt; g ())
-&gt; (forall (a :: k). f a -&gt; g ()) -&gt; Telescope f f xs -&gt; g ()
forall k (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *).
(SListI xs, Applicative m) =&gt;
(forall (x :: k). g x -&gt; m ())
-&gt; (forall (x :: k). f x -&gt; m ()) -&gt; Telescope g f xs -&gt; m ()
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse_"><span class="hs-identifier hs-var">bihtraverse_</span></a></span><span>    </span><span class="annot"><span class="annottext">forall (a :: k). f a -&gt; g ()
</span><a href="#local-6989586621680006273"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: k). f a -&gt; g ()
</span><a href="#local-6989586621680006273"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope f f xs -&gt; g ())
-&gt; (SimpleTelescope f xs -&gt; Telescope f f xs)
-&gt; SimpleTelescope f xs
-&gt; g ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleTelescope f xs -&gt; Telescope f f xs
forall k (f :: k -&gt; *) (xs :: [k]).
SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HSequence</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>  </span><span id="local-6989586621680006268"><span class="annot"><span class="annottext">hsequence' :: SimpleTelescope (f :.: g) xs -&gt; f (SimpleTelescope g xs)
</span><a href="#local-6989586621680006268"><span class="hs-identifier hs-var hs-var hs-var hs-var">hsequence'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Telescope g g xs -&gt; SimpleTelescope g xs)
-&gt; f (Telescope g g xs) -&gt; f (SimpleTelescope g xs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Telescope g g xs -&gt; SimpleTelescope g xs
forall k (f :: k -&gt; *) (xs :: [k]).
Telescope f f xs -&gt; SimpleTelescope f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-var">SimpleTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Telescope g g xs) -&gt; f (SimpleTelescope g xs))
-&gt; (SimpleTelescope (f :.: g) xs -&gt; f (Telescope g g xs))
-&gt; SimpleTelescope (f :.: g) xs
-&gt; f (SimpleTelescope g xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Telescope (f :.: g) (f :.: g) xs -&gt; f (Telescope g g xs)
forall k (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
(SListI xs, Applicative m) =&gt;
Telescope (m :.: g) (m :.: f) xs -&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihsequence%27"><span class="hs-identifier hs-var">bihsequence'</span></a></span><span>        </span><span class="annot"><span class="annottext">(Telescope (f :.: g) (f :.: g) xs -&gt; f (Telescope g g xs))
-&gt; (SimpleTelescope (f :.: g) xs
    -&gt; Telescope (f :.: g) (f :.: g) xs)
-&gt; SimpleTelescope (f :.: g) xs
-&gt; f (Telescope g g xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleTelescope (f :.: g) xs -&gt; Telescope (f :.: g) (f :.: g) xs
forall k (f :: k -&gt; *) (xs :: [k]).
SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621680006267"><span class="annot"><span class="annottext">hctraverse' :: proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g (f' a))
-&gt; SimpleTelescope f xs
-&gt; g (SimpleTelescope f' xs)
</span><a href="#local-6989586621680006267"><span class="hs-identifier hs-var hs-var hs-var hs-var">hctraverse'</span></a></span></span><span> </span><span id="local-6989586621680006266"><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006266"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680006265"><span class="annot"><span class="annottext">forall (a :: k). c a =&gt; f a -&gt; g (f' a)
</span><a href="#local-6989586621680006265"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Telescope f' f' xs -&gt; SimpleTelescope f' xs)
-&gt; g (Telescope f' f' xs) -&gt; g (SimpleTelescope f' xs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Telescope f' f' xs -&gt; SimpleTelescope f' xs
forall k (f :: k -&gt; *) (xs :: [k]).
Telescope f f xs -&gt; SimpleTelescope f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-var">SimpleTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Telescope f' f' xs) -&gt; g (SimpleTelescope f' xs))
-&gt; (SimpleTelescope f xs -&gt; g (Telescope f' f' xs))
-&gt; SimpleTelescope f xs
-&gt; g (SimpleTelescope f' xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g (f' a))
-&gt; (forall (a :: k). c a =&gt; f a -&gt; g (f' a))
-&gt; Telescope f f xs
-&gt; g (Telescope f' f' xs)
forall k (proxy :: (k -&gt; Constraint) -&gt; *) (c :: k -&gt; Constraint)
       (m :: * -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (xs :: [k]).
(All c xs, Applicative m) =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; g x -&gt; m (g' x))
-&gt; (forall (x :: k). c x =&gt; f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihctraverse%27"><span class="hs-identifier hs-var">bihctraverse'</span></a></span><span> </span><span class="annot"><span class="annottext">proxy c
</span><a href="#local-6989586621680006266"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: k). c a =&gt; f a -&gt; g (f' a)
</span><a href="#local-6989586621680006265"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: k). c a =&gt; f a -&gt; g (f' a)
</span><a href="#local-6989586621680006265"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope f f xs -&gt; g (Telescope f' f' xs))
-&gt; (SimpleTelescope f xs -&gt; Telescope f f xs)
-&gt; SimpleTelescope f xs
-&gt; g (Telescope f' f' xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleTelescope f xs -&gt; Telescope f f xs
forall k (f :: k -&gt; *) (xs :: [k]).
SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span id="local-6989586621680006264"><span class="annot"><span class="annottext">htraverse' :: (forall (a :: k). f a -&gt; g (f' a))
-&gt; SimpleTelescope f xs -&gt; g (SimpleTelescope f' xs)
</span><a href="#local-6989586621680006264"><span class="hs-identifier hs-var hs-var hs-var hs-var">htraverse'</span></a></span></span><span>    </span><span id="local-6989586621680006263"><span class="annot"><span class="annottext">forall (a :: k). f a -&gt; g (f' a)
</span><a href="#local-6989586621680006263"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Telescope f' f' xs -&gt; SimpleTelescope f' xs)
-&gt; g (Telescope f' f' xs) -&gt; g (SimpleTelescope f' xs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Telescope f' f' xs -&gt; SimpleTelescope f' xs
forall k (f :: k -&gt; *) (xs :: [k]).
Telescope f f xs -&gt; SimpleTelescope f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-var">SimpleTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Telescope f' f' xs) -&gt; g (SimpleTelescope f' xs))
-&gt; (SimpleTelescope f xs -&gt; g (Telescope f' f' xs))
-&gt; SimpleTelescope f xs
-&gt; g (SimpleTelescope f' xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall (a :: k). f a -&gt; g (f' a))
-&gt; (forall (a :: k). f a -&gt; g (f' a))
-&gt; Telescope f f xs
-&gt; g (Telescope f' f' xs)
forall k (xs :: [k]) (m :: * -&gt; *) (g :: k -&gt; *) (g' :: k -&gt; *)
       (f :: k -&gt; *) (f' :: k -&gt; *).
(SListI xs, Applicative m) =&gt;
(forall (x :: k). g x -&gt; m (g' x))
-&gt; (forall (x :: k). f x -&gt; m (f' x))
-&gt; Telescope g f xs
-&gt; m (Telescope g' f' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#bihtraverse%27"><span class="hs-identifier hs-var">bihtraverse'</span></a></span><span>    </span><span class="annot"><span class="annottext">forall (a :: k). f a -&gt; g (f' a)
</span><a href="#local-6989586621680006263"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: k). f a -&gt; g (f' a)
</span><a href="#local-6989586621680006263"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope f f xs -&gt; g (Telescope f' f' xs))
-&gt; (SimpleTelescope f xs -&gt; Telescope f f xs)
-&gt; SimpleTelescope f xs
-&gt; g (Telescope f' f' xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleTelescope f xs -&gt; Telescope f f xs
forall k (f :: k -&gt; *) (xs :: [k]).
SimpleTelescope f xs -&gt; Telescope f f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getSimpleTelescope"><span class="hs-identifier hs-var hs-var">getSimpleTelescope</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HCollapse</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>  </span><span id="local-6989586621680006260"><span class="annot"><span class="annottext">hcollapse :: SimpleTelescope (K a) xs -&gt; CollapseTo SimpleTelescope a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">hcollapse</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#SimpleTelescope"><span class="hs-identifier hs-type">SimpleTelescope</span></a></span><span> </span><span id="local-6989586621680006258"><span class="annot"><span class="annottext">Telescope (K a) (K a) xs
</span><a href="#local-6989586621680006258"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope (K a) (K a) xs -&gt; [a]
forall k a (xs :: [k]). Telescope (K a) (K a) xs -&gt; [a]
</span><a href="#local-6989586621680006257"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K a) (K a) xs
</span><a href="#local-6989586621680006258"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>      </span><span id="local-6989586621680006806"><span id="local-6989586621680006807"><span class="annot"><a href="#local-6989586621680006257"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="#local-6989586621680006807"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="#local-6989586621680006807"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006806"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680006807"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-268"></span><span>      </span><span id="local-6989586621680006257"><span class="annot"><span class="annottext">go :: Telescope (K a) (K a) xs -&gt; [a]
</span><a href="#local-6989586621680006257"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span id="local-6989586621680006255"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680006255"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680006255"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><a href="#local-6989586621680006257"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span id="local-6989586621680006254"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680006254"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680006253"><span class="annot"><span class="annottext">Telescope (K a) (K a) xs
</span><a href="#local-6989586621680006253"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680006254"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Telescope (K a) (K a) xs -&gt; [a]
forall k a (xs :: [k]). Telescope (K a) (K a) xs -&gt; [a]
</span><a href="#local-6989586621680006257"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K a) (K a) xs
</span><a href="#local-6989586621680006253"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Utilities
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span id="local-6989586621680006778"><span id="local-6989586621680006779"><span id="local-6989586621680006780"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-type">tip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006780"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006779"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006778"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006779"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006778"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span><span>
</span><span id="line-276"></span><span id="tip"><span class="annot"><span class="annottext">tip :: Telescope g f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-var hs-var">tip</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span>   </span><span id="local-6989586621680006252"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006252"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; NS f (x : xs)
forall a (f :: a -&gt; *) (x :: a) (xs :: [a]). f x -&gt; NS f (x : xs)
</span><a href="Data.SOP.Strict.html#Z"><span class="hs-identifier hs-var">Z</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006252"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-277"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006250"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006250"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NS f xs -&gt; NS f (x : xs)
forall a (f :: a -&gt; *) (xs :: [a]) (x :: a).
NS f xs -&gt; NS f (x : xs)
</span><a href="Data.SOP.Strict.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope g f xs -&gt; NS f xs
forall k (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
Telescope g f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006250"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span id="local-6989586621680006765"><span id="local-6989586621680006766"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTip"><span class="hs-identifier hs-type">fromTip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006766"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006765"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006766"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006765"><span class="hs-identifier hs-type">xs</span></a></span></span></span><span>
</span><span id="line-280"></span><span id="fromTip"><span class="annot"><span class="annottext">fromTip :: NS f xs -&gt; Telescope (K ()) f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTip"><span class="hs-identifier hs-var hs-var">fromTip</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#Z"><span class="hs-identifier hs-type">Z</span></a></span><span> </span><span id="local-6989586621680006248"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006248"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; Telescope (K ()) f (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006248"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-281"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTip"><span class="hs-identifier hs-var">fromTip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621680006247"><span class="annot"><span class="annottext">NS f xs
</span><a href="#local-6989586621680006247"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">K () x -&gt; Telescope (K ()) f xs -&gt; Telescope (K ()) f (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; K () x
forall k a (b :: k). a -&gt; K a b
</span><span class="hs-identifier hs-var">K</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NS f xs -&gt; Telescope (K ()) f xs
forall k (f :: k -&gt; *) (xs :: [k]).
NS f xs -&gt; Telescope (K ()) f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTip"><span class="hs-identifier hs-var">fromTip</span></a></span><span> </span><span class="annot"><span class="annottext">NS f xs
</span><a href="#local-6989586621680006247"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span id="local-6989586621680006245"><span id="local-6989586621680006246"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#toAtMost"><span class="hs-identifier hs-type">toAtMost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="#local-6989586621680006246"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680006246"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006245"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#AtMost"><span class="hs-identifier hs-type">AtMost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006245"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006246"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-284"></span><span id="toAtMost"><span class="annot"><span class="annottext">toAtMost :: Telescope (K a) (K (Maybe a)) xs -&gt; AtMost xs a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#toAtMost"><span class="hs-identifier hs-var hs-var">toAtMost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope (K a) (K (Maybe a)) xs -&gt; AtMost xs a
forall a (xs :: [*]).
Telescope (K a) (K (Maybe a)) xs -&gt; AtMost xs a
</span><a href="#local-6989586621680006244"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621680006760"><span id="local-6989586621680006761"><span class="annot"><a href="#local-6989586621680006244"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="#local-6989586621680006761"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680006761"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006760"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#AtMost"><span class="hs-identifier hs-type">AtMost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006760"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006761"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621680006244"><span class="annot"><span class="annottext">go :: Telescope (K a) (K (Maybe a)) xs -&gt; AtMost xs a
</span><a href="#local-6989586621680006244"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span id="local-6989586621680006243"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621680006243"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AtMost (x : xs) a
-&gt; (a -&gt; AtMost (x : xs) a) -&gt; Maybe a -&gt; AtMost (x : xs) a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">AtMost (x : xs) a
forall (xs :: [*]) a. AtMost xs a
</span><a href="Ouroboros.Consensus.Util.Counting.html#AtMostNil"><span class="hs-identifier hs-var">AtMostNil</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; AtMost (x : xs) a
forall a x (xs :: [*]). a -&gt; AtMost (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#atMostOne"><span class="hs-identifier hs-var">atMostOne</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621680006243"><span class="hs-identifier hs-var">ma</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="#local-6989586621680006244"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span id="local-6989586621680006239"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680006239"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680006238"><span class="annot"><span class="annottext">Telescope (K a) (K (Maybe a)) xs
</span><a href="#local-6989586621680006238"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; AtMost xs a -&gt; AtMost (x : xs) a
forall a (xs :: [*]) x. a -&gt; AtMost xs a -&gt; AtMost (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#AtMostCons"><span class="hs-identifier hs-var">AtMostCons</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680006239"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope (K a) (K (Maybe a)) xs -&gt; AtMost xs a
forall a (xs :: [*]).
Telescope (K a) (K (Maybe a)) xs -&gt; AtMost xs a
</span><a href="#local-6989586621680006244"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K a) (K (Maybe a)) xs
</span><a href="#local-6989586621680006238"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span id="local-6989586621680006234"><span id="local-6989586621680006235"><span id="local-6989586621680006236"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTZ"><span class="hs-identifier hs-type">fromTZ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006236"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006235"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680006234"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006235"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006234"><span class="hs-identifier hs-type">x</span></a></span></span></span></span><span>
</span><span id="line-291"></span><span id="fromTZ"><span class="annot"><span class="annottext">fromTZ :: Telescope g f '[x] -&gt; f x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTZ"><span class="hs-identifier hs-var hs-var">fromTZ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006233"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006233"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006233"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Extension and retraction
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">newtype</span><span> </span><span id="Extend"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-var">Extend</span></a></span></span><span> </span><span id="local-6989586621680006708"><span class="annot"><a href="#local-6989586621680006708"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680006707"><span class="annot"><a href="#local-6989586621680006707"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006706"><span class="annot"><a href="#local-6989586621680006706"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006705"><span class="annot"><a href="#local-6989586621680006705"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680006704"><span class="annot"><a href="#local-6989586621680006704"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Extend"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-var">Extend</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="extendWith"><span class="annot"><span class="annottext">Extend m g f x y -&gt; f x -&gt; m (g x, f y)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extendWith"><span class="hs-identifier hs-var hs-var">extendWith</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680006706"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006705"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006708"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006707"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006705"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680006706"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006704"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Extend the telescope</span><span>
</span><span id="line-300"></span><span class="hs-comment">--</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- We will not attempt to extend the telescope past its final segment.</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- Blockchain intuition: suppose we have a telescope containing the ledger</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- state. The &quot;how to extend&quot; argument would take, say, the final Byron</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- state to the initial Shelley state; and &quot;where to extend from&quot; argument</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- would indicate when we want to extend: when the current slot number has</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- gone past the end of the Byron era.</span><span>
</span><span id="line-308"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extend"><span class="hs-identifier hs-type">extend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006584"><span class="annot"><a href="#local-6989586621680006584"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680006583"><span class="annot"><a href="#local-6989586621680006583"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621680006582"><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006581"><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006580"><span class="annot"><a href="#local-6989586621680006580"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006584"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006583"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006584"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006580"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-comment">-- ^ How to extend</span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680006583"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006580"><span class="hs-identifier hs-type">xs</span></a></span><span>              </span><span class="hs-comment">-- ^ Where to extend /from/</span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006580"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006584"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006580"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span id="extend"><span class="annot"><span class="annottext">extend :: InPairs (Requiring h (Extend m g f)) xs
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extend"><span class="hs-identifier hs-var hs-var">extend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) xs
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall (xs' :: [k]).
InPairs (Requiring h (Extend m g f)) xs'
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006230"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621680006723"><span class="annot"><a href="#local-6989586621680006230"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006583"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006584"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006723"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-315"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680006583"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006723"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006723"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006584"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006582"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006581"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006723"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621680006230"><span class="annot"><span class="annottext">go :: InPairs (Requiring h (Extend m g f)) xs'
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006230"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) xs'
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#PNil"><span class="hs-identifier hs-var">PNil</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; (Maybe :.: h)) xs'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006228"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006228"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">Telescope g f '[x] -&gt; m (Telescope g f '[x])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Telescope g f '[x]
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006228"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621680006230"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#PCons"><span class="hs-identifier hs-type">PCons</span></a></span><span> </span><span id="local-6989586621680006226"><span class="annot"><span class="annottext">Requiring h (Extend m g f) x y
</span><a href="#local-6989586621680006226"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680006225"><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006225"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006224"><span class="annot"><span class="annottext">(-.-&gt;) f (Maybe :.: h) x
</span><a href="#local-6989586621680006224"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006223"><span class="annot"><span class="annottext">NP (f -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006223"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006222"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006222"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(:.:) Maybe h x -&gt; Maybe (h x)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">((:.:) Maybe h x -&gt; Maybe (h x)) -&gt; (:.:) Maybe h x -&gt; Maybe (h x)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f (Maybe :.: h) x -&gt; f x -&gt; (:.:) Maybe h x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f (Maybe :.: h) x
</span><a href="#local-6989586621680006224"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006222"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>          </span><span class="annot"><span class="annottext">Maybe (h x)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>            </span><span class="annot"><span class="annottext">Telescope g f (x : y : zs) -&gt; m (Telescope g f (x : y : zs))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Telescope g f (x : y : zs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006222"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680006221"><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680006221"><span class="hs-identifier hs-var">hx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680006220"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006220"><span class="hs-identifier hs-var">gx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680006219"><span class="annot"><span class="annottext">f y
</span><a href="#local-6989586621680006219"><span class="hs-identifier hs-var">fy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extend m g f x y -&gt; f x -&gt; m (g x, f y)
forall (m :: * -&gt; *) k (g :: k -&gt; *) (f :: k -&gt; *) (x :: k)
       (y :: k).
Extend m g f x y -&gt; f x -&gt; m (g x, f y)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extendWith"><span class="hs-identifier hs-var hs-var">extendWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Requiring h (Extend m g f) x y -&gt; h x -&gt; Extend m g f x y
forall k1 (h :: k1 -&gt; *) k2 (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
Requiring h f x y -&gt; h x -&gt; f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#provide"><span class="hs-identifier hs-var hs-var">provide</span></a></span><span> </span><span class="annot"><span class="annottext">Requiring h (Extend m g f) x y
</span><a href="#local-6989586621680006226"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">h x
h x
</span><a href="#local-6989586621680006221"><span class="hs-identifier hs-var">hx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006222"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-325"></span><span>            </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f (y : zs) -&gt; Telescope g f (x : y : zs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006220"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g f (y : zs) -&gt; Telescope g f (x : y : zs))
-&gt; m (Telescope g f (y : zs)) -&gt; m (Telescope g f (x : y : zs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) (y : zs)
-&gt; NP (f -.-&gt; (Maybe :.: h)) (y : zs)
-&gt; Telescope g f (y : zs)
-&gt; m (Telescope g f (y : zs))
forall (xs' :: [k]).
InPairs (Requiring h (Extend m g f)) xs'
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006230"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006225"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; (Maybe :.: h)) xs
NP (f -.-&gt; (Maybe :.: h)) (y : zs)
</span><a href="#local-6989586621680006223"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f y -&gt; Telescope g f (y : zs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">f y
</span><a href="#local-6989586621680006219"><span class="hs-identifier hs-var">fy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><a href="#local-6989586621680006230"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#PCons"><span class="hs-identifier hs-type">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">Requiring h (Extend m g f) x y
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006217"><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006217"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f (Maybe :.: h) x
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006216"><span class="annot"><span class="annottext">NP (f -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006216"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006215"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006215"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006214"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006214"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>        </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f (y : zs) -&gt; Telescope g f (x : y : zs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006215"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g f (y : zs) -&gt; Telescope g f (x : y : zs))
-&gt; m (Telescope g f (y : zs)) -&gt; m (Telescope g f (x : y : zs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) (y : zs)
-&gt; NP (f -.-&gt; (Maybe :.: h)) (y : zs)
-&gt; Telescope g f (y : zs)
-&gt; m (Telescope g f (y : zs))
forall (xs' :: [k]).
InPairs (Requiring h (Extend m g f)) xs'
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006230"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring h (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006217"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; (Maybe :.: h)) xs
NP (f -.-&gt; (Maybe :.: h)) (y : zs)
</span><a href="#local-6989586621680006216"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
Telescope g f (y : zs)
</span><a href="#local-6989586621680006214"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-keyword">newtype</span><span> </span><span id="Retract"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-var">Retract</span></a></span></span><span> </span><span id="local-6989586621680006638"><span class="annot"><a href="#local-6989586621680006638"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680006637"><span class="annot"><a href="#local-6989586621680006637"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006636"><span class="annot"><a href="#local-6989586621680006636"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006635"><span class="annot"><a href="#local-6989586621680006635"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680006634"><span class="annot"><a href="#local-6989586621680006634"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Retract"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-var">Retract</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="retractWith"><span class="annot"><span class="annottext">Retract m g f x y -&gt; g x -&gt; f y -&gt; m (f x)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractWith"><span class="hs-identifier hs-var hs-var">retractWith</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680006637"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006635"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006636"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006634"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006638"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006636"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006635"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | Retract a telescope</span><span>
</span><span id="line-332"></span><span class="hs-comment">--</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- Blockchain intuition: suppose we have a telescope containing the consensus</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- state. When we rewind the consensus state, we might cross a hard fork</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- transition point. So we first /retract/ the telescope /to/ the era containing</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- the slot number that we want to rewind to, and only then call</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- 'rewindChainDepState' on that era. Of course, retraction may fail (we</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- might not /have/ past consensus state to rewind to anymore); this failure</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- would require a choice for a particular monad @m@.</span><span>
</span><span id="line-340"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retract"><span class="hs-identifier hs-type">retract</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006560"><span class="annot"><a href="#local-6989586621680006560"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680006559"><span class="annot"><a href="#local-6989586621680006559"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621680006558"><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006557"><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006556"><span class="annot"><a href="#local-6989586621680006556"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006560"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#Tails"><span class="hs-identifier hs-type">Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006559"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-type">Retract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006556"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ How to retract</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680006559"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006556"><span class="hs-identifier hs-type">xs</span></a></span><span>              </span><span class="hs-comment">-- ^ Where to retract /to/</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006556"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006556"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="retract"><span class="annot"><span class="annottext">retract :: Tails (Requiring h (Retract m g f)) xs
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retract"><span class="hs-identifier hs-var hs-var">retract</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621680006211"><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs
</span><a href="#local-6989586621680006211"><span class="hs-identifier hs-var">tails</span></a></span></span><span> </span><span id="local-6989586621680006210"><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006210"><span class="hs-identifier hs-var">np</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-346"></span><span>       </span><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall k (a :: k -&gt; *) (xs :: [k]) r.
NP a xs -&gt; (SListI xs =&gt; r) -&gt; r
</span><a href="Ouroboros.Consensus.Util.SOP.html#npToSListI"><span class="hs-identifier hs-var">npToSListI</span></a></span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006210"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">((SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
 -&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall (xs' :: [k]).
SListI xs' =&gt;
Tails (Requiring h (Retract m g f)) xs'
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006208"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs
</span><a href="#local-6989586621680006211"><span class="hs-identifier hs-var">tails</span></a></span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006210"><span class="hs-identifier hs-var">np</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621680006672"><span class="annot"><a href="#local-6989586621680006208"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680006672"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-349"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#Tails"><span class="hs-identifier hs-type">Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006559"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-type">Retract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006672"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-350"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680006559"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006672"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-351"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006672"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006560"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006558"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006557"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006672"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621680006208"><span class="annot"><span class="annottext">go :: Tails (Requiring h (Retract m g f)) xs'
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006208"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs'
</span><span class="hs-identifier">_</span></span><span>            </span><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs'
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006207"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006207"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope g f (x : xs) -&gt; m (Telescope g f (x : xs))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Telescope g f (x : xs) -&gt; m (Telescope g f (x : xs)))
-&gt; Telescope g f (x : xs) -&gt; m (Telescope g f (x : xs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Telescope g f (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006207"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="#local-6989586621680006208"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#TCons"><span class="hs-identifier hs-type">TCons</span></a></span><span> </span><span id="local-6989586621680006205"><span class="annot"><span class="annottext">NP (Requiring h (Retract m g f) x) xs
</span><a href="#local-6989586621680006205"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680006204"><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs
</span><a href="#local-6989586621680006204"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006203"><span class="annot"><span class="annottext">(-.-&gt;) g (Maybe :.: h) x
</span><a href="#local-6989586621680006203"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006202"><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006202"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006201"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006201"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006200"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006200"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(:.:) Maybe h x -&gt; Maybe (h x)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) g (Maybe :.: h) x -&gt; g x -&gt; (:.:) Maybe h x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) g (Maybe :.: h) x
</span><a href="#local-6989586621680006203"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">g x
g x
</span><a href="#local-6989586621680006201"><span class="hs-identifier hs-var">gx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680006199"><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680006199"><span class="hs-identifier hs-var">hx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>            </span><span class="annot"><span class="annottext">(NS (K (f x)) xs -&gt; Telescope g f (x : xs))
-&gt; m (NS (K (f x)) xs) -&gt; m (Telescope g f (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Telescope g f (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">(f x -&gt; Telescope g f (x : xs))
-&gt; (NS (K (f x)) xs -&gt; f x)
-&gt; NS (K (f x)) xs
-&gt; Telescope g f (x : xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NS (K (f x)) xs -&gt; f x
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) a.
(HCollapse h, SListIN h xs) =&gt;
h (K a) xs -&gt; CollapseTo h a
</span><span class="hs-identifier hs-var">hcollapse</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (NS (K (f x)) xs) -&gt; m (Telescope g f (x : xs)))
-&gt; m (NS (K (f x)) xs) -&gt; m (Telescope g f (x : xs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NS (m :.: K (f x)) xs -&gt; m (NS (K (f x)) xs)
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: * -&gt; *)
       (g :: k -&gt; *).
(HSequence h, SListIN h xs, Applicative f) =&gt;
h (f :.: g) xs -&gt; f (h g xs)
</span><span class="hs-identifier hs-var">hsequence'</span></span><span> </span><span class="annot"><span class="annottext">(NS (m :.: K (f x)) xs -&gt; m (NS (K (f x)) xs))
-&gt; NS (m :.: K (f x)) xs -&gt; m (NS (K (f x)) xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-357"></span><span>              </span><span class="annot"><span class="annottext">(forall (a :: k).
 Requiring h (Retract m g f) x a -&gt; f a -&gt; (:.:) m (K (f x)) a)
-&gt; Prod NS (Requiring h (Retract m g f) x) xs
-&gt; NS f xs
-&gt; NS (m :.: K (f x)) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *) (f'' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h, HAp (Prod h)) =&gt;
(forall (a :: k). f a -&gt; f' a -&gt; f'' a)
-&gt; Prod h f xs -&gt; h f' xs -&gt; h f'' xs
</span><span class="hs-identifier hs-var">hzipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">h x
-&gt; g x
-&gt; Requiring h (Retract m g f) x a
-&gt; f a
-&gt; (:.:) m (K (f x)) a
forall k (m :: * -&gt; *) (h :: k -&gt; *) (x :: k) (g :: k -&gt; *)
       (f :: k -&gt; *) (z :: k).
Functor m =&gt;
h x
-&gt; g x
-&gt; Requiring h (Retract m g f) x z
-&gt; f z
-&gt; (:.:) m (K (f x)) z
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractAux"><span class="hs-identifier hs-var">retractAux</span></a></span><span> </span><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680006199"><span class="hs-identifier hs-var">hx</span></a></span><span> </span><span class="annot"><span class="annottext">g x
g x
</span><a href="#local-6989586621680006201"><span class="hs-identifier hs-var">gx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prod NS (Requiring h (Retract m g f) x) xs
NP (Requiring h (Retract m g f) x) xs
</span><a href="#local-6989586621680006205"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope g f xs -&gt; NS f xs
forall k (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
Telescope g f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006200"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">Maybe (h x)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>            </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006201"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g f xs -&gt; Telescope g f (x : xs))
-&gt; m (Telescope g f xs) -&gt; m (Telescope g f (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall (xs' :: [k]).
SListI xs' =&gt;
Tails (Requiring h (Retract m g f)) xs'
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f xs')
</span><a href="#local-6989586621680006208"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring h (Retract m g f)) xs
</span><a href="#local-6989586621680006204"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; (Maybe :.: h)) xs
NP (g -.-&gt; (Maybe :.: h)) xs
</span><a href="#local-6989586621680006202"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
Telescope g f xs
</span><a href="#local-6989586621680006200"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="hs-comment">-- | Internal auxiliary to 'retract' and 'alignWith'</span><span>
</span><span id="line-362"></span><span id="local-6989586621680006647"><span id="local-6989586621680006648"><span id="local-6989586621680006649"><span id="local-6989586621680006650"><span id="local-6989586621680006651"><span id="local-6989586621680006652"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractAux"><span class="hs-identifier hs-type">retractAux</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621680006652"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-363"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006651"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006650"><span class="hs-identifier hs-type">x</span></a></span><span>  </span><span class="hs-comment">-- Proof that we need to retract</span><span>
</span><span id="line-364"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006649"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006650"><span class="hs-identifier hs-type">x</span></a></span><span>  </span><span class="hs-comment">-- Era we are retracting to</span><span>
</span><span id="line-365"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006651"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-type">Retract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006649"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006648"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006650"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006647"><span class="hs-identifier hs-type">z</span></a></span><span>
</span><span id="line-366"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006648"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006647"><span class="hs-identifier hs-type">z</span></a></span><span>  </span><span class="hs-comment">-- Current tip (what we are retracting from)</span><span>
</span><span id="line-367"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006648"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006650"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006647"><span class="hs-identifier hs-type">z</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-368"></span><span id="retractAux"><span class="annot"><span class="annottext">retractAux :: h x
-&gt; g x
-&gt; Requiring h (Retract m g f) x z
-&gt; f z
-&gt; (:.:) m (K (f x)) z
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractAux"><span class="hs-identifier hs-var hs-var">retractAux</span></a></span></span><span> </span><span id="local-6989586621680006196"><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680006196"><span class="hs-identifier hs-var">hx</span></a></span></span><span> </span><span id="local-6989586621680006195"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006195"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006194"><span class="annot"><span class="annottext">Requiring h (Retract m g f) x z
</span><a href="#local-6989586621680006194"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680006193"><span class="annot"><span class="annottext">f z
</span><a href="#local-6989586621680006193"><span class="hs-identifier hs-var">fz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (K (f x) z) -&gt; (:.:) m (K (f x)) z
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(m (K (f x) z) -&gt; (:.:) m (K (f x)) z)
-&gt; m (K (f x) z) -&gt; (:.:) m (K (f x)) z
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f x -&gt; K (f x) z
forall k a (b :: k). a -&gt; K a b
</span><span class="hs-identifier hs-var">K</span></span><span> </span><span class="annot"><span class="annottext">(f x -&gt; K (f x) z) -&gt; m (f x) -&gt; m (K (f x) z)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Retract m g f x z -&gt; g x -&gt; f z -&gt; m (f x)
forall (m :: * -&gt; *) k (g :: k -&gt; *) (f :: k -&gt; *) (x :: k)
       (y :: k).
Retract m g f x y -&gt; g x -&gt; f y -&gt; m (f x)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractWith"><span class="hs-identifier hs-var hs-var">retractWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Requiring h (Retract m g f) x z -&gt; h x -&gt; Retract m g f x z
forall k1 (h :: k1 -&gt; *) k2 (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
Requiring h f x y -&gt; h x -&gt; f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#provide"><span class="hs-identifier hs-var hs-var">provide</span></a></span><span> </span><span class="annot"><span class="annottext">Requiring h (Retract m g f) x z
</span><a href="#local-6989586621680006194"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680006196"><span class="hs-identifier hs-var">hx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006195"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">f z
</span><a href="#local-6989586621680006193"><span class="hs-identifier hs-var">fz</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">-- | Align a telescope with another, then apply a function to the tips</span><span>
</span><span id="line-371"></span><span class="hs-comment">--</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- Aligning is a combination of extension and retraction, extending or</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- retracting the telescope as required to match up with the other telescope.</span><span>
</span><span id="line-374"></span><span class="hs-comment">--</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- Blockchain intuition: suppose we have one telescope containing the</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- already-ticked ledger state, and another telescope containing the consensus</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- state. Since the ledger state has already been ticked, it might have been</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- advanced to the next era. If this happens, we should then align the</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- consensus state with the ledger state, moving /it/ also to the next era,</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- before we can do the consensus header validation check. Note that in this</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- particular example, the ledger state will always be ahead of the consensus</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- state, never behind; 'alignExtend' can be used in this case.</span><span>
</span><span id="line-383"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#align"><span class="hs-identifier hs-type">align</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680006537"><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680006536"><span class="annot"><a href="#local-6989586621680006536"><span class="hs-identifier hs-type">g'</span></a></span></span><span> </span><span id="local-6989586621680006535"><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006532"><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span></span><span> </span><span id="local-6989586621680006534"><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680006531"><span class="annot"><a href="#local-6989586621680006531"><span class="hs-identifier hs-type">f''</span></a></span></span><span> </span><span id="local-6989586621680006533"><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-384"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006536"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ How to extend</span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#Tails"><span class="hs-identifier hs-type">Tails</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-type">Retract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ How to retract</span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006531"><span class="hs-identifier hs-type">f''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ Function to apply at the tip</span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006536"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span><span>          </span><span class="hs-comment">-- ^ Telescope we are aligning with</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006531"><span class="hs-identifier hs-type">f''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006533"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span id="align"><span class="annot"><span class="annottext">align :: InPairs (Requiring g' (Extend m g f)) xs
-&gt; Tails (Requiring f' (Retract m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#align"><span class="hs-identifier hs-var hs-var">align</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680006192"><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs
</span><a href="#local-6989586621680006192"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680006191"><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
</span><a href="#local-6989586621680006191"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621680006190"><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006190"><span class="hs-identifier hs-var">atTip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; (SListI xs =&gt;
    Telescope g' f' xs -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall k (a :: k -&gt; *) (xs :: [k]) r.
NP a xs -&gt; (SListI xs =&gt; r) -&gt; r
</span><a href="Ouroboros.Consensus.Util.SOP.html#npToSListI"><span class="hs-identifier hs-var">npToSListI</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006190"><span class="hs-identifier hs-var">atTip</span></a></span><span> </span><span class="annot"><span class="annottext">((SListI xs =&gt;
  Telescope g' f' xs -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
 -&gt; Telescope g' f' xs
 -&gt; Telescope g f xs
 -&gt; m (Telescope g f'' xs))
-&gt; (SListI xs =&gt;
    Telescope g' f' xs -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs
-&gt; Tails (Requiring f' (Retract m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall (xs' :: [k]).
SListI xs' =&gt;
InPairs (Requiring g' (Extend m g f)) xs'
-&gt; Tails (Requiring f' (Retract m g f)) xs'
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs'
-&gt; Telescope g' f' xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f'' xs')
</span><a href="#local-6989586621680006189"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs
</span><a href="#local-6989586621680006192"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
</span><a href="#local-6989586621680006191"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006190"><span class="hs-identifier hs-var">atTip</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621680006625"><span class="annot"><a href="#local-6989586621680006189"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-393"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006536"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-394"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#Tails"><span class="hs-identifier hs-type">Tails</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-type">Retract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-395"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006531"><span class="hs-identifier hs-type">f''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-396"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006536"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006532"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006534"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006535"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006531"><span class="hs-identifier hs-type">f''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006625"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621680006189"><span class="annot"><span class="annottext">go :: InPairs (Requiring g' (Extend m g f)) xs'
-&gt; Tails (Requiring f' (Retract m g f)) xs'
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs'
-&gt; Telescope g' f' xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f'' xs')
</span><a href="#local-6989586621680006189"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs'
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006188"><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x
</span><a href="#local-6989586621680006188"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006187"><span class="annot"><span class="annottext">f' x
</span><a href="#local-6989586621680006187"><span class="hs-identifier hs-var">f'x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006186"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006186"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">Telescope g f'' (x : xs) -&gt; m (Telescope g f'' (x : xs))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Telescope g f'' (x : xs) -&gt; m (Telescope g f'' (x : xs)))
-&gt; Telescope g f'' (x : xs) -&gt; m (Telescope g f'' (x : xs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f'' x -&gt; Telescope g f'' (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x
</span><a href="#local-6989586621680006188"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x -&gt; f' x -&gt; (-.-&gt;) f f'' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-operator hs-var hs-var">`apFn`</span></span><span> </span><span class="annot"><span class="annottext">f' x
f' x
</span><a href="#local-6989586621680006187"><span class="hs-identifier hs-var">f'x</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f f'' x -&gt; f x -&gt; f'' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-operator hs-var hs-var">`apFn`</span></span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006186"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="#local-6989586621680006189"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#PCons"><span class="hs-identifier hs-type">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">Requiring g' (Extend m g f) x y
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006185"><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006185"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#TCons"><span class="hs-identifier hs-type">TCons</span></a></span><span> </span><span class="annot"><span class="annottext">NP (Requiring f' (Retract m g f) x) xs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006184"><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
</span><a href="#local-6989586621680006184"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006183"><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006183"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g' x
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006182"><span class="annot"><span class="annottext">Telescope g' f' xs
</span><a href="#local-6989586621680006182"><span class="hs-identifier hs-var">f'x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006181"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006181"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006180"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006180"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f'' (y : zs) -&gt; Telescope g f'' (x : y : zs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006181"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g f'' (y : zs) -&gt; Telescope g f'' (x : y : zs))
-&gt; m (Telescope g f'' (y : zs)) -&gt; m (Telescope g f'' (x : y : zs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) (y : zs)
-&gt; Tails (Requiring f' (Retract m g f)) (y : zs)
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) (y : zs)
-&gt; Telescope g' f' (y : zs)
-&gt; Telescope g f (y : zs)
-&gt; m (Telescope g f'' (y : zs))
forall (xs' :: [k]).
SListI xs' =&gt;
InPairs (Requiring g' (Extend m g f)) xs'
-&gt; Tails (Requiring f' (Retract m g f)) xs'
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs'
-&gt; Telescope g' f' xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f'' xs')
</span><a href="#local-6989586621680006189"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006185"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
Tails (Requiring f' (Retract m g f)) (y : zs)
</span><a href="#local-6989586621680006184"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
NP (f' -.-&gt; (f -.-&gt; f'')) (y : zs)
</span><a href="#local-6989586621680006183"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g' f' xs
Telescope g' f' (y : zs)
</span><a href="#local-6989586621680006182"><span class="hs-identifier hs-var">f'x</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
Telescope g f (y : zs)
</span><a href="#local-6989586621680006180"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="annot"><a href="#local-6989586621680006189"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#TCons"><span class="hs-identifier hs-type">TCons</span></a></span><span> </span><span id="local-6989586621680006179"><span class="annot"><span class="annottext">NP (Requiring f' (Retract m g f) x) xs
</span><a href="#local-6989586621680006179"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680006178"><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x
</span><a href="#local-6989586621680006178"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006177"><span class="annot"><span class="annottext">f' x
</span><a href="#local-6989586621680006177"><span class="hs-identifier hs-var">f'x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006176"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006176"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006175"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006175"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><span class="annottext">(NS (K (f x)) xs -&gt; Telescope g f'' (x : xs))
-&gt; m (NS (K (f x)) xs) -&gt; m (Telescope g f'' (x : xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f'' x -&gt; Telescope g f'' (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">(f'' x -&gt; Telescope g f'' (x : xs))
-&gt; (NS (K (f x)) xs -&gt; f'' x)
-&gt; NS (K (f x)) xs
-&gt; Telescope g f'' (x : xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680006174"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006174"><span class="hs-identifier hs-var">fx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x
</span><a href="#local-6989586621680006178"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x -&gt; f' x -&gt; (-.-&gt;) f f'' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-operator hs-var hs-var">`apFn`</span></span><span> </span><span class="annot"><span class="annottext">f' x
f' x
</span><a href="#local-6989586621680006177"><span class="hs-identifier hs-var">f'x</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f f'' x -&gt; f x -&gt; f'' x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-operator hs-var hs-var">`apFn`</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006174"><span class="hs-identifier hs-var">fx'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(f x -&gt; f'' x)
-&gt; (NS (K (f x)) xs -&gt; f x) -&gt; NS (K (f x)) xs -&gt; f'' x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NS (K (f x)) xs -&gt; f x
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) a.
(HCollapse h, SListIN h xs) =&gt;
h (K a) xs -&gt; CollapseTo h a
</span><span class="hs-identifier hs-var">hcollapse</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (NS (K (f x)) xs) -&gt; m (Telescope g f'' (x : xs)))
-&gt; m (NS (K (f x)) xs) -&gt; m (Telescope g f'' (x : xs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NS (m :.: K (f x)) xs -&gt; m (NS (K (f x)) xs)
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: * -&gt; *)
       (g :: k -&gt; *).
(HSequence h, SListIN h xs, Applicative f) =&gt;
h (f :.: g) xs -&gt; f (h g xs)
</span><span class="hs-identifier hs-var">hsequence'</span></span><span> </span><span class="annot"><span class="annottext">(NS (m :.: K (f x)) xs -&gt; m (NS (K (f x)) xs))
-&gt; NS (m :.: K (f x)) xs -&gt; m (NS (K (f x)) xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-403"></span><span>          </span><span class="annot"><span class="annottext">(forall (a :: k).
 Requiring f' (Retract m g f) x a -&gt; f a -&gt; (:.:) m (K (f x)) a)
-&gt; Prod NS (Requiring f' (Retract m g f) x) xs
-&gt; NS f xs
-&gt; NS (m :.: K (f x)) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *) (f'' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h, HAp (Prod h)) =&gt;
(forall (a :: k). f a -&gt; f' a -&gt; f'' a)
-&gt; Prod h f xs -&gt; h f' xs -&gt; h f'' xs
</span><span class="hs-identifier hs-var">hzipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f' x
-&gt; g x
-&gt; Requiring f' (Retract m g f) x a
-&gt; f a
-&gt; (:.:) m (K (f x)) a
forall k (m :: * -&gt; *) (h :: k -&gt; *) (x :: k) (g :: k -&gt; *)
       (f :: k -&gt; *) (z :: k).
Functor m =&gt;
h x
-&gt; g x
-&gt; Requiring h (Retract m g f) x z
-&gt; f z
-&gt; (:.:) m (K (f x)) z
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractAux"><span class="hs-identifier hs-var">retractAux</span></a></span><span> </span><span class="annot"><span class="annottext">f' x
</span><a href="#local-6989586621680006177"><span class="hs-identifier hs-var">f'x</span></a></span><span> </span><span class="annot"><span class="annottext">g x
g x
</span><a href="#local-6989586621680006176"><span class="hs-identifier hs-var">gx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prod NS (Requiring f' (Retract m g f) x) xs
NP (Requiring f' (Retract m g f) x) xs
</span><a href="#local-6989586621680006179"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope g f xs -&gt; NS f xs
forall k (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
Telescope g f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006175"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><a href="#local-6989586621680006189"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#PCons"><span class="hs-identifier hs-type">PCons</span></a></span><span> </span><span id="local-6989586621680006173"><span class="annot"><span class="annottext">Requiring g' (Extend m g f) x y
</span><a href="#local-6989586621680006173"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680006172"><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006172"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#TCons"><span class="hs-identifier hs-type">TCons</span></a></span><span> </span><span class="annot"><span class="annottext">NP (Requiring f' (Retract m g f) x) xs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680006171"><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
</span><a href="#local-6989586621680006171"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') x
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680006170"><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006170"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006169"><span class="annot"><span class="annottext">g' x
</span><a href="#local-6989586621680006169"><span class="hs-identifier hs-var">g'x</span></a></span></span><span> </span><span id="local-6989586621680006168"><span class="annot"><span class="annottext">Telescope g' f' xs
</span><a href="#local-6989586621680006168"><span class="hs-identifier hs-var">t'x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006167"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006167"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680006166"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006166"><span class="hs-identifier hs-var">gx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680006165"><span class="annot"><span class="annottext">f y
</span><a href="#local-6989586621680006165"><span class="hs-identifier hs-var">fy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extend m g f x y -&gt; f x -&gt; m (g x, f y)
forall (m :: * -&gt; *) k (g :: k -&gt; *) (f :: k -&gt; *) (x :: k)
       (y :: k).
Extend m g f x y -&gt; f x -&gt; m (g x, f y)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extendWith"><span class="hs-identifier hs-var hs-var">extendWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Requiring g' (Extend m g f) x y -&gt; g' x -&gt; Extend m g f x y
forall k1 (h :: k1 -&gt; *) k2 (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
Requiring h f x y -&gt; h x -&gt; f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#provide"><span class="hs-identifier hs-var hs-var">provide</span></a></span><span> </span><span class="annot"><span class="annottext">Requiring g' (Extend m g f) x y
</span><a href="#local-6989586621680006173"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">g' x
g' x
</span><a href="#local-6989586621680006169"><span class="hs-identifier hs-var">g'x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f x
f x
</span><a href="#local-6989586621680006167"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="annottext">g x -&gt; Telescope g f'' (y : zs) -&gt; Telescope g f'' (x : y : zs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006166"><span class="hs-identifier hs-var">gx</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope g f'' (y : zs) -&gt; Telescope g f'' (x : y : zs))
-&gt; m (Telescope g f'' (y : zs)) -&gt; m (Telescope g f'' (x : y : zs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) (y : zs)
-&gt; Tails (Requiring f' (Retract m g f)) (y : zs)
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) (y : zs)
-&gt; Telescope g' f' (y : zs)
-&gt; Telescope g f (y : zs)
-&gt; m (Telescope g f'' (y : zs))
forall (xs' :: [k]).
SListI xs' =&gt;
InPairs (Requiring g' (Extend m g f)) xs'
-&gt; Tails (Requiring f' (Retract m g f)) xs'
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs'
-&gt; Telescope g' f' xs'
-&gt; Telescope g f xs'
-&gt; m (Telescope g f'' xs')
</span><a href="#local-6989586621680006189"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) (y : zs)
</span><a href="#local-6989586621680006172"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Tails (Requiring f' (Retract m g f)) xs
Tails (Requiring f' (Retract m g f)) (y : zs)
</span><a href="#local-6989586621680006171"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
NP (f' -.-&gt; (f -.-&gt; f'')) (y : zs)
</span><a href="#local-6989586621680006170"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope g' f' xs
Telescope g' f' (y : zs)
</span><a href="#local-6989586621680006168"><span class="hs-identifier hs-var">t'x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f y -&gt; Telescope g f (y : zs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">f y
</span><a href="#local-6989586621680006165"><span class="hs-identifier hs-var">fy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Derived API
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- | Version of 'extend' where the evidence is a simple 'Bool'</span><span>
</span><span id="line-413"></span><span id="local-6989586621680006161"><span id="local-6989586621680006162"><span id="local-6989586621680006163"><span id="local-6989586621680006164"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extendIf"><span class="hs-identifier hs-type">extendIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006164"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-414"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006164"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006163"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006162"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006161"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-comment">-- ^ How to extend</span><span>
</span><span id="line-415"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006162"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006161"><span class="hs-identifier hs-type">xs</span></a></span><span>     </span><span class="hs-comment">-- ^ Where to extend /from/</span><span>
</span><span id="line-416"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006163"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006162"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006161"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006164"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006163"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006162"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006161"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-417"></span><span id="extendIf"><span class="annot"><span class="annottext">extendIf :: InPairs (Extend m g f) xs
-&gt; NP (f -.-&gt; K Bool) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extendIf"><span class="hs-identifier hs-var hs-var">extendIf</span></a></span></span><span> </span><span id="local-6989586621680006160"><span class="annot"><span class="annottext">InPairs (Extend m g f) xs
</span><a href="#local-6989586621680006160"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680006159"><span class="annot"><span class="annottext">NP (f -.-&gt; K Bool) xs
</span><a href="#local-6989586621680006159"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; K Bool) xs
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall k (a :: k -&gt; *) (xs :: [k]) r.
NP a xs -&gt; (SListI xs =&gt; r) -&gt; r
</span><a href="Ouroboros.Consensus.Util.SOP.html#npToSListI"><span class="hs-identifier hs-var">npToSListI</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; K Bool) xs
</span><a href="#local-6989586621680006159"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">((SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
 -&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><span class="annottext">InPairs (Requiring (K ()) (Extend m g f)) xs
-&gt; NP (f -.-&gt; (Maybe :.: K ())) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall k (m :: * -&gt; *) (h :: k -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *)
       (xs :: [k]).
Monad m =&gt;
InPairs (Requiring h (Extend m g f)) xs
-&gt; NP (f -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#extend"><span class="hs-identifier hs-var">extend</span></a></span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (x :: k) (y :: k).
 Extend m g f x y -&gt; Requiring (K ()) (Extend m g f) x y)
-&gt; InPairs (Extend m g f) xs
-&gt; InPairs (Requiring (K ()) (Extend m g f)) xs
forall k (xs :: [k]) (f :: k -&gt; k -&gt; *) (g :: k -&gt; k -&gt; *).
SListI xs =&gt;
(forall (x :: k) (y :: k). f x y -&gt; g x y)
-&gt; InPairs f xs -&gt; InPairs g xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#hmap"><span class="hs-identifier hs-var">InPairs.hmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(K () x -&gt; Extend m g f x y) -&gt; Requiring (K ()) (Extend m g f) x y
forall k1 k2 (h :: k1 -&gt; *) (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
(h x -&gt; f x y) -&gt; Requiring h f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Require"><span class="hs-identifier hs-var">Require</span></a></span><span> </span><span class="annot"><span class="annottext">((K () x -&gt; Extend m g f x y)
 -&gt; Requiring (K ()) (Extend m g f) x y)
-&gt; (Extend m g f x y -&gt; K () x -&gt; Extend m g f x y)
-&gt; Extend m g f x y
-&gt; Requiring (K ()) (Extend m g f) x y
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Extend m g f x y -&gt; K () x -&gt; Extend m g f x y
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InPairs (Extend m g f) xs
</span><a href="#local-6989586621680006160"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (a :: k).
 (-.-&gt;) f (K Bool) a -&gt; (-.-&gt;) f (Maybe :.: K ()) a)
-&gt; NP (f -.-&gt; K Bool) xs -&gt; NP (f -.-&gt; (Maybe :.: K ())) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680006155"><span class="annot"><span class="annottext">(-.-&gt;) f (K Bool) a
</span><a href="#local-6989586621680006155"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(f a -&gt; (:.:) Maybe (K ()) a) -&gt; (-.-&gt;) f (Maybe :.: K ()) a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">((f a -&gt; (:.:) Maybe (K ()) a) -&gt; (-.-&gt;) f (Maybe :.: K ()) a)
-&gt; (f a -&gt; (:.:) Maybe (K ()) a) -&gt; (-.-&gt;) f (Maybe :.: K ()) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">K Bool a -&gt; (:.:) Maybe (K ()) a
forall k (x :: k). K Bool x -&gt; (:.:) Maybe (K ()) x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="annot"><span class="annottext">(K Bool a -&gt; (:.:) Maybe (K ()) a)
-&gt; (f a -&gt; K Bool a) -&gt; f a -&gt; (:.:) Maybe (K ()) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f (K Bool) a -&gt; f a -&gt; K Bool a
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f (K Bool) a
</span><a href="#local-6989586621680006155"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP (f -.-&gt; K Bool) xs
</span><a href="#local-6989586621680006159"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- | Version of 'retract' where the evidence is a simple 'Bool'</span><span>
</span><span id="line-423"></span><span id="local-6989586621680006150"><span id="local-6989586621680006151"><span id="local-6989586621680006152"><span id="local-6989586621680006153"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractIf"><span class="hs-identifier hs-type">retractIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006153"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-424"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#Tails"><span class="hs-identifier hs-type">Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Retract"><span class="hs-identifier hs-type">Retract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006153"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006152"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006151"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006150"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ How to retract</span><span>
</span><span id="line-425"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006152"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006150"><span class="hs-identifier hs-type">xs</span></a></span><span>     </span><span class="hs-comment">-- ^ Where to retract /to/</span><span>
</span><span id="line-426"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006152"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006151"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006150"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006153"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006152"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006151"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006150"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-427"></span><span id="retractIf"><span class="annot"><span class="annottext">retractIf :: Tails (Retract m g f) xs
-&gt; NP (g -.-&gt; K Bool) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retractIf"><span class="hs-identifier hs-var hs-var">retractIf</span></a></span></span><span> </span><span id="local-6989586621680006149"><span class="annot"><span class="annottext">Tails (Retract m g f) xs
</span><a href="#local-6989586621680006149"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621680006148"><span class="annot"><span class="annottext">NP (g -.-&gt; K Bool) xs
</span><a href="#local-6989586621680006148"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; K Bool) xs
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall k (a :: k -&gt; *) (xs :: [k]) r.
NP a xs -&gt; (SListI xs =&gt; r) -&gt; r
</span><a href="Ouroboros.Consensus.Util.SOP.html#npToSListI"><span class="hs-identifier hs-var">npToSListI</span></a></span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; K Bool) xs
</span><a href="#local-6989586621680006148"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">((SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
 -&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><span class="annottext">Tails (Requiring (K ()) (Retract m g f)) xs
-&gt; NP (g -.-&gt; (Maybe :.: K ())) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
forall k (m :: * -&gt; *) (h :: k -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *)
       (xs :: [k]).
Monad m =&gt;
Tails (Requiring h (Retract m g f)) xs
-&gt; NP (g -.-&gt; (Maybe :.: h)) xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#retract"><span class="hs-identifier hs-var">retract</span></a></span><span>
</span><span id="line-429"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (x :: k) (y :: k).
 Retract m g f x y -&gt; Requiring (K ()) (Retract m g f) x y)
-&gt; Tails (Retract m g f) xs
-&gt; Tails (Requiring (K ()) (Retract m g f)) xs
forall k (xs :: [k]) (f :: k -&gt; k -&gt; *) (g :: k -&gt; k -&gt; *).
SListI xs =&gt;
(forall (x :: k) (y :: k). f x y -&gt; g x y)
-&gt; Tails f xs -&gt; Tails g xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#hmap"><span class="hs-identifier hs-var">Tails.hmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(K () x -&gt; Retract m g f x y)
-&gt; Requiring (K ()) (Retract m g f) x y
forall k1 k2 (h :: k1 -&gt; *) (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
(h x -&gt; f x y) -&gt; Requiring h f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Require"><span class="hs-identifier hs-var">Require</span></a></span><span> </span><span class="annot"><span class="annottext">((K () x -&gt; Retract m g f x y)
 -&gt; Requiring (K ()) (Retract m g f) x y)
-&gt; (Retract m g f x y -&gt; K () x -&gt; Retract m g f x y)
-&gt; Retract m g f x y
-&gt; Requiring (K ()) (Retract m g f) x y
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Retract m g f x y -&gt; K () x -&gt; Retract m g f x y
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tails (Retract m g f) xs
</span><a href="#local-6989586621680006149"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (a :: k).
 (-.-&gt;) g (K Bool) a -&gt; (-.-&gt;) g (Maybe :.: K ()) a)
-&gt; NP (g -.-&gt; K Bool) xs -&gt; NP (g -.-&gt; (Maybe :.: K ())) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680006146"><span class="annot"><span class="annottext">(-.-&gt;) g (K Bool) a
</span><a href="#local-6989586621680006146"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(g a -&gt; (:.:) Maybe (K ()) a) -&gt; (-.-&gt;) g (Maybe :.: K ()) a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *).
(f a -&gt; f' a) -&gt; (-.-&gt;) f f' a
</span><span class="hs-identifier hs-var">fn</span></span><span> </span><span class="annot"><span class="annottext">((g a -&gt; (:.:) Maybe (K ()) a) -&gt; (-.-&gt;) g (Maybe :.: K ()) a)
-&gt; (g a -&gt; (:.:) Maybe (K ()) a) -&gt; (-.-&gt;) g (Maybe :.: K ()) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">K Bool a -&gt; (:.:) Maybe (K ()) a
forall k (x :: k). K Bool x -&gt; (:.:) Maybe (K ()) x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="annot"><span class="annottext">(K Bool a -&gt; (:.:) Maybe (K ()) a)
-&gt; (g a -&gt; K Bool a) -&gt; g a -&gt; (:.:) Maybe (K ()) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) g (K Bool) a -&gt; g a -&gt; K Bool a
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) g (K Bool) a
</span><a href="#local-6989586621680006146"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP (g -.-&gt; K Bool) xs
</span><a href="#local-6989586621680006148"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- | Version of 'align' that never retracts, only extends</span><span>
</span><span id="line-433"></span><span class="hs-comment">--</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- PRE: The telescope we are aligning with cannot be behind us.</span><span>
</span><span id="line-435"></span><span id="local-6989586621680006506"><span id="local-6989586621680006507"><span id="local-6989586621680006508"><span id="local-6989586621680006509"><span id="local-6989586621680006510"><span id="local-6989586621680006511"><span id="local-6989586621680006512"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtend"><span class="hs-identifier hs-type">alignExtend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006512"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier hs-type">Requiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006511"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006510"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006509"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006508"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ How to extend</span><span>
</span><span id="line-437"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006507"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006509"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006506"><span class="hs-identifier hs-type">f''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006508"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ Function to apply at the tip</span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006511"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006507"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006508"><span class="hs-identifier hs-type">xs</span></a></span><span>          </span><span class="hs-comment">-- ^ Telescope we are aligning with</span><span>
</span><span id="line-439"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006510"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006509"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006508"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006510"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006506"><span class="hs-identifier hs-type">f''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006508"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span>
</span><span id="line-440"></span><span id="alignExtend"><span class="annot"><span class="annottext">alignExtend :: InPairs (Requiring g' (Extend m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtend"><span class="hs-identifier hs-var hs-var">alignExtend</span></a></span></span><span> </span><span id="local-6989586621680006145"><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs
</span><a href="#local-6989586621680006145"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680006144"><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006144"><span class="hs-identifier hs-var">atTip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; (SListI xs =&gt;
    Telescope g' f' xs -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall k (a :: k -&gt; *) (xs :: [k]) r.
NP a xs -&gt; (SListI xs =&gt; r) -&gt; r
</span><a href="Ouroboros.Consensus.Util.SOP.html#npToSListI"><span class="hs-identifier hs-var">npToSListI</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006144"><span class="hs-identifier hs-var">atTip</span></a></span><span> </span><span class="annot"><span class="annottext">((SListI xs =&gt;
  Telescope g' f' xs -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
 -&gt; Telescope g' f' xs
 -&gt; Telescope g f xs
 -&gt; m (Telescope g f'' xs))
-&gt; (SListI xs =&gt;
    Telescope g' f' xs -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs
-&gt; Tails (Requiring f' (Retract m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall k (m :: * -&gt; *) (g' :: k -&gt; *) (g :: k -&gt; *) (f' :: k -&gt; *)
       (f :: k -&gt; *) (f'' :: k -&gt; *) (xs :: [k]).
Monad m =&gt;
InPairs (Requiring g' (Extend m g f)) xs
-&gt; Tails (Requiring f' (Retract m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#align"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (Requiring g' (Extend m g f)) xs
</span><a href="#local-6989586621680006145"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (x :: k) (y :: k). Requiring f' (Retract m g f) x y)
-&gt; Tails (Requiring f' (Retract m g f)) xs
forall k (xs :: [k]) (f :: k -&gt; k -&gt; *).
SListI xs =&gt;
(forall (x :: k) (y :: k). f x y) -&gt; Tails f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Tails.html#hpure"><span class="hs-identifier hs-var">Tails.hpure</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (x :: k) (y :: k). Requiring f' (Retract m g f) x y)
 -&gt; Tails (Requiring f' (Retract m g f)) xs)
-&gt; (forall (x :: k) (y :: k). Requiring f' (Retract m g f) x y)
-&gt; Tails (Requiring f' (Retract m g f)) xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(f' x -&gt; Retract m g f x y) -&gt; Requiring f' (Retract m g f) x y
forall k1 k2 (h :: k1 -&gt; *) (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
(h x -&gt; f x y) -&gt; Requiring h f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Require"><span class="hs-identifier hs-var">Require</span></a></span><span> </span><span class="annot"><span class="annottext">((f' x -&gt; Retract m g f x y) -&gt; Requiring f' (Retract m g f) x y)
-&gt; (f' x -&gt; Retract m g f x y) -&gt; Requiring f' (Retract m g f) x y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">f' x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Retract m g f x y
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680006141"><span class="hs-identifier hs-var">precondition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006144"><span class="hs-identifier hs-var">atTip</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="#local-6989586621680006141"><span class="hs-identifier hs-type">precondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-444"></span><span>    </span><span id="local-6989586621680006141"><span class="annot"><span class="annottext">precondition :: [Char]
</span><a href="#local-6989586621680006141"><span class="hs-identifier hs-var hs-var">precondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;alignExtend: precondition violated&quot;</span></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="hs-comment">-- | Version of 'alignExtend' that extends with an NS instead</span><span>
</span><span id="line-447"></span><span id="local-6989586621680006134"><span id="local-6989586621680006135"><span id="local-6989586621680006136"><span id="local-6989586621680006137"><span id="local-6989586621680006138"><span id="local-6989586621680006139"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtendNS"><span class="hs-identifier hs-type">alignExtendNS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680006139"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-type">Extend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006139"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006138"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006137"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006136"><span class="hs-identifier hs-type">xs</span></a></span><span>   </span><span class="hs-comment">-- ^ How to extend</span><span>
</span><span id="line-449"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006135"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006137"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680006134"><span class="hs-identifier hs-type">f''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006136"><span class="hs-identifier hs-type">xs</span></a></span><span>  </span><span class="hs-comment">-- ^ Function to apply at the tip</span><span>
</span><span id="line-450"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006135"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006136"><span class="hs-identifier hs-type">xs</span></a></span><span>                    </span><span class="hs-comment">-- ^ NS we are aligning with</span><span>
</span><span id="line-451"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006138"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006137"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006136"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006139"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006138"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006134"><span class="hs-identifier hs-type">f''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006136"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-452"></span><span id="alignExtendNS"><span class="annot"><span class="annottext">alignExtendNS :: InPairs (Extend m g f) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; NS f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtendNS"><span class="hs-identifier hs-var hs-var">alignExtendNS</span></a></span></span><span> </span><span id="local-6989586621680006133"><span class="annot"><span class="annottext">InPairs (Extend m g f) xs
</span><a href="#local-6989586621680006133"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680006132"><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006132"><span class="hs-identifier hs-var">atTip</span></a></span></span><span> </span><span id="local-6989586621680006131"><span class="annot"><span class="annottext">NS f' xs
</span><a href="#local-6989586621680006131"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall k (a :: k -&gt; *) (xs :: [k]) r.
NP a xs -&gt; (SListI xs =&gt; r) -&gt; r
</span><a href="Ouroboros.Consensus.Util.SOP.html#npToSListI"><span class="hs-identifier hs-var">npToSListI</span></a></span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006132"><span class="hs-identifier hs-var">atTip</span></a></span><span> </span><span class="annot"><span class="annottext">((SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
 -&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; (SListI xs =&gt; Telescope g f xs -&gt; m (Telescope g f'' xs))
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-453"></span><span>   </span><span class="annot"><span class="annottext">InPairs (Requiring (K ()) (Extend m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope (K ()) f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
forall k (m :: * -&gt; *) (g' :: k -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *)
       (xs :: [k]) (f' :: k -&gt; *) (f'' :: k -&gt; *).
(Monad m, HasCallStack) =&gt;
InPairs (Requiring g' (Extend m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtend"><span class="hs-identifier hs-var">alignExtend</span></a></span><span>
</span><span id="line-454"></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (x :: k) (y :: k).
 Extend m g f x y -&gt; Requiring (K ()) (Extend m g f) x y)
-&gt; InPairs (Extend m g f) xs
-&gt; InPairs (Requiring (K ()) (Extend m g f)) xs
forall k (xs :: [k]) (f :: k -&gt; k -&gt; *) (g :: k -&gt; k -&gt; *).
SListI xs =&gt;
(forall (x :: k) (y :: k). f x y -&gt; g x y)
-&gt; InPairs f xs -&gt; InPairs g xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#hmap"><span class="hs-identifier hs-var">InPairs.hmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(K () x -&gt; Extend m g f x y) -&gt; Requiring (K ()) (Extend m g f) x y
forall k1 k2 (h :: k1 -&gt; *) (f :: k1 -&gt; k2 -&gt; *) (x :: k1)
       (y :: k2).
(h x -&gt; f x y) -&gt; Requiring h f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Require"><span class="hs-identifier hs-var">Require</span></a></span><span> </span><span class="annot"><span class="annottext">((K () x -&gt; Extend m g f x y)
 -&gt; Requiring (K ()) (Extend m g f) x y)
-&gt; (Extend m g f x y -&gt; K () x -&gt; Extend m g f x y)
-&gt; Extend m g f x y
-&gt; Requiring (K ()) (Extend m g f) x y
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Extend m g f x y -&gt; K () x -&gt; Extend m g f x y
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InPairs (Extend m g f) xs
</span><a href="#local-6989586621680006133"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>     </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680006132"><span class="hs-identifier hs-var">atTip</span></a></span><span>
</span><span id="line-456"></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NS f' xs -&gt; Telescope (K ()) f' xs
forall k (f :: k -&gt; *) (xs :: [k]).
NS f xs -&gt; Telescope (K ()) f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTip"><span class="hs-identifier hs-var">fromTip</span></a></span><span> </span><span class="annot"><span class="annottext">NS f' xs
</span><a href="#local-6989586621680006131"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | Internal auxiliary to 'extendIf' and 'retractIf'</span><span>
</span><span id="line-459"></span><span id="local-6989586621680006567"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromBool"><span class="hs-identifier hs-type">fromBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><a href="#local-6989586621680006567"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006567"><span class="hs-identifier hs-type">x</span></a></span></span><span>
</span><span id="line-460"></span><span id="fromBool"><span class="annot"><span class="annottext">fromBool :: K Bool x -&gt; (:.:) Maybe (K ()) x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromBool"><span class="hs-identifier hs-var hs-var">fromBool</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (K () x) -&gt; (:.:) Maybe (K ()) x
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (K () x) -&gt; (:.:) Maybe (K ()) x)
-&gt; Maybe (K () x) -&gt; (:.:) Maybe (K ()) x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">K () x -&gt; Maybe (K () x)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(K () x -&gt; Maybe (K () x)) -&gt; K () x -&gt; Maybe (K () x)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; K () x
forall k a (b :: k). a -&gt; K a b
</span><span class="hs-identifier hs-var">K</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (K () x) -&gt; (:.:) Maybe (K ()) x
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (K () x) -&gt; (:.:) Maybe (K ()) x)
-&gt; Maybe (K () x) -&gt; (:.:) Maybe (K ()) x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (K () x)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Additional API
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-keyword">newtype</span><span> </span><span id="ScanNext"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#ScanNext"><span class="hs-identifier hs-var">ScanNext</span></a></span></span><span> </span><span id="local-6989586621680006465"><span class="annot"><a href="#local-6989586621680006465"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621680006464"><span class="annot"><a href="#local-6989586621680006464"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621680006463"><span class="annot"><a href="#local-6989586621680006463"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680006462"><span class="annot"><a href="#local-6989586621680006462"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScanNext"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#ScanNext"><span class="hs-identifier hs-var">ScanNext</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getNext"><span class="annot"><span class="annottext">ScanNext h g x y -&gt; h x -&gt; g x -&gt; h y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getNext"><span class="hs-identifier hs-var hs-var">getNext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680006465"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006463"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006464"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006463"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006465"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006462"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-comment">-- | Telescope analogue of 'scanl' on lists</span><span>
</span><span id="line-470"></span><span class="hs-comment">--</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- This function is modelled on</span><span>
</span><span id="line-472"></span><span class="hs-comment">--</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- &gt; scanl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]</span><span>
</span><span id="line-474"></span><span class="hs-comment">--</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- but there are a few differences:</span><span>
</span><span id="line-476"></span><span class="hs-comment">--</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- * Since every seed has a different type, we must be given a function</span><span>
</span><span id="line-478"></span><span class="hs-comment">--   for each transition.</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- * Unlike 'scanl', we preserve the length of the telescope</span><span>
</span><span id="line-480"></span><span class="hs-comment">--   ('scanl' prepends the initial seed)</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- * Instead of generating a telescope containing only the seeds, we</span><span>
</span><span id="line-482"></span><span class="hs-comment">--   instead pair the seeds with the elements.</span><span>
</span><span id="line-483"></span><span id="local-6989586621680006124"><span id="local-6989586621680006125"><span id="local-6989586621680006126"><span id="local-6989586621680006127"><span id="local-6989586621680006128"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#scanl"><span class="hs-identifier hs-type">scanl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#ScanNext"><span class="hs-identifier hs-type">ScanNext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006128"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006127"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006126"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006125"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006128"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006126"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006127"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006124"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006126"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006125"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><a href="#local-6989586621680006128"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006127"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><a href="#local-6989586621680006128"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006124"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006126"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006125"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-487"></span><span id="scanl"><span class="annot"><span class="annottext">scanl :: InPairs (ScanNext h g) (x : xs)
-&gt; h x
-&gt; Telescope g f (x : xs)
-&gt; Telescope (Product h g) (Product h f) (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#scanl"><span class="hs-identifier hs-var hs-var">scanl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InPairs (ScanNext h g) (x : xs)
-&gt; h x
-&gt; Telescope g f (x : xs)
-&gt; Telescope (Product h g) (Product h f) (x : xs)
forall a (h :: a -&gt; *) (g :: a -&gt; *) (x' :: a) (xs' :: [a])
       (f :: a -&gt; *).
InPairs (ScanNext h g) (x' : xs')
-&gt; h x'
-&gt; Telescope g f (x' : xs')
-&gt; Telescope (Product h g) (Product h f) (x' : xs')
</span><a href="#local-6989586621680006123"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-489"></span><span>    </span><span id="local-6989586621680006483"><span id="local-6989586621680006484"><span id="local-6989586621680006485"><span id="local-6989586621680006486"><span id="local-6989586621680006487"><span class="annot"><a href="#local-6989586621680006123"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#ScanNext"><span class="hs-identifier hs-type">ScanNext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006487"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006486"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006485"><span class="hs-identifier hs-type">x'</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006484"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680006487"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006485"><span class="hs-identifier hs-type">x'</span></a></span><span>
</span><span id="line-491"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006486"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006483"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006485"><span class="hs-identifier hs-type">x'</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006484"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><a href="#local-6989586621680006487"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006486"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><a href="#local-6989586621680006487"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006483"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680006485"><span class="hs-identifier hs-type">x'</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680006484"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621680006123"><span class="annot"><span class="annottext">go :: InPairs (ScanNext h g) (x' : xs')
-&gt; h x'
-&gt; Telescope g f (x' : xs')
-&gt; Telescope (Product h g) (Product h f) (x' : xs')
</span><a href="#local-6989586621680006123"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">InPairs (ScanNext h g) (x' : xs')
</span><span class="hs-identifier">_</span></span><span>            </span><span id="local-6989586621680006122"><span class="annot"><span class="annottext">h x'
</span><a href="#local-6989586621680006122"><span class="hs-identifier hs-var">hx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006121"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006121"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product h f x' -&gt; Telescope (Product h g) (Product h f) (x' : xs')
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">h x' -&gt; f x' -&gt; Product h f x'
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">h x'
</span><a href="#local-6989586621680006122"><span class="hs-identifier hs-var">hx</span></a></span><span> </span><span class="annot"><span class="annottext">f x'
f x
</span><a href="#local-6989586621680006121"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="#local-6989586621680006123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#PCons"><span class="hs-identifier hs-type">PCons</span></a></span><span> </span><span id="local-6989586621680006119"><span class="annot"><span class="annottext">ScanNext h g x y
</span><a href="#local-6989586621680006119"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680006118"><span class="annot"><span class="annottext">InPairs (ScanNext h g) (y : zs)
</span><a href="#local-6989586621680006118"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680006117"><span class="annot"><span class="annottext">h x'
</span><a href="#local-6989586621680006117"><span class="hs-identifier hs-var">hx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006116"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006116"><span class="hs-identifier hs-var">gx</span></a></span></span><span> </span><span id="local-6989586621680006115"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006115"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product h g x'
-&gt; Telescope (Product h g) (Product h f) (y : zs)
-&gt; Telescope (Product h g) (Product h f) (x' : y : zs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">h x' -&gt; g x' -&gt; Product h g x'
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">h x'
</span><a href="#local-6989586621680006117"><span class="hs-identifier hs-var">hx</span></a></span><span> </span><span class="annot"><span class="annottext">g x'
g x
</span><a href="#local-6989586621680006116"><span class="hs-identifier hs-var">gx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Telescope (Product h g) (Product h f) (y : zs)
 -&gt; Telescope (Product h g) (Product h f) (x' : y : zs))
-&gt; Telescope (Product h g) (Product h f) (y : zs)
-&gt; Telescope (Product h g) (Product h f) (x' : y : zs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InPairs (ScanNext h g) (y : zs)
-&gt; h y
-&gt; Telescope g f (y : zs)
-&gt; Telescope (Product h g) (Product h f) (y : zs)
forall a (h :: a -&gt; *) (g :: a -&gt; *) (x' :: a) (xs' :: [a])
       (f :: a -&gt; *).
InPairs (ScanNext h g) (x' : xs')
-&gt; h x'
-&gt; Telescope g f (x' : xs')
-&gt; Telescope (Product h g) (Product h f) (x' : xs')
</span><a href="#local-6989586621680006123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">InPairs (ScanNext h g) (y : zs)
</span><a href="#local-6989586621680006118"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScanNext h g x y -&gt; h x -&gt; g x -&gt; h y
forall k (h :: k -&gt; *) (g :: k -&gt; *) (x :: k) (y :: k).
ScanNext h g x y -&gt; h x -&gt; g x -&gt; h y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#getNext"><span class="hs-identifier hs-var hs-var">getNext</span></a></span><span> </span><span class="annot"><span class="annottext">ScanNext h g x y
</span><a href="#local-6989586621680006119"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">h x'
h x
</span><a href="#local-6989586621680006117"><span class="hs-identifier hs-var">hx</span></a></span><span> </span><span class="annot"><span class="annottext">g x
g x
</span><a href="#local-6989586621680006116"><span class="hs-identifier hs-var">gx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
Telescope g f (y : zs)
</span><a href="#local-6989586621680006115"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Standard type class instances
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span id="local-6989586621680006108"><span id="local-6989586621680006110"><span id="local-6989586621680006112"><span id="local-6989586621680006113"><span id="local-6989586621680006114"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680006114"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006113"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-501"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680006112"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006113"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-502"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006114"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006112"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006113"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span id="local-6989586621680006089"><span id="local-6989586621680006091"><span id="local-6989586621680006093"><span id="local-6989586621680006095"><span id="local-6989586621680006097"><span id="local-6989586621680006099"><span id="local-6989586621680006101"><span id="local-6989586621680006104"><span id="local-6989586621680006105"><span id="local-6989586621680006106"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>  </span><span class="annot"><a href="#local-6989586621680006106"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006105"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-505"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680006106"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006105"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-506"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>  </span><span class="annot"><a href="#local-6989586621680006104"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006105"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-507"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680006104"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006105"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-508"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006106"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006104"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006105"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span id="local-6989586621680006079"><span id="local-6989586621680006081"><span id="local-6989586621680006083"><span id="local-6989586621680006085"><span id="local-6989586621680006086"><span id="local-6989586621680006087"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680006087"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006086"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-511"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680006085"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006086"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-512"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006087"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006085"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006086"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span id="local-6989586621680006075"><span id="local-6989586621680006076"><span id="local-6989586621680006077"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680006073"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="annot"><a href="#local-6989586621680006077"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006076"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-515"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compose</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="annot"><a href="#local-6989586621680006075"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680006076"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-516"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006077"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006075"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680006076"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-517"></span><span>  </span><span id="local-6989586621680006069"><span class="annot"><span class="annottext">showTypeOf :: Proxy (Telescope g f xs) -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">showTypeOf</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy (Telescope g f xs)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Telescope&quot;</span></span><span>
</span><span id="line-518"></span><span>  </span><span id="local-6989586621680006067"><span class="annot"><span class="annottext">wNoThunks :: Context -&gt; Telescope g f xs -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">wNoThunks</span></span></span><span> </span><span id="local-6989586621680006065"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680006065"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-519"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680006064"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006064"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context -&gt; f x -&gt; IO (Maybe ThunkInfo)
forall a. NoThunks a =&gt; Context -&gt; a -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var">noThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Context -&gt; Context
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680006065"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680006064"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680006062"><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006062"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680006061"><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006061"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[IO (Maybe ThunkInfo)] -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var">allNoThunks</span></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-521"></span><span>                   </span><span class="annot"><span class="annottext">Context -&gt; g x -&gt; IO (Maybe ThunkInfo)
forall a. NoThunks a =&gt; Context -&gt; a -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var">noThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;g&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Context -&gt; Context
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TS&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Context -&gt; Context
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680006065"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g x
</span><a href="#local-6989586621680006062"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-522"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Telescope g f xs -&gt; IO (Maybe ThunkInfo)
forall a. NoThunks a =&gt; Context -&gt; a -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var">noThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;t&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Context -&gt; Context
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TS&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Context -&gt; Context
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680006065"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope g f xs
</span><a href="#local-6989586621680006061"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-523"></span><span>                 </span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-524"></span></pre></body></html>