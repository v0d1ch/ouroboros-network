<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric       #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances   #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving  #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Protocol</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports to keep 'Protocol.State' an internal module</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkCanBeLeader"><span class="hs-identifier">HardForkCanBeLeader</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier">HardForkChainDepState</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkIsLeader"><span class="hs-identifier">HardForkIsLeader</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier">HardForkValidationErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports to keep 'Protocol.LedgerView' an internal module</span></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#HardForkLedgerView"><span class="hs-identifier">HardForkLedgerView</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#HardForkLedgerView_"><span class="hs-identifier">HardForkLedgerView_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Type family instances</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/mtl-2.2.2/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Data.Functor.Product</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.SOP.Strict.html"><span class="hs-identifier">Data.SOP.Strict</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">GHC.Stack</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Abstract</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html"><span class="hs-identifier">Ouroboros.Consensus.TypeFamilyWrappers</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.html"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.html#.%3A"><span class="hs-operator">(.:)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.OptNP.html"><span class="hs-identifier">Ouroboros.Consensus.Util.OptNP</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OptNP</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html"><span class="hs-identifier">Ouroboros.Consensus.Util.SOP</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Abstract</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.AcrossEras</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Basics</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Block.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Block</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Info.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Info</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.PartialConfig.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.PartialConfig</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView</span></a></span><span>
</span><span id="line-51"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#HardForkLedgerView"><span class="hs-identifier">HardForkLedgerView</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#HardForkLedgerView_"><span class="hs-identifier">HardForkLedgerView_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier">HardForkState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Translate"><span class="hs-identifier">Translate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Translation.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Translation</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span>
</span><span id="line-57"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InPairs</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Match</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Match</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  ChainSelection
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">newtype</span><span> </span><span id="HardForkSelectView"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-var">HardForkSelectView</span></a></span></span><span> </span><span id="local-6989586621680013631"><span class="annot"><a href="#local-6989586621680013631"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HardForkSelectView"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-var">HardForkSelectView</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-66"></span><span>      </span><span id="getHardForkSelectView"><span class="annot"><span class="annottext">HardForkSelectView xs -&gt; WithBlockNo OneEraSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#getHardForkSelectView"><span class="hs-identifier hs-var hs-var">getHardForkSelectView</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel.html#WithBlockNo"><span class="hs-identifier hs-type">WithBlockNo</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraSelectView"><span class="hs-identifier hs-type">OneEraSelectView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013631"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680013330"><span id="local-6989586621680013332"><span id="local-6989586621680013334"><span class="annot"><span class="annottext">Int -&gt; HardForkSelectView xs -&gt; ShowS
[HardForkSelectView xs] -&gt; ShowS
HardForkSelectView xs -&gt; String
(Int -&gt; HardForkSelectView xs -&gt; ShowS)
-&gt; (HardForkSelectView xs -&gt; String)
-&gt; ([HardForkSelectView xs] -&gt; ShowS)
-&gt; Show (HardForkSelectView xs)
forall (xs :: [*]).
CanHardFork xs =&gt;
Int -&gt; HardForkSelectView xs -&gt; ShowS
forall (xs :: [*]).
CanHardFork xs =&gt;
[HardForkSelectView xs] -&gt; ShowS
forall (xs :: [*]).
CanHardFork xs =&gt;
HardForkSelectView xs -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [HardForkSelectView xs] -&gt; ShowS
$cshowList :: forall (xs :: [*]).
CanHardFork xs =&gt;
[HardForkSelectView xs] -&gt; ShowS
show :: HardForkSelectView xs -&gt; String
$cshow :: forall (xs :: [*]).
CanHardFork xs =&gt;
HardForkSelectView xs -&gt; String
showsPrec :: Int -&gt; HardForkSelectView xs -&gt; ShowS
$cshowsPrec :: forall (xs :: [*]).
CanHardFork xs =&gt;
Int -&gt; HardForkSelectView xs -&gt; ShowS
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680013325"><span id="local-6989586621680013327"><span class="annot"><span class="annottext">HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool
(HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool)
-&gt; (HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool)
-&gt; Eq (HardForkSelectView xs)
forall (xs :: [*]).
CanHardFork xs =&gt;
HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool
$c/= :: forall (xs :: [*]).
CanHardFork xs =&gt;
HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool
== :: HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool
$c== :: forall (xs :: [*]).
CanHardFork xs =&gt;
HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span id="local-6989586621680013323"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680013309"><span id="local-6989586621680013311"><span id="local-6989586621680013313"><span id="local-6989586621680013315"><span id="local-6989586621680013317"><span id="local-6989586621680013319"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013323"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-type">HardForkSelectView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013323"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621680013307"><span class="annot"><span class="annottext">compare :: HardForkSelectView xs -&gt; HardForkSelectView xs -&gt; Ordering
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-type">HardForkSelectView</span></a></span><span> </span><span id="local-6989586621680013305"><span class="annot"><span class="annottext">WithBlockNo OneEraSelectView xs
</span><a href="#local-6989586621680013305"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-type">HardForkSelectView</span></a></span><span> </span><span id="local-6989586621680013304"><span class="annot"><span class="annottext">WithBlockNo OneEraSelectView xs
</span><a href="#local-6989586621680013304"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>     </span><span class="annot"><span class="annottext">Tails AcrossEraSelection xs
-&gt; WithBlockNo (NS WrapSelectView) xs
-&gt; WithBlockNo (NS WrapSelectView) xs
-&gt; Ordering
forall (xs :: [*]).
All SingleEraBlock xs =&gt;
Tails AcrossEraSelection xs
-&gt; WithBlockNo (NS WrapSelectView) xs
-&gt; WithBlockNo (NS WrapSelectView) xs
-&gt; Ordering
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel.html#acrossEraSelection"><span class="hs-identifier hs-var">acrossEraSelection</span></a></span><span>
</span><span id="line-73"></span><span>       </span><span class="annot"><span class="annottext">Tails AcrossEraSelection xs
forall (xs :: [*]). CanHardFork xs =&gt; Tails AcrossEraSelection xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#hardForkChainSel"><span class="hs-identifier hs-var">hardForkChainSel</span></a></span><span>
</span><span id="line-74"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OneEraSelectView xs -&gt; NS WrapSelectView xs)
-&gt; WithBlockNo OneEraSelectView xs
-&gt; WithBlockNo (NS WrapSelectView) xs
forall k1 k2 (f :: k1 -&gt; *) (x :: k1) (g :: k2 -&gt; *) (y :: k2).
(f x -&gt; g y) -&gt; WithBlockNo f x -&gt; WithBlockNo g y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel.html#mapWithBlockNo"><span class="hs-identifier hs-var">mapWithBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">OneEraSelectView xs -&gt; NS WrapSelectView xs
forall (xs :: [*]). OneEraSelectView xs -&gt; NS WrapSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getOneEraSelectView"><span class="hs-identifier hs-var hs-var">getOneEraSelectView</span></a></span><span> </span><span class="annot"><span class="annottext">WithBlockNo OneEraSelectView xs
</span><a href="#local-6989586621680013305"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OneEraSelectView xs -&gt; NS WrapSelectView xs)
-&gt; WithBlockNo OneEraSelectView xs
-&gt; WithBlockNo (NS WrapSelectView) xs
forall k1 k2 (f :: k1 -&gt; *) (x :: k1) (g :: k2 -&gt; *) (y :: k2).
(f x -&gt; g y) -&gt; WithBlockNo f x -&gt; WithBlockNo g y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel.html#mapWithBlockNo"><span class="hs-identifier hs-var">mapWithBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">OneEraSelectView xs -&gt; NS WrapSelectView xs
forall (xs :: [*]). OneEraSelectView xs -&gt; NS WrapSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getOneEraSelectView"><span class="hs-identifier hs-var hs-var">getOneEraSelectView</span></a></span><span> </span><span class="annot"><span class="annottext">WithBlockNo OneEraSelectView xs
</span><a href="#local-6989586621680013304"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span id="local-6989586621680013553"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#mkHardForkSelectView"><span class="hs-identifier hs-type">mkHardForkSelectView</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-78"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapSelectView"><span class="hs-identifier hs-type">WrapSelectView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013553"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-type">HardForkSelectView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013553"><span class="hs-identifier hs-type">xs</span></a></span></span><span>
</span><span id="line-81"></span><span id="mkHardForkSelectView"><span class="annot"><span class="annottext">mkHardForkSelectView :: BlockNo -&gt; NS WrapSelectView xs -&gt; HardForkSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#mkHardForkSelectView"><span class="hs-identifier hs-var hs-var">mkHardForkSelectView</span></a></span></span><span> </span><span id="local-6989586621680013298"><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621680013298"><span class="hs-identifier hs-var">bno</span></a></span></span><span> </span><span id="local-6989586621680013297"><span class="annot"><span class="annottext">NS WrapSelectView xs
</span><a href="#local-6989586621680013297"><span class="hs-identifier hs-var">view</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">WithBlockNo OneEraSelectView xs -&gt; HardForkSelectView xs
forall (xs :: [*]).
WithBlockNo OneEraSelectView xs -&gt; HardForkSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-var">HardForkSelectView</span></a></span><span> </span><span class="annot"><span class="annottext">(WithBlockNo OneEraSelectView xs -&gt; HardForkSelectView xs)
-&gt; WithBlockNo OneEraSelectView xs -&gt; HardForkSelectView xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNo -&gt; OneEraSelectView xs -&gt; WithBlockNo OneEraSelectView xs
forall k (f :: k -&gt; *) (a :: k). BlockNo -&gt; f a -&gt; WithBlockNo f a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.ChainSel.html#WithBlockNo"><span class="hs-identifier hs-var">WithBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621680013298"><span class="hs-identifier hs-var">bno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NS WrapSelectView xs -&gt; OneEraSelectView xs
forall (xs :: [*]). NS WrapSelectView xs -&gt; OneEraSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraSelectView"><span class="hs-identifier hs-var">OneEraSelectView</span></a></span><span> </span><span class="annot"><span class="annottext">NS WrapSelectView xs
</span><a href="#local-6989586621680013297"><span class="hs-identifier hs-var">view</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  ConsensusProtocol
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">type</span><span> </span><span id="HardForkChainDepState"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-var">HardForkChainDepState</span></a></span></span><span> </span><span id="local-6989586621680013294"><span class="annot"><a href="#local-6989586621680013294"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013294"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621680013293"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusProtocol"><span class="hs-identifier hs-type">ConsensusProtocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ChainDepState"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ChainDepState"><span class="hs-identifier hs-var">ChainDepState</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ValidationErr"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ValidationErr"><span class="hs-identifier hs-var">ValidationErr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="SelectView"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#SelectView"><span class="hs-identifier hs-var">SelectView</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkSelectView"><span class="hs-identifier hs-type">HardForkSelectView</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="LedgerView"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#LedgerView"><span class="hs-identifier hs-var">LedgerView</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#HardForkLedgerView"><span class="hs-identifier hs-type">HardForkLedgerView</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="CanBeLeader"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#CanBeLeader"><span class="hs-identifier hs-var">CanBeLeader</span></a></span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkCanBeLeader"><span class="hs-identifier hs-type">HardForkCanBeLeader</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="IsLeader"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#IsLeader"><span class="hs-identifier hs-var">IsLeader</span></a></span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkIsLeader"><span class="hs-identifier hs-type">HardForkIsLeader</span></a></span><span>      </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ValidateView"><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ValidateView"><span class="hs-identifier hs-var">ValidateView</span></a></span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidateView"><span class="hs-identifier hs-type">OneEraValidateView</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621680013293"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-comment">-- Operations on the state</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621680013275"><span class="annot"><span class="annottext">tickChainDepState :: ConsensusConfig (HardForkProtocol xs)
-&gt; Ticked (LedgerView (HardForkProtocol xs))
-&gt; SlotNo
-&gt; ChainDepState (HardForkProtocol xs)
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#tickChainDepState"><span class="hs-identifier hs-var hs-var hs-var hs-var">tickChainDepState</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (HardForkProtocol xs)
-&gt; Ticked (LedgerView (HardForkProtocol xs))
-&gt; SlotNo
-&gt; ChainDepState (HardForkProtocol xs)
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
forall (xs :: [*]).
CanHardFork xs =&gt;
ConsensusConfig (HardForkProtocol xs)
-&gt; Ticked (HardForkLedgerView xs)
-&gt; SlotNo
-&gt; HardForkChainDepState xs
-&gt; Ticked (HardForkChainDepState xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tick"><span class="hs-identifier hs-var">tick</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680013272"><span class="annot"><span class="annottext">checkIsLeader :: ConsensusConfig (HardForkProtocol xs)
-&gt; CanBeLeader (HardForkProtocol xs)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; Maybe (IsLeader (HardForkProtocol xs))
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#checkIsLeader"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkIsLeader</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (HardForkProtocol xs)
-&gt; CanBeLeader (HardForkProtocol xs)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; Maybe (IsLeader (HardForkProtocol xs))
forall (xs :: [*]).
(CanHardFork xs, HasCallStack) =&gt;
ConsensusConfig (HardForkProtocol xs)
-&gt; HardForkCanBeLeader xs
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; Maybe (HardForkIsLeader xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#check"><span class="hs-identifier hs-var">check</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621680013269"><span class="annot"><span class="annottext">updateChainDepState :: ConsensusConfig (HardForkProtocol xs)
-&gt; ValidateView (HardForkProtocol xs)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; Except
     (ValidationErr (HardForkProtocol xs))
     (ChainDepState (HardForkProtocol xs))
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#updateChainDepState"><span class="hs-identifier hs-var hs-var hs-var hs-var">updateChainDepState</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (HardForkProtocol xs)
-&gt; ValidateView (HardForkProtocol xs)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; Except
     (ValidationErr (HardForkProtocol xs))
     (ChainDepState (HardForkProtocol xs))
forall (xs :: [*]).
CanHardFork xs =&gt;
ConsensusConfig (HardForkProtocol xs)
-&gt; OneEraValidateView xs
-&gt; SlotNo
-&gt; Ticked (HardForkChainDepState xs)
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#update"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621680013266"><span class="annot"><span class="annottext">reupdateChainDepState :: ConsensusConfig (HardForkProtocol xs)
-&gt; ValidateView (HardForkProtocol xs)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; ChainDepState (HardForkProtocol xs)
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#reupdateChainDepState"><span class="hs-identifier hs-var hs-var hs-var hs-var">reupdateChainDepState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (HardForkProtocol xs)
-&gt; ValidateView (HardForkProtocol xs)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; ChainDepState (HardForkProtocol xs)
forall (xs :: [*]).
CanHardFork xs =&gt;
ConsensusConfig (HardForkProtocol xs)
-&gt; OneEraValidateView xs
-&gt; SlotNo
-&gt; Ticked (HardForkChainDepState xs)
-&gt; HardForkChainDepState xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#reupdate"><span class="hs-identifier hs-var">reupdate</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- Straight-forward extensions</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- Security parameter must be equal across /all/ eras</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621680013263"><span class="annot"><span class="annottext">protocolSecurityParam :: ConsensusConfig (HardForkProtocol xs) -&gt; SecurityParam
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#protocolSecurityParam"><span class="hs-identifier hs-var hs-var hs-var hs-var">protocolSecurityParam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (HardForkProtocol xs) -&gt; SecurityParam
forall (xs :: [*]).
ConsensusConfig (HardForkProtocol xs) -&gt; SecurityParam
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#hardForkConsensusConfigK"><span class="hs-identifier hs-var hs-var">hardForkConsensusConfigK</span></a></span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  BlockSupportsProtocol
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span id="local-6989586621680013260"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013260"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.SupportsProtocol.html#BlockSupportsProtocol"><span class="hs-identifier hs-type">BlockSupportsProtocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013260"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621680013249"><span class="annot"><span class="annottext">validateView :: BlockConfig (HardForkBlock xs)
-&gt; Header (HardForkBlock xs)
-&gt; ValidateView (BlockProtocol (HardForkBlock xs))
</span><a href="Ouroboros.Consensus.Block.SupportsProtocol.html#validateView"><span class="hs-identifier hs-var hs-var hs-var hs-var">validateView</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlockConfig"><span class="hs-identifier hs-type">HardForkBlockConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013246"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#hardForkBlockConfigPerEra"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="annottext">NS WrapValidateView xs -&gt; OneEraValidateView xs
forall (xs :: [*]). NS WrapValidateView xs -&gt; OneEraValidateView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidateView"><span class="hs-identifier hs-var">OneEraValidateView</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">(NS WrapValidateView xs -&gt; OneEraValidateView xs)
-&gt; (Header (HardForkBlock xs) -&gt; NS WrapValidateView xs)
-&gt; Header (HardForkBlock xs)
-&gt; OneEraValidateView xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    BlockConfig a -&gt; Header a -&gt; WrapValidateView a)
-&gt; Prod NS BlockConfig xs
-&gt; NS Header xs
-&gt; NS WrapValidateView xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (f'' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h, HAp (Prod h)) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a -&gt; f'' a)
-&gt; Prod h f xs
-&gt; h f' xs
-&gt; h f'' xs
</span><span class="hs-identifier hs-var">hczipWith</span></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidateView (BlockProtocol a) -&gt; WrapValidateView a
forall blk.
ValidateView (BlockProtocol blk) -&gt; WrapValidateView blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapValidateView"><span class="hs-identifier hs-var">WrapValidateView</span></a></span><span> </span><span class="annot"><span class="annottext">(ValidateView (BlockProtocol a) -&gt; WrapValidateView a)
-&gt; (BlockConfig a -&gt; Header a -&gt; ValidateView (BlockProtocol a))
-&gt; BlockConfig a
-&gt; Header a
-&gt; WrapValidateView a
forall y z x0 x1. (y -&gt; z) -&gt; (x0 -&gt; x1 -&gt; y) -&gt; x0 -&gt; x1 -&gt; z
</span><a href="Ouroboros.Consensus.Util.html#.%3A"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">BlockConfig a -&gt; Header a -&gt; ValidateView (BlockProtocol a)
forall blk.
BlockSupportsProtocol blk =&gt;
BlockConfig blk -&gt; Header blk -&gt; ValidateView (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.Block.SupportsProtocol.html#validateView"><span class="hs-identifier hs-var">validateView</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prod NS BlockConfig xs
NP BlockConfig xs
</span><a href="#local-6989586621680013239"><span class="hs-identifier hs-var">cfgs</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">(NS Header xs -&gt; NS WrapValidateView xs)
-&gt; (Header (HardForkBlock xs) -&gt; NS Header xs)
-&gt; Header (HardForkBlock xs)
-&gt; NS WrapValidateView xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OneEraHeader xs -&gt; NS Header xs
forall (xs :: [*]). OneEraHeader xs -&gt; NS Header xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getOneEraHeader"><span class="hs-identifier hs-var hs-var">getOneEraHeader</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><span class="annottext">(OneEraHeader xs -&gt; NS Header xs)
-&gt; (Header (HardForkBlock xs) -&gt; OneEraHeader xs)
-&gt; Header (HardForkBlock xs)
-&gt; NS Header xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Header (HardForkBlock xs) -&gt; OneEraHeader xs
forall (xs :: [*]). Header (HardForkBlock xs) -&gt; OneEraHeader xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Block.html#getHardForkHeader"><span class="hs-identifier hs-var hs-var">getHardForkHeader</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>      </span><span id="local-6989586621680013239"><span class="annot"><span class="annottext">cfgs :: NP BlockConfig xs
</span><a href="#local-6989586621680013239"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraBlockConfig xs -&gt; NP BlockConfig xs
forall (xs :: [*]). PerEraBlockConfig xs -&gt; NP BlockConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraBlockConfig"><span class="hs-identifier hs-var hs-var">getPerEraBlockConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraBlockConfig xs
</span><a href="#local-6989586621680013246"><span class="hs-identifier hs-var">hardForkBlockConfigPerEra</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621680013235"><span class="annot"><span class="annottext">selectView :: BlockConfig (HardForkBlock xs)
-&gt; Header (HardForkBlock xs)
-&gt; SelectView (BlockProtocol (HardForkBlock xs))
</span><a href="Ouroboros.Consensus.Block.SupportsProtocol.html#selectView"><span class="hs-identifier hs-var hs-var hs-var hs-var">selectView</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlockConfig"><span class="hs-identifier hs-type">HardForkBlockConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013233"><span class="annot"><a href="#local-6989586621680013233"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680013232"><span class="annot"><span class="annottext">Header (HardForkBlock xs)
</span><a href="#local-6989586621680013232"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">BlockNo -&gt; NS WrapSelectView xs -&gt; HardForkSelectView xs
forall (xs :: [*]).
BlockNo -&gt; NS WrapSelectView xs -&gt; HardForkSelectView xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#mkHardForkSelectView"><span class="hs-identifier hs-var">mkHardForkSelectView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Header (HardForkBlock xs) -&gt; BlockNo
forall b. HasHeader b =&gt; b -&gt; BlockNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">blockNo</span></a></span><span> </span><span class="annot"><span class="annottext">Header (HardForkBlock xs)
</span><a href="#local-6989586621680013232"><span class="hs-identifier hs-var">hdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="annottext">(NS WrapSelectView xs -&gt; HardForkSelectView xs)
-&gt; (OneEraHeader xs -&gt; NS WrapSelectView xs)
-&gt; OneEraHeader xs
-&gt; HardForkSelectView xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    BlockConfig a -&gt; Header a -&gt; WrapSelectView a)
-&gt; Prod NS BlockConfig xs
-&gt; NS Header xs
-&gt; NS WrapSelectView xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (f'' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h, HAp (Prod h)) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a -&gt; f'' a)
-&gt; Prod h f xs
-&gt; h f' xs
-&gt; h f'' xs
</span><span class="hs-identifier hs-var">hczipWith</span></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectView (BlockProtocol a) -&gt; WrapSelectView a
forall blk. SelectView (BlockProtocol blk) -&gt; WrapSelectView blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapSelectView"><span class="hs-identifier hs-var">WrapSelectView</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectView (BlockProtocol a) -&gt; WrapSelectView a)
-&gt; (BlockConfig a -&gt; Header a -&gt; SelectView (BlockProtocol a))
-&gt; BlockConfig a
-&gt; Header a
-&gt; WrapSelectView a
forall y z x0 x1. (y -&gt; z) -&gt; (x0 -&gt; x1 -&gt; y) -&gt; x0 -&gt; x1 -&gt; z
</span><a href="Ouroboros.Consensus.Util.html#.%3A"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">BlockConfig a -&gt; Header a -&gt; SelectView (BlockProtocol a)
forall blk.
BlockSupportsProtocol blk =&gt;
BlockConfig blk -&gt; Header blk -&gt; SelectView (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.Block.SupportsProtocol.html#selectView"><span class="hs-identifier hs-var">selectView</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prod NS BlockConfig xs
NP BlockConfig xs
</span><a href="#local-6989586621680013229"><span class="hs-identifier hs-var">cfgs</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">(NS Header xs -&gt; NS WrapSelectView xs)
-&gt; (OneEraHeader xs -&gt; NS Header xs)
-&gt; OneEraHeader xs
-&gt; NS WrapSelectView xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OneEraHeader xs -&gt; NS Header xs
forall (xs :: [*]). OneEraHeader xs -&gt; NS Header xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getOneEraHeader"><span class="hs-identifier hs-var hs-var">getOneEraHeader</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">(OneEraHeader xs -&gt; HardForkSelectView xs)
-&gt; OneEraHeader xs -&gt; HardForkSelectView xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Header (HardForkBlock xs) -&gt; OneEraHeader xs
forall (xs :: [*]). Header (HardForkBlock xs) -&gt; OneEraHeader xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Block.html#getHardForkHeader"><span class="hs-identifier hs-var hs-var">getHardForkHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Header (HardForkBlock xs)
</span><a href="#local-6989586621680013232"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>      </span><span id="local-6989586621680013229"><span class="annot"><span class="annottext">cfgs :: NP BlockConfig xs
</span><a href="#local-6989586621680013229"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraBlockConfig xs -&gt; NP BlockConfig xs
forall (xs :: [*]). PerEraBlockConfig xs -&gt; NP BlockConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraBlockConfig"><span class="hs-identifier hs-var hs-var">getPerEraBlockConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraBlockConfig xs
</span><a href="#local-6989586621680013233"><span class="hs-identifier hs-var">hardForkBlockConfigPerEra</span></a></span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Ticking the chain dependent state
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Ticked"><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-var">Ticked</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span id="local-6989586621680013540"><span class="annot"><a href="#local-6989586621680013540"><span class="hs-identifier hs-type hs-type">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>    </span><span id="TickedHardForkChainDepState"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#TickedHardForkChainDepState"><span class="hs-identifier hs-var">TickedHardForkChainDepState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-140"></span><span>        </span><span id="tickedHardForkChainDepStatePerEra"><span class="annot"><span class="annottext">Ticked (HardForkChainDepState xs)
-&gt; HardForkState (Ticked :.: WrapChainDepState) xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tickedHardForkChainDepStatePerEra"><span class="hs-identifier hs-var hs-var">tickedHardForkChainDepStatePerEra</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-141"></span><span>             </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013540"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">-- | 'EpochInfo' constructed from the ticked 'LedgerView'</span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="tickedHardForkChainDepStateEpochInfo"><span class="annot"><span class="annottext">Ticked (HardForkChainDepState xs)
-&gt; EpochInfo (Except PastHorizonException)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tickedHardForkChainDepStateEpochInfo"><span class="hs-identifier hs-var hs-var">tickedHardForkChainDepStateEpochInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-145"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">EpochInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span id="local-6989586621680013606"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tick"><span class="hs-identifier hs-type">tick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013606"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-149"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusConfig"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013606"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#HardForkLedgerView"><span class="hs-identifier hs-type">HardForkLedgerView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013606"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-152"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013606"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-153"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013606"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-154"></span><span id="tick"><span class="annot"><span class="annottext">tick :: ConsensusConfig (HardForkProtocol xs)
-&gt; Ticked (HardForkLedgerView xs)
-&gt; SlotNo
-&gt; HardForkChainDepState xs
-&gt; Ticked (HardForkChainDepState xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tick"><span class="hs-identifier hs-var hs-var">tick</span></a></span></span><span> </span><span id="local-6989586621680013225"><span class="annot"><span class="annottext">cfg :: ConsensusConfig (HardForkProtocol xs)
</span><a href="#local-6989586621680013225"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkConsensusConfig"><span class="hs-identifier hs-type">HardForkConsensusConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013221"><span id="local-6989586621680013222"><span id="local-6989586621680013223"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#hardForkConsensusConfigPerEra"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-155"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.LedgerView.html#TickedHardForkLedgerView"><span class="hs-identifier hs-type">TickedHardForkLedgerView</span></a></span><span> </span><span id="local-6989586621680013217"><span class="annot"><a href="#local-6989586621680013217"><span class="hs-identifier hs-var">transition</span></a></span></span><span> </span><span id="local-6989586621680013216"><span class="annot"><a href="#local-6989586621680013216"><span class="hs-identifier hs-var">ledgerView</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>     </span><span id="local-6989586621680013215"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013215"><span class="hs-identifier hs-var">slot</span></a></span></span><span>
</span><span id="line-157"></span><span>     </span><span id="local-6989586621680013214"><span class="annot"><span class="annottext">HardForkChainDepState xs
</span><a href="#local-6989586621680013214"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TickedHardForkChainDepState :: forall (xs :: [*]).
HardForkState (Ticked :.: WrapChainDepState) xs
-&gt; EpochInfo (Except PastHorizonException)
-&gt; Ticked (HardForkChainDepState xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#TickedHardForkChainDepState"><span class="hs-identifier hs-type">TickedHardForkChainDepState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><span class="annottext">tickedHardForkChainDepStateEpochInfo :: EpochInfo (Except PastHorizonException)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tickedHardForkChainDepStateEpochInfo"><span class="hs-identifier hs-var">tickedHardForkChainDepStateEpochInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013213"><span class="hs-identifier hs-var">ei</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tickedHardForkChainDepStatePerEra :: HardForkState (Ticked :.: WrapChainDepState) xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#tickedHardForkChainDepStatePerEra"><span class="hs-identifier hs-var">tickedHardForkChainDepStatePerEra</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>         </span><span class="annot"><span class="annottext">InPairs (Translate WrapChainDepState) xs
-&gt; NP
     ((Ticked :.: WrapLedgerView)
      -.-&gt; (WrapChainDepState -.-&gt; (Ticked :.: WrapChainDepState)))
     xs
-&gt; HardForkState (Ticked :.: WrapLedgerView) xs
-&gt; HardForkChainDepState xs
-&gt; HardForkState (Ticked :.: WrapChainDepState) xs
forall (xs :: [*]) (f :: * -&gt; *) (f' :: * -&gt; *) (f'' :: * -&gt; *).
All SingleEraBlock xs =&gt;
InPairs (Translate f) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; HardForkState f' xs
-&gt; HardForkState f xs
-&gt; HardForkState f'' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#align"><span class="hs-identifier hs-var">State.align</span></a></span><span>
</span><span id="line-161"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; ConsensusConfig (HardForkProtocol xs)
-&gt; InPairs (Translate WrapChainDepState) xs
forall (xs :: [*]).
CanHardFork xs =&gt;
EpochInfo (Except PastHorizonException)
-&gt; ConsensusConfig (HardForkProtocol xs)
-&gt; InPairs (Translate WrapChainDepState) xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#translateConsensus"><span class="hs-identifier hs-var">translateConsensus</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013213"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (HardForkProtocol xs)
</span><a href="#local-6989586621680013225"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    WrapPartialConsensusConfig a
    -&gt; (-.-&gt;)
         (Ticked :.: WrapLedgerView)
         (WrapChainDepState -.-&gt; (Ticked :.: WrapChainDepState))
         a)
-&gt; NP WrapPartialConsensusConfig xs
-&gt; NP
     ((Ticked :.: WrapLedgerView)
      -.-&gt; (WrapChainDepState -.-&gt; (Ticked :.: WrapChainDepState)))
     xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hcmap</span></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((:.:) Ticked WrapLedgerView a
 -&gt; WrapChainDepState a -&gt; (:.:) Ticked WrapChainDepState a)
-&gt; (-.-&gt;)
     (Ticked :.: WrapLedgerView)
     (WrapChainDepState -.-&gt; (Ticked :.: WrapChainDepState))
     a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *) (f'' :: k -&gt; *).
(f a -&gt; f' a -&gt; f'' a) -&gt; (-.-&gt;) f (f' -.-&gt; f'') a
</span><span class="hs-identifier hs-var">fn_2</span></span><span> </span><span class="annot"><span class="annottext">(((:.:) Ticked WrapLedgerView a
  -&gt; WrapChainDepState a -&gt; (:.:) Ticked WrapChainDepState a)
 -&gt; (-.-&gt;)
      (Ticked :.: WrapLedgerView)
      (WrapChainDepState -.-&gt; (Ticked :.: WrapChainDepState))
      a)
-&gt; (WrapPartialConsensusConfig a
    -&gt; (:.:) Ticked WrapLedgerView a
    -&gt; WrapChainDepState a
    -&gt; (:.:) Ticked WrapChainDepState a)
-&gt; WrapPartialConsensusConfig a
-&gt; (-.-&gt;)
     (Ticked :.: WrapLedgerView)
     (WrapChainDepState -.-&gt; (Ticked :.: WrapChainDepState))
     a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WrapPartialConsensusConfig a
-&gt; (:.:) Ticked WrapLedgerView a
-&gt; WrapChainDepState a
-&gt; (:.:) Ticked WrapChainDepState a
forall blk.
SingleEraBlock blk =&gt;
WrapPartialConsensusConfig blk
-&gt; (:.:) Ticked WrapLedgerView blk
-&gt; WrapChainDepState blk
-&gt; (:.:) Ticked WrapChainDepState blk
</span><a href="#local-6989586621680013208"><span class="hs-identifier hs-var">tickOne</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013207"><span class="hs-identifier hs-var">cfgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>           </span><span class="annot"><span class="annottext">HardForkState (Ticked :.: WrapLedgerView) xs
</span><a href="#local-6989586621680013216"><span class="hs-identifier hs-var">ledgerView</span></a></span><span>
</span><span id="line-164"></span><span>           </span><span class="annot"><span class="annottext">HardForkChainDepState xs
</span><a href="#local-6989586621680013214"><span class="hs-identifier hs-var">chainDepState</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621680013207"><span class="annot"><span class="annottext">cfgs :: NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013207"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
forall (xs :: [*]).
PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraConsensusConfig"><span class="hs-identifier hs-var hs-var">getPerEraConsensusConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs
</span><a href="#local-6989586621680013221"><span class="hs-identifier hs-var">hardForkConsensusConfigPerEra</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621680013213"><span class="annot"><span class="annottext">ei :: EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013213"><span class="hs-identifier hs-var hs-var">ei</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shape xs
-&gt; TransitionInfo
-&gt; HardForkState (Ticked :.: WrapLedgerView) xs
-&gt; EpochInfo (Except PastHorizonException)
forall (xs :: [*]) (f :: * -&gt; *).
Shape xs
-&gt; TransitionInfo
-&gt; HardForkState f xs
-&gt; EpochInfo (Except PastHorizonException)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.html#epochInfoPrecomputedTransitionInfo"><span class="hs-identifier hs-var">State.epochInfoPrecomputedTransitionInfo</span></a></span><span>
</span><span id="line-169"></span><span>             </span><span class="annot"><span class="annottext">Shape xs
</span><a href="#local-6989586621680013222"><span class="hs-identifier hs-var">hardForkConsensusConfigShape</span></a></span><span>
</span><span id="line-170"></span><span>             </span><span class="annot"><span class="annottext">TransitionInfo
</span><a href="#local-6989586621680013217"><span class="hs-identifier hs-var">transition</span></a></span><span>
</span><span id="line-171"></span><span>             </span><span class="annot"><span class="annottext">HardForkState (Ticked :.: WrapLedgerView) xs
</span><a href="#local-6989586621680013216"><span class="hs-identifier hs-var">ledgerView</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621680013514"><span class="annot"><a href="#local-6989586621680013208"><span class="hs-identifier hs-type">tickOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span>                 </span><span class="annot"><a href="#local-6989586621680013514"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-174"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.PartialConfig.html#WrapPartialConsensusConfig"><span class="hs-identifier hs-type">WrapPartialConsensusConfig</span></a></span><span>     </span><span class="annot"><a href="#local-6989586621680013514"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapLedgerView"><span class="hs-identifier hs-type">WrapLedgerView</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><a href="#local-6989586621680013514"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span>              </span><span class="annot"><a href="#local-6989586621680013514"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013514"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621680013208"><span class="annot"><span class="annottext">tickOne :: WrapPartialConsensusConfig blk
-&gt; (:.:) Ticked WrapLedgerView blk
-&gt; WrapChainDepState blk
-&gt; (:.:) Ticked WrapChainDepState blk
</span><a href="#local-6989586621680013208"><span class="hs-identifier hs-var hs-var">tickOne</span></a></span></span><span> </span><span id="local-6989586621680013204"><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013204"><span class="hs-identifier hs-var">cfg'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680013202"><span class="annot"><span class="annottext">Ticked (WrapLedgerView blk)
</span><a href="#local-6989586621680013202"><span class="hs-identifier hs-var">ledgerView'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680013201"><span class="annot"><span class="annottext">WrapChainDepState blk
</span><a href="#local-6989586621680013201"><span class="hs-identifier hs-var">chainDepState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
-&gt; (:.:) Ticked WrapChainDepState blk
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(Ticked (WrapChainDepState blk)
 -&gt; (:.:) Ticked WrapChainDepState blk)
-&gt; Ticked (WrapChainDepState blk)
-&gt; (:.:) Ticked WrapChainDepState blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">Ticked (ChainDepState (BlockProtocol blk))
-&gt; Ticked (WrapChainDepState blk)
forall blk.
Ticked (ChainDepState (BlockProtocol blk))
-&gt; Ticked (WrapChainDepState blk)
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapTickedChainDepState"><span class="hs-identifier hs-var">WrapTickedChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">(Ticked (ChainDepState (BlockProtocol blk))
 -&gt; Ticked (WrapChainDepState blk))
-&gt; Ticked (ChainDepState (BlockProtocol blk))
-&gt; Ticked (WrapChainDepState blk)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-180"></span><span>          </span><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol blk)
-&gt; Ticked (LedgerView (BlockProtocol blk))
-&gt; SlotNo
-&gt; ChainDepState (BlockProtocol blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
forall p.
ConsensusProtocol p =&gt;
ConsensusConfig p
-&gt; Ticked (LedgerView p)
-&gt; SlotNo
-&gt; ChainDepState p
-&gt; Ticked (ChainDepState p)
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#tickChainDepState"><span class="hs-identifier hs-var">tickChainDepState</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
forall blk.
HasPartialConsensusConfig (BlockProtocol blk) =&gt;
EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#completeConsensusConfig%27"><span class="hs-identifier hs-var">completeConsensusConfig'</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013213"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013204"><span class="hs-identifier hs-var">cfg'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ticked (WrapLedgerView blk)
-&gt; Ticked (LedgerView (BlockProtocol blk))
forall blk.
Ticked (WrapLedgerView blk)
-&gt; Ticked (LedgerView (BlockProtocol blk))
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapTickedLedgerView"><span class="hs-identifier hs-var hs-var">unwrapTickedLedgerView</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (WrapLedgerView blk)
</span><a href="#local-6989586621680013202"><span class="hs-identifier hs-var">ledgerView'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>            </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013215"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WrapChainDepState blk -&gt; ChainDepState (BlockProtocol blk)
forall blk.
WrapChainDepState blk -&gt; ChainDepState (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapChainDepState"><span class="hs-identifier hs-var hs-var">unwrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">WrapChainDepState blk
</span><a href="#local-6989586621680013201"><span class="hs-identifier hs-var">chainDepState'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Leader check

  NOTE: The precondition to 'align' is satisfied: the consensus state will never
  be ahead (but possibly behind) the ledger state, which we tick first.
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">-- | We are a leader if we have a proof from one of the eras</span><span>
</span><span id="line-194"></span><span class="hs-keyword">type</span><span> </span><span id="HardForkIsLeader"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkIsLeader"><span class="hs-identifier hs-var">HardForkIsLeader</span></a></span></span><span> </span><span id="local-6989586621680013196"><span class="annot"><a href="#local-6989586621680013196"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraIsLeader"><span class="hs-identifier hs-type">OneEraIsLeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013196"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- | We have one or more 'BlockForging's, and thus 'CanBeLeader' proofs, for</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- each era in which we can forge blocks.</span><span>
</span><span id="line-198"></span><span class="hs-keyword">type</span><span> </span><span id="HardForkCanBeLeader"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkCanBeLeader"><span class="hs-identifier hs-var">HardForkCanBeLeader</span></a></span></span><span> </span><span id="local-6989586621680013195"><span class="annot"><a href="#local-6989586621680013195"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#SomeErasCanBeLeader"><span class="hs-identifier hs-type">SomeErasCanBeLeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013195"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | POSTCONDITION: if the result is @Just isLeader@, then 'HardForkCanBeLeader'</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- and the ticked 'ChainDepState' must be in the same era. The returned</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- @isLeader@ will be from the same era.</span><span>
</span><span id="line-203"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#check"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680013603"><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusConfig"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkCanBeLeader"><span class="hs-identifier hs-type">HardForkCanBeLeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ChainDepState"><span class="hs-identifier hs-type">ChainDepState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkIsLeader"><span class="hs-identifier hs-type">HardForkIsLeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span id="check"><span class="annot"><span class="annottext">check :: ConsensusConfig (HardForkProtocol xs)
-&gt; HardForkCanBeLeader xs
-&gt; SlotNo
-&gt; Ticked (ChainDepState (HardForkProtocol xs))
-&gt; Maybe (HardForkIsLeader xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#check"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkConsensusConfig"><span class="hs-identifier hs-type">HardForkConsensusConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013191"><span id="local-6989586621680013192"><span id="local-6989586621680013193"><span class="annot"><a href="#local-6989586621680013191"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#SomeErasCanBeLeader"><span class="hs-identifier hs-type">SomeErasCanBeLeader</span></a></span><span> </span><span id="local-6989586621680013189"><span class="annot"><span class="annottext">OptNP 'False WrapCanBeLeader xs
</span><a href="#local-6989586621680013189"><span class="hs-identifier hs-var">canBeLeader</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>      </span><span id="local-6989586621680013188"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013188"><span class="hs-identifier hs-var">slot</span></a></span></span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#TickedHardForkChainDepState"><span class="hs-identifier hs-type">TickedHardForkChainDepState</span></a></span><span> </span><span id="local-6989586621680013187"><span class="annot"><a href="#local-6989586621680013187"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span> </span><span id="local-6989586621680013186"><span class="annot"><a href="#local-6989586621680013186"><span class="hs-identifier hs-var">ei</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">NS (Maybe :.: WrapIsLeader) xs -&gt; Maybe (HardForkIsLeader xs)
</span><a href="#local-6989586621680013185"><span class="hs-identifier hs-var">undistrib</span></a></span><span> </span><span class="annot"><span class="annottext">(NS (Maybe :.: WrapIsLeader) xs -&gt; Maybe (HardForkIsLeader xs))
-&gt; NS (Maybe :.: WrapIsLeader) xs -&gt; Maybe (HardForkIsLeader xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    WrapPartialConsensusConfig a
    -&gt; (:.:) Maybe WrapCanBeLeader a
    -&gt; (:.:) Ticked WrapChainDepState a
    -&gt; (:.:) Maybe WrapIsLeader a)
-&gt; Prod NS WrapPartialConsensusConfig xs
-&gt; Prod NS (Maybe :.: WrapCanBeLeader) xs
-&gt; NS (Ticked :.: WrapChainDepState) xs
-&gt; NS (Maybe :.: WrapIsLeader) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (f'' :: k -&gt; *) (f''' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h, HAp (Prod h)) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a -&gt; f'' a -&gt; f''' a)
-&gt; Prod h f xs
-&gt; Prod h f' xs
-&gt; h f'' xs
-&gt; h f''' xs
</span><span class="hs-identifier hs-var">hczipWith3</span></span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="annottext">forall a.
SingleEraBlock a =&gt;
WrapPartialConsensusConfig a
-&gt; (:.:) Maybe WrapCanBeLeader a
-&gt; (:.:) Ticked WrapChainDepState a
-&gt; (:.:) Maybe WrapIsLeader a
</span><a href="#local-6989586621680013183"><span class="hs-identifier hs-var">checkOne</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="annottext">Prod NS WrapPartialConsensusConfig xs
NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013182"><span class="hs-identifier hs-var">cfgs</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OptNP 'False WrapCanBeLeader xs
-&gt; NP (Maybe :.: WrapCanBeLeader) xs
forall k (empty :: Bool) (f :: k -&gt; *) (xs :: [k]).
OptNP empty f xs -&gt; NP (Maybe :.: f) xs
</span><a href="Ouroboros.Consensus.Util.OptNP.html#toNP"><span class="hs-identifier hs-var">OptNP.toNP</span></a></span><span> </span><span class="annot"><span class="annottext">OptNP 'False WrapCanBeLeader xs
</span><a href="#local-6989586621680013189"><span class="hs-identifier hs-var">canBeLeader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HardForkState (Ticked :.: WrapChainDepState) xs
-&gt; NS (Ticked :.: WrapChainDepState) xs
forall (xs :: [*]) (f :: * -&gt; *).
SListI xs =&gt;
HardForkState f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#tip"><span class="hs-identifier hs-var">State.tip</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState (Ticked :.: WrapChainDepState) xs
</span><a href="#local-6989586621680013187"><span class="hs-identifier hs-var">chainDepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621680013182"><span class="annot"><span class="annottext">cfgs :: NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013182"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
forall (xs :: [*]).
PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraConsensusConfig"><span class="hs-identifier hs-var hs-var">getPerEraConsensusConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs
</span><a href="#local-6989586621680013191"><span class="hs-identifier hs-var">hardForkConsensusConfigPerEra</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621680013179"><span class="annot"><a href="#local-6989586621680013183"><span class="hs-identifier hs-type">checkOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-224"></span><span>         </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span>                 </span><span class="annot"><a href="#local-6989586621680013179"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.PartialConfig.html#WrapPartialConsensusConfig"><span class="hs-identifier hs-type">WrapPartialConsensusConfig</span></a></span><span>     </span><span class="annot"><a href="#local-6989586621680013179"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapCanBeLeader"><span class="hs-identifier hs-type">WrapCanBeLeader</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><a href="#local-6989586621680013179"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013179"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-228"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapIsLeader"><span class="hs-identifier hs-type">WrapIsLeader</span></a></span><span class="hs-special">)</span><span>       </span><span class="annot"><a href="#local-6989586621680013179"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621680013183"><span class="annot"><span class="annottext">checkOne :: WrapPartialConsensusConfig blk
-&gt; (:.:) Maybe WrapCanBeLeader blk
-&gt; (:.:) Ticked WrapChainDepState blk
-&gt; (:.:) Maybe WrapIsLeader blk
</span><a href="#local-6989586621680013183"><span class="hs-identifier hs-var hs-var">checkOne</span></a></span></span><span> </span><span id="local-6989586621680013178"><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013178"><span class="hs-identifier hs-var">cfg'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680013177"><span class="annot"><span class="annottext">Maybe (WrapCanBeLeader blk)
</span><a href="#local-6989586621680013177"><span class="hs-identifier hs-var">mCanBeLeader</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680013176"><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
</span><a href="#local-6989586621680013176"><span class="hs-identifier hs-var">chainDepState'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (WrapIsLeader blk) -&gt; (:.:) Maybe WrapIsLeader blk
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (WrapIsLeader blk) -&gt; (:.:) Maybe WrapIsLeader blk)
-&gt; Maybe (WrapIsLeader blk) -&gt; (:.:) Maybe WrapIsLeader blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621680013175"><span class="annot"><span class="annottext">WrapCanBeLeader blk
</span><a href="#local-6989586621680013175"><span class="hs-identifier hs-var">canBeLeader'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (WrapCanBeLeader blk)
</span><a href="#local-6989586621680013177"><span class="hs-identifier hs-var">mCanBeLeader</span></a></span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="annottext">IsLeader (BlockProtocol blk) -&gt; WrapIsLeader blk
forall blk. IsLeader (BlockProtocol blk) -&gt; WrapIsLeader blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapIsLeader"><span class="hs-identifier hs-var">WrapIsLeader</span></a></span><span> </span><span class="annot"><span class="annottext">(IsLeader (BlockProtocol blk) -&gt; WrapIsLeader blk)
-&gt; Maybe (IsLeader (BlockProtocol blk)) -&gt; Maybe (WrapIsLeader blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-232"></span><span>          </span><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol blk)
-&gt; CanBeLeader (BlockProtocol blk)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (BlockProtocol blk))
-&gt; Maybe (IsLeader (BlockProtocol blk))
forall p.
(ConsensusProtocol p, HasCallStack) =&gt;
ConsensusConfig p
-&gt; CanBeLeader p
-&gt; SlotNo
-&gt; Ticked (ChainDepState p)
-&gt; Maybe (IsLeader p)
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#checkIsLeader"><span class="hs-identifier hs-var">checkIsLeader</span></a></span><span>
</span><span id="line-233"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
forall blk.
HasPartialConsensusConfig (BlockProtocol blk) =&gt;
EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#completeConsensusConfig%27"><span class="hs-identifier hs-var">completeConsensusConfig'</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013186"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013178"><span class="hs-identifier hs-var">cfg'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WrapCanBeLeader blk -&gt; CanBeLeader (BlockProtocol blk)
forall blk. WrapCanBeLeader blk -&gt; CanBeLeader (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapCanBeLeader"><span class="hs-identifier hs-var hs-var">unwrapCanBeLeader</span></a></span><span> </span><span class="annot"><span class="annottext">WrapCanBeLeader blk
</span><a href="#local-6989586621680013175"><span class="hs-identifier hs-var">canBeLeader'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>            </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013188"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
forall blk.
Ticked (WrapChainDepState blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapTickedChainDepState"><span class="hs-identifier hs-var hs-var">unwrapTickedChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
</span><a href="#local-6989586621680013176"><span class="hs-identifier hs-var">chainDepState'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621680013185"><span class="hs-identifier hs-type">undistrib</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapIsLeader"><span class="hs-identifier hs-type">WrapIsLeader</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkIsLeader"><span class="hs-identifier hs-type">HardForkIsLeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621680013185"><span class="annot"><span class="annottext">undistrib :: NS (Maybe :.: WrapIsLeader) xs -&gt; Maybe (HardForkIsLeader xs)
</span><a href="#local-6989586621680013185"><span class="hs-identifier hs-var hs-var">undistrib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NS (K (Maybe (HardForkIsLeader xs))) xs
-&gt; Maybe (HardForkIsLeader xs)
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) a.
(HCollapse h, SListIN h xs) =&gt;
h (K a) xs -&gt; CollapseTo h a
</span><span class="hs-identifier hs-var">hcollapse</span></span><span> </span><span class="annot"><span class="annottext">(NS (K (Maybe (HardForkIsLeader xs))) xs
 -&gt; Maybe (HardForkIsLeader xs))
-&gt; (NS (Maybe :.: WrapIsLeader) xs
    -&gt; NS (K (Maybe (HardForkIsLeader xs))) xs)
-&gt; NS (Maybe :.: WrapIsLeader) xs
-&gt; Maybe (HardForkIsLeader xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(forall a.
 Index xs a
 -&gt; (:.:) Maybe WrapIsLeader a -&gt; K (Maybe (HardForkIsLeader xs)) a)
-&gt; NS (Maybe :.: WrapIsLeader) xs
-&gt; NS (K (Maybe (HardForkIsLeader xs))) xs
forall k (h :: (k -&gt; *) -&gt; [k] -&gt; *) (xs :: [k]) (f1 :: k -&gt; *)
       (f2 :: k -&gt; *).
(HAp h, SListI xs, Prod h ~ NP) =&gt;
(forall (a :: k). Index xs a -&gt; f1 a -&gt; f2 a) -&gt; h f1 xs -&gt; h f2 xs
</span><a href="Ouroboros.Consensus.Util.SOP.html#himap"><span class="hs-identifier hs-var">himap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a.
Index xs a
-&gt; (:.:) Maybe WrapIsLeader a -&gt; K (Maybe (HardForkIsLeader xs)) a
</span><a href="#local-6989586621680013168"><span class="hs-identifier hs-var">inj</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-241"></span><span>        </span><span id="local-6989586621680013167"><span class="annot"><a href="#local-6989586621680013168"><span class="hs-identifier hs-type">inj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013167"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-242"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapIsLeader"><span class="hs-identifier hs-type">WrapIsLeader</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013167"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkIsLeader"><span class="hs-identifier hs-type">HardForkIsLeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013603"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013167"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621680013168"><span class="annot"><span class="annottext">inj :: Index xs blk
-&gt; (:.:) Maybe WrapIsLeader blk
-&gt; K (Maybe (HardForkIsLeader xs)) blk
</span><a href="#local-6989586621680013168"><span class="hs-identifier hs-var hs-var">inj</span></a></span></span><span> </span><span id="local-6989586621680013166"><span class="annot"><span class="annottext">Index xs blk
</span><a href="#local-6989586621680013166"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680013165"><span class="annot"><span class="annottext">Maybe (WrapIsLeader blk)
</span><a href="#local-6989586621680013165"><span class="hs-identifier hs-var">mIsLeader</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HardForkIsLeader xs) -&gt; K (Maybe (HardForkIsLeader xs)) blk
forall k a (b :: k). a -&gt; K a b
</span><span class="hs-identifier hs-var">K</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (HardForkIsLeader xs)
 -&gt; K (Maybe (HardForkIsLeader xs)) blk)
-&gt; Maybe (HardForkIsLeader xs)
-&gt; K (Maybe (HardForkIsLeader xs)) blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="annottext">NS WrapIsLeader xs -&gt; HardForkIsLeader xs
forall (xs :: [*]). NS WrapIsLeader xs -&gt; OneEraIsLeader xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraIsLeader"><span class="hs-identifier hs-var">OneEraIsLeader</span></a></span><span> </span><span class="annot"><span class="annottext">(NS WrapIsLeader xs -&gt; HardForkIsLeader xs)
-&gt; (WrapIsLeader blk -&gt; NS WrapIsLeader xs)
-&gt; WrapIsLeader blk
-&gt; HardForkIsLeader xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs blk -&gt; WrapIsLeader blk -&gt; NS WrapIsLeader xs
forall k (f :: k -&gt; *) (x :: k) (xs :: [k]).
Index xs x -&gt; f x -&gt; NS f xs
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS"><span class="hs-identifier hs-var">injectNS</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs blk
</span><a href="#local-6989586621680013166"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">(WrapIsLeader blk -&gt; HardForkIsLeader xs)
-&gt; Maybe (WrapIsLeader blk) -&gt; Maybe (HardForkIsLeader xs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WrapIsLeader blk)
</span><a href="#local-6989586621680013165"><span class="hs-identifier hs-var">mIsLeader</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Rolling forward and backward
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span id="local-6989586621680013160"><span id="local-6989586621680013161"></span></span><span class="hs-keyword">data</span><span> </span><span id="HardForkValidationErr"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-var">HardForkValidationErr</span></a></span></span><span> </span><span id="local-6989586621680013424"><span class="annot"><a href="#local-6989586621680013424"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-comment">-- | Validation error from one of the eras</span><span>
</span><span id="line-253"></span><span>    </span><span id="HardForkValidationErrFromEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErrFromEra"><span class="hs-identifier hs-var">HardForkValidationErrFromEra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidationErr"><span class="hs-identifier hs-type">OneEraValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013424"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- | We tried to apply a block from the wrong era</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HardForkValidationErrWrongEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErrWrongEra"><span class="hs-identifier hs-var">HardForkValidationErrWrongEra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#MismatchEraInfo"><span class="hs-identifier hs-type">MismatchEraInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013424"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 HardForkValidationErr xs -&gt; Rep (HardForkValidationErr xs) x)
-&gt; (forall x.
    Rep (HardForkValidationErr xs) x -&gt; HardForkValidationErr xs)
-&gt; Generic (HardForkValidationErr xs)
forall (xs :: [*]) x.
Rep (HardForkValidationErr xs) x -&gt; HardForkValidationErr xs
forall (xs :: [*]) x.
HardForkValidationErr xs -&gt; Rep (HardForkValidationErr xs) x
forall x.
Rep (HardForkValidationErr xs) x -&gt; HardForkValidationErr xs
forall x.
HardForkValidationErr xs -&gt; Rep (HardForkValidationErr xs) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall (xs :: [*]) x.
Rep (HardForkValidationErr xs) x -&gt; HardForkValidationErr xs
$cfrom :: forall (xs :: [*]) x.
HardForkValidationErr xs -&gt; Rep (HardForkValidationErr xs) x
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#update"><span class="hs-identifier hs-type">update</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680013600"><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-260"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusConfig"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidateView"><span class="hs-identifier hs-type">OneEraValidateView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-262"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-263"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013600"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span id="update"><span class="annot"><span class="annottext">update :: ConsensusConfig (HardForkProtocol xs)
-&gt; OneEraValidateView xs
-&gt; SlotNo
-&gt; Ticked (HardForkChainDepState xs)
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#update"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkConsensusConfig"><span class="hs-identifier hs-type">HardForkConsensusConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013152"><span id="local-6989586621680013153"><span id="local-6989586621680013154"><span class="annot"><a href="#local-6989586621680013152"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-266"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidateView"><span class="hs-identifier hs-type">OneEraValidateView</span></a></span><span> </span><span id="local-6989586621680013151"><span class="annot"><span class="annottext">NS WrapValidateView xs
</span><a href="#local-6989586621680013151"><span class="hs-identifier hs-var">view</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>       </span><span id="local-6989586621680013150"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013150"><span class="hs-identifier hs-var">slot</span></a></span></span><span>
</span><span id="line-268"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#TickedHardForkChainDepState"><span class="hs-identifier hs-type">TickedHardForkChainDepState</span></a></span><span> </span><span id="local-6989586621680013149"><span class="annot"><a href="#local-6989586621680013149"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span> </span><span id="local-6989586621680013148"><span class="annot"><a href="#local-6989586621680013148"><span class="hs-identifier hs-var">ei</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NS WrapValidateView xs
-&gt; HardForkState (Ticked :.: WrapChainDepState) xs
-&gt; Either
     (Mismatch
        WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs)
     (HardForkState
        (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs)
forall (xs :: [*]) (h :: * -&gt; *) (f :: * -&gt; *).
SListI xs =&gt;
NS h xs
-&gt; HardForkState f xs
-&gt; Either
     (Mismatch h (Current f) xs) (HardForkState (Product h f) xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#match"><span class="hs-identifier hs-var">State.match</span></a></span><span> </span><span class="annot"><span class="annottext">NS WrapValidateView xs
</span><a href="#local-6989586621680013151"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState (Ticked :.: WrapChainDepState) xs
</span><a href="#local-6989586621680013149"><span class="hs-identifier hs-var">chainDepState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680013146"><span class="annot"><span class="annottext">Mismatch
  WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013146"><span class="hs-identifier hs-var">mismatch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">HardForkValidationErr xs
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkValidationErr xs
 -&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs))
-&gt; HardForkValidationErr xs
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MismatchEraInfo xs -&gt; HardForkValidationErr xs
forall (xs :: [*]). MismatchEraInfo xs -&gt; HardForkValidationErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErrWrongEra"><span class="hs-identifier hs-var">HardForkValidationErrWrongEra</span></a></span><span> </span><span class="annot"><span class="annottext">(MismatchEraInfo xs -&gt; HardForkValidationErr xs)
-&gt; (Mismatch SingleEraInfo LedgerEraInfo xs -&gt; MismatchEraInfo xs)
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs
-&gt; HardForkValidationErr xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Mismatch SingleEraInfo LedgerEraInfo xs -&gt; MismatchEraInfo xs
forall (xs :: [*]).
Mismatch SingleEraInfo LedgerEraInfo xs -&gt; MismatchEraInfo xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#MismatchEraInfo"><span class="hs-identifier hs-var">MismatchEraInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Mismatch SingleEraInfo LedgerEraInfo xs
 -&gt; HardForkValidationErr xs)
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs
-&gt; HardForkValidationErr xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-272"></span><span>          </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall x.
    SingleEraBlock x =&gt;
    WrapValidateView x -&gt; SingleEraInfo x)
-&gt; (forall x.
    SingleEraBlock x =&gt;
    Current (Ticked :.: WrapChainDepState) x -&gt; LedgerEraInfo x)
-&gt; Mismatch
     WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs
forall k (c :: k -&gt; Constraint) (xs :: [k])
       (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *) (f' :: k -&gt; *)
       (g :: k -&gt; *) (g' :: k -&gt; *).
All c xs =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; f x -&gt; f' x)
-&gt; (forall (x :: k). c x =&gt; g x -&gt; g' x)
-&gt; Mismatch f g xs
-&gt; Mismatch f' g' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html#bihcmap"><span class="hs-identifier hs-var">Match.bihcmap</span></a></span><span>
</span><span id="line-273"></span><span>            </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span>
</span><span id="line-274"></span><span>            </span><span class="annot"><span class="annottext">forall x. SingleEraBlock x =&gt; WrapValidateView x -&gt; SingleEraInfo x
forall blk (proxy :: * -&gt; *).
SingleEraBlock blk =&gt;
proxy blk -&gt; SingleEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#singleEraInfo"><span class="hs-identifier hs-var">singleEraInfo</span></a></span><span>
</span><span id="line-275"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingleEraInfo x -&gt; LedgerEraInfo x
forall blk. SingleEraInfo blk -&gt; LedgerEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Info.html#LedgerEraInfo"><span class="hs-identifier hs-var">LedgerEraInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SingleEraInfo x -&gt; LedgerEraInfo x)
-&gt; (Current (Ticked :.: WrapChainDepState) x -&gt; SingleEraInfo x)
-&gt; Current (Ticked :.: WrapChainDepState) x
-&gt; LedgerEraInfo x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(:.:) Ticked WrapChainDepState x -&gt; SingleEraInfo x
forall blk.
SingleEraBlock blk =&gt;
(:.:) Ticked WrapChainDepState blk -&gt; SingleEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#chainDepStateInfo"><span class="hs-identifier hs-var">chainDepStateInfo</span></a></span><span> </span><span class="annot"><span class="annottext">((:.:) Ticked WrapChainDepState x -&gt; SingleEraInfo x)
-&gt; (Current (Ticked :.: WrapChainDepState) x
    -&gt; (:.:) Ticked WrapChainDepState x)
-&gt; Current (Ticked :.: WrapChainDepState) x
-&gt; SingleEraInfo x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Current (Ticked :.: WrapChainDepState) x
-&gt; (:.:) Ticked WrapChainDepState x
forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var hs-var">State.currentState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>            </span><span class="annot"><span class="annottext">Mismatch
  WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013146"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680013138"><span class="annot"><span class="annottext">HardForkState
  (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013138"><span class="hs-identifier hs-var">matched</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>           </span><span class="annot"><span class="annottext">HardForkState
  (ExceptT (HardForkValidationErr xs) Identity :.: WrapChainDepState)
  xs
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: * -&gt; *)
       (g :: k -&gt; *).
(HSequence h, SListIN h xs, Applicative f) =&gt;
h (f :.: g) xs -&gt; f (h g xs)
</span><span class="hs-identifier hs-var">hsequence'</span></span><span>
</span><span id="line-279"></span><span>         </span><span class="annot"><span class="annottext">(HardForkState
   (ExceptT (HardForkValidationErr xs) Identity :.: WrapChainDepState)
   xs
 -&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs))
-&gt; (HardForkState
      (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
    -&gt; HardForkState
         (ExceptT (HardForkValidationErr xs) Identity :.: WrapChainDepState)
         xs)
-&gt; HardForkState
     (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    Index xs a
    -&gt; WrapPartialConsensusConfig a
    -&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) a
    -&gt; (:.:)
         (ExceptT (HardForkValidationErr xs) Identity) WrapChainDepState a)
-&gt; NP WrapPartialConsensusConfig xs
-&gt; HardForkState
     (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
-&gt; HardForkState
     (ExceptT (HardForkValidationErr xs) Identity :.: WrapChainDepState)
     xs
forall k (h :: (k -&gt; *) -&gt; [k] -&gt; *) (c :: k -&gt; Constraint)
       (xs :: [k]) (proxy :: (k -&gt; Constraint) -&gt; *) (f1 :: k -&gt; *)
       (f2 :: k -&gt; *) (f3 :: k -&gt; *).
(HAp h, All c xs, Prod h ~ NP) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; Index xs a -&gt; f1 a -&gt; f2 a -&gt; f3 a)
-&gt; NP f1 xs
-&gt; h f2 xs
-&gt; h f3 xs
</span><a href="Ouroboros.Consensus.Util.SOP.html#hcizipWith"><span class="hs-identifier hs-var">hcizipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; SlotNo
-&gt; Index xs a
-&gt; WrapPartialConsensusConfig a
-&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) a
-&gt; (:.:)
     (ExceptT (HardForkValidationErr xs) Identity) WrapChainDepState a
forall (xs :: [*]) blk.
SingleEraBlock blk =&gt;
EpochInfo (Except PastHorizonException)
-&gt; SlotNo
-&gt; Index xs blk
-&gt; WrapPartialConsensusConfig blk
-&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) blk
-&gt; (:.:) (Except (HardForkValidationErr xs)) WrapChainDepState blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#updateEra"><span class="hs-identifier hs-var">updateEra</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013148"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013150"><span class="hs-identifier hs-var">slot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013134"><span class="hs-identifier hs-var">cfgs</span></a></span><span>
</span><span id="line-280"></span><span>         </span><span class="annot"><span class="annottext">(HardForkState
   (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
 -&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs))
-&gt; HardForkState
     (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
-&gt; Except (HardForkValidationErr xs) (HardForkChainDepState xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState
  (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013138"><span class="hs-identifier hs-var">matched</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621680013134"><span class="annot"><span class="annottext">cfgs :: NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013134"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
forall (xs :: [*]).
PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraConsensusConfig"><span class="hs-identifier hs-var hs-var">getPerEraConsensusConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs
</span><a href="#local-6989586621680013152"><span class="hs-identifier hs-var">hardForkConsensusConfigPerEra</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#updateEra"><span class="hs-identifier hs-type">updateEra</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680013383"><span class="annot"><a href="#local-6989586621680013383"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span id="local-6989586621680013384"><span class="annot"><a href="#local-6989586621680013384"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013384"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-285"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-287"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013383"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013384"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-288"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.PartialConfig.html#WrapPartialConsensusConfig"><span class="hs-identifier hs-type">WrapPartialConsensusConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013384"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapValidateView"><span class="hs-identifier hs-type">WrapValidateView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013384"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013383"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013384"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-291"></span><span id="updateEra"><span class="annot"><span class="annottext">updateEra :: EpochInfo (Except PastHorizonException)
-&gt; SlotNo
-&gt; Index xs blk
-&gt; WrapPartialConsensusConfig blk
-&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) blk
-&gt; (:.:) (Except (HardForkValidationErr xs)) WrapChainDepState blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#updateEra"><span class="hs-identifier hs-var hs-var">updateEra</span></a></span></span><span> </span><span id="local-6989586621680013133"><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013133"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621680013132"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013132"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621680013131"><span class="annot"><span class="annottext">Index xs blk
</span><a href="#local-6989586621680013131"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680013130"><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013130"><span class="hs-identifier hs-var">cfg</span></a></span></span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621680013128"><span class="annot"><span class="annottext">WrapValidateView blk
</span><a href="#local-6989586621680013128"><span class="hs-identifier hs-var">view</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680013127"><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
</span><a href="#local-6989586621680013127"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT (HardForkValidationErr xs) Identity (WrapChainDepState blk)
-&gt; (:.:) (Except (HardForkValidationErr xs)) WrapChainDepState blk
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (HardForkValidationErr xs) Identity (WrapChainDepState blk)
 -&gt; (:.:) (Except (HardForkValidationErr xs)) WrapChainDepState blk)
-&gt; ExceptT
     (HardForkValidationErr xs) Identity (WrapChainDepState blk)
-&gt; (:.:) (Except (HardForkValidationErr xs)) WrapChainDepState blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><span class="annottext">(ValidationErr (BlockProtocol blk) -&gt; HardForkValidationErr xs)
-&gt; Except
     (ValidationErr (BlockProtocol blk)) (WrapChainDepState blk)
-&gt; ExceptT
     (HardForkValidationErr xs) Identity (WrapChainDepState blk)
forall e e' a. (e -&gt; e') -&gt; Except e a -&gt; Except e' a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">withExcept</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index xs blk
-&gt; ValidationErr (BlockProtocol blk) -&gt; HardForkValidationErr xs
forall (xs :: [*]) blk.
Index xs blk
-&gt; ValidationErr (BlockProtocol blk) -&gt; HardForkValidationErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#injectValidationErr"><span class="hs-identifier hs-var">injectValidationErr</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs blk
</span><a href="#local-6989586621680013131"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Except (ValidationErr (BlockProtocol blk)) (WrapChainDepState blk)
 -&gt; ExceptT
      (HardForkValidationErr xs) Identity (WrapChainDepState blk))
-&gt; Except
     (ValidationErr (BlockProtocol blk)) (WrapChainDepState blk)
-&gt; ExceptT
     (HardForkValidationErr xs) Identity (WrapChainDepState blk)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><span class="annottext">(ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk)
-&gt; ExceptT
     (ValidationErr (BlockProtocol blk))
     Identity
     (ChainDepState (BlockProtocol blk))
-&gt; Except
     (ValidationErr (BlockProtocol blk)) (WrapChainDepState blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
forall blk.
ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-var">WrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ValidationErr (BlockProtocol blk))
   Identity
   (ChainDepState (BlockProtocol blk))
 -&gt; Except
      (ValidationErr (BlockProtocol blk)) (WrapChainDepState blk))
-&gt; ExceptT
     (ValidationErr (BlockProtocol blk))
     Identity
     (ChainDepState (BlockProtocol blk))
-&gt; Except
     (ValidationErr (BlockProtocol blk)) (WrapChainDepState blk)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol blk)
-&gt; ValidateView (BlockProtocol blk)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (BlockProtocol blk))
-&gt; ExceptT
     (ValidationErr (BlockProtocol blk))
     Identity
     (ChainDepState (BlockProtocol blk))
forall p.
(ConsensusProtocol p, HasCallStack) =&gt;
ConsensusConfig p
-&gt; ValidateView p
-&gt; SlotNo
-&gt; Ticked (ChainDepState p)
-&gt; Except (ValidationErr p) (ChainDepState p)
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#updateChainDepState"><span class="hs-identifier hs-var">updateChainDepState</span></a></span><span>
</span><span id="line-296"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
forall blk.
HasPartialConsensusConfig (BlockProtocol blk) =&gt;
EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#completeConsensusConfig%27"><span class="hs-identifier hs-var">completeConsensusConfig'</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013133"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013130"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WrapValidateView blk -&gt; ValidateView (BlockProtocol blk)
forall blk.
WrapValidateView blk -&gt; ValidateView (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapValidateView"><span class="hs-identifier hs-var hs-var">unwrapValidateView</span></a></span><span> </span><span class="annot"><span class="annottext">WrapValidateView blk
</span><a href="#local-6989586621680013128"><span class="hs-identifier hs-var">view</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>          </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013132"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
forall blk.
Ticked (WrapChainDepState blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapTickedChainDepState"><span class="hs-identifier hs-var hs-var">unwrapTickedChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
</span><a href="#local-6989586621680013127"><span class="hs-identifier hs-var">chainDepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#reupdate"><span class="hs-identifier hs-type">reupdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680013597"><span class="annot"><a href="#local-6989586621680013597"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013597"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-302"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusConfig"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013597"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidateView"><span class="hs-identifier hs-type">OneEraValidateView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013597"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-304"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-305"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013597"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013597"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-307"></span><span id="reupdate"><span class="annot"><span class="annottext">reupdate :: ConsensusConfig (HardForkProtocol xs)
-&gt; OneEraValidateView xs
-&gt; SlotNo
-&gt; Ticked (HardForkChainDepState xs)
-&gt; HardForkChainDepState xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#reupdate"><span class="hs-identifier hs-var hs-var">reupdate</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkConsensusConfig"><span class="hs-identifier hs-type">HardForkConsensusConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013120"><span id="local-6989586621680013121"><span id="local-6989586621680013122"><span class="annot"><a href="#local-6989586621680013120"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-308"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidateView"><span class="hs-identifier hs-type">OneEraValidateView</span></a></span><span> </span><span id="local-6989586621680013119"><span class="annot"><span class="annottext">NS WrapValidateView xs
</span><a href="#local-6989586621680013119"><span class="hs-identifier hs-var">view</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>         </span><span id="local-6989586621680013118"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013118"><span class="hs-identifier hs-var">slot</span></a></span></span><span>
</span><span id="line-310"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#TickedHardForkChainDepState"><span class="hs-identifier hs-type">TickedHardForkChainDepState</span></a></span><span> </span><span id="local-6989586621680013117"><span class="annot"><a href="#local-6989586621680013117"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span> </span><span id="local-6989586621680013116"><span class="annot"><a href="#local-6989586621680013116"><span class="hs-identifier hs-var">ei</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NS WrapValidateView xs
-&gt; HardForkState (Ticked :.: WrapChainDepState) xs
-&gt; Either
     (Mismatch
        WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs)
     (HardForkState
        (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs)
forall (xs :: [*]) (h :: * -&gt; *) (f :: * -&gt; *).
SListI xs =&gt;
NS h xs
-&gt; HardForkState f xs
-&gt; Either
     (Mismatch h (Current f) xs) (HardForkState (Product h f) xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#match"><span class="hs-identifier hs-var">State.match</span></a></span><span> </span><span class="annot"><span class="annottext">NS WrapValidateView xs
</span><a href="#local-6989586621680013119"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState (Ticked :.: WrapChainDepState) xs
</span><a href="#local-6989586621680013117"><span class="hs-identifier hs-var">chainDepState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-312"></span><span>      </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680013115"><span class="annot"><span class="annottext">Mismatch
  WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013115"><span class="hs-identifier hs-var">mismatch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; HardForkChainDepState xs
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HardForkChainDepState xs)
-&gt; String -&gt; HardForkChainDepState xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkValidationErr xs -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkValidationErr xs -&gt; String)
-&gt; (Mismatch SingleEraInfo LedgerEraInfo xs
    -&gt; HardForkValidationErr xs)
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MismatchEraInfo xs -&gt; HardForkValidationErr xs
forall (xs :: [*]). MismatchEraInfo xs -&gt; HardForkValidationErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErrWrongEra"><span class="hs-identifier hs-var">HardForkValidationErrWrongEra</span></a></span><span> </span><span class="annot"><span class="annottext">(MismatchEraInfo xs -&gt; HardForkValidationErr xs)
-&gt; (Mismatch SingleEraInfo LedgerEraInfo xs -&gt; MismatchEraInfo xs)
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs
-&gt; HardForkValidationErr xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Mismatch SingleEraInfo LedgerEraInfo xs -&gt; MismatchEraInfo xs
forall (xs :: [*]).
Mismatch SingleEraInfo LedgerEraInfo xs -&gt; MismatchEraInfo xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#MismatchEraInfo"><span class="hs-identifier hs-var">MismatchEraInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Mismatch SingleEraInfo LedgerEraInfo xs -&gt; String)
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall x.
    SingleEraBlock x =&gt;
    WrapValidateView x -&gt; SingleEraInfo x)
-&gt; (forall x.
    SingleEraBlock x =&gt;
    Current (Ticked :.: WrapChainDepState) x -&gt; LedgerEraInfo x)
-&gt; Mismatch
     WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs
-&gt; Mismatch SingleEraInfo LedgerEraInfo xs
forall k (c :: k -&gt; Constraint) (xs :: [k])
       (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *) (f' :: k -&gt; *)
       (g :: k -&gt; *) (g' :: k -&gt; *).
All c xs =&gt;
proxy c
-&gt; (forall (x :: k). c x =&gt; f x -&gt; f' x)
-&gt; (forall (x :: k). c x =&gt; g x -&gt; g' x)
-&gt; Mismatch f g xs
-&gt; Mismatch f' g' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html#bihcmap"><span class="hs-identifier hs-var">Match.bihcmap</span></a></span><span>
</span><span id="line-315"></span><span>            </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span>
</span><span id="line-316"></span><span>            </span><span class="annot"><span class="annottext">forall x. SingleEraBlock x =&gt; WrapValidateView x -&gt; SingleEraInfo x
forall blk (proxy :: * -&gt; *).
SingleEraBlock blk =&gt;
proxy blk -&gt; SingleEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#singleEraInfo"><span class="hs-identifier hs-var">singleEraInfo</span></a></span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingleEraInfo x -&gt; LedgerEraInfo x
forall blk. SingleEraInfo blk -&gt; LedgerEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Info.html#LedgerEraInfo"><span class="hs-identifier hs-var">LedgerEraInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SingleEraInfo x -&gt; LedgerEraInfo x)
-&gt; (Current (Ticked :.: WrapChainDepState) x -&gt; SingleEraInfo x)
-&gt; Current (Ticked :.: WrapChainDepState) x
-&gt; LedgerEraInfo x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(:.:) Ticked WrapChainDepState x -&gt; SingleEraInfo x
forall blk.
SingleEraBlock blk =&gt;
(:.:) Ticked WrapChainDepState blk -&gt; SingleEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#chainDepStateInfo"><span class="hs-identifier hs-var">chainDepStateInfo</span></a></span><span> </span><span class="annot"><span class="annottext">((:.:) Ticked WrapChainDepState x -&gt; SingleEraInfo x)
-&gt; (Current (Ticked :.: WrapChainDepState) x
    -&gt; (:.:) Ticked WrapChainDepState x)
-&gt; Current (Ticked :.: WrapChainDepState) x
-&gt; SingleEraInfo x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Current (Ticked :.: WrapChainDepState) x
-&gt; (:.:) Ticked WrapChainDepState x
forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var hs-var">State.currentState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>            </span><span class="annot"><span class="annottext">Mismatch
  WrapValidateView (Current (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013115"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680013112"><span class="annot"><span class="annottext">HardForkState
  (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013112"><span class="hs-identifier hs-var">matched</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-320"></span><span>           </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    WrapPartialConsensusConfig a
    -&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) a
    -&gt; WrapChainDepState a)
-&gt; Prod HardForkState WrapPartialConsensusConfig xs
-&gt; HardForkState
     (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
-&gt; HardForkChainDepState xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *) (f'' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h, HAp (Prod h)) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a -&gt; f'' a)
-&gt; Prod h f xs
-&gt; h f' xs
-&gt; h f'' xs
</span><span class="hs-identifier hs-var">hczipWith</span></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; SlotNo
-&gt; WrapPartialConsensusConfig a
-&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) a
-&gt; WrapChainDepState a
forall blk.
SingleEraBlock blk =&gt;
EpochInfo (Except PastHorizonException)
-&gt; SlotNo
-&gt; WrapPartialConsensusConfig blk
-&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) blk
-&gt; WrapChainDepState blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#reupdateEra"><span class="hs-identifier hs-var">reupdateEra</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013116"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013118"><span class="hs-identifier hs-var">slot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prod HardForkState WrapPartialConsensusConfig xs
NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013110"><span class="hs-identifier hs-var">cfgs</span></a></span><span>
</span><span id="line-321"></span><span>         </span><span class="annot"><span class="annottext">(HardForkState
   (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
 -&gt; HardForkChainDepState xs)
-&gt; HardForkState
     (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
-&gt; HardForkChainDepState xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState
  (Product WrapValidateView (Ticked :.: WrapChainDepState)) xs
</span><a href="#local-6989586621680013112"><span class="hs-identifier hs-var">matched</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621680013110"><span class="annot"><span class="annottext">cfgs :: NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013110"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
forall (xs :: [*]).
PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraConsensusConfig"><span class="hs-identifier hs-var hs-var">getPerEraConsensusConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs
</span><a href="#local-6989586621680013120"><span class="hs-identifier hs-var">hardForkConsensusConfigPerEra</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span id="local-6989586621680013367"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#reupdateEra"><span class="hs-identifier hs-type">reupdateEra</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013367"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-326"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-328"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.PartialConfig.html#WrapPartialConsensusConfig"><span class="hs-identifier hs-type">WrapPartialConsensusConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013367"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-329"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapValidateView"><span class="hs-identifier hs-type">WrapValidateView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013367"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013367"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-331"></span><span id="reupdateEra"><span class="annot"><span class="annottext">reupdateEra :: EpochInfo (Except PastHorizonException)
-&gt; SlotNo
-&gt; WrapPartialConsensusConfig blk
-&gt; Product WrapValidateView (Ticked :.: WrapChainDepState) blk
-&gt; WrapChainDepState blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#reupdateEra"><span class="hs-identifier hs-var hs-var">reupdateEra</span></a></span></span><span> </span><span id="local-6989586621680013109"><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013109"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621680013108"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013108"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621680013107"><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013107"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621680013106"><span class="annot"><span class="annottext">WrapValidateView blk
</span><a href="#local-6989586621680013106"><span class="hs-identifier hs-var">view</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span id="local-6989586621680013105"><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
</span><a href="#local-6989586621680013105"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
forall blk.
ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-var">WrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk)
-&gt; ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol blk)
-&gt; ValidateView (BlockProtocol blk)
-&gt; SlotNo
-&gt; Ticked (ChainDepState (BlockProtocol blk))
-&gt; ChainDepState (BlockProtocol blk)
forall p.
(ConsensusProtocol p, HasCallStack) =&gt;
ConsensusConfig p
-&gt; ValidateView p
-&gt; SlotNo
-&gt; Ticked (ChainDepState p)
-&gt; ChainDepState p
</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#reupdateChainDepState"><span class="hs-identifier hs-var">reupdateChainDepState</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
forall blk.
HasPartialConsensusConfig (BlockProtocol blk) =&gt;
EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk
-&gt; ConsensusConfig (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#completeConsensusConfig%27"><span class="hs-identifier hs-var">completeConsensusConfig'</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013109"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">WrapPartialConsensusConfig blk
</span><a href="#local-6989586621680013107"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WrapValidateView blk -&gt; ValidateView (BlockProtocol blk)
forall blk.
WrapValidateView blk -&gt; ValidateView (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapValidateView"><span class="hs-identifier hs-var hs-var">unwrapValidateView</span></a></span><span> </span><span class="annot"><span class="annottext">WrapValidateView blk
</span><a href="#local-6989586621680013106"><span class="hs-identifier hs-var">view</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680013108"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
forall blk.
Ticked (WrapChainDepState blk)
-&gt; Ticked (ChainDepState (BlockProtocol blk))
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapTickedChainDepState"><span class="hs-identifier hs-var hs-var">unwrapTickedChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (WrapChainDepState blk)
</span><a href="#local-6989586621680013105"><span class="hs-identifier hs-var">chainDepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Auxiliary
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#chainDepStateInfo"><span class="hs-identifier hs-type">chainDepStateInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680013406"><span class="annot"><a href="#local-6989586621680013406"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013406"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-344"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ticked.html#Ticked"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013406"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Info.html#SingleEraInfo"><span class="hs-identifier hs-type">SingleEraInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013406"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-345"></span><span id="chainDepStateInfo"><span class="annot"><span class="annottext">chainDepStateInfo :: (:.:) Ticked WrapChainDepState blk -&gt; SingleEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#chainDepStateInfo"><span class="hs-identifier hs-var hs-var">chainDepStateInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">(:.:) Ticked WrapChainDepState blk
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; SingleEraInfo blk
forall blk (proxy :: * -&gt; *).
SingleEraBlock blk =&gt;
proxy blk -&gt; SingleEraInfo blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#singleEraInfo"><span class="hs-identifier hs-var">singleEraInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk
forall k (t :: k). Proxy t
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680013406"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#translateConsensus"><span class="hs-identifier hs-type">translateConsensus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680013531"><span class="annot"><a href="#local-6989586621680013531"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013531"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-348"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusConfig"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkProtocol"><span class="hs-identifier hs-type">HardForkProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013531"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Translate"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680013531"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-351"></span><span id="translateConsensus"><span class="annot"><span class="annottext">translateConsensus :: EpochInfo (Except PastHorizonException)
-&gt; ConsensusConfig (HardForkProtocol xs)
-&gt; InPairs (Translate WrapChainDepState) xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#translateConsensus"><span class="hs-identifier hs-var hs-var">translateConsensus</span></a></span></span><span> </span><span id="local-6989586621680013103"><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013103"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkConsensusConfig"><span class="hs-identifier hs-type">HardForkConsensusConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621680013100"><span id="local-6989586621680013101"><span id="local-6989586621680013102"><span class="annot"><a href="#local-6989586621680013100"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">NP WrapConsensusConfig xs
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     xs
-&gt; InPairs (Translate WrapChainDepState) xs
forall k (h :: k -&gt; *) (xs :: [k]) (f :: k -&gt; k -&gt; *).
NP h xs -&gt; InPairs (RequiringBoth h f) xs -&gt; InPairs f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#requiringBoth"><span class="hs-identifier hs-var">InPairs.requiringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">NP WrapConsensusConfig xs
</span><a href="#local-6989586621680013098"><span class="hs-identifier hs-var">cfgs</span></a></span><span> </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
   xs
 -&gt; InPairs (Translate WrapChainDepState) xs)
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     xs
-&gt; InPairs (Translate WrapChainDepState) xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-353"></span><span>       </span><span class="annot"><span class="annottext">EraTranslation xs
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     xs
forall (xs :: [*]).
EraTranslation xs
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Translation.html#translateChainDepState"><span class="hs-identifier hs-var hs-var">translateChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">EraTranslation xs
forall (xs :: [*]). CanHardFork xs =&gt; EraTranslation xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#hardForkEraTranslation"><span class="hs-identifier hs-var">hardForkEraTranslation</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621680013095"><span class="annot"><span class="annottext">pcfgs :: NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013095"><span class="hs-identifier hs-var hs-var">pcfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
forall (xs :: [*]).
PerEraConsensusConfig xs -&gt; NP WrapPartialConsensusConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#getPerEraConsensusConfig"><span class="hs-identifier hs-var hs-var">getPerEraConsensusConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PerEraConsensusConfig xs
</span><a href="#local-6989586621680013100"><span class="hs-identifier hs-var">hardForkConsensusConfigPerEra</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621680013098"><span class="annot"><span class="annottext">cfgs :: NP WrapConsensusConfig xs
</span><a href="#local-6989586621680013098"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
-&gt; (forall a.
    SingleEraBlock a =&gt;
    WrapPartialConsensusConfig a -&gt; WrapConsensusConfig a)
-&gt; NP WrapPartialConsensusConfig xs
-&gt; NP WrapConsensusConfig xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (c :: k -&gt; Constraint)
       (xs :: l) (proxy :: (k -&gt; Constraint) -&gt; *) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(AllN (Prod h) c xs, HAp h) =&gt;
proxy c
-&gt; (forall (a :: k). c a =&gt; f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hcmap</span></span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#proxySingle"><span class="hs-identifier hs-var">proxySingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig a -&gt; WrapConsensusConfig a
forall blk.
HasPartialConsensusConfig (BlockProtocol blk) =&gt;
EpochInfo (Except PastHorizonException)
-&gt; WrapPartialConsensusConfig blk -&gt; WrapConsensusConfig blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#completeConsensusConfig%27%27"><span class="hs-identifier hs-var">completeConsensusConfig''</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
</span><a href="#local-6989586621680013103"><span class="hs-identifier hs-var">ei</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP WrapPartialConsensusConfig xs
</span><a href="#local-6989586621680013095"><span class="hs-identifier hs-var">pcfgs</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span id="local-6989586621680013376"><span id="local-6989586621680013377"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#injectValidationErr"><span class="hs-identifier hs-type">injectValidationErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013377"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013376"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-359"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Protocol.Abstract.html#ValidationErr"><span class="hs-identifier hs-type">ValidationErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#BlockProtocol"><span class="hs-identifier hs-type">BlockProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013376"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013377"><span class="hs-identifier hs-type">xs</span></a></span></span></span><span>
</span><span id="line-361"></span><span id="injectValidationErr"><span class="annot"><span class="annottext">injectValidationErr :: Index xs blk
-&gt; ValidationErr (BlockProtocol blk) -&gt; HardForkValidationErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#injectValidationErr"><span class="hs-identifier hs-var hs-var">injectValidationErr</span></a></span></span><span> </span><span id="local-6989586621680013093"><span class="annot"><span class="annottext">Index xs blk
</span><a href="#local-6989586621680013093"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">OneEraValidationErr xs -&gt; HardForkValidationErr xs
forall (xs :: [*]).
OneEraValidationErr xs -&gt; HardForkValidationErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErrFromEra"><span class="hs-identifier hs-var">HardForkValidationErrFromEra</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><span class="annottext">(OneEraValidationErr xs -&gt; HardForkValidationErr xs)
-&gt; (ValidationErr (BlockProtocol blk) -&gt; OneEraValidationErr xs)
-&gt; ValidationErr (BlockProtocol blk)
-&gt; HardForkValidationErr xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NS WrapValidationErr xs -&gt; OneEraValidationErr xs
forall (xs :: [*]).
NS WrapValidationErr xs -&gt; OneEraValidationErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraValidationErr"><span class="hs-identifier hs-var">OneEraValidationErr</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">(NS WrapValidationErr xs -&gt; OneEraValidationErr xs)
-&gt; (ValidationErr (BlockProtocol blk) -&gt; NS WrapValidationErr xs)
-&gt; ValidationErr (BlockProtocol blk)
-&gt; OneEraValidationErr xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs blk -&gt; WrapValidationErr blk -&gt; NS WrapValidationErr xs
forall k (f :: k -&gt; *) (x :: k) (xs :: [k]).
Index xs x -&gt; f x -&gt; NS f xs
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS"><span class="hs-identifier hs-var">injectNS</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs blk
</span><a href="#local-6989586621680013093"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><span class="annottext">(WrapValidationErr blk -&gt; NS WrapValidationErr xs)
-&gt; (ValidationErr (BlockProtocol blk) -&gt; WrapValidationErr blk)
-&gt; ValidationErr (BlockProtocol blk)
-&gt; NS WrapValidationErr xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationErr (BlockProtocol blk) -&gt; WrapValidationErr blk
forall blk.
ValidationErr (BlockProtocol blk) -&gt; WrapValidationErr blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapValidationErr"><span class="hs-identifier hs-var">WrapValidationErr</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Instances
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span id="local-6989586621680013086"><span id="local-6989586621680013088"><span id="local-6989586621680013090"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013090"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013090"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-372"></span><span id="local-6989586621680013079"><span id="local-6989586621680013081"><span id="local-6989586621680013083"><span id="local-6989586621680013085"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013085"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013085"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-373"></span><span id="local-6989586621680013072"><span id="local-6989586621680013074"><span id="local-6989586621680013076"><span id="local-6989586621680013078"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013078"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkValidationErr"><span class="hs-identifier hs-type">HardForkValidationErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680013078"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-374"></span></pre></body></html>