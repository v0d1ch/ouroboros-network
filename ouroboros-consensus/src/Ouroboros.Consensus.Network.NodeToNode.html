<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds             #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns        #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE QuantifiedConstraints #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards       #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables   #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications      #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | Intended for qualified import</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Network.NodeToNode</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Handlers</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier">Handlers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkHandlers"><span class="hs-identifier">mkHandlers</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Codecs</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier">Codecs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#defaultCodecs"><span class="hs-identifier">defaultCodecs</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#identityCodecs"><span class="hs-identifier">identityCodecs</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Tracers</span></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier">Tracers</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers%27"><span class="hs-identifier">Tracers'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#nullTracers"><span class="hs-identifier">nullTracers</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#showTracers"><span class="hs-identifier">showTracers</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Applications</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier">Apps</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier">ClientApp</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier">ServerApp</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkApps"><span class="hs-identifier">mkApps</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Projections</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#initiator"><span class="hs-identifier">initiator</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#responder"><span class="hs-identifier">responder</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">ChainSyncTimeout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decoder</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forever</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier">MonadTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier">Control.Monad.Class.MonadTimer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier">MonadTimer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Tracer</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.AnchoredFragment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">AnchoredFragment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Serialised</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">decodePoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">decodeTip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">encodePoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">encodeTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.BlockFetch</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.BlockFetch.Client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">BlockFetchClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">blockFetchClient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Ouroboros.Network.Channel</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Ouroboros.Network.Codec</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.DeltaQ</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Ouroboros.Network.Driver</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.KeepAlive</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Ouroboros.Network.Mux</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.NodeToNode</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.BlockFetch.Codec</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.BlockFetch.Server</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">BlockFetchServer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">blockFetchServerPeer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.BlockFetch.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">BlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.ChainSync.ClientPipelined</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.ChainSync.Codec</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.ChainSync.PipelineDecision</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.ChainSync.Server</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.ChainSync.Type</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.KeepAlive.Client</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.KeepAlive.Codec</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.KeepAlive.Server</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.KeepAlive.Type</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.Trans.Hello.Util</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hello</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.TxSubmission.Client</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.TxSubmission.Codec</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.TxSubmission.Server</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.TxSubmission.Type</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.TxSubmission2.Codec</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Protocol.TxSubmission2.Type</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.TxSubmission.Inbound</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.TxSubmission.Mempool.Reader</span></a></span><span>
</span><span id="line-80"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">mapTxSubmissionMempoolReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.TxSubmission.Outbound</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.SupportsMempool</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsProtocol.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.SupportsProtocol</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.MiniProtocol.BlockFetch.Server.html"><span class="hs-identifier">Ouroboros.Consensus.MiniProtocol.BlockFetch.Server</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Client.html"><span class="hs-identifier">Ouroboros.Consensus.MiniProtocol.ChainSync.Client</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Server.html"><span class="hs-identifier">Ouroboros.Consensus.MiniProtocol.ChainSync.Server</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html"><span class="hs-identifier">Ouroboros.Consensus.Node.NetworkProtocolVersion</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Run</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Serialisation.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Serialisation</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Tracers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Node</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html"><span class="hs-identifier">Ouroboros.Consensus.NodeKernel</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.API.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.API</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ChainDB</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.html"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">ShowProxy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.Orphans.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html"><span class="hs-identifier">Ouroboros.Consensus.Util.ResourceRegistry</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.Serialisation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier">SerialisedHeader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Handlers
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- | Protocol handlers for node-to-node (remote) communication</span><span>
</span><span id="line-107"></span><span class="hs-keyword">data</span><span> </span><span id="Handlers"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span></span><span> </span><span id="local-6989586621680045797"><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045798"><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span></span><span> </span><span id="local-6989586621680045796"><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Handlers"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-108"></span><span>      </span><span id="hChainSyncClient"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; peer
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hChainSyncClient"><span class="hs-identifier hs-var hs-var">hChainSyncClient</span></a></span></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">StrictTVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">AnchoredFragment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSyncClientPipelined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Client.html#ChainSyncClientResult"><span class="hs-identifier hs-type">ChainSyncClientResult</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-comment">-- TODO: we should consider either bundling these context parameters</span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-comment">-- into a record, or extending the protocol handler representation</span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-comment">-- to support bracket-style initialisation so that we could have the</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-comment">-- closure include these and not need to be explicit about them here.</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hChainSyncServer"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hChainSyncServer"><span class="hs-identifier hs-var hs-var">hChainSyncServer</span></a></span></span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#Follower"><span class="hs-identifier hs-type">ChainDB.Follower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#WithPoint"><span class="hs-identifier hs-type">ChainDB.WithPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSyncServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- TODO block fetch client does not have GADT view of the handlers.</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hBlockFetchClient"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; BlockFetchClient (Header blk) blk m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hBlockFetchClient"><span class="hs-identifier hs-var hs-var">hBlockFetchClient</span></a></span></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetchClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hBlockFetchServer"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hBlockFetchServer"><span class="hs-identifier hs-var hs-var">hBlockFetchServer</span></a></span></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetchServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hTxSubmissionClient"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; peer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hTxSubmissionClient"><span class="hs-identifier hs-var hs-var">hTxSubmissionClient</span></a></span></span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmissionClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hTxSubmissionServer"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; peer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hTxSubmissionServer"><span class="hs-identifier hs-var hs-var">hTxSubmissionServer</span></a></span></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmissionServerPipelined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045796"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hKeepAliveClient"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; peer
-&gt; StrictTVar m (Map peer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hKeepAliveClient"><span class="hs-identifier hs-var hs-var">hKeepAliveClient</span></a></span></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">StrictTVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">PeerGSV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">KeepAliveInterval</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">KeepAliveClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hKeepAliveServer"><span class="annot"><span class="annottext">Handlers m peer blk
-&gt; NodeToNodeVersion -&gt; peer -&gt; KeepAliveServer m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hKeepAliveServer"><span class="hs-identifier hs-var hs-var">hKeepAliveServer</span></a></span></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045798"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">KeepAliveServer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkHandlers"><span class="hs-identifier hs-type">mkHandlers</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680045159"><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045158"><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621680045157"><span class="annot"><a href="#local-6989586621680045157"><span class="hs-identifier hs-type">remotePeer</span></a></span></span><span> </span><span id="local-6989586621680045156"><span class="annot"><a href="#local-6989586621680045156"><span class="hs-identifier hs-type">localPeer</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-162"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html#IOLike"><span class="hs-identifier hs-type">IOLike</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-163"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-164"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">MonadTimer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-165"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#LedgerSupportsMempool"><span class="hs-identifier hs-type">LedgerSupportsMempool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-166"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#HasTxId"><span class="hs-identifier hs-type">HasTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsProtocol.html#LedgerSupportsProtocol"><span class="hs-identifier hs-type">LedgerSupportsProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-168"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680045157"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-169"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045157"><span class="hs-identifier hs-type">remotePeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045156"><span class="hs-identifier hs-type">localPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span>     </span><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045157"><span class="hs-identifier hs-type">remotePeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045156"><span class="hs-identifier hs-type">localPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span>       </span><span class="annot"><a href="#local-6989586621680045159"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045157"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>           </span><span class="annot"><a href="#local-6989586621680045158"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-173"></span><span id="mkHandlers"><span class="annot"><span class="annottext">mkHandlers :: NodeKernelArgs m remotePeer localPeer blk
-&gt; NodeKernel m remotePeer localPeer blk
-&gt; Handlers m remotePeer blk
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkHandlers"><span class="hs-identifier hs-var hs-var">mkHandlers</span></a></span></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680045154"><span class="annot"><span class="annottext">StdGen
$sel:keepAliveRng:NodeKernelArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernelArgs m remotePeer localPeer blk -&gt; StdGen
keepAliveRng :: StdGen
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AkeepAliveRng%3ANodeKernelArgs"><span class="hs-identifier hs-var hs-var">keepAliveRng</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680045152"><span class="annot"><span class="annottext">MiniProtocolParameters
$sel:miniProtocolParameters:NodeKernelArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernelArgs m remotePeer localPeer blk -&gt; MiniProtocolParameters
miniProtocolParameters :: MiniProtocolParameters
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeKernelArgs"><span class="hs-identifier hs-var hs-var">miniProtocolParameters</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680045149"><span class="annot"><span class="annottext">ChainDB m blk
$sel:getChainDB:NodeKernel :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk -&gt; ChainDB m blk
getChainDB :: ChainDB m blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetChainDB%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getChainDB</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680045147"><span class="annot"><span class="annottext">Mempool m blk TicketNo
$sel:getMempool:NodeKernel :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk -&gt; Mempool m blk TicketNo
getMempool :: Mempool m blk TicketNo
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetMempool%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getMempool</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680045145"><span class="annot"><span class="annottext">TopLevelConfig blk
$sel:getTopLevelConfig:NodeKernel :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk -&gt; TopLevelConfig blk
getTopLevelConfig :: TopLevelConfig blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetTopLevelConfig%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getTopLevelConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:getTracers:NodeKernel :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk
-&gt; Tracers m remotePeer localPeer blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetTracers%3ANodeKernel"><span class="hs-identifier hs-var">getTracers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680045142"><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">Handlers :: forall (m :: * -&gt; *) peer blk.
(peer
 -&gt; NodeToNodeVersion
 -&gt; ControlMessageSTM m
 -&gt; StrictTVar m (AnchoredFragment (Header blk))
 -&gt; ChainSyncClientPipelined
      (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult)
-&gt; (NodeToNodeVersion
    -&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
    -&gt; ChainSyncServer
         (SerialisedHeader blk) (Point blk) (Tip blk) m ())
-&gt; (NodeToNodeVersion
    -&gt; ControlMessageSTM m -&gt; BlockFetchClient (Header blk) blk m ())
-&gt; (NodeToNodeVersion
    -&gt; ResourceRegistry m
    -&gt; BlockFetchServer (Serialised blk) (Point blk) m ())
-&gt; (NodeToNodeVersion
    -&gt; ControlMessageSTM m
    -&gt; peer
    -&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ())
-&gt; (NodeToNodeVersion
    -&gt; peer
    -&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ())
-&gt; (NodeToNodeVersion
    -&gt; ControlMessageSTM m
    -&gt; peer
    -&gt; StrictTVar m (Map peer PeerGSV)
    -&gt; KeepAliveInterval
    -&gt; KeepAliveClient m ())
-&gt; (NodeToNodeVersion -&gt; peer -&gt; KeepAliveServer m ())
-&gt; Handlers m peer blk
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">hChainSyncClient :: remotePeer
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hChainSyncClient"><span class="hs-identifier hs-var">hChainSyncClient</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045141"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045141"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-178"></span><span>          </span><span class="annot"><span class="annottext">MkPipelineDecision
-&gt; Tracer m (TraceChainSyncClientEvent blk)
-&gt; TopLevelConfig blk
-&gt; ChainDbView m blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
forall (m :: * -&gt; *) blk.
(IOLike m, LedgerSupportsProtocol blk) =&gt;
MkPipelineDecision
-&gt; Tracer m (TraceChainSyncClientEvent blk)
-&gt; TopLevelConfig blk
-&gt; ChainDbView m blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; Consensus ChainSyncClientPipelined blk m
</span><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Client.html#chainSyncClient"><span class="hs-identifier hs-var">chainSyncClient</span></a></span><span>
</span><span id="line-179"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; MkPipelineDecision
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">pipelineDecisionLowHighMark</span></a></span><span>
</span><span id="line-180"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word32
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">chainSyncPipeliningLowMark</span></a></span><span>  </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680045152"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word32
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">chainSyncPipeliningHighMark</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680045152"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceChainSyncClientEvent blk
 -&gt; TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
-&gt; Tracer
     m (TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
-&gt; Tracer m (TraceChainSyncClientEvent blk)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceChainSyncClientEvent blk
-&gt; TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk)
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045141"><span class="hs-identifier hs-var">peer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
-&gt; Tracer
     m (TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
</span><a href="Ouroboros.Consensus.Node.Tracers.html#chainSyncClientTracer"><span class="hs-identifier hs-var hs-var">Node.chainSyncClientTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>            </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680045145"><span class="hs-identifier hs-var">getTopLevelConfig</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainDB m blk -&gt; ChainDbView m blk
forall (m :: * -&gt; *) blk.
(IOLike m, LedgerSupportsProtocol blk) =&gt;
ChainDB m blk -&gt; ChainDbView m blk
</span><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Client.html#defaultChainDbView"><span class="hs-identifier hs-var">defaultChainDbView</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621680045149"><span class="hs-identifier hs-var">getChainDB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hChainSyncServer :: NodeToNodeVersion
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hChainSyncServer"><span class="hs-identifier hs-var">hChainSyncServer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045132"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045132"><span class="hs-identifier hs-var">_version</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">Tracer m (TraceChainSyncServerEvent blk)
-&gt; ChainDB m blk
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
forall (m :: * -&gt; *) blk.
(IOLike m, HasHeader (Header blk)) =&gt;
Tracer m (TraceChainSyncServerEvent blk)
-&gt; ChainDB m blk
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
</span><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Server.html#chainSyncHeadersServer"><span class="hs-identifier hs-var">chainSyncHeadersServer</span></a></span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
-&gt; Tracer m (TraceChainSyncServerEvent blk)
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceChainSyncServerEvent blk)
</span><a href="Ouroboros.Consensus.Node.Tracers.html#chainSyncServerHeaderTracer"><span class="hs-identifier hs-var hs-var">Node.chainSyncServerHeaderTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>            </span><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621680045149"><span class="hs-identifier hs-var">getChainDB</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hBlockFetchClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m -&gt; BlockFetchClient (Header blk) blk m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hBlockFetchClient"><span class="hs-identifier hs-var">hBlockFetchClient</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>          </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; ControlMessageSTM m -&gt; BlockFetchClient (Header blk) blk m ()
forall header block (m :: * -&gt; *).
(MonadSTM m, MonadThrow m, MonadTime m, HasHeader header,
 HasHeader block, HeaderHash header ~ HeaderHash block) =&gt;
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; FetchClientContext header block m
-&gt; PeerPipelined
     (BlockFetch block (Point block)) 'AsClient 'BFIdle m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">blockFetchClient</span></a></span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hBlockFetchServer :: NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hBlockFetchServer"><span class="hs-identifier hs-var">hBlockFetchServer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045129"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045129"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>          </span><span class="annot"><span class="annottext">Tracer m (TraceBlockFetchServerEvent blk)
-&gt; ChainDB m blk
-&gt; NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
forall (m :: * -&gt; *) blk.
(IOLike m, StandardHash blk, Typeable blk) =&gt;
Tracer m (TraceBlockFetchServerEvent blk)
-&gt; ChainDB m blk
-&gt; NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
</span><a href="Ouroboros.Consensus.MiniProtocol.BlockFetch.Server.html#blockFetchServer"><span class="hs-identifier hs-var">blockFetchServer</span></a></span><span>
</span><span id="line-193"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
-&gt; Tracer m (TraceBlockFetchServerEvent blk)
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceBlockFetchServerEvent blk)
</span><a href="Ouroboros.Consensus.Node.Tracers.html#blockFetchServerTracer"><span class="hs-identifier hs-var hs-var">Node.blockFetchServerTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621680045149"><span class="hs-identifier hs-var">getChainDB</span></a></span><span>
</span><span id="line-195"></span><span>            </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045129"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hTxSubmissionClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hTxSubmissionClient"><span class="hs-identifier hs-var">hTxSubmissionClient</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045126"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045126"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680045125"><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680045125"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span></span><span> </span><span id="local-6989586621680045124"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045124"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-197"></span><span>          </span><span class="annot"><span class="annottext">Tracer m (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk))
-&gt; Word16
-&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
forall txid tx idx (m :: * -&gt; *).
(Ord txid, Ord idx, MonadSTM m, MonadThrow m) =&gt;
Tracer m (TraceTxSubmissionOutbound txid tx)
-&gt; Word16
-&gt; TxSubmissionMempoolReader txid tx idx m
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; TxSubmissionClient txid tx m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionOutbound</span></a></span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk)
 -&gt; TraceLabelPeer
      remotePeer (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk)))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk)))
-&gt; Tracer m (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk)
-&gt; TraceLabelPeer
     remotePeer (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045124"><span class="hs-identifier hs-var">peer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk)))
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceLabelPeer
        remotePeer (TraceTxSubmissionOutbound (GenTxId blk) (GenTx blk)))
</span><a href="Ouroboros.Consensus.Node.Tracers.html#txOutboundTracer"><span class="hs-identifier hs-var hs-var">Node.txOutboundTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word16
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">txSubmissionMaxUnacked</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680045152"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Validated (GenTx blk) -&gt; GenTx blk)
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
-&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m
forall (m :: * -&gt; *) tx tx' txid idx.
MonadSTM m =&gt;
(tx -&gt; tx')
-&gt; TxSubmissionMempoolReader txid tx idx m
-&gt; TxSubmissionMempoolReader txid tx' idx m
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">mapTxSubmissionMempoolReader</span></a></span><span> </span><span class="annot"><span class="annottext">Validated (GenTx blk) -&gt; GenTx blk
forall blk.
LedgerSupportsMempool blk =&gt;
Validated (GenTx blk) -&gt; GenTx blk
</span><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#txForgetValidated"><span class="hs-identifier hs-var">txForgetValidated</span></a></span><span> </span><span class="annot"><span class="annottext">(TxSubmissionMempoolReader
   (GenTxId blk) (Validated (GenTx blk)) TicketNo m
 -&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m)
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
-&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Mempool m blk TicketNo
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
forall (m :: * -&gt; *) blk.
(LedgerSupportsMempool blk, IOLike m, HasTxId (GenTx blk)) =&gt;
Mempool m blk TicketNo
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
</span><a href="Ouroboros.Consensus.NodeKernel.html#getMempoolReader"><span class="hs-identifier hs-var">getMempoolReader</span></a></span><span> </span><span class="annot"><span class="annottext">Mempool m blk TicketNo
</span><a href="#local-6989586621680045147"><span class="hs-identifier hs-var">getMempool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045126"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-202"></span><span>            </span><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680045125"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span>
</span><span id="line-203"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hTxSubmissionServer :: NodeToNodeVersion
-&gt; remotePeer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hTxSubmissionServer"><span class="hs-identifier hs-var">hTxSubmissionServer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045118"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045118"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680045117"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045117"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">Counter m (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk))
-&gt; Word16
-&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m
-&gt; TxSubmissionMempoolWriter (GenTxId blk) (GenTx blk) TicketNo m
-&gt; NodeToNodeVersion
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
forall txid tx idx (m :: * -&gt; *).
(Ord txid, NoThunks txid, NoThunks tx, MonadSTM m, MonadThrow m) =&gt;
Counter m (TraceTxSubmissionInbound txid tx)
-&gt; Word16
-&gt; TxSubmissionMempoolReader txid tx idx m
-&gt; TxSubmissionMempoolWriter txid tx idx m
-&gt; NodeToNodeVersion
-&gt; TxSubmissionServerPipelined txid tx m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionInbound</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceTxSubmissionInbound (GenTxId blk) (GenTx blk)
 -&gt; TraceLabelPeer
      remotePeer (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk)))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk)))
-&gt; Counter m (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceTxSubmissionInbound (GenTxId blk) (GenTx blk)
-&gt; TraceLabelPeer
     remotePeer (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045117"><span class="hs-identifier hs-var">peer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk)))
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceLabelPeer
        remotePeer (TraceTxSubmissionInbound (GenTxId blk) (GenTx blk)))
</span><a href="Ouroboros.Consensus.Node.Tracers.html#txInboundTracer"><span class="hs-identifier hs-var hs-var">Node.txInboundTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word16
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">txSubmissionMaxUnacked</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680045152"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Validated (GenTx blk) -&gt; GenTx blk)
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
-&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m
forall (m :: * -&gt; *) tx tx' txid idx.
MonadSTM m =&gt;
(tx -&gt; tx')
-&gt; TxSubmissionMempoolReader txid tx idx m
-&gt; TxSubmissionMempoolReader txid tx' idx m
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">mapTxSubmissionMempoolReader</span></a></span><span> </span><span class="annot"><span class="annottext">Validated (GenTx blk) -&gt; GenTx blk
forall blk.
LedgerSupportsMempool blk =&gt;
Validated (GenTx blk) -&gt; GenTx blk
</span><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#txForgetValidated"><span class="hs-identifier hs-var">txForgetValidated</span></a></span><span> </span><span class="annot"><span class="annottext">(TxSubmissionMempoolReader
   (GenTxId blk) (Validated (GenTx blk)) TicketNo m
 -&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m)
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
-&gt; TxSubmissionMempoolReader (GenTxId blk) (GenTx blk) TicketNo m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Mempool m blk TicketNo
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
forall (m :: * -&gt; *) blk.
(LedgerSupportsMempool blk, IOLike m, HasTxId (GenTx blk)) =&gt;
Mempool m blk TicketNo
-&gt; TxSubmissionMempoolReader
     (GenTxId blk) (Validated (GenTx blk)) TicketNo m
</span><a href="Ouroboros.Consensus.NodeKernel.html#getMempoolReader"><span class="hs-identifier hs-var">getMempoolReader</span></a></span><span> </span><span class="annot"><span class="annottext">Mempool m blk TicketNo
</span><a href="#local-6989586621680045147"><span class="hs-identifier hs-var">getMempool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mempool m blk TicketNo
-&gt; TxSubmissionMempoolWriter (GenTxId blk) (GenTx blk) TicketNo m
forall blk (m :: * -&gt; *).
(LedgerSupportsMempool blk, IOLike m, HasTxId (GenTx blk)) =&gt;
Mempool m blk TicketNo
-&gt; TxSubmissionMempoolWriter (GenTxId blk) (GenTx blk) TicketNo m
</span><a href="Ouroboros.Consensus.NodeKernel.html#getMempoolWriter"><span class="hs-identifier hs-var">getMempoolWriter</span></a></span><span> </span><span class="annot"><span class="annottext">Mempool m blk TicketNo
</span><a href="#local-6989586621680045147"><span class="hs-identifier hs-var">getMempool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>            </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045118"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hKeepAliveClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; StrictTVar m (Map remotePeer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hKeepAliveClient"><span class="hs-identifier hs-var">hKeepAliveClient</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045113"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045113"><span class="hs-identifier hs-var">_version</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tracer m (TraceKeepAliveClient remotePeer)
-&gt; StdGen
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; StrictTVar m (Map remotePeer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
forall (m :: * -&gt; *) peer.
(MonadSTM m, MonadMonotonicTime m, MonadTimer m, Ord peer) =&gt;
Tracer m (TraceKeepAliveClient peer)
-&gt; StdGen
-&gt; ControlMessageSTM m
-&gt; peer
-&gt; StrictTVar m (Map peer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
-&gt; Tracer m (TraceKeepAliveClient remotePeer)
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceKeepAliveClient remotePeer)
</span><a href="Ouroboros.Consensus.Node.Tracers.html#keepAliveClientTracer"><span class="hs-identifier hs-var hs-var">Node.keepAliveClientTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m remotePeer localPeer blk
</span><a href="#local-6989586621680045142"><span class="hs-identifier hs-var">tracers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680045154"><span class="hs-identifier hs-var">keepAliveRng</span></a></span><span>
</span><span id="line-211"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hKeepAliveServer :: NodeToNodeVersion -&gt; remotePeer -&gt; KeepAliveServer m ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#hKeepAliveServer"><span class="hs-identifier hs-var">hKeepAliveServer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680045110"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045110"><span class="hs-identifier hs-var">_version</span></a></span></span><span> </span><span id="local-6989586621680045109"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680045109"><span class="hs-identifier hs-var">_peer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeepAliveServer m ()
forall (m :: * -&gt; *). Applicative m =&gt; KeepAliveServer m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveServer</span></a></span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Codecs
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Node-to-node protocol codecs needed to run 'Handlers'.</span><span>
</span><span id="line-219"></span><span class="hs-keyword">data</span><span> </span><span id="Codecs"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-var">Codecs</span></a></span></span><span> </span><span id="local-6989586621680045634"><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621680045633"><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680045632"><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045631"><span class="annot"><a href="#local-6989586621680045631"><span class="hs-identifier hs-type">bCS</span></a></span></span><span> </span><span id="local-6989586621680045630"><span class="annot"><a href="#local-6989586621680045630"><span class="hs-identifier hs-type">bSCS</span></a></span></span><span> </span><span id="local-6989586621680045629"><span class="annot"><a href="#local-6989586621680045629"><span class="hs-identifier hs-type">bBF</span></a></span></span><span> </span><span id="local-6989586621680045628"><span class="annot"><a href="#local-6989586621680045628"><span class="hs-identifier hs-type">bSBF</span></a></span></span><span> </span><span id="local-6989586621680045627"><span class="annot"><a href="#local-6989586621680045627"><span class="hs-identifier hs-type">bTX</span></a></span></span><span> </span><span id="local-6989586621680045626"><span class="annot"><a href="#local-6989586621680045626"><span class="hs-identifier hs-type">bTX2</span></a></span></span><span> </span><span id="local-6989586621680045625"><span class="annot"><a href="#local-6989586621680045625"><span class="hs-identifier hs-type">bKA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Codecs"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-var">Codecs</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-220"></span><span>      </span><span id="cChainSyncCodec"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (ChainSync (Header blk) (Point blk) (Tip blk)) e m bCS
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodec"><span class="hs-identifier hs-var hs-var">cChainSyncCodec</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>           </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045631"><span class="hs-identifier hs-type">bCS</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cChainSyncCodecSerialised"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) e m bSCS
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodecSerialised"><span class="hs-identifier hs-var hs-var">cChainSyncCodecSerialised</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045630"><span class="hs-identifier hs-type">bSCS</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cBlockFetchCodec"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (BlockFetch blk (Point blk)) e m bBF
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodec"><span class="hs-identifier hs-var hs-var">cBlockFetchCodec</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                             </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045629"><span class="hs-identifier hs-type">bBF</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cBlockFetchCodecSerialised"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (BlockFetch (Serialised blk) (Point blk)) e m bSBF
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodecSerialised"><span class="hs-identifier hs-var hs-var">cBlockFetchCodecSerialised</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045628"><span class="hs-identifier hs-type">bSBF</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cTxSubmissionCodec"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmissionCodec"><span class="hs-identifier hs-var hs-var">cTxSubmissionCodec</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                 </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045627"><span class="hs-identifier hs-type">bTX</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cTxSubmission2Codec"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmission2Codec"><span class="hs-identifier hs-var hs-var">cTxSubmission2Codec</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmission2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045634"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045626"><span class="hs-identifier hs-type">bTX2</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cKeepAliveCodec"><span class="annot"><span class="annottext">Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec KeepAlive e m bKA
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cKeepAliveCodec"><span class="hs-identifier hs-var hs-var">cKeepAliveCodec</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">KeepAlive</span></a></span><span>                                                </span><span class="annot"><a href="#local-6989586621680045633"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045632"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045625"><span class="hs-identifier hs-type">bKA</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- | Protocol codecs for the node-to-node protocols</span><span>
</span><span id="line-230"></span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#defaultCodecs"><span class="hs-identifier hs-type">defaultCodecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680045099"><span class="annot"><a href="#local-6989586621680045099"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045098"><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html#IOLike"><span class="hs-identifier hs-type">IOLike</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045099"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#SerialiseNodeToNodeConstraints"><span class="hs-identifier hs-type">SerialiseNodeToNodeConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>                                </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ShowProxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ShowProxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#CodecConfig"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span>       </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-233"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToNodeVersion"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-234"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-235"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-type">Codecs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">DeserialiseFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045099"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-236"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-237"></span><span id="defaultCodecs"><span class="annot"><span class="annottext">defaultCodecs :: CodecConfig blk
-&gt; BlockNodeToNodeVersion blk
-&gt; NodeToNodeVersion
-&gt; Codecs
     blk
     DeserialiseFailure
     m
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#defaultCodecs"><span class="hs-identifier hs-var hs-var">defaultCodecs</span></a></span></span><span> </span><span id="local-6989586621680045096"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621680045096"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span id="local-6989586621680045095"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680045095"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680045094"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045094"><span class="hs-identifier hs-var">nodeToNodeVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codecs :: forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codec (ChainSync (Header blk) (Point blk) (Tip blk)) e m bCS
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) e m bSCS
-&gt; Codec (BlockFetch blk (Point blk)) e m bBF
-&gt; Codec (BlockFetch (Serialised blk) (Point blk)) e m bSBF
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
-&gt; Codec KeepAlive e m bKA
-&gt; Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-type">Codecs</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><span class="annottext">cChainSyncCodec :: Codec
  (ChainSync (Header blk) (Point blk) (Tip blk))
  DeserialiseFailure
  m
  ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodec"><span class="hs-identifier hs-var">cChainSyncCodec</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">(Header blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Header blk))
-&gt; (Point blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Point blk))
-&gt; (Tip blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Tip blk))
-&gt; Codec
     (ChainSync (Header blk) (Point blk) (Tip blk))
     DeserialiseFailure
     m
     ByteString
forall header point tip (m :: * -&gt; *).
MonadST m =&gt;
(header -&gt; Encoding)
-&gt; (forall s. Decoder s header)
-&gt; (point -&gt; Encoding)
-&gt; (forall s. Decoder s point)
-&gt; (tip -&gt; Encoding)
-&gt; (forall s. Decoder s tip)
-&gt; Codec
     (ChainSync header point tip) DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecChainSync</span></a></span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">Header blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (Header blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-242"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderHash blk -&gt; Encoding) -&gt; Point blk -&gt; Encoding
forall block.
(HeaderHash block -&gt; Encoding) -&gt; Point block -&gt; Encoding
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">encodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Encoding
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; Encoding
</span><a href="Ouroboros.Consensus.Block.Abstract.html#encodeRawHash"><span class="hs-identifier hs-var">encodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Point blk)
forall block.
(forall s. Decoder s (HeaderHash block))
-&gt; forall s. Decoder s (Point block)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">decodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
</span><a href="Ouroboros.Consensus.Block.Abstract.html#decodeRawHash"><span class="hs-identifier hs-var">decodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderHash blk -&gt; Encoding) -&gt; Tip blk -&gt; Encoding
forall blk. (HeaderHash blk -&gt; Encoding) -&gt; Tip blk -&gt; Encoding
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">encodeTip</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Encoding
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; Encoding
</span><a href="Ouroboros.Consensus.Block.Abstract.html#encodeRawHash"><span class="hs-identifier hs-var">encodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Tip blk)
forall blk.
(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Tip blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">decodeTip</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
</span><a href="Ouroboros.Consensus.Block.Abstract.html#decodeRawHash"><span class="hs-identifier hs-var">decodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cChainSyncCodecSerialised :: Codec
  (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
  DeserialiseFailure
  m
  ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodecSerialised"><span class="hs-identifier hs-var">cChainSyncCodecSerialised</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><span class="annottext">(SerialisedHeader blk -&gt; Encoding)
-&gt; (forall s. Decoder s (SerialisedHeader blk))
-&gt; (Point blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Point blk))
-&gt; (Tip blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Tip blk))
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
     DeserialiseFailure
     m
     ByteString
forall header point tip (m :: * -&gt; *).
MonadST m =&gt;
(header -&gt; Encoding)
-&gt; (forall s. Decoder s header)
-&gt; (point -&gt; Encoding)
-&gt; (forall s. Decoder s point)
-&gt; (tip -&gt; Encoding)
-&gt; (forall s. Decoder s tip)
-&gt; Codec
     (ChainSync header point tip) DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecChainSync</span></a></span><span>
</span><span id="line-249"></span><span>          </span><span class="annot"><span class="annottext">SerialisedHeader blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-250"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (SerialisedHeader blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-251"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderHash blk -&gt; Encoding) -&gt; Point blk -&gt; Encoding
forall block.
(HeaderHash block -&gt; Encoding) -&gt; Point block -&gt; Encoding
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">encodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Encoding
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; Encoding
</span><a href="Ouroboros.Consensus.Block.Abstract.html#encodeRawHash"><span class="hs-identifier hs-var">encodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Point blk)
forall block.
(forall s. Decoder s (HeaderHash block))
-&gt; forall s. Decoder s (Point block)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">decodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
</span><a href="Ouroboros.Consensus.Block.Abstract.html#decodeRawHash"><span class="hs-identifier hs-var">decodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderHash blk -&gt; Encoding) -&gt; Tip blk -&gt; Encoding
forall blk. (HeaderHash blk -&gt; Encoding) -&gt; Tip blk -&gt; Encoding
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">encodeTip</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Encoding
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; Encoding
</span><a href="Ouroboros.Consensus.Block.Abstract.html#encodeRawHash"><span class="hs-identifier hs-var">encodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Tip blk)
forall blk.
(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Tip blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">decodeTip</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
</span><a href="Ouroboros.Consensus.Block.Abstract.html#decodeRawHash"><span class="hs-identifier hs-var">decodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cBlockFetchCodec :: Codec (BlockFetch blk (Point blk)) DeserialiseFailure m ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodec"><span class="hs-identifier hs-var">cBlockFetchCodec</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">(blk -&gt; Encoding)
-&gt; (forall s. Decoder s blk)
-&gt; (Point blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Point blk))
-&gt; Codec
     (BlockFetch blk (Point blk)) DeserialiseFailure m ByteString
forall block point (m :: * -&gt; *).
MonadST m =&gt;
(block -&gt; Encoding)
-&gt; (forall s. Decoder s block)
-&gt; (point -&gt; Encoding)
-&gt; (forall s. Decoder s point)
-&gt; Codec (BlockFetch block point) DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecBlockFetch</span></a></span><span>
</span><span id="line-258"></span><span>          </span><span class="annot"><span class="annottext">blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s blk
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-260"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderHash blk -&gt; Encoding) -&gt; Point blk -&gt; Encoding
forall block.
(HeaderHash block -&gt; Encoding) -&gt; Point block -&gt; Encoding
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">encodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Encoding
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; Encoding
</span><a href="Ouroboros.Consensus.Block.Abstract.html#encodeRawHash"><span class="hs-identifier hs-var">encodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Point blk)
forall block.
(forall s. Decoder s (HeaderHash block))
-&gt; forall s. Decoder s (Point block)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">decodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
</span><a href="Ouroboros.Consensus.Block.Abstract.html#decodeRawHash"><span class="hs-identifier hs-var">decodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cBlockFetchCodecSerialised :: Codec
  (BlockFetch (Serialised blk) (Point blk))
  DeserialiseFailure
  m
  ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodecSerialised"><span class="hs-identifier hs-var">cBlockFetchCodecSerialised</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">(Serialised blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Serialised blk))
-&gt; (Point blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Point blk))
-&gt; Codec
     (BlockFetch (Serialised blk) (Point blk))
     DeserialiseFailure
     m
     ByteString
forall block point (m :: * -&gt; *).
MonadST m =&gt;
(block -&gt; Encoding)
-&gt; (forall s. Decoder s block)
-&gt; (point -&gt; Encoding)
-&gt; (forall s. Decoder s point)
-&gt; Codec (BlockFetch block point) DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecBlockFetch</span></a></span><span>
</span><span id="line-265"></span><span>          </span><span class="annot"><span class="annottext">Serialised blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-266"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (Serialised blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-267"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderHash blk -&gt; Encoding) -&gt; Point blk -&gt; Encoding
forall block.
(HeaderHash block -&gt; Encoding) -&gt; Point block -&gt; Encoding
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">encodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Encoding
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; Encoding
</span><a href="Ouroboros.Consensus.Block.Abstract.html#encodeRawHash"><span class="hs-identifier hs-var">encodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (HeaderHash blk))
-&gt; forall s. Decoder s (Point blk)
forall block.
(forall s. Decoder s (HeaderHash block))
-&gt; forall s. Decoder s (Point block)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">decodePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; forall s. Decoder s (HeaderHash blk)
</span><a href="Ouroboros.Consensus.Block.Abstract.html#decodeRawHash"><span class="hs-identifier hs-var">decodeRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cTxSubmissionCodec :: Codec
  (TxSubmission (GenTxId blk) (GenTx blk))
  DeserialiseFailure
  m
  ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmissionCodec"><span class="hs-identifier hs-var">cTxSubmissionCodec</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">(GenTxId blk -&gt; Encoding)
-&gt; (forall s. Decoder s (GenTxId blk))
-&gt; (GenTx blk -&gt; Encoding)
-&gt; (forall s. Decoder s (GenTx blk))
-&gt; Codec
     (TxSubmission (GenTxId blk) (GenTx blk))
     DeserialiseFailure
     m
     ByteString
forall txid tx (m :: * -&gt; *).
MonadST m =&gt;
(txid -&gt; Encoding)
-&gt; (forall s. Decoder s txid)
-&gt; (tx -&gt; Encoding)
-&gt; (forall s. Decoder s tx)
-&gt; Codec (TxSubmission txid tx) DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecTxSubmission</span></a></span><span>
</span><span id="line-272"></span><span>          </span><span class="annot"><span class="annottext">GenTxId blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-273"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (GenTxId blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><span class="annottext">GenTx blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-275"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (GenTx blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cTxSubmission2Codec :: Codec
  (TxSubmission2 (GenTxId blk) (GenTx blk))
  DeserialiseFailure
  m
  ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmission2Codec"><span class="hs-identifier hs-var">cTxSubmission2Codec</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">(GenTxId blk -&gt; Encoding)
-&gt; (forall s. Decoder s (GenTxId blk))
-&gt; (GenTx blk -&gt; Encoding)
-&gt; (forall s. Decoder s (GenTx blk))
-&gt; Codec
     (TxSubmission2 (GenTxId blk) (GenTx blk))
     DeserialiseFailure
     m
     ByteString
forall txid tx (m :: * -&gt; *).
(MonadST m, ShowProxy txid, ShowProxy tx) =&gt;
(txid -&gt; Encoding)
-&gt; (forall s. Decoder s txid)
-&gt; (tx -&gt; Encoding)
-&gt; (forall s. Decoder s tx)
-&gt; Codec (TxSubmission2 txid tx) DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecTxSubmission2</span></a></span><span>
</span><span id="line-279"></span><span>          </span><span class="annot"><span class="annottext">GenTxId blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-280"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (GenTxId blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-281"></span><span>          </span><span class="annot"><span class="annottext">GenTx blk -&gt; Encoding
forall a. SerialiseNodeToNode blk a =&gt; a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="annottext">forall s. Decoder s (GenTx blk)
forall a s. SerialiseNodeToNode blk a =&gt; Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cKeepAliveCodec :: Codec KeepAlive DeserialiseFailure m ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cKeepAliveCodec"><span class="hs-identifier hs-var">cKeepAliveCodec</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680045094"><span class="hs-identifier hs-var">nodeToNodeVersion</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; NodeToNodeVersion -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">NodeToNodeV_6</span></a></span><span>
</span><span id="line-286"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Codec KeepAlive DeserialiseFailure m ByteString
forall (m :: * -&gt; *).
MonadST m =&gt;
Codec KeepAlive DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecKeepAlive</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Codec KeepAlive DeserialiseFailure m ByteString
forall (m :: * -&gt; *).
MonadST m =&gt;
Codec KeepAlive DeserialiseFailure m ByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecKeepAlive_v2</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="#local-6989586621680045089"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621680045089"><span class="annot"><span class="annottext">p :: Proxy blk
</span><a href="#local-6989586621680045089"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy blk
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621680045614"><span class="annot"><a href="#local-6989586621680045092"><span class="hs-identifier hs-type">enc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Serialisation.html#SerialiseNodeToNode"><span class="hs-identifier hs-type">SerialiseNodeToNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045614"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045614"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span></span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621680045092"><span class="annot"><span class="annottext">enc :: a -&gt; Encoding
</span><a href="#local-6989586621680045092"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="Ouroboros.Consensus.Node.Serialisation.html#encodeNodeToNode"><span class="hs-identifier hs-var">encodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621680045096"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680045095"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621680045612"><span class="annot"><a href="#local-6989586621680045091"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Serialisation.html#SerialiseNodeToNode"><span class="hs-identifier hs-type">SerialiseNodeToNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045098"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045612"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680045611"><span class="annot"><a href="#local-6989586621680045611"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621680045611"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045612"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621680045091"><span class="annot"><span class="annottext">dec :: forall s. Decoder s a
</span><a href="#local-6989586621680045091"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk
-&gt; BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="Ouroboros.Consensus.Node.Serialisation.html#decodeNodeToNode"><span class="hs-identifier hs-var">decodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621680045096"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680045095"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Identity codecs used in tests.</span><span>
</span><span id="line-300"></span><span id="local-6989586621680045076"><span id="local-6989586621680045077"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#identityCodecs"><span class="hs-identifier hs-type">identityCodecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680045077"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-301"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-type">Codecs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">CodecFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045077"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-302"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmission2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045076"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/typed-protocols-examples-0.1.0.0/noopt/doc/html/typed-protocols-examples/src"><span class="hs-identifier hs-type">AnyMessage</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">KeepAlive</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-309"></span><span id="identityCodecs"><span class="annot"><span class="annottext">identityCodecs :: Codecs
  blk
  CodecFailure
  m
  (AnyMessage (ChainSync (Header blk) (Point blk) (Tip blk)))
  (AnyMessage
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))
  (AnyMessage (BlockFetch blk (Point blk)))
  (AnyMessage (BlockFetch (Serialised blk) (Point blk)))
  (AnyMessage (TxSubmission (GenTxId blk) (GenTx blk)))
  (AnyMessage (TxSubmission2 (GenTxId blk) (GenTx blk)))
  (AnyMessage KeepAlive)
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#identityCodecs"><span class="hs-identifier hs-var hs-var">identityCodecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codecs :: forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codec (ChainSync (Header blk) (Point blk) (Tip blk)) e m bCS
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) e m bSCS
-&gt; Codec (BlockFetch blk (Point blk)) e m bBF
-&gt; Codec (BlockFetch (Serialised blk) (Point blk)) e m bSBF
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
-&gt; Codec KeepAlive e m bKA
-&gt; Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-type">Codecs</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><span class="annottext">cChainSyncCodec :: Codec
  (ChainSync (Header blk) (Point blk) (Tip blk))
  CodecFailure
  m
  (AnyMessage (ChainSync (Header blk) (Point blk) (Tip blk)))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodec"><span class="hs-identifier hs-var">cChainSyncCodec</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec
  (ChainSync (Header blk) (Point blk) (Tip blk))
  CodecFailure
  m
  (AnyMessage (ChainSync (Header blk) (Point blk) (Tip blk)))
forall k1 k2 k3 (header :: k1) (point :: k2) (tip :: k3)
       (m :: * -&gt; *).
Monad m =&gt;
Codec
  (ChainSync header point tip)
  CodecFailure
  m
  (AnyMessage (ChainSync header point tip))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecChainSyncId</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cChainSyncCodecSerialised :: Codec
  (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
  CodecFailure
  m
  (AnyMessage
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodecSerialised"><span class="hs-identifier hs-var">cChainSyncCodecSerialised</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec
  (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
  CodecFailure
  m
  (AnyMessage
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))
forall k1 k2 k3 (header :: k1) (point :: k2) (tip :: k3)
       (m :: * -&gt; *).
Monad m =&gt;
Codec
  (ChainSync header point tip)
  CodecFailure
  m
  (AnyMessage (ChainSync header point tip))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecChainSyncId</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cBlockFetchCodec :: Codec
  (BlockFetch blk (Point blk))
  CodecFailure
  m
  (AnyMessage (BlockFetch blk (Point blk)))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodec"><span class="hs-identifier hs-var">cBlockFetchCodec</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec
  (BlockFetch blk (Point blk))
  CodecFailure
  m
  (AnyMessage (BlockFetch blk (Point blk)))
forall k1 k2 (block :: k1) (point :: k2) (m :: * -&gt; *).
Monad m =&gt;
Codec
  (BlockFetch block point)
  CodecFailure
  m
  (AnyMessage (BlockFetch block point))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecBlockFetchId</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cBlockFetchCodecSerialised :: Codec
  (BlockFetch (Serialised blk) (Point blk))
  CodecFailure
  m
  (AnyMessage (BlockFetch (Serialised blk) (Point blk)))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodecSerialised"><span class="hs-identifier hs-var">cBlockFetchCodecSerialised</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec
  (BlockFetch (Serialised blk) (Point blk))
  CodecFailure
  m
  (AnyMessage (BlockFetch (Serialised blk) (Point blk)))
forall k1 k2 (block :: k1) (point :: k2) (m :: * -&gt; *).
Monad m =&gt;
Codec
  (BlockFetch block point)
  CodecFailure
  m
  (AnyMessage (BlockFetch block point))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecBlockFetchId</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cTxSubmissionCodec :: Codec
  (TxSubmission (GenTxId blk) (GenTx blk))
  CodecFailure
  m
  (AnyMessage (TxSubmission (GenTxId blk) (GenTx blk)))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmissionCodec"><span class="hs-identifier hs-var">cTxSubmissionCodec</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec
  (TxSubmission (GenTxId blk) (GenTx blk))
  CodecFailure
  m
  (AnyMessage (TxSubmission (GenTxId blk) (GenTx blk)))
forall k1 k2 (txid :: k1) (tx :: k2) (m :: * -&gt; *).
Monad m =&gt;
Codec
  (TxSubmission txid tx)
  CodecFailure
  m
  (AnyMessage (TxSubmission txid tx))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecTxSubmissionId</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cTxSubmission2Codec :: Codec
  (TxSubmission2 (GenTxId blk) (GenTx blk))
  CodecFailure
  m
  (AnyMessage (TxSubmission2 (GenTxId blk) (GenTx blk)))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmission2Codec"><span class="hs-identifier hs-var">cTxSubmission2Codec</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec
  (TxSubmission2 (GenTxId blk) (GenTx blk))
  CodecFailure
  m
  (AnyMessage (TxSubmission2 (GenTxId blk) (GenTx blk)))
forall txid tx (m :: * -&gt; *).
Monad m =&gt;
Codec
  (TxSubmission2 txid tx)
  CodecFailure
  m
  (AnyMessage (TxSubmission2 txid tx))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecTxSubmission2Id</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cKeepAliveCodec :: Codec KeepAlive CodecFailure m (AnyMessage KeepAlive)
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cKeepAliveCodec"><span class="hs-identifier hs-var">cKeepAliveCodec</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codec KeepAlive CodecFailure m (AnyMessage KeepAlive)
forall (m :: * -&gt; *).
Monad m =&gt;
Codec KeepAlive CodecFailure m (AnyMessage KeepAlive)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">codecKeepAliveId</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Tracers
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | A record of 'Tracer's for the different protocols.</span><span>
</span><span id="line-324"></span><span class="hs-keyword">type</span><span> </span><span id="Tracers"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-var">Tracers</span></a></span></span><span> </span><span id="local-6989586621680045070"><span class="annot"><a href="#local-6989586621680045070"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045069"><span class="annot"><a href="#local-6989586621680045069"><span class="hs-identifier hs-type">peer</span></a></span></span><span> </span><span id="local-6989586621680045068"><span class="annot"><a href="#local-6989586621680045068"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621680045067"><span class="annot"><a href="#local-6989586621680045067"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>     </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers%27"><span class="hs-identifier hs-type">Tracers'</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680045069"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045068"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045067"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621680045070"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-keyword">data</span><span> </span><span id="Tracers%27"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers%27"><span class="hs-identifier hs-var">Tracers'</span></a></span></span><span> </span><span id="local-6989586621680045496"><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span></span><span> </span><span id="local-6989586621680045495"><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621680045494"><span class="annot"><a href="#local-6989586621680045494"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680045497"><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Tracers"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-var">Tracers</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-328"></span><span>      </span><span id="tChainSyncTracer"><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncTracer"><span class="hs-identifier hs-var hs-var">tChainSyncTracer</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TraceLabelPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tChainSyncSerialisedTracer"><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncSerialisedTracer"><span class="hs-identifier hs-var hs-var">tChainSyncSerialisedTracer</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TraceLabelPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Tip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tBlockFetchTracer"><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchTracer"><span class="hs-identifier hs-var hs-var">tBlockFetchTracer</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TraceLabelPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tBlockFetchSerialisedTracer"><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchSerialisedTracer"><span class="hs-identifier hs-var hs-var">tBlockFetchSerialisedTracer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TraceLabelPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tTxSubmissionTracer"><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmissionTracer"><span class="hs-identifier hs-var hs-var">tTxSubmissionTracer</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TraceLabelPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tTxSubmission2Tracer"><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmission2Tracer"><span class="hs-identifier hs-var hs-var">tTxSubmission2Tracer</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680045497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TraceLabelPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045496"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">TxSubmission2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045495"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span id="local-6989586621680045056"><span id="local-6989586621680045057"><span id="local-6989586621680045058"><span id="local-6989586621680045059"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680045051"><span id="local-6989586621680045053"><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680045499"><span class="annot"><a href="#local-6989586621680045499"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680045059"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045499"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers%27"><span class="hs-identifier hs-type">Tracers'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045058"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045057"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045056"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045059"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621680045049"><span class="annot"><span class="annottext">Tracers' peer blk e f
</span><a href="#local-6989586621680045049"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680045048"><span class="annot"><span class="annottext">&lt;&gt; :: Tracers' peer blk e f
-&gt; Tracers' peer blk e f -&gt; Tracers' peer blk e f
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621680045047"><span class="annot"><span class="annottext">Tracers' peer blk e f
</span><a href="#local-6989586621680045047"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracers :: forall peer blk e (f :: * -&gt; *).
f (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracers' peer blk e f
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-338"></span><span>        </span><span class="annot"><span class="annottext">tChainSyncTracer :: f (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncTracer"><span class="hs-identifier hs-var">tChainSyncTracer</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tracers' peer blk e f
 -&gt; f (TraceLabelPeer
         peer
         (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk)))))
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
forall a. Semigroup a =&gt; (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncTracer"><span class="hs-identifier hs-var hs-var">tChainSyncTracer</span></a></span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tChainSyncSerialisedTracer :: f (TraceLabelPeer
     peer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncSerialisedTracer"><span class="hs-identifier hs-var">tChainSyncSerialisedTracer</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tracers' peer blk e f
 -&gt; f (TraceLabelPeer
         peer
         (TraceSendRecv
            (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))))
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
forall a. Semigroup a =&gt; (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncSerialisedTracer"><span class="hs-identifier hs-var hs-var">tChainSyncSerialisedTracer</span></a></span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tBlockFetchTracer :: f (TraceLabelPeer
     peer (TraceSendRecv (BlockFetch blk (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchTracer"><span class="hs-identifier hs-var">tBlockFetchTracer</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tracers' peer blk e f
 -&gt; f (TraceLabelPeer
         peer (TraceSendRecv (BlockFetch blk (Point blk)))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
forall a. Semigroup a =&gt; (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchTracer"><span class="hs-identifier hs-var hs-var">tBlockFetchTracer</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tBlockFetchSerialisedTracer :: f (TraceLabelPeer
     peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchSerialisedTracer"><span class="hs-identifier hs-var">tBlockFetchSerialisedTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tracers' peer blk e f
 -&gt; f (TraceLabelPeer
         peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk)))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
forall a. Semigroup a =&gt; (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchSerialisedTracer"><span class="hs-identifier hs-var hs-var">tBlockFetchSerialisedTracer</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTxSubmissionTracer :: f (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmissionTracer"><span class="hs-identifier hs-var">tTxSubmissionTracer</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tracers' peer blk e f
 -&gt; f (TraceLabelPeer
         peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
forall a. Semigroup a =&gt; (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmissionTracer"><span class="hs-identifier hs-var hs-var">tTxSubmissionTracer</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTxSubmission2Tracer :: f (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmission2Tracer"><span class="hs-identifier hs-var">tTxSubmission2Tracer</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tracers' peer blk e f
 -&gt; f (TraceLabelPeer
         peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
forall a. Semigroup a =&gt; (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmission2Tracer"><span class="hs-identifier hs-var hs-var">tTxSubmission2Tracer</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>      </span><span class="annot"><a href="#local-6989586621680045046"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680045493"><span class="annot"><a href="#local-6989586621680045493"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680045493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers%27"><span class="hs-identifier hs-type">Tracers'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045058"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045057"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045056"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045059"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span id="local-6989586621680045046"><span class="annot"><span class="annottext">f :: (Tracers' peer blk e f -&gt; a) -&gt; a
</span><a href="#local-6989586621680045046"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680045045"><span class="annot"><span class="annottext">Tracers' peer blk e f -&gt; a
</span><a href="#local-6989586621680045045"><span class="hs-identifier hs-var">prj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f -&gt; a
</span><a href="#local-6989586621680045045"><span class="hs-identifier hs-var">prj</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
</span><a href="#local-6989586621680045049"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f -&gt; a
</span><a href="#local-6989586621680045045"><span class="hs-identifier hs-var">prj</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers' peer blk e f
</span><a href="#local-6989586621680045047"><span class="hs-identifier hs-var">r</span></a></span></span></span></span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- | Use a 'nullTracer' for each protocol.</span><span>
</span><span id="line-352"></span><span id="local-6989586621680045041"><span id="local-6989586621680045042"><span id="local-6989586621680045043"><span id="local-6989586621680045044"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#nullTracers"><span class="hs-identifier hs-type">nullTracers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680045044"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045044"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045043"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045042"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045041"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-353"></span><span id="nullTracers"><span class="annot"><span class="annottext">nullTracers :: Tracers m peer blk e
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#nullTracers"><span class="hs-identifier hs-var hs-var">nullTracers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracers :: forall peer blk e (f :: * -&gt; *).
f (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracers' peer blk e f
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-354"></span><span>      </span><span class="annot"><span class="annottext">tChainSyncTracer :: Tracer
  m
  (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncTracer"><span class="hs-identifier hs-var">tChainSyncTracer</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tChainSyncSerialisedTracer :: Tracer
  m
  (TraceLabelPeer
     peer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncSerialisedTracer"><span class="hs-identifier hs-var">tChainSyncSerialisedTracer</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     peer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tBlockFetchTracer :: Tracer
  m
  (TraceLabelPeer peer (TraceSendRecv (BlockFetch blk (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchTracer"><span class="hs-identifier hs-var">tBlockFetchTracer</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer peer (TraceSendRecv (BlockFetch blk (Point blk))))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tBlockFetchSerialisedTracer :: Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchSerialisedTracer"><span class="hs-identifier hs-var">tBlockFetchSerialisedTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTxSubmissionTracer :: Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmissionTracer"><span class="hs-identifier hs-var">tTxSubmissionTracer</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTxSubmission2Tracer :: Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmission2Tracer"><span class="hs-identifier hs-var">tTxSubmission2Tracer</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span id="local-6989586621680045036"><span id="local-6989586621680045037"><span id="local-6989586621680045038"><span id="local-6989586621680045039"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#showTracers"><span class="hs-identifier hs-type">showTracers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-363"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680045038"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-364"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTxId"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">HasHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-368"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.NestedContent.html#HasNestedContent"><span class="hs-identifier hs-type">HasNestedContent</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-369"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621680045037"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045037"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045038"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045039"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045036"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-371"></span><span id="showTracers"><span class="annot"><span class="annottext">showTracers :: Tracer m String -&gt; Tracers m peer blk e
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#showTracers"><span class="hs-identifier hs-var hs-var">showTracers</span></a></span></span><span> </span><span id="local-6989586621680045034"><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracers :: forall peer blk e (f :: * -&gt; *).
f (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracers' peer blk e f
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">tChainSyncTracer :: Tracer
  m
  (TraceLabelPeer
     peer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncTracer"><span class="hs-identifier hs-var">tChainSyncTracer</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer m String
-&gt; Tracer
     m
     (TraceLabelPeer
        peer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><span class="hs-identifier hs-var">showTracing</span></span><span> </span><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tChainSyncSerialisedTracer :: Tracer
  m
  (TraceLabelPeer
     peer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tChainSyncSerialisedTracer"><span class="hs-identifier hs-var">tChainSyncSerialisedTracer</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer m String
-&gt; Tracer
     m
     (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><span class="hs-identifier hs-var">showTracing</span></span><span> </span><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tBlockFetchTracer :: Tracer
  m
  (TraceLabelPeer peer (TraceSendRecv (BlockFetch blk (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchTracer"><span class="hs-identifier hs-var">tBlockFetchTracer</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer m String
-&gt; Tracer
     m
     (TraceLabelPeer peer (TraceSendRecv (BlockFetch blk (Point blk))))
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><span class="hs-identifier hs-var">showTracing</span></span><span> </span><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tBlockFetchSerialisedTracer :: Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tBlockFetchSerialisedTracer"><span class="hs-identifier hs-var">tBlockFetchSerialisedTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer m String
-&gt; Tracer
     m
     (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><span class="hs-identifier hs-var">showTracing</span></span><span> </span><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTxSubmissionTracer :: Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmissionTracer"><span class="hs-identifier hs-var">tTxSubmissionTracer</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer m String
-&gt; Tracer
     m
     (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><span class="hs-identifier hs-var">showTracing</span></span><span> </span><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTxSubmission2Tracer :: Tracer
  m
  (TraceLabelPeer
     peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#tTxSubmission2Tracer"><span class="hs-identifier hs-var">tTxSubmission2Tracer</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer m String
-&gt; Tracer
     m
     (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><span class="hs-identifier hs-var">showTracing</span></span><span> </span><span class="annot"><span class="annottext">Tracer m String
</span><a href="#local-6989586621680045034"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Applications
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | A node-to-node application</span><span>
</span><span id="line-385"></span><span class="hs-keyword">type</span><span> </span><span id="ClientApp"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier hs-var">ClientApp</span></a></span></span><span> </span><span id="local-6989586621680045032"><span class="annot"><a href="#local-6989586621680045032"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045031"><span class="annot"><a href="#local-6989586621680045031"><span class="hs-identifier hs-type">peer</span></a></span></span><span> </span><span id="local-6989586621680045030"><span class="annot"><a href="#local-6989586621680045030"><span class="hs-identifier hs-type">bytes</span></a></span></span><span> </span><span id="local-6989586621680045029"><span class="annot"><a href="#local-6989586621680045029"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-386"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045032"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045031"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045032"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045030"><span class="hs-identifier hs-type">bytes</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045032"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680045029"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045030"><span class="hs-identifier hs-type">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-keyword">type</span><span> </span><span id="ServerApp"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier hs-var">ServerApp</span></a></span></span><span> </span><span id="local-6989586621680045028"><span class="annot"><a href="#local-6989586621680045028"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045027"><span class="annot"><a href="#local-6989586621680045027"><span class="hs-identifier hs-type">peer</span></a></span></span><span> </span><span id="local-6989586621680045026"><span class="annot"><a href="#local-6989586621680045026"><span class="hs-identifier hs-type">bytes</span></a></span></span><span> </span><span id="local-6989586621680045025"><span class="annot"><a href="#local-6989586621680045025"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-393"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045027"><span class="hs-identifier hs-type">peer</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045028"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045026"><span class="hs-identifier hs-type">bytes</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045028"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680045025"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045026"><span class="hs-identifier hs-type">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">-- | Applications for the node-to-node protocols</span><span>
</span><span id="line-399"></span><span class="hs-comment">--</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- See 'Network.Mux.Types.MuxApplication'</span><span>
</span><span id="line-401"></span><span class="hs-keyword">data</span><span> </span><span id="Apps"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-var">Apps</span></a></span></span><span> </span><span id="local-6989586621680045383"><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045382"><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span></span><span> </span><span id="local-6989586621680045381"><span class="annot"><a href="#local-6989586621680045381"><span class="hs-identifier hs-type">bCS</span></a></span></span><span> </span><span id="local-6989586621680045379"><span class="annot"><a href="#local-6989586621680045379"><span class="hs-identifier hs-type">bBF</span></a></span></span><span> </span><span id="local-6989586621680045378"><span class="annot"><a href="#local-6989586621680045378"><span class="hs-identifier hs-type">bTX</span></a></span></span><span> </span><span id="local-6989586621680045377"><span class="annot"><a href="#local-6989586621680045377"><span class="hs-identifier hs-type">bTX2</span></a></span></span><span> </span><span id="local-6989586621680045376"><span class="annot"><a href="#local-6989586621680045376"><span class="hs-identifier hs-type">bKA</span></a></span></span><span> </span><span id="local-6989586621680045380"><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Apps"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-var">Apps</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-comment">-- | Start a chain sync client that communicates with the given upstream</span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-comment">-- node.</span><span>
</span><span id="line-404"></span><span>      </span><span id="aChainSyncClient"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bCS a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aChainSyncClient"><span class="hs-identifier hs-var hs-var">aChainSyncClient</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier hs-type">ClientApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045381"><span class="hs-identifier hs-type">bCS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-comment">-- | Start a chain sync server.</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aChainSyncServer"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bCS a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aChainSyncServer"><span class="hs-identifier hs-var hs-var">aChainSyncServer</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier hs-type">ServerApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045381"><span class="hs-identifier hs-type">bCS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-comment">-- | Start a block fetch client that communicates with the given</span><span>
</span><span id="line-410"></span><span>      </span><span class="hs-comment">-- upstream node.</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aBlockFetchClient"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bBF a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aBlockFetchClient"><span class="hs-identifier hs-var hs-var">aBlockFetchClient</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier hs-type">ClientApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045379"><span class="hs-identifier hs-type">bBF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-comment">-- | Start a block fetch server.</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aBlockFetchServer"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bBF a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aBlockFetchServer"><span class="hs-identifier hs-var hs-var">aBlockFetchServer</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier hs-type">ServerApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045379"><span class="hs-identifier hs-type">bBF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-comment">-- | Start a transaction submission client that communicates with the</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-comment">-- given upstream node.</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aTxSubmissionClient"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bTX a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aTxSubmissionClient"><span class="hs-identifier hs-var hs-var">aTxSubmissionClient</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier hs-type">ClientApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045378"><span class="hs-identifier hs-type">bTX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-comment">-- | Start a transaction submission server.</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aTxSubmissionServer"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bTX a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aTxSubmissionServer"><span class="hs-identifier hs-var hs-var">aTxSubmissionServer</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier hs-type">ServerApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045378"><span class="hs-identifier hs-type">bTX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-comment">-- | Start a transaction submission v2 client that communicates with the</span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-comment">-- given upstream node.</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aTxSubmission2Client"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bTX2 a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aTxSubmission2Client"><span class="hs-identifier hs-var hs-var">aTxSubmission2Client</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier hs-type">ClientApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045377"><span class="hs-identifier hs-type">bTX2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-comment">-- | Start a transaction submission v2 server.</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aTxSubmission2Server"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bTX2 a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aTxSubmission2Server"><span class="hs-identifier hs-var hs-var">aTxSubmission2Server</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier hs-type">ServerApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045377"><span class="hs-identifier hs-type">bTX2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-comment">-- | Start a keep-alive client.</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aKeepAliveClient"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bKA a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aKeepAliveClient"><span class="hs-identifier hs-var hs-var">aKeepAliveClient</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ClientApp"><span class="hs-identifier hs-type">ClientApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045376"><span class="hs-identifier hs-type">bKA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>      </span><span class="hs-comment">-- | Start a keep-alive server.</span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="aKeepAliveServer"><span class="annot"><span class="annottext">Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bKA a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#aKeepAliveServer"><span class="hs-identifier hs-var hs-var">aKeepAliveServer</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#ServerApp"><span class="hs-identifier hs-type">ServerApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045383"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045382"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045376"><span class="hs-identifier hs-type">bKA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045380"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-comment">-- | Construct the 'NetworkApplication' for the node-to-node protocols</span><span>
</span><span id="line-438"></span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkApps"><span class="hs-identifier hs-type">mkApps</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680045013"><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680045012"><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span></span><span> </span><span id="local-6989586621680045011"><span class="annot"><a href="#local-6989586621680045011"><span class="hs-identifier hs-type">localPeer</span></a></span></span><span> </span><span id="local-6989586621680045010"><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621680045009"><span class="annot"><a href="#local-6989586621680045009"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680045008"><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span></span><span> </span><span id="local-6989586621680045007"><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span></span><span> </span><span id="local-6989586621680045006"><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span></span><span> </span><span id="local-6989586621680045005"><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span></span><span> </span><span id="local-6989586621680045004"><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-440"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html#IOLike"><span class="hs-identifier hs-type">IOLike</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-441"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">MonadTimer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-442"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-443"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680045009"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-444"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsProtocol.html#LedgerSupportsProtocol"><span class="hs-identifier hs-type">LedgerSupportsProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-445"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ShowProxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-446"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ShowProxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ShowProxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ShowProxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045011"><span class="hs-identifier hs-type">localPeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-comment">-- ^ Needed for bracketing only</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045009"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Codecs"><span class="hs-identifier hs-type">Codecs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045009"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">ChainSyncTimeout</span></a></span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045010"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">Apps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="mkApps"><span class="annot"><span class="annottext">mkApps :: NodeKernel m remotePeer localPeer blk
-&gt; Tracers m remotePeer blk e
-&gt; (NodeToNodeVersion
    -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA)
-&gt; m ChainSyncTimeout
-&gt; Handlers m remotePeer blk
-&gt; Apps m remotePeer bCS bBF bTX bTX2 bKA ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkApps"><span class="hs-identifier hs-var hs-var">mkApps</span></a></span></span><span> </span><span id="local-6989586621680045001"><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680044995"><span id="local-6989586621680044996"><span id="local-6989586621680044997"><span id="local-6989586621680044998"><span id="local-6989586621680044999"><span id="local-6989586621680045000"><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
Tracer
  m
  (TraceLabelPeer
     remotePeer (TraceSendRecv (BlockFetch blk (Point blk))))
Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
tTxSubmission2Tracer :: Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
tTxSubmissionTracer :: Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
tBlockFetchSerialisedTracer :: Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
tBlockFetchTracer :: Tracer
  m
  (TraceLabelPeer
     remotePeer (TraceSendRecv (BlockFetch blk (Point blk))))
tChainSyncSerialisedTracer :: Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
tChainSyncTracer :: Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
tTxSubmission2Tracer :: forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
tTxSubmissionTracer :: forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
tBlockFetchSerialisedTracer :: forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
tBlockFetchTracer :: forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer (TraceSendRecv (BlockFetch blk (Point blk))))
tChainSyncSerialisedTracer :: forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
tChainSyncTracer :: forall peer blk e (f :: * -&gt; *).
Tracers' peer blk e f
-&gt; f (TraceLabelPeer
        peer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="#local-6989586621680044995"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680044994"><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span></span><span> </span><span id="local-6989586621680044993"><span class="annot"><span class="annottext">m ChainSyncTimeout
</span><a href="#local-6989586621680044993"><span class="hs-identifier hs-var">genChainSyncTimeout</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680044985"><span id="local-6989586621680044986"><span id="local-6989586621680044987"><span id="local-6989586621680044988"><span id="local-6989586621680044989"><span id="local-6989586621680044990"><span id="local-6989586621680044991"><span id="local-6989586621680044992"><span class="annot"><span class="annottext">remotePeer
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
NodeToNodeVersion
-&gt; remotePeer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
NodeToNodeVersion -&gt; remotePeer -&gt; KeepAliveServer m ()
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; StrictTVar m (Map remotePeer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
NodeToNodeVersion
-&gt; ControlMessageSTM m -&gt; BlockFetchClient (Header blk) blk m ()
NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
NodeToNodeVersion
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
hKeepAliveServer :: NodeToNodeVersion -&gt; remotePeer -&gt; KeepAliveServer m ()
hKeepAliveClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; StrictTVar m (Map remotePeer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
hTxSubmissionServer :: NodeToNodeVersion
-&gt; remotePeer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
hTxSubmissionClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
hBlockFetchServer :: NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
hBlockFetchClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m -&gt; BlockFetchClient (Header blk) blk m ()
hChainSyncServer :: NodeToNodeVersion
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
hChainSyncClient :: remotePeer
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
hKeepAliveServer :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion -&gt; peer -&gt; KeepAliveServer m ()
hKeepAliveClient :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; peer
-&gt; StrictTVar m (Map peer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
hTxSubmissionServer :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; peer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
hTxSubmissionClient :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; peer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
hBlockFetchServer :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
hBlockFetchClient :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; BlockFetchClient (Header blk) blk m ()
hChainSyncServer :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; NodeToNodeVersion
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
hChainSyncClient :: forall (m :: * -&gt; *) peer blk.
Handlers m peer blk
-&gt; peer
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
</span><a href="#local-6989586621680044985"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>    </span><span class="annot"><span class="annottext">Apps :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
ClientApp m peer bCS a
-&gt; ServerApp m peer bCS a
-&gt; ClientApp m peer bBF a
-&gt; ServerApp m peer bBF a
-&gt; ClientApp m peer bTX a
-&gt; ServerApp m peer bTX a
-&gt; ClientApp m peer bTX2 a
-&gt; ServerApp m peer bTX2 a
-&gt; ClientApp m peer bKA a
-&gt; ServerApp m peer bKA a
-&gt; Apps m peer bCS bBF bTX bTX2 bKA a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">Apps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bCS -&gt; m ((), Maybe bCS)
NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bBF -&gt; m ((), Maybe bBF)
NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX -&gt; m ((), Maybe bTX)
NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX2 -&gt; m ((), Maybe bTX2)
NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bKA -&gt; m ((), Maybe bKA)
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bCS
-&gt; m ((), Maybe bCS)
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bBF
-&gt; m ((), Maybe bBF)
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX
-&gt; m ((), Maybe bTX)
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX2
-&gt; m ((), Maybe bTX2)
NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bKA
-&gt; m ((), Maybe bKA)
aKeepAliveServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bKA -&gt; m ((), Maybe bKA)
aKeepAliveClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bKA
-&gt; m ((), Maybe bKA)
aTxSubmission2Server :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX2 -&gt; m ((), Maybe bTX2)
aTxSubmission2Client :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX2
-&gt; m ((), Maybe bTX2)
aTxSubmissionServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX -&gt; m ((), Maybe bTX)
aTxSubmissionClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX
-&gt; m ((), Maybe bTX)
aBlockFetchServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bBF -&gt; m ((), Maybe bBF)
aBlockFetchClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bBF
-&gt; m ((), Maybe bBF)
aChainSyncServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bCS -&gt; m ((), Maybe bCS)
aChainSyncClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bCS
-&gt; m ((), Maybe bCS)
aKeepAliveServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bKA -&gt; m ((), Maybe bKA)
aKeepAliveClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bKA
-&gt; m ((), Maybe bKA)
aTxSubmission2Server :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX2 -&gt; m ((), Maybe bTX2)
aTxSubmission2Client :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX2
-&gt; m ((), Maybe bTX2)
aTxSubmissionServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX -&gt; m ((), Maybe bTX)
aTxSubmissionClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX
-&gt; m ((), Maybe bTX)
aBlockFetchServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bBF -&gt; m ((), Maybe bBF)
aBlockFetchClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bBF
-&gt; m ((), Maybe bBF)
aChainSyncServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bCS -&gt; m ((), Maybe bCS)
aChainSyncClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bCS
-&gt; m ((), Maybe bCS)
</span><a href="#local-6989586621680044975"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-459"></span><span>    </span><span class="annot"><a href="#local-6989586621680044984"><span class="hs-identifier hs-type">aChainSyncClient</span></a></span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621680044984"><span class="annot"><span class="annottext">aChainSyncClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bCS
-&gt; m ((), Maybe bCS)
</span><a href="#local-6989586621680044984"><span class="hs-identifier hs-var hs-var">aChainSyncClient</span></a></span></span><span> </span><span id="local-6989586621680044974"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044974"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044973"><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044973"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span></span><span> </span><span id="local-6989586621680044972"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044972"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044971"><span class="annot"><span class="annottext">Channel m bCS
</span><a href="#local-6989586621680044971"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ChainSyncClient&quot;</span></span><span>
</span><span id="line-467"></span><span>      </span><span class="hs-comment">-- Note that it is crucial that we sync with the fetch client &quot;outside&quot;</span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-comment">-- of registering the state for the sync client. This is needed to</span><span>
</span><span id="line-469"></span><span>      </span><span class="hs-comment">-- maintain a state invariant required by the block fetch logic: that for</span><span>
</span><span id="line-470"></span><span>      </span><span class="hs-comment">-- each candidate chain there is a corresponding block fetch client that</span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-comment">-- can be used to fetch blocks for that chain.</span><span>
</span><span id="line-472"></span><span>      </span><span class="annot"><span class="annottext">FetchClientRegistry remotePeer (Header blk) blk m
-&gt; remotePeer -&gt; m ((), Maybe bCS) -&gt; m ((), Maybe bCS)
forall (m :: * -&gt; *) a peer header block.
(MonadThrow m, MonadSTM m, MonadFork m, Ord peer) =&gt;
FetchClientRegistry peer header block m -&gt; peer -&gt; m a -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">bracketSyncWithFetchClient</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
-&gt; FetchClientRegistry remotePeer (Header blk) blk m
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk
-&gt; FetchClientRegistry remotePeer (Header blk) blk m
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetFetchClientRegistry%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getFetchClientRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044972"><span class="hs-identifier hs-var">them</span></a></span><span> </span><span class="annot"><span class="annottext">(m ((), Maybe bCS) -&gt; m ((), Maybe bCS))
-&gt; m ((), Maybe bCS) -&gt; m ((), Maybe bCS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">Tracer m (TraceChainSyncClientEvent blk)
-&gt; ChainDbView m blk
-&gt; StrictTVar
     m (Map remotePeer (StrictTVar m (AnchoredFragment (Header blk))))
-&gt; remotePeer
-&gt; (StrictTVar m (AnchoredFragment (Header blk))
    -&gt; m ((), Maybe bCS))
-&gt; m ((), Maybe bCS)
forall (m :: * -&gt; *) peer blk a.
(IOLike m, Ord peer, BlockSupportsProtocol blk,
 LedgerSupportsProtocol blk) =&gt;
Tracer m (TraceChainSyncClientEvent blk)
-&gt; ChainDbView m blk
-&gt; StrictTVar
     m (Map peer (StrictTVar m (AnchoredFragment (Header blk))))
-&gt; peer
-&gt; (StrictTVar m (AnchoredFragment (Header blk)) -&gt; m a)
-&gt; m a
</span><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Client.html#bracketChainSyncClient"><span class="hs-identifier hs-var">bracketChainSyncClient</span></a></span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceChainSyncClientEvent blk
 -&gt; TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
-&gt; Tracer
     m (TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
-&gt; Tracer m (TraceChainSyncClientEvent blk)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceChainSyncClientEvent blk
-&gt; TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk)
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044972"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers' remotePeer localPeer blk (Tracer m)
-&gt; Tracer
     m (TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceLabelPeer remotePeer (TraceChainSyncClientEvent blk))
</span><a href="Ouroboros.Consensus.Node.Tracers.html#chainSyncClientTracer"><span class="hs-identifier hs-var hs-var">Node.chainSyncClientTracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
-&gt; Tracers' remotePeer localPeer blk (Tracer m)
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk
-&gt; Tracers m remotePeer localPeer blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetTracers%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getTracers</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainDB m blk -&gt; ChainDbView m blk
forall (m :: * -&gt; *) blk.
(IOLike m, LedgerSupportsProtocol blk) =&gt;
ChainDB m blk -&gt; ChainDbView m blk
</span><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Client.html#defaultChainDbView"><span class="hs-identifier hs-var">defaultChainDbView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk -&gt; ChainDB m blk
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk -&gt; ChainDB m blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetChainDB%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getChainDB</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
-&gt; StrictTVar
     m (Map remotePeer (StrictTVar m (AnchoredFragment (Header blk))))
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk
-&gt; StrictTVar
     m (Map remotePeer (StrictTVar m (AnchoredFragment (Header blk))))
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetNodeCandidates%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getNodeCandidates</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>            </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044972"><span class="hs-identifier hs-var">them</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictTVar m (AnchoredFragment (Header blk))
  -&gt; m ((), Maybe bCS))
 -&gt; m ((), Maybe bCS))
-&gt; (StrictTVar m (AnchoredFragment (Header blk))
    -&gt; m ((), Maybe bCS))
-&gt; m ((), Maybe bCS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680044965"><span class="annot"><span class="annottext">StrictTVar m (AnchoredFragment (Header blk))
</span><a href="#local-6989586621680044965"><span class="hs-identifier hs-var">varCandidate</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>              </span><span id="local-6989586621680044964"><span class="annot"><span class="annottext">ChainSyncTimeout
</span><a href="#local-6989586621680044964"><span class="hs-identifier hs-var">chainSyncTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ChainSyncTimeout
</span><a href="#local-6989586621680044993"><span class="hs-identifier hs-var">genChainSyncTimeout</span></a></span><span>
</span><span id="line-480"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainSyncClientResult
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680044963"><span class="annot"><span class="annottext">Maybe bCS
</span><a href="#local-6989586621680044963"><span class="hs-identifier hs-var">trailing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-481"></span><span>                </span><span class="annot"><span class="annottext">Tracer
  m (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk)))
-&gt; Codec (ChainSync (Header blk) (Point blk) (Tip blk)) e m bCS
-&gt; ProtocolSizeLimits
     (ChainSync (Header blk) (Point blk) (Tip blk)) bCS
-&gt; ProtocolTimeLimits
     (ChainSync (Header blk) (Point blk) (Tip blk))
-&gt; Channel m bCS
-&gt; PeerPipelined
     (ChainSync (Header blk) (Point blk) (Tip blk))
     'AsClient
     'StIdle
     m
     ChainSyncClientResult
-&gt; m (ChainSyncClientResult, Maybe bCS)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; PeerPipelined ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPipelinedPeerWithLimits</span></a></span><span>
</span><span id="line-482"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
-&gt; Tracer
     m (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))
-&gt; TraceLabelPeer
     remotePeer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044972"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (ChainSync (Header blk) (Point blk) (Tip blk))))
</span><a href="#local-6989586621680045000"><span class="hs-identifier hs-var">tChainSyncTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (ChainSync (Header blk) (Point blk) (Tip blk)) e m bCS
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (ChainSync (Header blk) (Point blk) (Tip blk)) e m bCS
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodec"><span class="hs-identifier hs-var hs-var">cChainSyncCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044974"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bCS -&gt; Word)
-&gt; ProtocolSizeLimits
     (ChainSync (Header blk) (Point blk) (Tip blk)) bCS
forall k1 k2 k3 bytes (header :: k1) (point :: k2) (tip :: k3).
(bytes -&gt; Word)
-&gt; ProtocolSizeLimits (ChainSync header point tip) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bCS -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-485"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainSyncTimeout
-&gt; ProtocolTimeLimits
     (ChainSync (Header blk) (Point blk) (Tip blk))
forall k1 k2 k3 (header :: k1) (point :: k2) (tip :: k3).
ChainSyncTimeout -&gt; ProtocolTimeLimits (ChainSync header point tip)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsChainSync</span></a></span><span> </span><span class="annot"><span class="annottext">ChainSyncTimeout
</span><a href="#local-6989586621680044964"><span class="hs-identifier hs-var">chainSyncTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>                  </span><span class="annot"><span class="annottext">Channel m bCS
</span><a href="#local-6989586621680044971"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-487"></span><span>                  </span><span class="annot"><span class="annottext">(PeerPipelined
   (ChainSync (Header blk) (Point blk) (Tip blk))
   'AsClient
   'StIdle
   m
   ChainSyncClientResult
 -&gt; m (ChainSyncClientResult, Maybe bCS))
-&gt; PeerPipelined
     (ChainSync (Header blk) (Point blk) (Tip blk))
     'AsClient
     'StIdle
     m
     ChainSyncClientResult
-&gt; m (ChainSyncClientResult, Maybe bCS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainSyncClientPipelined
  (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
-&gt; PeerPipelined
     (ChainSync (Header blk) (Point blk) (Tip blk))
     'AsClient
     'StIdle
     m
     ChainSyncClientResult
forall header point tip (m :: * -&gt; *) a.
Monad m =&gt;
ChainSyncClientPipelined header point tip m a
-&gt; PeerPipelined (ChainSync header point tip) 'AsClient 'StIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">chainSyncClientPeerPipelined</span></a></span><span>
</span><span id="line-488"></span><span>                  </span><span class="annot"><span class="annottext">(ChainSyncClientPipelined
   (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
 -&gt; PeerPipelined
      (ChainSync (Header blk) (Point blk) (Tip blk))
      'AsClient
      'StIdle
      m
      ChainSyncClientResult)
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
-&gt; PeerPipelined
     (ChainSync (Header blk) (Point blk) (Tip blk))
     'AsClient
     'StIdle
     m
     ChainSyncClientResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">remotePeer
-&gt; NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; StrictTVar m (AnchoredFragment (Header blk))
-&gt; ChainSyncClientPipelined
     (Header blk) (Point blk) (Tip blk) m ChainSyncClientResult
</span><a href="#local-6989586621680044992"><span class="hs-identifier hs-var">hChainSyncClient</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044972"><span class="hs-identifier hs-var">them</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044974"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044973"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">StrictTVar m (AnchoredFragment (Header blk))
</span><a href="#local-6989586621680044965"><span class="hs-identifier hs-var">varCandidate</span></a></span><span>
</span><span id="line-489"></span><span>              </span><span class="annot"><span class="annottext">((), Maybe bCS) -&gt; m ((), Maybe bCS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe bCS
</span><a href="#local-6989586621680044963"><span class="hs-identifier hs-var">trailing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><a href="#local-6989586621680044983"><span class="hs-identifier hs-type">aChainSyncServer</span></a></span><span>
</span><span id="line-492"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-494"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span>
</span><span id="line-495"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045008"><span class="hs-identifier hs-type">bCS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>    </span><span id="local-6989586621680044983"><span class="annot"><span class="annottext">aChainSyncServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bCS -&gt; m ((), Maybe bCS)
</span><a href="#local-6989586621680044983"><span class="hs-identifier hs-var hs-var">aChainSyncServer</span></a></span></span><span> </span><span id="local-6989586621680044957"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044957"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044956"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044956"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044955"><span class="annot"><span class="annottext">Channel m bCS
</span><a href="#local-6989586621680044955"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-497"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ChainSyncServer&quot;</span></span><span>
</span><span id="line-498"></span><span>      </span><span id="local-6989586621680044954"><span class="annot"><span class="annottext">ChainSyncTimeout
</span><a href="#local-6989586621680044954"><span class="hs-identifier hs-var">chainSyncTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ChainSyncTimeout
</span><a href="#local-6989586621680044993"><span class="hs-identifier hs-var">genChainSyncTimeout</span></a></span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">(ResourceRegistry m
 -&gt; m (Follower m blk (WithPoint blk (SerialisedHeader blk))))
-&gt; (Follower m blk (WithPoint blk (SerialisedHeader blk)) -&gt; m ())
-&gt; (Follower m blk (WithPoint blk (SerialisedHeader blk))
    -&gt; m ((), Maybe bCS))
-&gt; m ((), Maybe bCS)
forall (m :: * -&gt; *) a r.
(IOLike m, HasCallStack) =&gt;
(ResourceRegistry m -&gt; m a) -&gt; (a -&gt; m ()) -&gt; (a -&gt; m r) -&gt; m r
</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#bracketWithPrivateRegistry"><span class="hs-identifier hs-var">bracketWithPrivateRegistry</span></a></span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainDB m blk
-&gt; ResourceRegistry m
-&gt; m (Follower m blk (WithPoint blk (SerialisedHeader blk)))
forall (m :: * -&gt; *) blk.
ChainDB m blk
-&gt; ResourceRegistry m
-&gt; m (Follower m blk (WithPoint blk (SerialisedHeader blk)))
</span><a href="Ouroboros.Consensus.MiniProtocol.ChainSync.Server.html#chainSyncHeaderServerFollower"><span class="hs-identifier hs-var">chainSyncHeaderServerFollower</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk -&gt; ChainDB m blk
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk -&gt; ChainDB m blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetChainDB%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getChainDB</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">Follower m blk (WithPoint blk (SerialisedHeader blk)) -&gt; m ()
forall (m :: * -&gt; *) blk a. Follower m blk a -&gt; m ()
</span><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#followerClose"><span class="hs-identifier hs-var hs-var">ChainDB.followerClose</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><span class="annottext">((Follower m blk (WithPoint blk (SerialisedHeader blk))
  -&gt; m ((), Maybe bCS))
 -&gt; m ((), Maybe bCS))
-&gt; (Follower m blk (WithPoint blk (SerialisedHeader blk))
    -&gt; m ((), Maybe bCS))
-&gt; m ((), Maybe bCS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680044950"><span class="annot"><span class="annottext">Follower m blk (WithPoint blk (SerialisedHeader blk))
</span><a href="#local-6989586621680044950"><span class="hs-identifier hs-var">flr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>          </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceSendRecv
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) e m bCS
-&gt; ProtocolSizeLimits
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) bCS
-&gt; ProtocolTimeLimits
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
-&gt; Channel m bCS
-&gt; Peer
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
     'AsServer
     'StIdle
     m
     ()
-&gt; m ((), Maybe bCS)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; Peer ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPeerWithLimits</span></a></span><span>
</span><span id="line-504"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv
   (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv
         (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv
           (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
-&gt; Tracer
     m
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
-&gt; TraceLabelPeer
     remotePeer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044956"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv
        (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))))
</span><a href="#local-6989586621680044999"><span class="hs-identifier hs-var">tChainSyncSerialisedTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) e m bCS
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) e m bSCS
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cChainSyncCodecSerialised"><span class="hs-identifier hs-var hs-var">cChainSyncCodecSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044957"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bCS -&gt; Word)
-&gt; ProtocolSizeLimits
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk)) bCS
forall k1 k2 k3 bytes (header :: k1) (point :: k2) (tip :: k3).
(bytes -&gt; Word)
-&gt; ProtocolSizeLimits (ChainSync header point tip) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsChainSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bCS -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-507"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainSyncTimeout
-&gt; ProtocolTimeLimits
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
forall k1 k2 k3 (header :: k1) (point :: k2) (tip :: k3).
ChainSyncTimeout -&gt; ProtocolTimeLimits (ChainSync header point tip)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsChainSync</span></a></span><span> </span><span class="annot"><span class="annottext">ChainSyncTimeout
</span><a href="#local-6989586621680044954"><span class="hs-identifier hs-var">chainSyncTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>            </span><span class="annot"><span class="annottext">Channel m bCS
</span><a href="#local-6989586621680044955"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-509"></span><span>            </span><span class="annot"><span class="annottext">(Peer
   (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
   'AsServer
   'StIdle
   m
   ()
 -&gt; m ((), Maybe bCS))
-&gt; Peer
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
     'AsServer
     'StIdle
     m
     ()
-&gt; m ((), Maybe bCS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainSyncServer (SerialisedHeader blk) (Point blk) (Tip blk) m ()
-&gt; Peer
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
     'AsServer
     'StIdle
     m
     ()
forall header point tip (m :: * -&gt; *) a.
Monad m =&gt;
ChainSyncServer header point tip m a
-&gt; Peer (ChainSync header point tip) 'AsServer 'StIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">chainSyncServerPeer</span></a></span><span>
</span><span id="line-510"></span><span>            </span><span class="annot"><span class="annottext">(ChainSyncServer (SerialisedHeader blk) (Point blk) (Tip blk) m ()
 -&gt; Peer
      (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
      'AsServer
      'StIdle
      m
      ())
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
-&gt; Peer
     (ChainSync (SerialisedHeader blk) (Point blk) (Tip blk))
     'AsServer
     'StIdle
     m
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; Follower m blk (WithPoint blk (SerialisedHeader blk))
-&gt; ChainSyncServer
     (SerialisedHeader blk) (Point blk) (Tip blk) m ()
</span><a href="#local-6989586621680044991"><span class="hs-identifier hs-var">hChainSyncServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044957"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Follower m blk (WithPoint blk (SerialisedHeader blk))
</span><a href="#local-6989586621680044950"><span class="hs-identifier hs-var">flr</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="#local-6989586621680044982"><span class="hs-identifier hs-type">aBlockFetchClient</span></a></span><span>
</span><span id="line-513"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>    </span><span id="local-6989586621680044982"><span class="annot"><span class="annottext">aBlockFetchClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bBF
-&gt; m ((), Maybe bBF)
</span><a href="#local-6989586621680044982"><span class="hs-identifier hs-var hs-var">aBlockFetchClient</span></a></span></span><span> </span><span id="local-6989586621680044947"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044947"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044946"><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044946"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span></span><span> </span><span id="local-6989586621680044945"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044945"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044944"><span class="annot"><span class="annottext">Channel m bBF
</span><a href="#local-6989586621680044944"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BlockFetchClient&quot;</span></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><span class="annottext">FetchClientRegistry remotePeer (Header blk) blk m
-&gt; remotePeer
-&gt; (FetchClientContext (Header blk) blk m -&gt; m ((), Maybe bBF))
-&gt; m ((), Maybe bBF)
forall (m :: * -&gt; *) a peer header block.
(MonadThrow m, MonadSTM m, MonadFork m, Ord peer) =&gt;
FetchClientRegistry peer header block m
-&gt; peer -&gt; (FetchClientContext header block m -&gt; m a) -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">bracketFetchClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
-&gt; FetchClientRegistry remotePeer (Header blk) blk m
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk
-&gt; FetchClientRegistry remotePeer (Header blk) blk m
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetFetchClientRegistry%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getFetchClientRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044945"><span class="hs-identifier hs-var">them</span></a></span><span> </span><span class="annot"><span class="annottext">((FetchClientContext (Header blk) blk m -&gt; m ((), Maybe bBF))
 -&gt; m ((), Maybe bBF))
-&gt; (FetchClientContext (Header blk) blk m -&gt; m ((), Maybe bBF))
-&gt; m ((), Maybe bBF)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680044942"><span class="annot"><span class="annottext">FetchClientContext (Header blk) blk m
</span><a href="#local-6989586621680044942"><span class="hs-identifier hs-var">clientCtx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-521"></span><span>        </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv (BlockFetch blk (Point blk)))
-&gt; Codec (BlockFetch blk (Point blk)) e m bBF
-&gt; ProtocolSizeLimits (BlockFetch blk (Point blk)) bBF
-&gt; ProtocolTimeLimits (BlockFetch blk (Point blk))
-&gt; Channel m bBF
-&gt; PeerPipelined
     (BlockFetch blk (Point blk)) 'AsClient 'BFIdle m ()
-&gt; m ((), Maybe bBF)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; PeerPipelined ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPipelinedPeerWithLimits</span></a></span><span>
</span><span id="line-522"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (BlockFetch blk (Point blk))
 -&gt; TraceLabelPeer
      remotePeer (TraceSendRecv (BlockFetch blk (Point blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer (TraceSendRecv (BlockFetch blk (Point blk))))
-&gt; Tracer m (TraceSendRecv (BlockFetch blk (Point blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (BlockFetch blk (Point blk))
-&gt; TraceLabelPeer
     remotePeer (TraceSendRecv (BlockFetch blk (Point blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044945"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer (TraceSendRecv (BlockFetch blk (Point blk))))
</span><a href="#local-6989586621680044998"><span class="hs-identifier hs-var">tBlockFetchTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (BlockFetch blk (Point blk)) e m bBF
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (BlockFetch blk (Point blk)) e m bBF
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodec"><span class="hs-identifier hs-var hs-var">cBlockFetchCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044947"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bBF -&gt; Word)
-&gt; ProtocolSizeLimits (BlockFetch blk (Point blk)) bBF
forall k1 k2 bytes (block :: k1) (point :: k2).
(bytes -&gt; Word)
-&gt; ProtocolSizeLimits (BlockFetch block point) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsBlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bBF -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-525"></span><span>          </span><span class="annot"><span class="annottext">ProtocolTimeLimits (BlockFetch blk (Point blk))
forall k1 k2 (block :: k1) (point :: k2).
ProtocolTimeLimits (BlockFetch block point)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsBlockFetch</span></a></span><span>
</span><span id="line-526"></span><span>          </span><span class="annot"><span class="annottext">Channel m bBF
</span><a href="#local-6989586621680044944"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><span class="annottext">(PeerPipelined (BlockFetch blk (Point blk)) 'AsClient 'BFIdle m ()
 -&gt; m ((), Maybe bBF))
-&gt; PeerPipelined
     (BlockFetch blk (Point blk)) 'AsClient 'BFIdle m ()
-&gt; m ((), Maybe bBF)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; ControlMessageSTM m -&gt; BlockFetchClient (Header blk) blk m ()
</span><a href="#local-6989586621680044990"><span class="hs-identifier hs-var">hBlockFetchClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044947"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044946"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">FetchClientContext (Header blk) blk m
</span><a href="#local-6989586621680044942"><span class="hs-identifier hs-var">clientCtx</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><a href="#local-6989586621680044981"><span class="hs-identifier hs-type">aBlockFetchServer</span></a></span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-531"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-532"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045007"><span class="hs-identifier hs-type">bBF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>    </span><span id="local-6989586621680044981"><span class="annot"><span class="annottext">aBlockFetchServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bBF -&gt; m ((), Maybe bBF)
</span><a href="#local-6989586621680044981"><span class="hs-identifier hs-var hs-var">aBlockFetchServer</span></a></span></span><span> </span><span id="local-6989586621680044939"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044939"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044938"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044938"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044937"><span class="annot"><span class="annottext">Channel m bBF
</span><a href="#local-6989586621680044937"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BlockFetchServer&quot;</span></span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="annottext">(ResourceRegistry m -&gt; m ((), Maybe bBF)) -&gt; m ((), Maybe bBF)
forall (m :: * -&gt; *) a.
(IOLike m, HasCallStack) =&gt;
(ResourceRegistry m -&gt; m a) -&gt; m a
</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#withRegistry"><span class="hs-identifier hs-var">withRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">((ResourceRegistry m -&gt; m ((), Maybe bBF)) -&gt; m ((), Maybe bBF))
-&gt; (ResourceRegistry m -&gt; m ((), Maybe bBF)) -&gt; m ((), Maybe bBF)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680044935"><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621680044935"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv (BlockFetch (Serialised blk) (Point blk)))
-&gt; Codec (BlockFetch (Serialised blk) (Point blk)) e m bBF
-&gt; ProtocolSizeLimits (BlockFetch (Serialised blk) (Point blk)) bBF
-&gt; ProtocolTimeLimits (BlockFetch (Serialised blk) (Point blk))
-&gt; Channel m bBF
-&gt; Peer
     (BlockFetch (Serialised blk) (Point blk)) 'AsServer 'BFIdle m ()
-&gt; m ((), Maybe bBF)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; Peer ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPeerWithLimits</span></a></span><span>
</span><span id="line-538"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (BlockFetch (Serialised blk) (Point blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
-&gt; Tracer
     m (TraceSendRecv (BlockFetch (Serialised blk) (Point blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (BlockFetch (Serialised blk) (Point blk))
-&gt; TraceLabelPeer
     remotePeer
     (TraceSendRecv (BlockFetch (Serialised blk) (Point blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044938"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (BlockFetch (Serialised blk) (Point blk))))
</span><a href="#local-6989586621680044997"><span class="hs-identifier hs-var">tBlockFetchSerialisedTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (BlockFetch (Serialised blk) (Point blk)) e m bBF
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (BlockFetch (Serialised blk) (Point blk)) e m bSBF
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cBlockFetchCodecSerialised"><span class="hs-identifier hs-var hs-var">cBlockFetchCodecSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044939"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bBF -&gt; Word)
-&gt; ProtocolSizeLimits (BlockFetch (Serialised blk) (Point blk)) bBF
forall k1 k2 bytes (block :: k1) (point :: k2).
(bytes -&gt; Word)
-&gt; ProtocolSizeLimits (BlockFetch block point) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsBlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bBF -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-541"></span><span>          </span><span class="annot"><span class="annottext">ProtocolTimeLimits (BlockFetch (Serialised blk) (Point blk))
forall k1 k2 (block :: k1) (point :: k2).
ProtocolTimeLimits (BlockFetch block point)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsBlockFetch</span></a></span><span>
</span><span id="line-542"></span><span>          </span><span class="annot"><span class="annottext">Channel m bBF
</span><a href="#local-6989586621680044937"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-543"></span><span>          </span><span class="annot"><span class="annottext">(Peer
   (BlockFetch (Serialised blk) (Point blk)) 'AsServer 'BFIdle m ()
 -&gt; m ((), Maybe bBF))
-&gt; Peer
     (BlockFetch (Serialised blk) (Point blk)) 'AsServer 'BFIdle m ()
-&gt; m ((), Maybe bBF)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockFetchServer (Serialised blk) (Point blk) m ()
-&gt; Peer
     (BlockFetch (Serialised blk) (Point blk)) 'AsServer 'BFIdle m ()
forall block point (m :: * -&gt; *) a.
Functor m =&gt;
BlockFetchServer block point m a
-&gt; Peer (BlockFetch block point) 'AsServer 'BFIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">blockFetchServerPeer</span></a></span><span>
</span><span id="line-544"></span><span>          </span><span class="annot"><span class="annottext">(BlockFetchServer (Serialised blk) (Point blk) m ()
 -&gt; Peer
      (BlockFetch (Serialised blk) (Point blk)) 'AsServer 'BFIdle m ())
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
-&gt; Peer
     (BlockFetch (Serialised blk) (Point blk)) 'AsServer 'BFIdle m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; ResourceRegistry m
-&gt; BlockFetchServer (Serialised blk) (Point blk) m ()
</span><a href="#local-6989586621680044989"><span class="hs-identifier hs-var">hBlockFetchServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044939"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621680044935"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><a href="#local-6989586621680044980"><span class="hs-identifier hs-type">aTxSubmissionClient</span></a></span><span>
</span><span id="line-547"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-549"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621680044980"><span class="annot"><span class="annottext">aTxSubmissionClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX
-&gt; m ((), Maybe bTX)
</span><a href="#local-6989586621680044980"><span class="hs-identifier hs-var hs-var">aTxSubmissionClient</span></a></span></span><span> </span><span id="local-6989586621680044934"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044934"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044933"><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044933"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span></span><span> </span><span id="local-6989586621680044932"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044932"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044931"><span class="annot"><span class="annottext">Channel m bTX
</span><a href="#local-6989586621680044931"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TxSubmissionClient&quot;</span></span><span>
</span><span id="line-554"></span><span>      </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
-&gt; ProtocolSizeLimits (TxSubmission (GenTxId blk) (GenTx blk)) bTX
-&gt; ProtocolTimeLimits (TxSubmission (GenTxId blk) (GenTx blk))
-&gt; Channel m bTX
-&gt; Peer
     (TxSubmission (GenTxId blk) (GenTx blk)) 'AsClient 'StIdle m ()
-&gt; m ((), Maybe bTX)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; Peer ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPeerWithLimits</span></a></span><span>
</span><span id="line-555"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))
-&gt; TraceLabelPeer
     remotePeer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044932"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="#local-6989586621680044996"><span class="hs-identifier hs-var">tTxSubmissionTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmissionCodec"><span class="hs-identifier hs-var hs-var">cTxSubmissionCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044934"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bTX -&gt; Word)
-&gt; ProtocolSizeLimits (TxSubmission (GenTxId blk) (GenTx blk)) bTX
forall k1 k2 bytes (txid :: k1) (tx :: k2).
(bytes -&gt; Word) -&gt; ProtocolSizeLimits (TxSubmission txid tx) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsTxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bTX -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-558"></span><span>        </span><span class="annot"><span class="annottext">ProtocolTimeLimits (TxSubmission (GenTxId blk) (GenTx blk))
forall k1 k2 (txid :: k1) (tx :: k2).
ProtocolTimeLimits (TxSubmission txid tx)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsTxSubmission</span></a></span><span>
</span><span id="line-559"></span><span>        </span><span class="annot"><span class="annottext">Channel m bTX
</span><a href="#local-6989586621680044931"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-560"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
-&gt; Peer
     (TxSubmission (GenTxId blk) (GenTx blk)) 'AsClient 'StIdle m ()
forall txid tx (m :: * -&gt; *) a.
Monad m =&gt;
TxSubmissionClient txid tx m a
-&gt; Peer (TxSubmission txid tx) 'AsClient 'StIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionClientPeer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
</span><a href="#local-6989586621680044988"><span class="hs-identifier hs-var">hTxSubmissionClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044934"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044933"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044932"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>    </span><span class="annot"><a href="#local-6989586621680044979"><span class="hs-identifier hs-type">aTxSubmissionServer</span></a></span><span>
</span><span id="line-563"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-564"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045006"><span class="hs-identifier hs-type">bTX</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>    </span><span id="local-6989586621680044979"><span class="annot"><span class="annottext">aTxSubmissionServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX -&gt; m ((), Maybe bTX)
</span><a href="#local-6989586621680044979"><span class="hs-identifier hs-var hs-var">aTxSubmissionServer</span></a></span></span><span> </span><span id="local-6989586621680044927"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044927"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044926"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044926"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044925"><span class="annot"><span class="annottext">Channel m bTX
</span><a href="#local-6989586621680044925"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TxSubmissionServer&quot;</span></span><span>
</span><span id="line-569"></span><span>      </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
-&gt; ProtocolSizeLimits (TxSubmission (GenTxId blk) (GenTx blk)) bTX
-&gt; ProtocolTimeLimits (TxSubmission (GenTxId blk) (GenTx blk))
-&gt; Channel m bTX
-&gt; PeerPipelined
     (TxSubmission (GenTxId blk) (GenTx blk)) 'AsServer 'StIdle m ()
-&gt; m ((), Maybe bTX)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; PeerPipelined ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPipelinedPeerWithLimits</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))
-&gt; TraceLabelPeer
     remotePeer (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044926"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission (GenTxId blk) (GenTx blk))))
</span><a href="#local-6989586621680044996"><span class="hs-identifier hs-var">tTxSubmissionTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (TxSubmission (GenTxId blk) (GenTx blk)) e m bTX
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmissionCodec"><span class="hs-identifier hs-var hs-var">cTxSubmissionCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044927"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bTX -&gt; Word)
-&gt; ProtocolSizeLimits (TxSubmission (GenTxId blk) (GenTx blk)) bTX
forall k1 k2 bytes (txid :: k1) (tx :: k2).
(bytes -&gt; Word) -&gt; ProtocolSizeLimits (TxSubmission txid tx) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsTxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bTX -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-573"></span><span>        </span><span class="annot"><span class="annottext">ProtocolTimeLimits (TxSubmission (GenTxId blk) (GenTx blk))
forall k1 k2 (txid :: k1) (tx :: k2).
ProtocolTimeLimits (TxSubmission txid tx)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsTxSubmission</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span class="annot"><span class="annottext">Channel m bTX
</span><a href="#local-6989586621680044925"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
-&gt; PeerPipelined
     (TxSubmission (GenTxId blk) (GenTx blk)) 'AsServer 'StIdle m ()
forall txid tx (m :: * -&gt; *) a.
Functor m =&gt;
TxSubmissionServerPipelined txid tx m a
-&gt; PeerPipelined (TxSubmission txid tx) 'AsServer 'StIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionServerPeerPipelined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; remotePeer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
</span><a href="#local-6989586621680044987"><span class="hs-identifier hs-var">hTxSubmissionServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044927"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044926"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span>    </span><span class="annot"><a href="#local-6989586621680044978"><span class="hs-identifier hs-type">aTxSubmission2Client</span></a></span><span>
</span><span id="line-578"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-580"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>    </span><span id="local-6989586621680044978"><span class="annot"><span class="annottext">aTxSubmission2Client :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bTX2
-&gt; m ((), Maybe bTX2)
</span><a href="#local-6989586621680044978"><span class="hs-identifier hs-var hs-var">aTxSubmission2Client</span></a></span></span><span> </span><span id="local-6989586621680044923"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044923"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044922"><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044922"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span></span><span> </span><span id="local-6989586621680044921"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044921"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044920"><span class="annot"><span class="annottext">Channel m bTX2
</span><a href="#local-6989586621680044920"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-584"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TxSubmissionClient&quot;</span></span><span>
</span><span id="line-585"></span><span>      </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
-&gt; ProtocolSizeLimits
     (TxSubmission2 (GenTxId blk) (GenTx blk)) bTX2
-&gt; ProtocolTimeLimits (TxSubmission2 (GenTxId blk) (GenTx blk))
-&gt; Channel m bTX2
-&gt; Peer
     (TxSubmission2 (GenTxId blk) (GenTx blk)) 'AsClient 'StHello m ()
-&gt; m ((), Maybe bTX2)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; Peer ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPeerWithLimits</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))
-&gt; TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044921"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="#local-6989586621680044995"><span class="hs-identifier hs-var">tTxSubmission2Tracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmission2Codec"><span class="hs-identifier hs-var hs-var">cTxSubmission2Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044923"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bTX2 -&gt; Word)
-&gt; ProtocolSizeLimits
     (TxSubmission2 (GenTxId blk) (GenTx blk)) bTX2
forall bytes txid tx.
(bytes -&gt; Word) -&gt; ProtocolSizeLimits (TxSubmission2 txid tx) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsTxSubmission2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bTX2 -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-589"></span><span>        </span><span class="annot"><span class="annottext">ProtocolTimeLimits (TxSubmission2 (GenTxId blk) (GenTx blk))
forall txid tx. ProtocolTimeLimits (TxSubmission2 txid tx)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsTxSubmission2</span></a></span><span>
</span><span id="line-590"></span><span>        </span><span class="annot"><span class="annottext">Channel m bTX2
</span><a href="#local-6989586621680044920"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Peer
  (TxSubmission (GenTxId blk) (GenTx blk)) 'AsClient 'StIdle m ()
-&gt; Peer
     (TxSubmission2 (GenTxId blk) (GenTx blk)) 'AsClient 'StHello m ()
forall ps (stIdle :: ps) (m :: * -&gt; *) a.
Functor m =&gt;
Peer ps 'AsClient stIdle m a
-&gt; Peer (Hello ps stIdle) 'AsClient 'StHello m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">Hello.wrapClientPeer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
-&gt; Peer
     (TxSubmission (GenTxId blk) (GenTx blk)) 'AsClient 'StIdle m ()
forall txid tx (m :: * -&gt; *) a.
Monad m =&gt;
TxSubmissionClient txid tx m a
-&gt; Peer (TxSubmission txid tx) 'AsClient 'StIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionClientPeer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; TxSubmissionClient (GenTxId blk) (GenTx blk) m ()
</span><a href="#local-6989586621680044988"><span class="hs-identifier hs-var">hTxSubmissionClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044923"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044922"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044921"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>    </span><span class="annot"><a href="#local-6989586621680044977"><span class="hs-identifier hs-type">aTxSubmission2Server</span></a></span><span>
</span><span id="line-594"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-595"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-596"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span><span>
</span><span id="line-597"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045005"><span class="hs-identifier hs-type">bTX2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621680044977"><span class="annot"><span class="annottext">aTxSubmission2Server :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bTX2 -&gt; m ((), Maybe bTX2)
</span><a href="#local-6989586621680044977"><span class="hs-identifier hs-var hs-var">aTxSubmission2Server</span></a></span></span><span> </span><span id="local-6989586621680044916"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044916"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044915"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044915"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044914"><span class="annot"><span class="annottext">Channel m bTX2
</span><a href="#local-6989586621680044914"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TxSubmissionServer&quot;</span></span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
-&gt; ProtocolSizeLimits
     (TxSubmission2 (GenTxId blk) (GenTx blk)) bTX2
-&gt; ProtocolTimeLimits (TxSubmission2 (GenTxId blk) (GenTx blk))
-&gt; Channel m bTX2
-&gt; PeerPipelined
     (TxSubmission2 (GenTxId blk) (GenTx blk)) 'AsServer 'StHello m ()
-&gt; m ((), Maybe bTX2)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; PeerPipelined ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPipelinedPeerWithLimits</span></a></span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))
 -&gt; TraceLabelPeer
      remotePeer
      (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m
     (TraceLabelPeer
        remotePeer
        (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
-&gt; Tracer
     m (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">remotePeer
-&gt; TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))
-&gt; TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk)))
forall peerid a. peerid -&gt; a -&gt; TraceLabelPeer peerid a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">TraceLabelPeer</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044915"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer
  m
  (TraceLabelPeer
     remotePeer
     (TraceSendRecv (TxSubmission2 (GenTxId blk) (GenTx blk))))
</span><a href="#local-6989586621680044995"><span class="hs-identifier hs-var">tTxSubmission2Tracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec (TxSubmission2 (GenTxId blk) (GenTx blk)) e m bTX2
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cTxSubmission2Codec"><span class="hs-identifier hs-var hs-var">cTxSubmission2Codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044916"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bTX2 -&gt; Word)
-&gt; ProtocolSizeLimits
     (TxSubmission2 (GenTxId blk) (GenTx blk)) bTX2
forall bytes txid tx.
(bytes -&gt; Word) -&gt; ProtocolSizeLimits (TxSubmission2 txid tx) bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsTxSubmission2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bTX2 -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-604"></span><span>        </span><span class="annot"><span class="annottext">ProtocolTimeLimits (TxSubmission2 (GenTxId blk) (GenTx blk))
forall txid tx. ProtocolTimeLimits (TxSubmission2 txid tx)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsTxSubmission2</span></a></span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="annottext">Channel m bTX2
</span><a href="#local-6989586621680044914"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerPipelined
  (TxSubmission (GenTxId blk) (GenTx blk)) 'AsServer 'StIdle m ()
-&gt; PeerPipelined
     (TxSubmission2 (GenTxId blk) (GenTx blk)) 'AsServer 'StHello m ()
forall ps (stIdle :: ps) (m :: * -&gt; *) a.
Functor m =&gt;
PeerPipelined ps 'AsServer stIdle m a
-&gt; PeerPipelined (Hello ps stIdle) 'AsServer 'StHello m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">Hello.wrapServerPeerPipelined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
-&gt; PeerPipelined
     (TxSubmission (GenTxId blk) (GenTx blk)) 'AsServer 'StIdle m ()
forall txid tx (m :: * -&gt; *) a.
Functor m =&gt;
TxSubmissionServerPipelined txid tx m a
-&gt; PeerPipelined (TxSubmission txid tx) 'AsServer 'StIdle m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionServerPeerPipelined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; remotePeer
-&gt; TxSubmissionServerPipelined (GenTxId blk) (GenTx blk) m ()
</span><a href="#local-6989586621680044987"><span class="hs-identifier hs-var">hTxSubmissionServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044916"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044915"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><a href="#local-6989586621680044976"><span class="hs-identifier hs-type">aKeepAliveClient</span></a></span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-610"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ControlMessageSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-611"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span><span>
</span><span id="line-613"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>    </span><span id="local-6989586621680044976"><span class="annot"><span class="annottext">aKeepAliveClient :: NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; Channel m bKA
-&gt; m ((), Maybe bKA)
</span><a href="#local-6989586621680044976"><span class="hs-identifier hs-var hs-var">aKeepAliveClient</span></a></span></span><span> </span><span id="local-6989586621680044912"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044912"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044911"><span class="annot"><span class="annottext">ControlMessageSTM m
</span><a href="#local-6989586621680044911"><span class="hs-identifier hs-var">_controlMessageSTM</span></a></span></span><span> </span><span id="local-6989586621680044910"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044910"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044909"><span class="annot"><span class="annottext">Channel m bKA
</span><a href="#local-6989586621680044909"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;KeepAliveClient&quot;</span></span><span>
</span><span id="line-616"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680044908"><span class="annot"><span class="annottext">kacApp :: StrictTVar m (Map remotePeer PeerGSV) -&gt; m ((), Maybe bKA)
</span><a href="#local-6989586621680044908"><span class="hs-identifier hs-var hs-var">kacApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044912"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-617"></span><span>                     </span><span class="hs-comment">-- Version 1 doesn't support keep alive protocol but Blockfetch</span><span>
</span><span id="line-618"></span><span>                     </span><span class="hs-comment">-- still requires a PeerGSV per peer.</span><span>
</span><span id="line-619"></span><span>                     </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">NodeToNodeV_1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">StrictTVar m (Map remotePeer PeerGSV)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m Any
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Any -&gt; m ((), Maybe bKA) -&gt; m ((), Maybe bKA)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((), Maybe bKA) -&gt; m ((), Maybe bKA)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe bKA
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>                     </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">NodeToNodeV_2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">StrictTVar m (Map remotePeer PeerGSV)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m Any
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Any -&gt; m ((), Maybe bKA) -&gt; m ((), Maybe bKA)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((), Maybe bKA) -&gt; m ((), Maybe bKA)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe bKA
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>                     </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680044904"><span class="annot"><span class="annottext">StrictTVar m (Map remotePeer PeerGSV)
</span><a href="#local-6989586621680044904"><span class="hs-identifier hs-var">dqCtx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-622"></span><span>                       </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv KeepAlive)
-&gt; Codec KeepAlive e m bKA
-&gt; ProtocolSizeLimits KeepAlive bKA
-&gt; ProtocolTimeLimits KeepAlive
-&gt; Channel m bKA
-&gt; Peer KeepAlive 'AsClient 'StClient m ()
-&gt; m ((), Maybe bKA)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; Peer ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPeerWithLimits</span></a></span><span>
</span><span id="line-623"></span><span>                         </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv KeepAlive)
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-624"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec KeepAlive e m bKA
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec KeepAlive e m bKA
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cKeepAliveCodec"><span class="hs-identifier hs-var hs-var">cKeepAliveCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044912"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bKA -&gt; Word) -&gt; ProtocolSizeLimits KeepAlive bKA
forall bytes. (bytes -&gt; Word) -&gt; ProtocolSizeLimits KeepAlive bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsKeepAlive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bKA -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-626"></span><span>                         </span><span class="annot"><span class="annottext">ProtocolTimeLimits KeepAlive
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsKeepAlive</span></a></span><span>
</span><span id="line-627"></span><span>                         </span><span class="annot"><span class="annottext">Channel m bKA
</span><a href="#local-6989586621680044909"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-628"></span><span>                         </span><span class="annot"><span class="annottext">(Peer KeepAlive 'AsClient 'StClient m () -&gt; m ((), Maybe bKA))
-&gt; Peer KeepAlive 'AsClient 'StClient m () -&gt; m ((), Maybe bKA)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeepAliveClient m () -&gt; Peer KeepAlive 'AsClient 'StClient m ()
forall (m :: * -&gt; *) a.
MonadThrow m =&gt;
KeepAliveClient m a -&gt; Peer KeepAlive 'AsClient 'StClient m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveClientPeer</span></a></span><span>
</span><span id="line-629"></span><span>                         </span><span class="annot"><span class="annottext">(KeepAliveClient m () -&gt; Peer KeepAlive 'AsClient 'StClient m ())
-&gt; KeepAliveClient m () -&gt; Peer KeepAlive 'AsClient 'StClient m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; ControlMessageSTM m
-&gt; remotePeer
-&gt; StrictTVar m (Map remotePeer PeerGSV)
-&gt; KeepAliveInterval
-&gt; KeepAliveClient m ()
</span><a href="#local-6989586621680044986"><span class="hs-identifier hs-var">hKeepAliveClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044912"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy m -&gt; ControlMessageSTM m
forall (m :: * -&gt; *) (proxy :: (* -&gt; *) -&gt; *).
Applicative (STM m) =&gt;
proxy m -&gt; ControlMessageSTM m
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">continueForever</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy m
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044910"><span class="hs-identifier hs-var">them</span></a></span><span> </span><span class="annot"><span class="annottext">StrictTVar m (Map remotePeer PeerGSV)
</span><a href="#local-6989586621680044904"><span class="hs-identifier hs-var">dqCtx</span></a></span><span>
</span><span id="line-630"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; KeepAliveInterval
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">KeepAliveInterval</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><span class="annottext">FetchClientRegistry remotePeer (Header blk) blk m
-&gt; remotePeer
-&gt; (StrictTVar m (Map remotePeer PeerGSV) -&gt; m ((), Maybe bKA))
-&gt; m ((), Maybe bKA)
forall (m :: * -&gt; *) a peer header block.
(MonadThrow m, MonadSTM m, MonadFork m, Ord peer) =&gt;
FetchClientRegistry peer header block m
-&gt; peer -&gt; (StrictTVar m (Map peer PeerGSV) -&gt; m a) -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">bracketKeepAliveClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
-&gt; FetchClientRegistry remotePeer (Header blk) blk m
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeKernel m remotePeer localPeer blk
-&gt; FetchClientRegistry remotePeer (Header blk) blk m
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetFetchClientRegistry%3ANodeKernel"><span class="hs-identifier hs-var hs-var">getFetchClientRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m remotePeer localPeer blk
</span><a href="#local-6989586621680045001"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044910"><span class="hs-identifier hs-var">them</span></a></span><span> </span><span class="annot"><span class="annottext">StrictTVar m (Map remotePeer PeerGSV) -&gt; m ((), Maybe bKA)
</span><a href="#local-6989586621680044908"><span class="hs-identifier hs-var">kacApp</span></a></span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><a href="#local-6989586621680044975"><span class="hs-identifier hs-type">aKeepAliveServer</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045012"><span class="hs-identifier hs-type">remotePeer</span></a></span><span>
</span><span id="line-637"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Channel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span><span>
</span><span id="line-638"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680045013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680045004"><span class="hs-identifier hs-type">bKA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>    </span><span id="local-6989586621680044975"><span class="annot"><span class="annottext">aKeepAliveServer :: NodeToNodeVersion
-&gt; remotePeer -&gt; Channel m bKA -&gt; m ((), Maybe bKA)
</span><a href="#local-6989586621680044975"><span class="hs-identifier hs-var hs-var">aKeepAliveServer</span></a></span></span><span> </span><span id="local-6989586621680044897"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044897"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680044896"><span class="annot"><span class="annottext">remotePeer
</span><a href="#local-6989586621680044896"><span class="hs-identifier hs-var">_them</span></a></span></span><span> </span><span id="local-6989586621680044895"><span class="annot"><span class="annottext">Channel m bKA
</span><a href="#local-6989586621680044895"><span class="hs-identifier hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">labelThisThread</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;KeepAliveServer&quot;</span></span><span>
</span><span id="line-641"></span><span>      </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv KeepAlive)
-&gt; Codec KeepAlive e m bKA
-&gt; ProtocolSizeLimits KeepAlive bKA
-&gt; ProtocolTimeLimits KeepAlive
-&gt; Channel m bKA
-&gt; Peer KeepAlive 'AsServer 'StClient m ()
-&gt; m ((), Maybe bKA)
forall ps (st :: ps) (pr :: PeerRole) failure bytes (m :: * -&gt; *)
       a.
(MonadAsync m, MonadFork m, MonadMask m, MonadThrow (STM m),
 MonadMonotonicTime m, MonadTimer m,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps,
 Show failure) =&gt;
Tracer m (TraceSendRecv ps)
-&gt; Codec ps failure m bytes
-&gt; ProtocolSizeLimits ps bytes
-&gt; ProtocolTimeLimits ps
-&gt; Channel m bytes
-&gt; Peer ps pr st m a
-&gt; m (a, Maybe bytes)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">runPeerWithLimits</span></a></span><span>
</span><span id="line-642"></span><span>        </span><span class="annot"><span class="annottext">Tracer m (TraceSendRecv KeepAlive)
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-643"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
-&gt; Codec KeepAlive e m bKA
forall blk e (m :: * -&gt; *) bCS bSCS bBF bSBF bTX bTX2 bKA.
Codecs blk e m bCS bSCS bBF bSBF bTX bTX2 bKA
-&gt; Codec KeepAlive e m bKA
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#cKeepAliveCodec"><span class="hs-identifier hs-var hs-var">cKeepAliveCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Codecs blk e m bCS bCS bBF bBF bTX bTX2 bKA
</span><a href="#local-6989586621680044994"><span class="hs-identifier hs-var">mkCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044897"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(bKA -&gt; Word) -&gt; ProtocolSizeLimits KeepAlive bKA
forall bytes. (bytes -&gt; Word) -&gt; ProtocolSizeLimits KeepAlive bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">byteLimitsKeepAlive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; bKA -&gt; Word
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Real Bytelimits, see #1727</span><span>
</span><span id="line-645"></span><span>        </span><span class="annot"><span class="annottext">ProtocolTimeLimits KeepAlive
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">timeLimitsKeepAlive</span></a></span><span>
</span><span id="line-646"></span><span>        </span><span class="annot"><span class="annottext">Channel m bKA
</span><a href="#local-6989586621680044895"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><span class="annottext">(Peer KeepAlive 'AsServer 'StClient m () -&gt; m ((), Maybe bKA))
-&gt; Peer KeepAlive 'AsServer 'StClient m () -&gt; m ((), Maybe bKA)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeepAliveServer m () -&gt; Peer KeepAlive 'AsServer 'StClient m ()
forall (m :: * -&gt; *) a.
Functor m =&gt;
KeepAliveServer m a -&gt; Peer KeepAlive 'AsServer 'StClient m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveServerPeer</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><span class="annottext">(KeepAliveServer m () -&gt; Peer KeepAlive 'AsServer 'StClient m ())
-&gt; KeepAliveServer m () -&gt; Peer KeepAlive 'AsServer 'StClient m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeepAliveServer m ()
forall (m :: * -&gt; *). Applicative m =&gt; KeepAliveServer m ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveServer</span></a></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Projections from 'Apps'
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-comment">-- | A projection from 'NetworkApplication' to a client-side</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- 'OuroborosApplication' for the node-to-node protocols.</span><span>
</span><span id="line-656"></span><span class="hs-comment">--</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- Implementation note: network currently doesn't enable protocols conditional</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- on the protocol version, but it eventually may; this is why @_version@ is</span><span>
</span><span id="line-659"></span><span class="hs-comment">-- currently unused.</span><span>
</span><span id="line-660"></span><span id="local-6989586621680044890"><span id="local-6989586621680044891"><span id="local-6989586621680044892"><span id="local-6989586621680044893"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#initiator"><span class="hs-identifier hs-type">initiator</span></a></span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">MiniProtocolParameters</span></a></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">Apps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044892"><span class="hs-identifier hs-type">peer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680044891"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044891"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044891"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044891"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044891"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044890"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">OuroborosApplication</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/network-mux-0.1.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier hs-type">InitiatorMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044892"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044891"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044890"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span></span></span></span></span><span>
</span><span id="line-665"></span><span id="initiator"><span class="annot"><span class="annottext">initiator :: MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; Apps m (ConnectionId peer) b b b b b a
-&gt; OuroborosApplication 'InitiatorMode peer b m a Void
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#initiator"><span class="hs-identifier hs-var hs-var">initiator</span></a></span></span><span> </span><span id="local-6989586621680044889"><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680044889"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span></span><span> </span><span id="local-6989586621680044888"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">Apps</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680044878"><span id="local-6989586621680044879"><span id="local-6989586621680044880"><span id="local-6989586621680044881"><span id="local-6989586621680044882"><span id="local-6989586621680044883"><span id="local-6989586621680044884"><span id="local-6989586621680044885"><span id="local-6989586621680044886"><span id="local-6989586621680044887"><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
ServerApp m (ConnectionId peer) b a
aKeepAliveServer :: ServerApp m (ConnectionId peer) b a
aKeepAliveClient :: ClientApp m (ConnectionId peer) b a
aTxSubmission2Server :: ServerApp m (ConnectionId peer) b a
aTxSubmission2Client :: ClientApp m (ConnectionId peer) b a
aTxSubmissionServer :: ServerApp m (ConnectionId peer) b a
aTxSubmissionClient :: ClientApp m (ConnectionId peer) b a
aBlockFetchServer :: ServerApp m (ConnectionId peer) b a
aBlockFetchClient :: ClientApp m (ConnectionId peer) b a
aChainSyncServer :: ServerApp m (ConnectionId peer) b a
aChainSyncClient :: ClientApp m (ConnectionId peer) b a
aKeepAliveServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bKA a
aKeepAliveClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bKA a
aTxSubmission2Server :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bTX2 a
aTxSubmission2Client :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bTX2 a
aTxSubmissionServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bTX a
aTxSubmissionClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bTX a
aBlockFetchServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bBF a
aBlockFetchClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bBF a
aChainSyncServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bCS a
aChainSyncClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bCS a
</span><a href="#local-6989586621680044878"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-666"></span><span>    </span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; (ConnectionId peer
    -&gt; STM m ControlMessage
    -&gt; NodeToNodeProtocols 'InitiatorMode b m a Void)
-&gt; NodeToNodeVersion
-&gt; OuroborosApplication 'InitiatorMode peer b m a Void
forall addr (m :: * -&gt; *) (appType :: MuxMode) bytes a b.
MiniProtocolParameters
-&gt; (ConnectionId addr
    -&gt; STM m ControlMessage -&gt; NodeToNodeProtocols appType bytes m a b)
-&gt; NodeToNodeVersion
-&gt; OuroborosApplication appType addr bytes m a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">nodeToNodeProtocols</span></a></span><span>
</span><span id="line-667"></span><span>      </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680044889"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-comment">-- TODO: currently consensus is using 'ConnectionId' for its 'peer' type.</span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-comment">-- This is currently ok, as we might accept multiple connections from the</span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-comment">-- same ip address, however this will change when we will switch to</span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-comment">-- p2p-governor &amp; connection-manager.  Then consenus can use peer's ip</span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-comment">-- address &amp; port number, rather than 'ConnectionId' (which is</span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-comment">-- a quadruple uniquely determinaing a connection).</span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680044876"><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044876"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044875"><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044875"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeToNodeProtocols :: forall (appType :: MuxMode) bytes (m :: * -&gt; *) a b.
RunMiniProtocol appType bytes m a b
-&gt; RunMiniProtocol appType bytes m a b
-&gt; RunMiniProtocol appType bytes m a b
-&gt; RunMiniProtocol appType bytes m a b
-&gt; NodeToNodeProtocols appType bytes m a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeProtocols</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-675"></span><span>          </span><span class="annot"><span class="annottext">chainSyncProtocol :: RunMiniProtocol 'InitiatorMode b m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">chainSyncProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-676"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'InitiatorMode b m a Void
forall bytes (m :: * -&gt; *) a.
MuxPeer bytes m a -&gt; RunMiniProtocol 'InitiatorMode bytes m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">InitiatorProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044887"><span class="hs-identifier hs-var">aChainSyncClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044875"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044876"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-677"></span><span>          </span><span class="annot"><span class="annottext">blockFetchProtocol :: RunMiniProtocol 'InitiatorMode b m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">blockFetchProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-678"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'InitiatorMode b m a Void
forall bytes (m :: * -&gt; *) a.
MuxPeer bytes m a -&gt; RunMiniProtocol 'InitiatorMode bytes m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">InitiatorProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044885"><span class="hs-identifier hs-var">aBlockFetchClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044875"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044876"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-679"></span><span>          </span><span class="annot"><span class="annottext">txSubmissionProtocol :: RunMiniProtocol 'InitiatorMode b m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-680"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; NodeToNodeVersion -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">NodeToNodeV_6</span></a></span><span>
</span><span id="line-681"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'InitiatorMode b m a Void
forall bytes (m :: * -&gt; *) a.
MuxPeer bytes m a -&gt; RunMiniProtocol 'InitiatorMode bytes m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">InitiatorProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044881"><span class="hs-identifier hs-var">aTxSubmission2Client</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044875"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044876"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'InitiatorMode b m a Void
forall bytes (m :: * -&gt; *) a.
MuxPeer bytes m a -&gt; RunMiniProtocol 'InitiatorMode bytes m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">InitiatorProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044883"><span class="hs-identifier hs-var">aTxSubmissionClient</span></a></span><span>  </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044875"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044876"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-683"></span><span>          </span><span class="annot"><span class="annottext">keepAliveProtocol :: RunMiniProtocol 'InitiatorMode b m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-684"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'InitiatorMode b m a Void
forall bytes (m :: * -&gt; *) a.
MuxPeer bytes m a -&gt; RunMiniProtocol 'InitiatorMode bytes m a Void
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">InitiatorProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044879"><span class="hs-identifier hs-var">aKeepAliveClient</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044875"><span class="hs-identifier hs-var">controlMessageSTM</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044876"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>      </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044888"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span class="hs-comment">-- | A projection from 'NetworkApplication' to a server-side</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- 'OuroborosApplication' for the node-to-node protocols.</span><span>
</span><span id="line-690"></span><span class="hs-comment">--</span><span>
</span><span id="line-691"></span><span class="hs-comment">-- See 'initiatorNetworkApplication' for rationale for the @_version@ arg.</span><span>
</span><span id="line-692"></span><span id="local-6989586621680044864"><span id="local-6989586621680044865"><span id="local-6989586621680044866"><span id="local-6989586621680044867"><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#responder"><span class="hs-identifier hs-type">responder</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">MiniProtocolParameters</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">Apps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044867"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">ConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044866"><span class="hs-identifier hs-type">peer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680044865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044864"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">OuroborosApplication</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/network-mux-0.1.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier hs-type">ResponderMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044866"><span class="hs-identifier hs-type">peer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044865"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680044867"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="#local-6989586621680044864"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-697"></span><span id="responder"><span class="annot"><span class="annottext">responder :: MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; Apps m (ConnectionId peer) b b b b b a
-&gt; OuroborosApplication 'ResponderMode peer b m Void a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#responder"><span class="hs-identifier hs-var hs-var">responder</span></a></span></span><span> </span><span id="local-6989586621680044863"><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680044863"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span></span><span> </span><span id="local-6989586621680044862"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">Apps</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680044852"><span id="local-6989586621680044853"><span id="local-6989586621680044854"><span id="local-6989586621680044855"><span id="local-6989586621680044856"><span id="local-6989586621680044857"><span id="local-6989586621680044858"><span id="local-6989586621680044859"><span id="local-6989586621680044860"><span id="local-6989586621680044861"><span class="annot"><span class="annottext">ClientApp m (ConnectionId peer) b a
ServerApp m (ConnectionId peer) b a
aKeepAliveServer :: ServerApp m (ConnectionId peer) b a
aKeepAliveClient :: ClientApp m (ConnectionId peer) b a
aTxSubmission2Server :: ServerApp m (ConnectionId peer) b a
aTxSubmission2Client :: ClientApp m (ConnectionId peer) b a
aTxSubmissionServer :: ServerApp m (ConnectionId peer) b a
aTxSubmissionClient :: ClientApp m (ConnectionId peer) b a
aBlockFetchServer :: ServerApp m (ConnectionId peer) b a
aBlockFetchClient :: ClientApp m (ConnectionId peer) b a
aChainSyncServer :: ServerApp m (ConnectionId peer) b a
aChainSyncClient :: ClientApp m (ConnectionId peer) b a
aKeepAliveServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bKA a
aKeepAliveClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bKA a
aTxSubmission2Server :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bTX2 a
aTxSubmission2Client :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bTX2 a
aTxSubmissionServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bTX a
aTxSubmissionClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bTX a
aBlockFetchServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bBF a
aBlockFetchClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bBF a
aChainSyncServer :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ServerApp m peer bCS a
aChainSyncClient :: forall (m :: * -&gt; *) peer bCS bBF bTX bTX2 bKA a.
Apps m peer bCS bBF bTX bTX2 bKA a -&gt; ClientApp m peer bCS a
</span><a href="#local-6989586621680044852"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; (ConnectionId peer
    -&gt; STM m ControlMessage
    -&gt; NodeToNodeProtocols 'ResponderMode b m Void a)
-&gt; NodeToNodeVersion
-&gt; OuroborosApplication 'ResponderMode peer b m Void a
forall addr (m :: * -&gt; *) (appType :: MuxMode) bytes a b.
MiniProtocolParameters
-&gt; (ConnectionId addr
    -&gt; STM m ControlMessage -&gt; NodeToNodeProtocols appType bytes m a b)
-&gt; NodeToNodeVersion
-&gt; OuroborosApplication appType addr bytes m a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">nodeToNodeProtocols</span></a></span><span>
</span><span id="line-699"></span><span>      </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680044863"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span>
</span><span id="line-700"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680044851"><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044851"><span class="hs-identifier hs-var">them</span></a></span></span><span> </span><span id="local-6989586621680044850"><span class="annot"><span class="annottext">STM m ControlMessage
</span><a href="#local-6989586621680044850"><span class="hs-identifier hs-var">_controlMessageSTM</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeToNodeProtocols :: forall (appType :: MuxMode) bytes (m :: * -&gt; *) a b.
RunMiniProtocol appType bytes m a b
-&gt; RunMiniProtocol appType bytes m a b
-&gt; RunMiniProtocol appType bytes m a b
-&gt; RunMiniProtocol appType bytes m a b
-&gt; NodeToNodeProtocols appType bytes m a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeProtocols</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-701"></span><span>          </span><span class="annot"><span class="annottext">chainSyncProtocol :: RunMiniProtocol 'ResponderMode b m Void a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">chainSyncProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'ResponderMode b m Void a
forall bytes (m :: * -&gt; *) b.
MuxPeer bytes m b -&gt; RunMiniProtocol 'ResponderMode bytes m Void b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">ResponderProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044860"><span class="hs-identifier hs-var">aChainSyncServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044851"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-703"></span><span>          </span><span class="annot"><span class="annottext">blockFetchProtocol :: RunMiniProtocol 'ResponderMode b m Void a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">blockFetchProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-704"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'ResponderMode b m Void a
forall bytes (m :: * -&gt; *) b.
MuxPeer bytes m b -&gt; RunMiniProtocol 'ResponderMode bytes m Void b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">ResponderProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044858"><span class="hs-identifier hs-var">aBlockFetchServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044851"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-705"></span><span>          </span><span class="annot"><span class="annottext">txSubmissionProtocol :: RunMiniProtocol 'ResponderMode b m Void a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">txSubmissionProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-706"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; NodeToNodeVersion -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">NodeToNodeV_6</span></a></span><span>
</span><span id="line-707"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'ResponderMode b m Void a
forall bytes (m :: * -&gt; *) b.
MuxPeer bytes m b -&gt; RunMiniProtocol 'ResponderMode bytes m Void b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">ResponderProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044854"><span class="hs-identifier hs-var">aTxSubmission2Server</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044851"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'ResponderMode b m Void a
forall bytes (m :: * -&gt; *) b.
MuxPeer bytes m b -&gt; RunMiniProtocol 'ResponderMode bytes m Void b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">ResponderProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044856"><span class="hs-identifier hs-var">aTxSubmissionServer</span></a></span><span>  </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044851"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-709"></span><span>          </span><span class="annot"><span class="annottext">keepAliveProtocol :: RunMiniProtocol 'ResponderMode b m Void a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">keepAliveProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-710"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MuxPeer b m a -&gt; RunMiniProtocol 'ResponderMode b m Void a
forall bytes (m :: * -&gt; *) b.
MuxPeer bytes m b -&gt; RunMiniProtocol 'ResponderMode bytes m Void b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">ResponderProtocolOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Channel m b -&gt; m (a, Maybe b)) -&gt; MuxPeer b m a
forall (m :: * -&gt; *) bytes a.
(Channel m bytes -&gt; m (a, Maybe bytes)) -&gt; MuxPeer bytes m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">MuxPeerRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerApp m (ConnectionId peer) b a
</span><a href="#local-6989586621680044852"><span class="hs-identifier hs-var">aKeepAliveServer</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionId peer
</span><a href="#local-6989586621680044851"><span class="hs-identifier hs-var">them</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>      </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680044862"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-713"></span></pre></body></html>