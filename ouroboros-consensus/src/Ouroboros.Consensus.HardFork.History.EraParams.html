<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass     #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards    #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators      #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.EraParams</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * API</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier">EraParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#SafeZone"><span class="hs-identifier">SafeZone</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Defaults</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#defaultEraParams"><span class="hs-identifier">defaultEraParams</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decoder</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decodeListLen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decodeWord8</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Encoding</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeListLen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeWord8</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Serialise</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Binary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">enforceSize</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime.WallClock.Types</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Config.SecurityParam.html"><span class="hs-identifier">Ouroboros.Consensus.Config.SecurityParam</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  OVERVIEW

  The overall chain consists of various /era/s. Each era has its own set of era
  parameters such as the slot length and epoch size, as well as its own block
  format, ledger format, ledger rules, etc. It is assumed that the overall
  /shape/ of the chain is known. In other words, we statically know which eras
  we expect and what their parameters are; adding an additional era would
  require a code update. What we /don't/ know precisely is /when/ we transition
  from one era to the next, i.e., the hard fork transition points.

  When we are at genesis, the chain therefore looks something like this:

  &gt; *-------------------?--------------------?--------------------
  &gt; ^
  &gt; \-- tip

  where we have (in this example) three eras (say, Byron, Shelley and Goguen)
  and therefore two hard fork transitions. Hard forks happen at epoch
  boundaries; the exact 'EpochNo' of each hard fork is determined by the era
  preceding it. Naturally, the exact 'EpochNo' of /past/ hard forks is known:

  &gt; ---------------A--------------*----------?--------------------
  &gt;                               ^
  &gt;                               \-- tip

  where A is a known hard fork transition, and the next hard fork transition
  is still unknown.

  SAFE ZONES

  Future hard fork points may be known or unknown, where &quot;known&quot; means
  &quot;certain&quot;; i.e., for Byron, it would mean an update proposal has been voted
  on, confirmed, endorsed, and that endorsement is at least @k@ blocks deep into
  the chain; for Shelley it means an update proposal is voted on and accepted,
  and that acceptance is at least @k@ blocks deep into the chain.

  When a hard fork point is still unknown, we assume that each era determines a
  &quot;safe zone&quot;: a number of slots from the tip of the ledger in which it is
  guaranteed that the hard fork will not happen.

  &gt; CASE (i)
  &gt;
  &gt; ---------------A--------------*----------?--------------------
  &gt;                               \..../
  &gt;                                safe
  &gt;                                zone

  Since the hard fork will not happen in the safe zone, we can extend the use of
  the current set of era parameters past the tip into the safe zone, giving us a
  limited ability to make predictions for the future (such as converting between
  slot numbers and wallclock time).

  We assume that once a transition point is known (and no longer subject to
  roll-back), this is guaranteed not to change anymore and we can use the era's
  parameters up to the transition point:

  &gt; CASE (ii)
  &gt;
  &gt; ---------------A--------------*----------------B--------------
  &gt;                               \.............../
  &gt;                                implicitly safe

  Moreover, we assume that we can extend B's safe zone from the point of the
  hard fork transition:

  &gt; CASE (iii)
  &gt;
  &gt; ---------------A--------------*----------------B--------------
  &gt;                               \.............../\..../
  &gt;                                implicitly safe  safe
  &gt;                                                 zone

  This is justified because the safe zones arise from stability requirements
  for the transactions that establish the transition point. The earliest point
  such a transaction could be included in the chain is after the hard fork
  transition, since it must be a transaction from the /new/ era.

  NOTE ON STABILITY

  If we used as yet /unconfirmed/ update proposals to determine hard fork
  transition points, then any of the resulting time conversions would be
  subject to rollback; if we switched to a different fork, time conversions
  might suddenly look different. Whilst this /may/ be doable, in practice this
  is a headache we would very much like to avoid. For example, it might mean
  that when a block comes in and we determine that it's from the future,
  we might have prematurely marked it as invalid. So, we insist that time
  conversions must be based on update propsals that are /certain/ (no longer
  subject to rollback). This means that the &quot;safe zone&quot; we have been discussing
  above must extend from the point of stability forward. Moreover, the safe zone
  must be long enough to include a sufficient number of blocks such that we can
  evaluate enough headers of an alternative fork (without having its blocks)
  to decide that we want to switch to that fork; since in the worst case that
  means we have to evaluate @k@ headers (or @k+1@), the safe zone must be long
  enough to cover @k@ blocks (and therefore a safe zone of @2k@ slots for Byron,
  and (probably) a safe zone of @3k/f@ slots for Shelley). Effectively, this
  means that consensus wants &quot;stability itself to be stable&quot;; we need a double
  safe zone after an update proposal has been confirmed.
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Parameters that can vary across hard forks</span><span>
</span><span id="line-133"></span><span id="local-6989586621679984560"><span id="local-6989586621679984561"></span></span><span class="hs-keyword">data</span><span> </span><span id="EraParams"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-var">EraParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EraParams"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-var">EraParams</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-134"></span><span>      </span><span id="eraEpochSize"><span class="annot"><span class="annottext">EraParams -&gt; EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraEpochSize"><span class="hs-identifier hs-var hs-var">eraEpochSize</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="eraSlotLength"><span class="annot"><span class="annottext">EraParams -&gt; SlotLength
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraSlotLength"><span class="hs-identifier hs-var hs-var">eraSlotLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="eraSafeZone"><span class="annot"><span class="annottext">EraParams -&gt; SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraSafeZone"><span class="hs-identifier hs-var hs-var">eraSafeZone</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#SafeZone"><span class="hs-identifier hs-type">SafeZone</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679984550"><span id="local-6989586621679984552"><span id="local-6989586621679984554"><span class="annot"><span class="annottext">Int -&gt; EraParams -&gt; ShowS
[EraParams] -&gt; ShowS
EraParams -&gt; String
(Int -&gt; EraParams -&gt; ShowS)
-&gt; (EraParams -&gt; String)
-&gt; ([EraParams] -&gt; ShowS)
-&gt; Show EraParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EraParams] -&gt; ShowS
$cshowList :: [EraParams] -&gt; ShowS
show :: EraParams -&gt; String
$cshow :: EraParams -&gt; String
showsPrec :: Int -&gt; EraParams -&gt; ShowS
$cshowsPrec :: Int -&gt; EraParams -&gt; ShowS
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679984545"><span id="local-6989586621679984547"><span class="annot"><span class="annottext">EraParams -&gt; EraParams -&gt; Bool
(EraParams -&gt; EraParams -&gt; Bool)
-&gt; (EraParams -&gt; EraParams -&gt; Bool) -&gt; Eq EraParams
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: EraParams -&gt; EraParams -&gt; Bool
$c/= :: EraParams -&gt; EraParams -&gt; Bool
== :: EraParams -&gt; EraParams -&gt; Bool
$c== :: EraParams -&gt; EraParams -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. EraParams -&gt; Rep EraParams x)
-&gt; (forall x. Rep EraParams x -&gt; EraParams) -&gt; Generic EraParams
forall x. Rep EraParams x -&gt; EraParams
forall x. EraParams -&gt; Rep EraParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep EraParams x -&gt; EraParams
$cfrom :: forall x. EraParams -&gt; Rep EraParams x
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679984535"><span id="local-6989586621679984537"><span id="local-6989586621679984539"><span class="annot"><span class="annottext">Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo)
Proxy EraParams -&gt; String
(Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy EraParams -&gt; String)
-&gt; NoThunks EraParams
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy EraParams -&gt; String
$cshowTypeOf :: Proxy EraParams -&gt; String
wNoThunks :: Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; EraParams -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Default 'EraParams'</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- We set</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- * epoch size to @10k@ slots</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- * the safe zone to @2k@ slots</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- * the upper bound to 'NoLowerBound'</span><span>
</span><span id="line-148"></span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- This is primarily useful for tests.</span><span>
</span><span id="line-150"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#defaultEraParams"><span class="hs-identifier hs-type">defaultEraParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Config.SecurityParam.html#SecurityParam"><span class="hs-identifier hs-type">SecurityParam</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span>
</span><span id="line-151"></span><span id="defaultEraParams"><span class="annot"><span class="annottext">defaultEraParams :: SecurityParam -&gt; SlotLength -&gt; EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#defaultEraParams"><span class="hs-identifier hs-var hs-var">defaultEraParams</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Config.SecurityParam.html#SecurityParam"><span class="hs-identifier hs-type">SecurityParam</span></a></span><span> </span><span id="local-6989586621679984532"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679984532"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679984531"><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679984531"><span class="hs-identifier hs-var">slotLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams :: EpochSize -&gt; SlotLength -&gt; SafeZone -&gt; EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">eraEpochSize :: EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraEpochSize"><span class="hs-identifier hs-var">eraEpochSize</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochSize
</span><span class="hs-identifier hs-var">EpochSize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679984532"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraSlotLength :: SlotLength
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraSlotLength"><span class="hs-identifier hs-var">eraSlotLength</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679984531"><span class="hs-identifier hs-var">slotLength</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraSafeZone :: SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraSafeZone"><span class="hs-identifier hs-var">eraSafeZone</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#StandardSafeZone"><span class="hs-identifier hs-var">StandardSafeZone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679984532"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | Zone in which it is guaranteed that no hard fork can take place</span><span>
</span><span id="line-158"></span><span id="local-6989586621679984526"><span id="local-6989586621679984527"></span></span><span class="hs-keyword">data</span><span> </span><span id="SafeZone"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#SafeZone"><span class="hs-identifier hs-var">SafeZone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- | Standard safe zone</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- We record</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- * Number of slots from the tip of the ledger.</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">--   This should be (at least) the number of slots in which we are</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">--   guaranteed to have @k@ blocks.</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- * Optionally, an 'EpochNo' before which no hard fork can take place.</span><span>
</span><span id="line-167"></span><span>    </span><span id="StandardSafeZone"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#StandardSafeZone"><span class="hs-identifier hs-var">StandardSafeZone</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">-- | Pretend the transition to the next era will not take place.</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- This constructor is marked as unsafe because it effectively extends</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- the safe zone of this era indefinitely into the future. This means that</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- we might reach invalid conclusions when doing</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- * slot to time conversions for blocks that are past the actual safe zone</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- * time to slot conversions for the current time, when behind in syncing</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- This is safe when the code is simply not yet ready to transition to the</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- next era, because in that case, we can be sure that blocks that come in</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- are still from this era. It also means that we can always /produce/ a</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- block, no matter how far ahead of the current ledger we are.</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- If the code is ready for the transition, just awaiting an update</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">-- proposal, then 'LowerBound' can be used instead.</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- This constructor can be regarded as an &quot; extreme &quot; version of</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- 'LowerBound', and can be used for similar reasons.</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnsafeIndefiniteSafeZone"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#UnsafeIndefiniteSafeZone"><span class="hs-identifier hs-var">UnsafeIndefiniteSafeZone</span></a></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679984519"><span id="local-6989586621679984521"><span id="local-6989586621679984523"><span class="annot"><span class="annottext">Int -&gt; SafeZone -&gt; ShowS
[SafeZone] -&gt; ShowS
SafeZone -&gt; String
(Int -&gt; SafeZone -&gt; ShowS)
-&gt; (SafeZone -&gt; String) -&gt; ([SafeZone] -&gt; ShowS) -&gt; Show SafeZone
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SafeZone] -&gt; ShowS
$cshowList :: [SafeZone] -&gt; ShowS
show :: SafeZone -&gt; String
$cshow :: SafeZone -&gt; String
showsPrec :: Int -&gt; SafeZone -&gt; ShowS
$cshowsPrec :: Int -&gt; SafeZone -&gt; ShowS
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679984515"><span id="local-6989586621679984517"><span class="annot"><span class="annottext">SafeZone -&gt; SafeZone -&gt; Bool
(SafeZone -&gt; SafeZone -&gt; Bool)
-&gt; (SafeZone -&gt; SafeZone -&gt; Bool) -&gt; Eq SafeZone
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SafeZone -&gt; SafeZone -&gt; Bool
$c/= :: SafeZone -&gt; SafeZone -&gt; Bool
== :: SafeZone -&gt; SafeZone -&gt; Bool
$c== :: SafeZone -&gt; SafeZone -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. SafeZone -&gt; Rep SafeZone x)
-&gt; (forall x. Rep SafeZone x -&gt; SafeZone) -&gt; Generic SafeZone
forall x. Rep SafeZone x -&gt; SafeZone
forall x. SafeZone -&gt; Rep SafeZone x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SafeZone x -&gt; SafeZone
$cfrom :: forall x. SafeZone -&gt; Rep SafeZone x
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679984507"><span id="local-6989586621679984509"><span id="local-6989586621679984511"><span class="annot"><span class="annottext">Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo)
Proxy SafeZone -&gt; String
(Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy SafeZone -&gt; String)
-&gt; NoThunks SafeZone
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy SafeZone -&gt; String
$cshowTypeOf :: Proxy SafeZone -&gt; String
wNoThunks :: Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; SafeZone -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679984507"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Serialisation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679984501"><span id="local-6989586621679984503"><span class="annot"><span class="hs-identifier hs-type">Serialise</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#SafeZone"><span class="hs-identifier hs-type">SafeZone</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621679984499"><span class="annot"><span class="annottext">encode :: SafeZone -&gt; Encoding
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">encode</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-198"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#StandardSafeZone"><span class="hs-identifier hs-type">StandardSafeZone</span></a></span><span> </span><span id="local-6989586621679984497"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679984497"><span class="hs-identifier hs-var">safeFromTip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Encoding] -&gt; Encoding
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-199"></span><span>          </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeWord8</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679984497"><span class="hs-identifier hs-var">safeFromTip</span></a></span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-comment">-- For backward compatibility we still encode safeBeforeEpoch</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Encoding
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#encodeSafeBeforeEpoch"><span class="hs-identifier hs-var">encodeSafeBeforeEpoch</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#UnsafeIndefiniteSafeZone"><span class="hs-identifier hs-var">UnsafeIndefiniteSafeZone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Encoding] -&gt; Encoding
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-206"></span><span>          </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeWord8</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621679984495"><span class="annot"><span class="annottext">decode :: Decoder s SafeZone
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">decode</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679984493"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679984493"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">decodeListLen</span></span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679984492"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679984492"><span class="hs-identifier hs-var">tag</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Word8
forall s. Decoder s Word8
</span><span class="hs-identifier hs-var">decodeWord8</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679984493"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679984492"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#StandardSafeZone"><span class="hs-identifier hs-var">StandardSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; SafeZone) -&gt; Decoder s Word64 -&gt; Decoder s SafeZone
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Word64
forall a s. Serialise a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decode</span></span><span> </span><span class="annot"><span class="annottext">Decoder s SafeZone -&gt; Decoder s () -&gt; Decoder s SafeZone
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;*</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s ()
forall s. Decoder s ()
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#decodeSafeBeforeEpoch"><span class="hs-identifier hs-var">decodeSafeBeforeEpoch</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeZone -&gt; Decoder s SafeZone
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#UnsafeIndefiniteSafeZone"><span class="hs-identifier hs-var">UnsafeIndefiniteSafeZone</span></a></span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">(Int, Word8)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s SafeZone
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s SafeZone) -&gt; String -&gt; Decoder s SafeZone
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SafeZone: invalid size and tag &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Word8) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679984493"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679984492"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Artificial encoder for backward compatibility, see #2646.</span><span>
</span><span id="line-218"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#encodeSafeBeforeEpoch"><span class="hs-identifier hs-type">encodeSafeBeforeEpoch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span><span>
</span><span id="line-219"></span><span id="encodeSafeBeforeEpoch"><span class="annot"><span class="annottext">encodeSafeBeforeEpoch :: Encoding
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#encodeSafeBeforeEpoch"><span class="hs-identifier hs-var hs-var">encodeSafeBeforeEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeWord8</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Artificial decoder for backward compatibility, see #2646.</span><span>
</span><span id="line-222"></span><span id="local-6989586621679984585"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#decodeSafeBeforeEpoch"><span class="hs-identifier hs-type">decodeSafeBeforeEpoch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679984585"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-223"></span><span id="decodeSafeBeforeEpoch"><span class="annot"><span class="annottext">decodeSafeBeforeEpoch :: Decoder s ()
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#decodeSafeBeforeEpoch"><span class="hs-identifier hs-var hs-var">decodeSafeBeforeEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679984487"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679984487"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">decodeListLen</span></span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679984486"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679984486"><span class="hs-identifier hs-var">tag</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Word8
forall s. Decoder s Word8
</span><span class="hs-identifier hs-var">decodeWord8</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679984487"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679984486"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Decoder s EpochNo -&gt; Decoder s ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Decoder s EpochNo -&gt; Decoder s ())
-&gt; Decoder s EpochNo -&gt; Decoder s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Serialise EpochNo =&gt; Decoder s EpochNo
forall a s. Serialise a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decode</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">(Int, Word8)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s ()) -&gt; String -&gt; Decoder s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SafeBeforeEpoch: invalid size and tag &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Word8) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679984487"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679984486"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679984480"><span id="local-6989586621679984482"><span class="annot"><span class="hs-identifier hs-type">Serialise</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621679984479"><span class="annot"><span class="annottext">encode :: EraParams -&gt; Encoding
</span><a href="#local-6989586621679984479"><span class="hs-identifier hs-var hs-var hs-var hs-var">encode</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621679984476"><span id="local-6989586621679984477"><span id="local-6989586621679984478"><span class="annot"><span class="annottext">SlotLength
EpochSize
SafeZone
eraSafeZone :: SafeZone
eraSlotLength :: SlotLength
eraEpochSize :: EpochSize
eraSafeZone :: EraParams -&gt; SafeZone
eraSlotLength :: EraParams -&gt; SlotLength
eraEpochSize :: EraParams -&gt; EpochSize
</span><a href="#local-6989586621679984476"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Encoding] -&gt; Encoding
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochSize -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">unEpochSize</span></span><span> </span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679984478"><span class="hs-identifier hs-var">eraEpochSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotLength -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679984477"><span class="hs-identifier hs-var">eraSlotLength</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SafeZone -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">SafeZone
</span><a href="#local-6989586621679984476"><span class="hs-identifier hs-var">eraSafeZone</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679984474"><span class="annot"><span class="annottext">decode :: Decoder s EraParams
</span><a href="#local-6989586621679984474"><span class="hs-identifier hs-var hs-var hs-var hs-var">decode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; Decoder s ()
forall s. Text -&gt; Int -&gt; Decoder s ()
</span><span class="hs-identifier hs-var">enforceSize</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;EraParams&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-241"></span><span>      </span><span id="local-6989586621679984473"><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679984473"><span class="hs-identifier hs-var">eraEpochSize</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochSize
</span><span class="hs-identifier hs-var">EpochSize</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; EpochSize) -&gt; Decoder s Word64 -&gt; Decoder s EpochSize
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Word64
forall a s. Serialise a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decode</span></span><span>
</span><span id="line-242"></span><span>      </span><span id="local-6989586621679984472"><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679984472"><span class="hs-identifier hs-var">eraSlotLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s SlotLength
forall a s. Serialise a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decode</span></span><span>
</span><span id="line-243"></span><span>      </span><span id="local-6989586621679984471"><span class="annot"><span class="annottext">SafeZone
</span><a href="#local-6989586621679984471"><span class="hs-identifier hs-var">eraSafeZone</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s SafeZone
forall a s. Serialise a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decode</span></span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">EraParams -&gt; Decoder s EraParams
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">EraParams :: EpochSize -&gt; SlotLength -&gt; SafeZone -&gt; EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">SlotLength
EpochSize
SafeZone
eraSafeZone :: SafeZone
eraSlotLength :: SlotLength
eraEpochSize :: EpochSize
eraSafeZone :: SafeZone
eraSlotLength :: SlotLength
eraEpochSize :: EpochSize
</span><a href="#local-6989586621679984471"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-245"></span></pre></body></html>