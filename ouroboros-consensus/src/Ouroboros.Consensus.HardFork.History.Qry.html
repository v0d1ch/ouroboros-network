<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric              #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia                #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs                      #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures             #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes                 #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards            #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving         #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances       #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Qry</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Qry</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier">PastHorizonException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier">qryFromExpr</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier">runQuery</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier">runQueryPure</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier">runQueryThrow</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** opaque</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier">Qry</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Interpreter</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#interpretQuery"><span class="hs-identifier">interpretQuery</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#mkInterpreter"><span class="hs-identifier">mkInterpreter</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#unsafeExtendSafeZone"><span class="hs-identifier">unsafeExtendSafeZone</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** opaque</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier">Interpreter</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Specific queries</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSize"><span class="hs-identifier">epochToSize</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier">epochToSlot</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier">epochToSlot'</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier">slotToEpoch</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier">slotToEpoch'</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier">slotToWallclock</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier">wallclockToSlot</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Serialise</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throw</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Fixed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">divMod'</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.SOP.Strict.html"><span class="hs-identifier">Data.SOP.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SListI</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">showSpace</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Quiet</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime.WallClock.Types</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.html"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier">Some</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Counting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.EraParams</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Summary</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Util.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Util</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Internal: reified queries

  NOTE. The lower bound of every era is inclusive, while the upper bound is
  really exclusive, making the upper bound of every era equal to the lower
  bound of the next.

  &gt;         era A         era B         era C
  &gt;        [.....) [...............) [..........)
  &gt; epoch         e                 e'
  &gt; slot          s                 s'
  &gt; time          t                 t'

  Now let's consider what happens when we do translations of the values at
  the boundary.

   1. Slot-to-epoch translation. Using era C, we get

      &gt; e' + ((s' - s') / epochSizeC) == e'

      Using era B (technically the wrong era to be using, since the upper bound
      is exclusive), we get

      &gt; e + ((s' - s) / epochSizeB)

      These are equal by (INV-1a).

   2. Epoch-to-slot translation. Using era C, we get

      &gt; s' + ((e' - e') * epochSizeC) == s'

      Using era B, we'd get

      &gt; s + ((e' - e) * epochSizeB

      These are equal by (INV-1b).

   3. Slot to time translation. Using era C, we get

      &gt; t' + ((s' - s') * slotLenC) == t'

      Using era C, we get

      &gt; t + ((s' - s) * slotLenB)

      These are equal by (INV-2b)

   4. Time to slot translation. Using era C, we get

      &gt; s' + ((t' - t') / slotLenC) == s'

      Using era B, we get

      &gt; s + ((t' - t) / slotLenB)

      These are equal by (INV-2a).

  This means that for values at that boundary, it does not matter if we use
  this era or the next era for the translation. However, this is only true for
  these 4 translations. If we are returning the era parameters directly, then
  of course we can't use the era parameters from the wrong era.

  There is however a benefit to using the current era: there might not /be/
  a next era, and so if we use the current era, we extend the period for which
  we do calculations just that tiny bit more. This might be important for
  ledger implementations. For example, suppose we want to know if a particular
  slot @s@ is far enough away from the next epoch boundary (e.g., to determine
  if an update proposal should take effect in this epoch or the next). One
  natural way to write this would be to translate @s@ to the corresponding
  epoch @e@, then translate @e + 1@ back to a slot @s'@, and check the
  distance @s' - s@. However, it is conceivable that the safe zone stops at
  that epoch boundary; if it does, this computation would result in a
  'PastHorizonException', even if a different way to write the same computation
  (translating @s + delta@ to an epoch number, and then comparing that to @e@)
  might succeed. Rather than imposing an unnecessary limitation on the ledger,
  we therefore treat the upper bound as inclusive, so that both ways to do the
  check would succeed.
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Query</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- 'Qry' adds a monadic interface on top of 'Expr'. Although means that 'Qry'</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- itself is not showable, the 'PastHorizonException' can nonetheless show the</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- offending expression alongside the 'Summary' against which it was evaluated.</span><span>
</span><span id="line-151"></span><span class="hs-keyword">data</span><span> </span><span id="Qry"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-var">Qry</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>  </span><span id="local-6989586621680015437"><span id="QPure"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680015437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015437"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621680015435"><span id="local-6989586621680015677"><span id="QExpr"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680015435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015677"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015677"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680015431"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621680015429"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; Qry a -&gt; Qry b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Qry a -&gt; Qry b
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680015419"><span id="local-6989586621680015421"><span id="local-6989586621680015423"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621680015417"><span class="annot"><span class="annottext">pure :: a -&gt; Qry a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Qry a
forall a. a -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621680015416"><span class="annot"><span class="annottext">&lt;*&gt; :: Qry (a -&gt; b) -&gt; Qry a -&gt; Qry b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qry (a -&gt; b) -&gt; Qry a -&gt; Qry b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680015411"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621680015408"><span class="annot"><span class="annottext">return :: a -&gt; Qry a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">return</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Qry a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-type">QPure</span></a></span><span> </span><span id="local-6989586621680015407"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015407"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span id="local-6989586621680015406"><span class="annot"><span class="annottext">&gt;&gt;= :: Qry a -&gt; (a -&gt; Qry b) -&gt; Qry b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621680015405"><span class="annot"><span class="annottext">a -&gt; Qry b
</span><a href="#local-6989586621680015405"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Qry b
</span><a href="#local-6989586621680015405"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015407"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-type">QExpr</span></a></span><span> </span><span id="local-6989586621680015404"><span class="annot"><span class="annottext">ClosedExpr a
</span><a href="#local-6989586621680015404"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015403"><span class="annot"><span class="annottext">a -&gt; Qry a
</span><a href="#local-6989586621680015403"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span id="local-6989586621680015402"><span class="annot"><span class="annottext">a -&gt; Qry b
</span><a href="#local-6989586621680015402"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedExpr a -&gt; (a -&gt; Qry b) -&gt; Qry b
forall a b. ClosedExpr a -&gt; (a -&gt; Qry b) -&gt; Qry b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedExpr a
</span><a href="#local-6989586621680015404"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Qry a
</span><a href="#local-6989586621680015403"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Qry a) -&gt; (a -&gt; Qry b) -&gt; a -&gt; Qry b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Qry b
</span><a href="#local-6989586621680015402"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Construct a 'Qry' from a closed 'Expr'</span><span>
</span><span id="line-168"></span><span id="local-6989586621680015522"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-type">qryFromExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680015672"><span class="annot"><a href="#local-6989586621680015672"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015672"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015522"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015522"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-169"></span><span id="qryFromExpr"><span class="annot"><span class="annottext">qryFromExpr :: (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var hs-var">qryFromExpr</span></a></span></span><span> </span><span id="local-6989586621680015400"><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Expr f a
</span><a href="#local-6989586621680015400"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedExpr a -&gt; (a -&gt; Qry a) -&gt; Qry a
forall a b. ClosedExpr a -&gt; (a -&gt; Qry b) -&gt; Qry b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f a) -&gt; ClosedExpr a
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; ClosedExpr a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-var">ClosedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Expr f a
</span><a href="#local-6989586621680015400"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; Qry a
forall a. a -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Clarifying newtypes
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span id="local-6989586621680015397"><span id="local-6989586621680015398"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="TimeInEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="TimeInEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a></span></span><span>   </span><span class="hs-special">{</span><span> </span><span id="getTimeInEra"><span class="annot"><span class="annottext">TimeInEra -&gt; NominalDiffTime
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInEra"><span class="hs-identifier hs-var hs-var">getTimeInEra</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. TimeInEra -&gt; Rep TimeInEra x)
-&gt; (forall x. Rep TimeInEra x -&gt; TimeInEra) -&gt; Generic TimeInEra
forall x. Rep TimeInEra x -&gt; TimeInEra
forall x. TimeInEra -&gt; Rep TimeInEra x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TimeInEra x -&gt; TimeInEra
$cfrom :: forall x. TimeInEra -&gt; Rep TimeInEra x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span id="local-6989586621680015390"><span id="local-6989586621680015391"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="TimeInSlot"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TimeInSlot"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a></span></span><span>  </span><span class="hs-special">{</span><span> </span><span id="getTimeInSlot"><span class="annot"><span class="annottext">TimeInSlot -&gt; NominalDiffTime
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInSlot"><span class="hs-identifier hs-var hs-var">getTimeInSlot</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. TimeInSlot -&gt; Rep TimeInSlot x)
-&gt; (forall x. Rep TimeInSlot x -&gt; TimeInSlot) -&gt; Generic TimeInSlot
forall x. Rep TimeInSlot x -&gt; TimeInSlot
forall x. TimeInSlot -&gt; Rep TimeInSlot x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TimeInSlot x -&gt; TimeInSlot
$cfrom :: forall x. TimeInSlot -&gt; Rep TimeInSlot x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span id="local-6989586621680015384"><span id="local-6989586621680015385"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="SlotInEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="SlotInEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a></span></span><span>   </span><span class="hs-special">{</span><span> </span><span id="getSlotInEra"><span class="annot"><span class="annottext">SlotInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEra"><span class="hs-identifier hs-var hs-var">getSlotInEra</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. SlotInEra -&gt; Rep SlotInEra x)
-&gt; (forall x. Rep SlotInEra x -&gt; SlotInEra) -&gt; Generic SlotInEra
forall x. Rep SlotInEra x -&gt; SlotInEra
forall x. SlotInEra -&gt; Rep SlotInEra x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SlotInEra x -&gt; SlotInEra
$cfrom :: forall x. SlotInEra -&gt; Rep SlotInEra x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span id="local-6989586621680015378"><span id="local-6989586621680015379"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="SlotInEpoch"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-var">SlotInEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SlotInEpoch"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-var">SlotInEpoch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getSlotInEpoch"><span class="annot"><span class="annottext">SlotInEpoch -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEpoch"><span class="hs-identifier hs-var hs-var">getSlotInEpoch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. SlotInEpoch -&gt; Rep SlotInEpoch x)
-&gt; (forall x. Rep SlotInEpoch x -&gt; SlotInEpoch)
-&gt; Generic SlotInEpoch
forall x. Rep SlotInEpoch x -&gt; SlotInEpoch
forall x. SlotInEpoch -&gt; Rep SlotInEpoch x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SlotInEpoch x -&gt; SlotInEpoch
$cfrom :: forall x. SlotInEpoch -&gt; Rep SlotInEpoch x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="local-6989586621680015372"><span id="local-6989586621680015373"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="EpochInEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EpochInEra"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a></span></span><span>  </span><span class="hs-special">{</span><span> </span><span id="getEpochInEra"><span class="annot"><span class="annottext">EpochInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getEpochInEra"><span class="hs-identifier hs-var hs-var">getEpochInEra</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. EpochInEra -&gt; Rep EpochInEra x)
-&gt; (forall x. Rep EpochInEra x -&gt; EpochInEra) -&gt; Generic EpochInEra
forall x. Rep EpochInEra x -&gt; EpochInEra
forall x. EpochInEra -&gt; Rep EpochInEra x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep EpochInEra x -&gt; EpochInEra
$cfrom :: forall x. EpochInEra -&gt; Rep EpochInEra x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621680015362"><span id="local-6989586621680015364"><span id="local-6989586621680015366"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quiet</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a></span><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a></span></span></span></span><span>
</span><span id="line-182"></span><span id="local-6989586621680015354"><span id="local-6989586621680015356"><span id="local-6989586621680015358"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quiet</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span><span>  </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span></span></span></span><span>
</span><span id="line-183"></span><span id="local-6989586621680015348"><span id="local-6989586621680015350"><span id="local-6989586621680015352"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quiet</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span></span></span></span><span>
</span><span id="line-184"></span><span id="local-6989586621680015342"><span id="local-6989586621680015344"><span id="local-6989586621680015346"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quiet</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span></span></span></span><span>
</span><span id="line-185"></span><span id="local-6989586621680015336"><span id="local-6989586621680015338"><span id="local-6989586621680015340"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quiet</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a></span><span>  </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a></span></span></span></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Expressions
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-keyword">data</span><span> </span><span id="ClosedExpr"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-var">ClosedExpr</span></a></span></span><span> </span><span id="local-6989586621680015668"><span class="annot"><a href="#local-6989586621680015668"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClosedExpr"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-var">ClosedExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680015669"><span class="annot"><a href="#local-6989586621680015669"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015669"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015668"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">-- | Query expressions in PHOAS</span><span>
</span><span id="line-194"></span><span class="hs-keyword">data</span><span> </span><span id="Expr"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-var">Expr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680015335"><span class="annot"><a href="#local-6989586621680015335"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-comment">-- PHOAS infrastructure</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621680015494"><span id="local-6989586621680015495"><span id="EVar"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680015495"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015494"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015495"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015494"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621680015497"><span id="local-6989586621680015498"><span id="ELit"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680015498"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680015498"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015497"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015498"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621680015332"><span id="local-6989586621680015501"><span id="local-6989586621680015503"><span id="ELet"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015503"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015332"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680015503"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015332"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015503"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015501"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015503"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015501"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-comment">-- Support for pairs makes expressions more easily composable</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621680015329"><span id="local-6989586621680015330"><span id="local-6989586621680015493"><span id="EPair"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015493"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015330"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015493"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015329"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015493"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680015330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680015329"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621680015327"><span id="local-6989586621680015476"><span id="local-6989586621680015477"><span id="EFst"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-var">EFst</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015477"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680015476"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680015327"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015477"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015476"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621680015325"><span id="local-6989586621680015488"><span id="local-6989586621680015490"><span id="ESnd"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015490"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680015325"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680015488"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015490"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015488"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-comment">-- Convert from absolute to era-relative</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621680015499"><span id="EAbsToRelTime"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-var">EAbsToRelTime</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015499"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015499"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a></span></span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621680015483"><span id="EAbsToRelSlot"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015483"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015483"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span></span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621680015472"><span id="EAbsToRelEpoch"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-var">EAbsToRelEpoch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015472"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015472"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a></span></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-comment">-- Convert from era-relative to absolute</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621680015485"><span id="ERelToAbsTime"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-var">ERelToAbsTime</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015485"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015485"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span></span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621680015496"><span id="ERelToAbsSlot"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015496"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015496"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span></span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621680015480"><span id="ERelToAbsEpoch"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-var">ERelToAbsEpoch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015480"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015480"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- Convert between relative values</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621680015500"><span id="ERelTimeToSlot"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-var">ERelTimeToSlot</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015500"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015500"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621680015484"><span id="ERelSlotToTime"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-var">ERelSlotToTime</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015484"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015484"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a></span></span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621680015481"><span id="ERelSlotToEpoch"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-var">ERelSlotToEpoch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015481"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015481"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621680015473"><span id="ERelEpochToSlot"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-var">ERelEpochToSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015473"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015473"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a></span></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-comment">-- Get era parameters</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">-- The arguments are used for bound checks</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621680015487"><span id="ESlotLength"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015487"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015487"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span></span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621680015478"><span id="EEpochSize"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015478"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015478"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Interpreter
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span id="local-6989586621680015577"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalExprInEra"><span class="hs-identifier hs-type">evalExprInEra</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015577"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680015577"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-237"></span><span id="evalExprInEra"><span class="annot"><span class="annottext">evalExprInEra :: EraSummary -&gt; ClosedExpr a -&gt; Maybe a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalExprInEra"><span class="hs-identifier hs-var hs-var">evalExprInEra</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span class="hs-special">{</span><span id="local-6989586621680015307"><span id="local-6989586621680015308"><span id="local-6989586621680015309"><span class="annot"><span class="annottext">EraParams
EraEnd
Bound
eraParams :: EraSummary -&gt; EraParams
eraEnd :: EraSummary -&gt; EraEnd
eraStart :: EraSummary -&gt; Bound
eraParams :: EraParams
eraEnd :: EraEnd
eraStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraParams"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span> </span><span id="local-6989586621680015303"><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Expr f a
</span><a href="#local-6989586621680015303"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr Identity a -&gt; Maybe a
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity a
forall (f :: * -&gt; *). Expr f a
</span><a href="#local-6989586621680015303"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680015298"><span id="local-6989586621680015299"><span id="local-6989586621680015300"><span class="annot"><span class="annottext">SlotLength
EpochSize
SafeZone
eraSafeZone :: EraParams -&gt; SafeZone
eraSlotLength :: EraParams -&gt; SlotLength
eraEpochSize :: EraParams -&gt; EpochSize
eraSafeZone :: SafeZone
eraSlotLength :: SlotLength
eraEpochSize :: EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraSafeZone"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680015307"><span class="hs-identifier hs-var">eraParams</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621680015294"><span class="annot"><span class="annottext">slotLen :: NominalDiffTime
</span><a href="#local-6989586621680015294"><span class="hs-identifier hs-var hs-var">slotLen</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotLength -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var hs-var">getSlotLength</span></span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621680015299"><span class="hs-identifier hs-var">eraSlotLength</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621680015292"><span class="annot"><span class="annottext">epochSize :: Word64
</span><a href="#local-6989586621680015292"><span class="hs-identifier hs-var hs-var">epochSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochSize -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">unEpochSize</span></span><span>   </span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621680015300"><span class="hs-identifier hs-var">eraEpochSize</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="#local-6989586621680015290"><span class="hs-identifier hs-type">guardEnd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">Bound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621680015290"><span class="annot"><span class="annottext">guardEnd :: (Bound -&gt; Bool) -&gt; Maybe ()
</span><a href="#local-6989586621680015290"><span class="hs-identifier hs-var hs-var">guardEnd</span></a></span></span><span> </span><span id="local-6989586621680015289"><span class="annot"><span class="annottext">Bound -&gt; Bool
</span><a href="#local-6989586621680015289"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EraEnd
</span><a href="#local-6989586621680015308"><span class="hs-identifier hs-var">eraEnd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>          </span><span class="annot"><span class="annottext">EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraUnbounded"><span class="hs-identifier hs-var">EraUnbounded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Maybe ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-type">EraEnd</span></a></span><span> </span><span id="local-6989586621680015286"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015286"><span class="hs-identifier hs-var">b</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; Bool
</span><a href="#local-6989586621680015289"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015286"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621680015639"><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><a href="#local-6989586621680015639"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680015639"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621680015302"><span class="annot"><span class="annottext">go :: Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-type">EVar</span></a></span><span> </span><span id="local-6989586621680015285"><span class="annot"><span class="annottext">Identity a
</span><a href="#local-6989586621680015285"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe a) -&gt; a -&gt; Maybe a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identity a -&gt; a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">Identity a
</span><a href="#local-6989586621680015285"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-type">ELet</span></a></span><span> </span><span id="local-6989586621680015283"><span class="annot"><span class="annottext">Expr Identity a
</span><a href="#local-6989586621680015283"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015282"><span class="annot"><span class="annottext">Identity a -&gt; Expr Identity a
</span><a href="#local-6989586621680015282"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">Expr Identity a -&gt; Maybe a
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity a
</span><a href="#local-6989586621680015283"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; (a -&gt; Maybe a) -&gt; Maybe a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Expr Identity a -&gt; Maybe a
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr Identity a -&gt; Maybe a)
-&gt; (a -&gt; Expr Identity a) -&gt; a -&gt; Maybe a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity a -&gt; Expr Identity a
</span><a href="#local-6989586621680015282"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Identity a -&gt; Expr Identity a)
-&gt; (a -&gt; Identity a) -&gt; a -&gt; Expr Identity a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Identity a
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- Literals and pairs</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-type">ELit</span></a></span><span> </span><span id="local-6989586621680015279"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015279"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015279"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-type">EPair</span></a></span><span> </span><span id="local-6989586621680015278"><span class="annot"><span class="annottext">Expr Identity a
</span><a href="#local-6989586621680015278"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015277"><span class="annot"><span class="annottext">Expr Identity b
</span><a href="#local-6989586621680015277"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>        </span><span id="local-6989586621680015276"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015276"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity a -&gt; Maybe a
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity a
</span><a href="#local-6989586621680015278"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621680015275"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680015275"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity b -&gt; Maybe b
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity b
</span><a href="#local-6989586621680015277"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">(a, b) -&gt; Maybe (a, b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015276"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680015275"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-type">EFst</span></a></span><span> </span><span id="local-6989586621680015274"><span class="annot"><span class="annottext">Expr Identity (a, b)
</span><a href="#local-6989586621680015274"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>       </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; a) -&gt; Maybe (a, b) -&gt; Maybe a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Identity (a, b) -&gt; Maybe (a, b)
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity (a, b)
</span><a href="#local-6989586621680015274"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-type">ESnd</span></a></span><span> </span><span id="local-6989586621680015272"><span class="annot"><span class="annottext">Expr Identity (a, a)
</span><a href="#local-6989586621680015272"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>       </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; Maybe (a, a) -&gt; Maybe a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Identity (a, a) -&gt; Maybe (a, a)
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity (a, a)
</span><a href="#local-6989586621680015272"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- Convert absolute to relative</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- The guards here justify the subtractions.</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-type">EAbsToRelTime</span></a></span><span> </span><span id="local-6989586621680015271"><span class="annot"><span class="annottext">Expr Identity RelativeTime
</span><a href="#local-6989586621680015271"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>        </span><span id="local-6989586621680015270"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015270"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity RelativeTime -&gt; Maybe RelativeTime
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity RelativeTime
</span><a href="#local-6989586621680015271"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015270"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; RelativeTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; RelativeTime
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundTime"><span class="hs-identifier hs-var hs-var">boundTime</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">TimeInEra -&gt; Maybe TimeInEra
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TimeInEra -&gt; Maybe TimeInEra) -&gt; TimeInEra -&gt; Maybe TimeInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; TimeInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015270"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; RelativeTime -&gt; NominalDiffTime
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#diffRelTime"><span class="hs-operator hs-var">`diffRelTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; RelativeTime
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundTime"><span class="hs-identifier hs-var hs-var">boundTime</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-type">EAbsToRelSlot</span></a></span><span> </span><span id="local-6989586621680015267"><span class="annot"><span class="annottext">Expr Identity SlotNo
</span><a href="#local-6989586621680015267"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>        </span><span id="local-6989586621680015266"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015266"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotNo -&gt; Maybe SlotNo
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotNo
</span><a href="#local-6989586621680015267"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015266"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">SlotInEra -&gt; Maybe SlotInEra
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotInEra -&gt; Maybe SlotInEra) -&gt; SlotInEra -&gt; Maybe SlotInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; SlotNo -&gt; SlotNo -&gt; Word64
SlotNo -&gt; SlotNo -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#countSlots"><span class="hs-identifier hs-var">countSlots</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015266"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-type">EAbsToRelEpoch</span></a></span><span> </span><span id="local-6989586621680015263"><span class="annot"><span class="annottext">Expr Identity EpochNo
</span><a href="#local-6989586621680015263"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>        </span><span id="local-6989586621680015262"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015262"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity EpochNo -&gt; Maybe EpochNo
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity EpochNo
</span><a href="#local-6989586621680015263"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015262"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">EpochInEra -&gt; Maybe EpochInEra
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(EpochInEra -&gt; Maybe EpochInEra) -&gt; EpochInEra -&gt; Maybe EpochInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; EpochNo -&gt; EpochNo -&gt; Word64
EpochNo -&gt; EpochNo -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#countEpochs"><span class="hs-identifier hs-var">countEpochs</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015262"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">-- Convert relative to absolute</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- As justified by the proof above, the guards treat the upper bound</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-comment">-- as inclusive.</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-type">ERelToAbsTime</span></a></span><span> </span><span id="local-6989586621680015259"><span class="annot"><span class="annottext">Expr Identity TimeInEra
</span><a href="#local-6989586621680015259"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>        </span><span id="local-6989586621680015258"><span class="annot"><span class="annottext">TimeInEra
</span><a href="#local-6989586621680015258"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity TimeInEra -&gt; Maybe TimeInEra
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity TimeInEra
</span><a href="#local-6989586621680015259"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680015257"><span class="annot"><span class="annottext">absTime :: RelativeTime
</span><a href="#local-6989586621680015257"><span class="hs-identifier hs-var hs-var">absTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeInEra -&gt; NominalDiffTime
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInEra"><span class="hs-identifier hs-var hs-var">getTimeInEra</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInEra
</span><a href="#local-6989586621680015258"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; RelativeTime -&gt; RelativeTime
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#addRelTime"><span class="hs-operator hs-var">`addRelTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; RelativeTime
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundTime"><span class="hs-identifier hs-var hs-var">boundTime</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">(Bound -&gt; Bool) -&gt; Maybe ()
</span><a href="#local-6989586621680015290"><span class="hs-identifier hs-var">guardEnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Bound -&gt; Bool) -&gt; Maybe ()) -&gt; (Bound -&gt; Bool) -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015255"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015255"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015257"><span class="hs-identifier hs-var">absTime</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; RelativeTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; RelativeTime
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundTime"><span class="hs-identifier hs-var hs-var">boundTime</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015255"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">RelativeTime -&gt; Maybe RelativeTime
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015257"><span class="hs-identifier hs-var">absTime</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-type">ERelToAbsSlot</span></a></span><span> </span><span id="local-6989586621680015253"><span class="annot"><span class="annottext">Expr Identity (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015253"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680015252"><span class="annot"><span class="annottext">SlotInEra
</span><a href="#local-6989586621680015252"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680015251"><span class="annot"><span class="annottext">TimeInSlot
</span><a href="#local-6989586621680015251"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity (SlotInEra, TimeInSlot)
-&gt; Maybe (SlotInEra, TimeInSlot)
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015253"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680015250"><span class="annot"><span class="annottext">absSlot :: SlotNo
</span><a href="#local-6989586621680015250"><span class="hs-identifier hs-var hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addSlots"><span class="hs-identifier hs-var">addSlots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEra"><span class="hs-identifier hs-var hs-var">getSlotInEra</span></a></span><span> </span><span class="annot"><span class="annottext">SlotInEra
</span><a href="#local-6989586621680015252"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">(Bound -&gt; Bool) -&gt; Maybe ()
</span><a href="#local-6989586621680015290"><span class="hs-identifier hs-var">guardEnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Bound -&gt; Bool) -&gt; Maybe ()) -&gt; (Bound -&gt; Bool) -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015248"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015248"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015250"><span class="hs-identifier hs-var">absSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span>  </span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015248"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-298"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015250"><span class="hs-identifier hs-var">absSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015248"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TimeInSlot -&gt; NominalDiffTime
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInSlot"><span class="hs-identifier hs-var hs-var">getTimeInSlot</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInSlot
</span><a href="#local-6989586621680015251"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">SlotNo -&gt; Maybe SlotNo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015250"><span class="hs-identifier hs-var">absSlot</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-type">ERelToAbsEpoch</span></a></span><span> </span><span id="local-6989586621680015244"><span class="annot"><span class="annottext">Expr Identity (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015244"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680015243"><span class="annot"><span class="annottext">EpochInEra
</span><a href="#local-6989586621680015243"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680015242"><span class="annot"><span class="annottext">SlotInEpoch
</span><a href="#local-6989586621680015242"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity (EpochInEra, SlotInEpoch)
-&gt; Maybe (EpochInEra, SlotInEpoch)
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015244"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680015241"><span class="annot"><span class="annottext">absEpoch :: EpochNo
</span><a href="#local-6989586621680015241"><span class="hs-identifier hs-var hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochNo -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addEpochs"><span class="hs-identifier hs-var">addEpochs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getEpochInEra"><span class="hs-identifier hs-var hs-var">getEpochInEra</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInEra
</span><a href="#local-6989586621680015243"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">(Bound -&gt; Bool) -&gt; Maybe ()
</span><a href="#local-6989586621680015290"><span class="hs-identifier hs-var">guardEnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Bound -&gt; Bool) -&gt; Maybe ()) -&gt; (Bound -&gt; Bool) -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015239"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015239"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015241"><span class="hs-identifier hs-var">absEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span>  </span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015239"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-304"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015241"><span class="hs-identifier hs-var">absEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015239"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SlotInEpoch -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEpoch"><span class="hs-identifier hs-var hs-var">getSlotInEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">SlotInEpoch
</span><a href="#local-6989586621680015242"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015241"><span class="hs-identifier hs-var">absEpoch</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-comment">-- Convert between relative values</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- No guards necessary</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-type">ERelTimeToSlot</span></a></span><span> </span><span id="local-6989586621680015238"><span class="annot"><span class="annottext">Expr Identity TimeInEra
</span><a href="#local-6989586621680015238"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621680015237"><span class="annot"><span class="annottext">TimeInEra
</span><a href="#local-6989586621680015237"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity TimeInEra -&gt; Maybe TimeInEra
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity TimeInEra
</span><a href="#local-6989586621680015238"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">(SlotInEra, TimeInSlot) -&gt; Maybe (SlotInEra, TimeInSlot)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((SlotInEra, TimeInSlot) -&gt; Maybe (SlotInEra, TimeInSlot))
-&gt; (SlotInEra, TimeInSlot) -&gt; Maybe (SlotInEra, TimeInSlot)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; SlotInEra)
-&gt; (NominalDiffTime -&gt; TimeInSlot)
-&gt; (Word64, NominalDiffTime)
-&gt; (SlotInEra, TimeInSlot)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; TimeInSlot
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInEra -&gt; NominalDiffTime
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInEra"><span class="hs-identifier hs-var hs-var">getTimeInEra</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInEra
</span><a href="#local-6989586621680015237"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; (Word64, NominalDiffTime)
forall a b. (Real a, Integral b) =&gt; a -&gt; a -&gt; (b, a)
</span><span class="hs-operator hs-var">`divMod'`</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621680015294"><span class="hs-identifier hs-var">slotLen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-type">ERelSlotToTime</span></a></span><span> </span><span id="local-6989586621680015235"><span class="annot"><span class="annottext">Expr Identity SlotInEra
</span><a href="#local-6989586621680015235"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621680015234"><span class="annot"><span class="annottext">SlotInEra
</span><a href="#local-6989586621680015234"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotInEra -&gt; Maybe SlotInEra
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotInEra
</span><a href="#local-6989586621680015235"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><span class="annottext">TimeInEra -&gt; Maybe TimeInEra
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TimeInEra -&gt; Maybe TimeInEra) -&gt; TimeInEra -&gt; Maybe TimeInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; TimeInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; NominalDiffTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEra"><span class="hs-identifier hs-var hs-var">getSlotInEra</span></a></span><span> </span><span class="annot"><span class="annottext">SlotInEra
</span><a href="#local-6989586621680015234"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621680015294"><span class="hs-identifier hs-var">slotLen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-type">ERelSlotToEpoch</span></a></span><span> </span><span id="local-6989586621680015232"><span class="annot"><span class="annottext">Expr Identity SlotInEra
</span><a href="#local-6989586621680015232"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>        </span><span id="local-6989586621680015231"><span class="annot"><span class="annottext">SlotInEra
</span><a href="#local-6989586621680015231"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotInEra -&gt; Maybe SlotInEra
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotInEra
</span><a href="#local-6989586621680015232"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="annottext">(EpochInEra, SlotInEpoch) -&gt; Maybe (EpochInEra, SlotInEpoch)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((EpochInEra, SlotInEpoch) -&gt; Maybe (EpochInEra, SlotInEpoch))
-&gt; (EpochInEra, SlotInEpoch) -&gt; Maybe (EpochInEra, SlotInEpoch)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; EpochInEra)
-&gt; (Word64 -&gt; SlotInEpoch)
-&gt; (Word64, Word64)
-&gt; (EpochInEra, SlotInEpoch)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotInEpoch
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-var">SlotInEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">((Word64, Word64) -&gt; (EpochInEra, SlotInEpoch))
-&gt; (Word64, Word64) -&gt; (EpochInEra, SlotInEpoch)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEra"><span class="hs-identifier hs-var hs-var">getSlotInEra</span></a></span><span> </span><span class="annot"><span class="annottext">SlotInEra
</span><a href="#local-6989586621680015231"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; (Word64, Word64)
forall a. Integral a =&gt; a -&gt; a -&gt; (a, a)
</span><span class="hs-operator hs-var">`divMod`</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680015292"><span class="hs-identifier hs-var">epochSize</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-type">ERelEpochToSlot</span></a></span><span> </span><span id="local-6989586621680015229"><span class="annot"><span class="annottext">Expr Identity EpochInEra
</span><a href="#local-6989586621680015229"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621680015228"><span class="annot"><span class="annottext">EpochInEra
</span><a href="#local-6989586621680015228"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity EpochInEra -&gt; Maybe EpochInEra
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity EpochInEra
</span><a href="#local-6989586621680015229"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><span class="annottext">SlotInEra -&gt; Maybe SlotInEra
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotInEra -&gt; Maybe SlotInEra) -&gt; SlotInEra -&gt; Maybe SlotInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochInEra -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getEpochInEra"><span class="hs-identifier hs-var hs-var">getEpochInEra</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInEra
</span><a href="#local-6989586621680015228"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680015292"><span class="hs-identifier hs-var">epochSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-comment">-- Get era parameters</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-comment">-- Here the upper bound must definitely be exclusive, or we'd return the</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-comment">-- era parameters from the wrong era.</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-type">ESlotLength</span></a></span><span> </span><span id="local-6989586621680015227"><span class="annot"><span class="annottext">Expr Identity SlotNo
</span><a href="#local-6989586621680015227"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>        </span><span id="local-6989586621680015226"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015226"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotNo -&gt; Maybe SlotNo
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity SlotNo
</span><a href="#local-6989586621680015227"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015226"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">(Bound -&gt; Bool) -&gt; Maybe ()
</span><a href="#local-6989586621680015290"><span class="hs-identifier hs-var">guardEnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Bound -&gt; Bool) -&gt; Maybe ()) -&gt; (Bound -&gt; Bool) -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015225"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015225"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015226"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015225"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">SlotLength -&gt; Maybe SlotLength
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621680015299"><span class="hs-identifier hs-var">eraSlotLength</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-type">EEpochSize</span></a></span><span> </span><span id="local-6989586621680015224"><span class="annot"><span class="annottext">Expr Identity EpochNo
</span><a href="#local-6989586621680015224"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>        </span><span id="local-6989586621680015223"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015223"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Identity EpochNo -&gt; Maybe EpochNo
forall a. Expr Identity a -&gt; Maybe a
</span><a href="#local-6989586621680015302"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Identity EpochNo
</span><a href="#local-6989586621680015224"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015223"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015309"><span class="hs-identifier hs-var">eraStart</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><span class="annottext">(Bound -&gt; Bool) -&gt; Maybe ()
</span><a href="#local-6989586621680015290"><span class="hs-identifier hs-var">guardEnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Bound -&gt; Bool) -&gt; Maybe ()) -&gt; (Bound -&gt; Bool) -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015222"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015222"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015223"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680015222"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span class="annot"><span class="annottext">EpochSize -&gt; Maybe EpochSize
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621680015300"><span class="hs-identifier hs-var">eraEpochSize</span></a></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  PastHorizonException
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | We tried to convert something that is past the horizon</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- That is, we tried to convert something that is past the point in time</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- beyond which we lack information due to uncertainty about the next</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- hard fork.</span><span>
</span><span id="line-349"></span><span class="hs-keyword">data</span><span> </span><span id="PastHorizonException"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-var">PastHorizonException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PastHorizon"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizon"><span class="hs-identifier hs-var">PastHorizon</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-comment">-- | Callstack to the call to 'runQuery'</span><span>
</span><span id="line-351"></span><span>      </span><span id="pastHorizonCallStack"><span class="annot"><span class="annottext">PastHorizonException -&gt; CallStack
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#pastHorizonCallStack"><span class="hs-identifier hs-var hs-var">pastHorizonCallStack</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CallStack</span></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-comment">-- | The 'Expr' we tried to evaluate</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pastHorizonExpression"><span class="annot"><span class="annottext">PastHorizonException -&gt; Some ClosedExpr
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#pastHorizonExpression"><span class="hs-identifier hs-var hs-var">pastHorizonExpression</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-type">Some</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-comment">-- | The 'EraSummary's that we tried to evaluate the 'Expr' against</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pastHorizonSummary"><span class="annot"><span class="annottext">PastHorizonException -&gt; [EraSummary]
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#pastHorizonSummary"><span class="hs-identifier hs-var hs-var">pastHorizonSummary</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span id="local-6989586621680015212"><span id="local-6989586621680015214"><span id="local-6989586621680015216"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span></span></span></span><span>
</span><span id="line-361"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680015204"><span id="local-6989586621680015206"><span id="local-6989586621680015208"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span></span></span></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Running queries
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-comment">-- | Run a query</span><span>
</span><span id="line-368"></span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- Unlike an 'Expr', which is evaluated in a single era, a 'Qry' is evaluated</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- against /all/ eras. Only if all 'Expr's embedded in the 'Qry' can be</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- evaluated in the /same/ era (we don't want to mix properties of different</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- eras in one query) do we return the result. If there is no era in which we</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- can evaluate all 'Expr's in the 'Qry', we report a 'PastHorizonException'.</span><span>
</span><span id="line-374"></span><span class="hs-comment">--</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- NOTE: this means that queries about separate eras have to be run separately,</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- they should not be composed into a single query. How could we know to which</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- era which relative slot/time refers?</span><span>
</span><span id="line-378"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-type">runQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-379"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680015561"><span class="annot"><a href="#local-6989586621680015561"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680015560"><span class="annot"><a href="#local-6989586621680015560"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015561"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015560"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015561"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-381"></span><span id="runQuery"><span class="annot"><span class="annottext">runQuery :: Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var hs-var">runQuery</span></a></span></span><span> </span><span id="local-6989586621680015202"><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015202"><span class="hs-identifier hs-var">qry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span id="local-6989586621680015200"><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015200"><span class="hs-identifier hs-var">summary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; Either PastHorizonException a
forall (xs' :: [*]).
NonEmpty xs' EraSummary -&gt; Either PastHorizonException a
</span><a href="#local-6989586621680015199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015200"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621680015585"><span class="annot"><a href="#local-6989586621680015199"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015585"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015561"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621680015199"><span class="annot"><span class="annottext">go :: NonEmpty xs' EraSummary -&gt; Either PastHorizonException a
</span><a href="#local-6989586621680015199"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-type">NonEmptyOne</span></a></span><span> </span><span id="local-6989586621680015197"><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015197"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; Qry a -&gt; Either PastHorizonException a
forall b. EraSummary -&gt; Qry b -&gt; Either PastHorizonException b
</span><a href="#local-6989586621680015196"><span class="hs-identifier hs-var">tryEra</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015197"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015202"><span class="hs-identifier hs-var">qry</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="#local-6989586621680015199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyCons"><span class="hs-identifier hs-type">NonEmptyCons</span></a></span><span> </span><span id="local-6989586621680015194"><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015194"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621680015193"><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015193"><span class="hs-identifier hs-var">eras</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; Qry a -&gt; Either PastHorizonException a
forall b. EraSummary -&gt; Qry b -&gt; Either PastHorizonException b
</span><a href="#local-6989586621680015196"><span class="hs-identifier hs-var">tryEra</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015194"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015202"><span class="hs-identifier hs-var">qry</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span class="annot"><span class="annottext">PastHorizonException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; Either PastHorizonException a
forall (xs' :: [*]).
NonEmpty xs' EraSummary -&gt; Either PastHorizonException a
</span><a href="#local-6989586621680015199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015193"><span class="hs-identifier hs-var">eras</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680015192"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015192"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either PastHorizonException a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015192"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>    </span><span class="annot"><a href="#local-6989586621680015196"><span class="hs-identifier hs-type">tryEra</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680015583"><span class="annot"><a href="#local-6989586621680015583"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015583"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015583"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621680015196"><span class="annot"><span class="annottext">tryEra :: EraSummary -&gt; Qry b -&gt; Either PastHorizonException b
</span><a href="#local-6989586621680015196"><span class="hs-identifier hs-var hs-var">tryEra</span></a></span></span><span> </span><span id="local-6989586621680015191"><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015191"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-type">QPure</span></a></span><span> </span><span id="local-6989586621680015190"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680015190"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either PastHorizonException b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680015190"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-type">QExpr</span></a></span><span> </span><span id="local-6989586621680015189"><span class="annot"><span class="annottext">ClosedExpr a
</span><a href="#local-6989586621680015189"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015188"><span class="annot"><span class="annottext">a -&gt; Qry b
</span><a href="#local-6989586621680015188"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; ClosedExpr a -&gt; Maybe a
forall a. EraSummary -&gt; ClosedExpr a -&gt; Maybe a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalExprInEra"><span class="hs-identifier hs-var">evalExprInEra</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015191"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedExpr a
</span><a href="#local-6989586621680015189"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680015187"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015187"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>              </span><span class="annot"><span class="annottext">EraSummary -&gt; Qry b -&gt; Either PastHorizonException b
forall b. EraSummary -&gt; Qry b -&gt; Either PastHorizonException b
</span><a href="#local-6989586621680015196"><span class="hs-identifier hs-var">tryEra</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015191"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Qry b
</span><a href="#local-6989586621680015188"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680015187"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>              </span><span class="annot"><span class="annottext">PastHorizonException -&gt; Either PastHorizonException b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(PastHorizonException -&gt; Either PastHorizonException b)
-&gt; PastHorizonException -&gt; Either PastHorizonException b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CallStack
-&gt; Some ClosedExpr -&gt; [EraSummary] -&gt; PastHorizonException
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizon"><span class="hs-identifier hs-var">PastHorizon</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
HasCallStack =&gt; CallStack
</span><span class="hs-identifier hs-var">callStack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosedExpr a -&gt; Some ClosedExpr
forall k (f :: k -&gt; *) (a :: k). f a -&gt; Some f
</span><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-var">Some</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedExpr a
</span><a href="#local-6989586621680015189"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; [EraSummary]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015200"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span id="local-6989586621680015182"><span id="local-6989586621680015183"><span id="local-6989586621680015184"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier hs-type">runQueryThrow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015183"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015182"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680015184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015183"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-400"></span><span id="runQueryThrow"><span class="annot"><span class="annottext">runQueryThrow :: Qry a -&gt; Summary xs -&gt; m a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier hs-var hs-var">runQueryThrow</span></a></span></span><span> </span><span id="local-6989586621680015181"><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015181"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PastHorizonException -&gt; m a)
-&gt; (a -&gt; m a) -&gt; Either PastHorizonException a -&gt; m a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; m a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either PastHorizonException a -&gt; m a)
-&gt; (Summary xs -&gt; Either PastHorizonException a)
-&gt; Summary xs
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
forall a (xs :: [*]).
HasCallStack =&gt;
Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015181"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span id="local-6989586621680015177"><span id="local-6989586621680015178"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier hs-type">runQueryPure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015178"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015177"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680015178"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-403"></span><span id="runQueryPure"><span class="annot"><span class="annottext">runQueryPure :: Qry a -&gt; Summary xs -&gt; a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier hs-var hs-var">runQueryPure</span></a></span></span><span> </span><span id="local-6989586621680015176"><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015176"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PastHorizonException -&gt; a)
-&gt; (a -&gt; a) -&gt; Either PastHorizonException a -&gt; a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; a
forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(Either PastHorizonException a -&gt; a)
-&gt; (Summary xs -&gt; Either PastHorizonException a) -&gt; Summary xs -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
forall a (xs :: [*]).
HasCallStack =&gt;
Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015176"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Interpreter
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="hs-comment">-- | Can be sent across the LocalStateQuery protocol to interpret queries in</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- the wallet.</span><span>
</span><span id="line-411"></span><span class="hs-comment">--</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- The 'Summary' should be considered internal.</span><span>
</span><span id="line-413"></span><span class="hs-keyword">newtype</span><span> </span><span id="Interpreter"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a></span></span><span> </span><span id="local-6989586621680015539"><span class="annot"><a href="#local-6989586621680015539"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Interpreter"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015539"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680015170"><span id="local-6989586621680015172"><span class="annot"><span class="annottext">Interpreter xs -&gt; Interpreter xs -&gt; Bool
(Interpreter xs -&gt; Interpreter xs -&gt; Bool)
-&gt; (Interpreter xs -&gt; Interpreter xs -&gt; Bool)
-&gt; Eq (Interpreter xs)
forall (xs :: [*]). Interpreter xs -&gt; Interpreter xs -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Interpreter xs -&gt; Interpreter xs -&gt; Bool
$c/= :: forall (xs :: [*]). Interpreter xs -&gt; Interpreter xs -&gt; Bool
== :: Interpreter xs -&gt; Interpreter xs -&gt; Bool
$c== :: forall (xs :: [*]). Interpreter xs -&gt; Interpreter xs -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span id="local-6989586621680015160"><span id="local-6989586621680015162"><span id="local-6989586621680015164"><span id="local-6989586621680015166"><span id="local-6989586621680015168"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680015168"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015168"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span id="local-6989586621680015158"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680015153"><span id="local-6989586621680015156"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015158"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621680015152"><span class="annot"><span class="annottext">show :: Interpreter xs -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><span class="annottext">Interpreter xs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;Interpreter&gt;&quot;</span></span></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span id="local-6989586621680015150"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#mkInterpreter"><span class="hs-identifier hs-type">mkInterpreter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015150"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015150"><span class="hs-identifier hs-type">xs</span></a></span></span><span>
</span><span id="line-422"></span><span id="mkInterpreter"><span class="annot"><span class="annottext">mkInterpreter :: Summary xs -&gt; Interpreter xs
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#mkInterpreter"><span class="hs-identifier hs-var hs-var">mkInterpreter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Summary xs -&gt; Interpreter xs
forall (xs :: [*]). Summary xs -&gt; Interpreter xs
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span id="local-6989586621680015148"><span id="local-6989586621680015149"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#interpretQuery"><span class="hs-identifier hs-type">interpretQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-425"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015149"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015148"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015148"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-429"></span><span id="interpretQuery"><span class="annot"><span class="annottext">interpretQuery :: Interpreter xs -&gt; Qry a -&gt; Either PastHorizonException a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#interpretQuery"><span class="hs-identifier hs-var hs-var">interpretQuery</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span id="local-6989586621680015147"><span class="annot"><span class="annottext">Summary xs
</span><a href="#local-6989586621680015147"><span class="hs-identifier hs-var">summary</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680015146"><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015146"><span class="hs-identifier hs-var">qry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
forall a (xs :: [*]).
HasCallStack =&gt;
Qry a -&gt; Summary xs -&gt; Either PastHorizonException a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Qry a
</span><a href="#local-6989586621680015146"><span class="hs-identifier hs-var">qry</span></a></span><span> </span><span class="annot"><span class="annottext">Summary xs
</span><a href="#local-6989586621680015147"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- | UNSAFE: extend the safe zone of the current era of the given 'Interpreter'</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- to be /unbounded/, ignoring any future hard forks.</span><span>
</span><span id="line-433"></span><span class="hs-comment">--</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- This only has effect when the 'Interpreter' was obtained in an era that was</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- /not the final one/ (in the final era, this is a no-op). The 'Interpreter'</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- will be made to believe that the current era is the final era, making its</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- horizon unbounded, and thus never returning a 'PastHorizonException'.</span><span>
</span><span id="line-438"></span><span class="hs-comment">--</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- Use of this function is /strongly discouraged/, as it will ignore any future</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- hard forks, and the results produced by the 'Interpreter' can thus be</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- incorrect.</span><span>
</span><span id="line-442"></span><span id="local-6989586621680015145"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#unsafeExtendSafeZone"><span class="hs-identifier hs-type">unsafeExtendSafeZone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015145"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015145"><span class="hs-identifier hs-type">xs</span></a></span></span><span>
</span><span id="line-443"></span><span id="unsafeExtendSafeZone"><span class="annot"><span class="annottext">unsafeExtendSafeZone :: Interpreter xs -&gt; Interpreter xs
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var hs-var">unsafeExtendSafeZone</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a></span><span> </span><span id="local-6989586621680015144"><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015144"><span class="hs-identifier hs-var">eraSummaries</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><span class="annottext">Summary xs -&gt; Interpreter xs
forall (xs :: [*]). Summary xs -&gt; Interpreter xs
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; Summary xs
forall (xs :: [*]). NonEmpty xs EraSummary -&gt; Summary xs
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-var">Summary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; NonEmpty xs EraSummary
forall (xs' :: [*]).
NonEmpty xs' EraSummary -&gt; NonEmpty xs' EraSummary
</span><a href="#local-6989586621680015143"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015144"><span class="hs-identifier hs-var">eraSummaries</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621680015534"><span class="annot"><a href="#local-6989586621680015143"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015534"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015534"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621680015143"><span class="annot"><span class="annottext">go :: NonEmpty xs' EraSummary -&gt; NonEmpty xs' EraSummary
</span><a href="#local-6989586621680015143"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyCons"><span class="hs-identifier hs-type">NonEmptyCons</span></a></span><span> </span><span id="local-6989586621680015142"><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015142"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015141"><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015141"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraSummary
-&gt; NonEmpty xs EraSummary -&gt; NonEmpty (x : xs) EraSummary
forall a (xs :: [*]) x. a -&gt; NonEmpty xs a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyCons"><span class="hs-identifier hs-var">NonEmptyCons</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015142"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; NonEmpty xs EraSummary
forall (xs' :: [*]).
NonEmpty xs' EraSummary -&gt; NonEmpty xs' EraSummary
</span><a href="#local-6989586621680015143"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary
</span><a href="#local-6989586621680015141"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>    </span><span class="annot"><a href="#local-6989586621680015143"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-type">NonEmptyOne</span></a></span><span>  </span><span id="local-6989586621680015140"><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015140"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; NonEmpty (x : xs) EraSummary
forall a x (xs :: [*]). a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-var">NonEmptyOne</span></a></span><span>  </span><span class="annot"><span class="annottext">EraSummary
</span><a href="#local-6989586621680015140"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eraEnd :: EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraEnd"><span class="hs-identifier hs-var">eraEnd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraUnbounded"><span class="hs-identifier hs-var">EraUnbounded</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Specific queries

  The primed forms are the ones used in the 'EpochInfo' construction.
  Critically, they do not ask for any of the era parameters. This means that
  their valid range /includes/ the end bound.

  All of these queries are constructed so that they contain a single 'Expr'
  (which is therefore evaluated against a single era).
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">-- | Translate 'UTCTime' to 'SlotNo'</span><span>
</span><span id="line-462"></span><span class="hs-comment">--</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- Additionally returns the time spent and time left in this slot.</span><span>
</span><span id="line-464"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier hs-type">wallclockToSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span id="wallclockToSlot"><span class="annot"><span class="annottext">wallclockToSlot :: RelativeTime -&gt; Qry (SlotNo, NominalDiffTime, NominalDiffTime)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier hs-var hs-var">wallclockToSlot</span></a></span></span><span> </span><span id="local-6989586621680015139"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015139"><span class="hs-identifier hs-var">absTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">(TimeInSlot, (SlotNo, SlotLength))
-&gt; (SlotNo, NominalDiffTime, NominalDiffTime)
</span><a href="#local-6989586621680015138"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">((TimeInSlot, (SlotNo, SlotLength))
 -&gt; (SlotNo, NominalDiffTime, NominalDiffTime))
-&gt; Qry (TimeInSlot, (SlotNo, SlotLength))
-&gt; Qry (SlotNo, NominalDiffTime, NominalDiffTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; Qry (TimeInSlot, (SlotNo, SlotLength))
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelativeTime -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
forall (f :: * -&gt; *).
RelativeTime -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlotExpr"><span class="hs-identifier hs-var">wallclockToSlotExpr</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015139"><span class="hs-identifier hs-var">absTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><a href="#local-6989586621680015138"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>    </span><span id="local-6989586621680015138"><span class="annot"><span class="annottext">aux :: (TimeInSlot, (SlotNo, SlotLength))
-&gt; (SlotNo, NominalDiffTime, NominalDiffTime)
</span><a href="#local-6989586621680015138"><span class="hs-identifier hs-var hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span><span> </span><span id="local-6989586621680015136"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621680015136"><span class="hs-identifier hs-var">timeInSlot</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680015135"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015135"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680015134"><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621680015134"><span class="hs-identifier hs-var">slotLen</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015135"><span class="hs-identifier hs-var">absSlot</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621680015136"><span class="hs-identifier hs-var">timeInSlot</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotLength -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var hs-var">getSlotLength</span></span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621680015134"><span class="hs-identifier hs-var">slotLen</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621680015136"><span class="hs-identifier hs-var">timeInSlot</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">-- | Translate 'SlotNo' to the 'UTCTime' at the start of that slot</span><span>
</span><span id="line-477"></span><span class="hs-comment">--</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- Additionally returns the length of the slot.</span><span>
</span><span id="line-479"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier hs-type">slotToWallclock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span id="slotToWallclock"><span class="annot"><span class="annottext">slotToWallclock :: SlotNo -&gt; Qry (RelativeTime, SlotLength)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier hs-var hs-var">slotToWallclock</span></a></span></span><span> </span><span id="local-6989586621680015133"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015133"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f (RelativeTime, SlotLength))
-&gt; Qry (RelativeTime, SlotLength)
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f (RelativeTime, SlotLength)
forall (f :: * -&gt; *). SlotNo -&gt; Expr f (RelativeTime, SlotLength)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclockExpr"><span class="hs-identifier hs-var">slotToWallclockExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015133"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-comment">-- | Convert 'SlotNo' to 'EpochNo' and the relative slot within the epoch</span><span>
</span><span id="line-484"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier hs-type">slotToEpoch'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span id="slotToEpoch%27"><span class="annot"><span class="annottext">slotToEpoch' :: SlotNo -&gt; Qry (EpochNo, Word64)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier hs-var hs-var">slotToEpoch'</span></a></span></span><span> </span><span id="local-6989586621680015131"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015131"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><span class="annottext">(SlotInEpoch -&gt; Word64)
-&gt; (EpochNo, SlotInEpoch) -&gt; (EpochNo, Word64)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">SlotInEpoch -&gt; Word64
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEpoch"><span class="hs-identifier hs-var hs-var">getSlotInEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochNo, SlotInEpoch) -&gt; (EpochNo, Word64))
-&gt; Qry (EpochNo, SlotInEpoch) -&gt; Qry (EpochNo, Word64)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f (EpochNo, SlotInEpoch))
-&gt; Qry (EpochNo, SlotInEpoch)
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f (EpochNo, SlotInEpoch)
forall (f :: * -&gt; *). SlotNo -&gt; Expr f (EpochNo, SlotInEpoch)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier hs-var">slotToEpochExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015131"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="hs-comment">-- | Translate 'SlotNo' to its corresponding 'EpochNo'</span><span>
</span><span id="line-489"></span><span class="hs-comment">--</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- Additionally returns the relative slot within this epoch and how many</span><span>
</span><span id="line-491"></span><span class="hs-comment">-- slots are left in this slot.</span><span>
</span><span id="line-492"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier hs-type">slotToEpoch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span id="slotToEpoch"><span class="annot"><span class="annottext">slotToEpoch :: SlotNo -&gt; Qry (EpochNo, Word64, Word64)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier hs-var hs-var">slotToEpoch</span></a></span></span><span> </span><span id="local-6989586621680015128"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015128"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">((EpochNo, SlotInEpoch), EpochSize) -&gt; (EpochNo, Word64, Word64)
</span><a href="#local-6989586621680015127"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(((EpochNo, SlotInEpoch), EpochSize) -&gt; (EpochNo, Word64, Word64))
-&gt; Qry ((EpochNo, SlotInEpoch), EpochSize)
-&gt; Qry (EpochNo, Word64, Word64)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f ((EpochNo, SlotInEpoch), EpochSize))
-&gt; Qry ((EpochNo, SlotInEpoch), EpochSize)
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize)
forall (f :: * -&gt; *).
SlotNo -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr"><span class="hs-identifier hs-var">slotToEpochExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015128"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><a href="#local-6989586621680015127"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>    </span><span id="local-6989586621680015127"><span class="annot"><span class="annottext">aux :: ((EpochNo, SlotInEpoch), EpochSize) -&gt; (EpochNo, Word64, Word64)
</span><a href="#local-6989586621680015127"><span class="hs-identifier hs-var hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680015125"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015125"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span> </span><span id="local-6989586621680015124"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680015124"><span class="hs-identifier hs-var">slotInEpoch</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680015123"><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621680015123"><span class="hs-identifier hs-var">epochSize</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-499"></span><span>          </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015125"><span class="hs-identifier hs-var">absEpoch</span></a></span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680015124"><span class="hs-identifier hs-var">slotInEpoch</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EpochSize -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">unEpochSize</span></span><span> </span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621680015123"><span class="hs-identifier hs-var">epochSize</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680015124"><span class="hs-identifier hs-var">slotInEpoch</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier hs-type">epochToSlot'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-505"></span><span id="epochToSlot%27"><span class="annot"><span class="annottext">epochToSlot' :: EpochNo -&gt; Qry SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier hs-var hs-var">epochToSlot'</span></a></span></span><span> </span><span id="local-6989586621680015122"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015122"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f SlotNo) -&gt; Qry SlotNo
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f SlotNo
forall (f :: * -&gt; *). EpochNo -&gt; Expr f SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier hs-var">epochToSlotExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015122"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-comment">-- | Translate 'EpochNo' to the 'SlotNo' of the first slot in that epoch</span><span>
</span><span id="line-509"></span><span class="hs-comment">--</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- Additionally returns the size of the epoch.</span><span>
</span><span id="line-511"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier hs-type">epochToSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span id="epochToSlot"><span class="annot"><span class="annottext">epochToSlot :: EpochNo -&gt; Qry (SlotNo, EpochSize)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier hs-var hs-var">epochToSlot</span></a></span></span><span> </span><span id="local-6989586621680015120"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015120"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f (SlotNo, EpochSize))
-&gt; Qry (SlotNo, EpochSize)
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f (SlotNo, EpochSize)
forall (f :: * -&gt; *). EpochNo -&gt; Expr f (SlotNo, EpochSize)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr"><span class="hs-identifier hs-var">epochToSlotExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015120"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSize"><span class="hs-identifier hs-type">epochToSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span><span>
</span><span id="line-516"></span><span id="epochToSize"><span class="annot"><span class="annottext">epochToSize :: EpochNo -&gt; Qry EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSize"><span class="hs-identifier hs-var hs-var">epochToSize</span></a></span></span><span> </span><span id="local-6989586621680015118"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015118"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *). Expr f EpochSize) -&gt; Qry EpochSize
forall a. (forall (f :: * -&gt; *). Expr f a) -&gt; Qry a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f EpochSize
forall (f :: * -&gt; *). EpochNo -&gt; Expr f EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier hs-var">epochToSizeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015118"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Supporting expressions for the queries above
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span id="local-6989586621680015520"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlotExpr"><span class="hs-identifier hs-type">wallclockToSlotExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015520"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-524"></span><span id="wallclockToSlotExpr"><span class="annot"><span class="annottext">wallclockToSlotExpr :: RelativeTime -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlotExpr"><span class="hs-identifier hs-var hs-var">wallclockToSlotExpr</span></a></span></span><span> </span><span id="local-6989586621680015116"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015116"><span class="hs-identifier hs-var">absTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><span class="annottext">Expr f (SlotInEra, TimeInSlot)
-&gt; (f (SlotInEra, TimeInSlot)
    -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
forall (f :: * -&gt; *) a b. Expr f a -&gt; (f a -&gt; Expr f b) -&gt; Expr f b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f TimeInEra -&gt; Expr f (SlotInEra, TimeInSlot)
forall (f :: * -&gt; *).
Expr f TimeInEra -&gt; Expr f (SlotInEra, TimeInSlot)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-var">ERelTimeToSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f RelativeTime -&gt; Expr f TimeInEra
forall (f :: * -&gt; *). Expr f RelativeTime -&gt; Expr f TimeInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-var">EAbsToRelTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelativeTime -&gt; Expr f RelativeTime
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680015116"><span class="hs-identifier hs-var">absTime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((f (SlotInEra, TimeInSlot)
  -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
 -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; (f (SlotInEra, TimeInSlot)
    -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015115"><span class="annot"><span class="annottext">f (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015115"><span class="hs-identifier hs-var">relSlot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><span class="annottext">Expr f SlotNo
-&gt; (f SlotNo -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
forall (f :: * -&gt; *) a b. Expr f a -&gt; (f a -&gt; Expr f b) -&gt; Expr f b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f (SlotInEra, TimeInSlot) -&gt; Expr f SlotNo
forall (f :: * -&gt; *).
Expr f (SlotInEra, TimeInSlot) -&gt; Expr f SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (SlotInEra, TimeInSlot) -&gt; Expr f (SlotInEra, TimeInSlot)
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015115"><span class="hs-identifier hs-var">relSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((f SlotNo -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
 -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; (f SlotNo -&gt; Expr f (TimeInSlot, (SlotNo, SlotLength)))
-&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015114"><span class="annot"><span class="annottext">f SlotNo
</span><a href="#local-6989586621680015114"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">Expr f TimeInSlot
-&gt; Expr f (SlotNo, SlotLength)
-&gt; Expr f (TimeInSlot, (SlotNo, SlotLength))
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f (SlotInEra, TimeInSlot) -&gt; Expr f TimeInSlot
forall (f :: * -&gt; *) a b. Expr f (a, b) -&gt; Expr f b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (SlotInEra, TimeInSlot) -&gt; Expr f (SlotInEra, TimeInSlot)
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015115"><span class="hs-identifier hs-var">relSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotNo -&gt; Expr f SlotLength -&gt; Expr f (SlotNo, SlotLength)
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f SlotNo -&gt; Expr f SlotNo
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f SlotNo
</span><a href="#local-6989586621680015114"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotNo -&gt; Expr f SlotLength
forall (f :: * -&gt; *). Expr f SlotNo -&gt; Expr f SlotLength
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f SlotNo -&gt; Expr f SlotNo
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f SlotNo
</span><a href="#local-6989586621680015114"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span id="local-6989586621680015518"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclockExpr"><span class="hs-identifier hs-type">slotToWallclockExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015518"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-531"></span><span id="slotToWallclockExpr"><span class="annot"><span class="annottext">slotToWallclockExpr :: SlotNo -&gt; Expr f (RelativeTime, SlotLength)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclockExpr"><span class="hs-identifier hs-var hs-var">slotToWallclockExpr</span></a></span></span><span> </span><span id="local-6989586621680015113"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015113"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="annottext">Expr f RelativeTime
-&gt; Expr f SlotLength -&gt; Expr f (RelativeTime, SlotLength)
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f TimeInEra -&gt; Expr f RelativeTime
forall (f :: * -&gt; *). Expr f TimeInEra -&gt; Expr f RelativeTime
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-var">ERelToAbsTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotInEra -&gt; Expr f TimeInEra
forall (f :: * -&gt; *). Expr f SlotInEra -&gt; Expr f TimeInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-var">ERelSlotToTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotNo -&gt; Expr f SlotInEra
forall (f :: * -&gt; *). Expr f SlotNo -&gt; Expr f SlotInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f SlotNo
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015113"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotNo -&gt; Expr f SlotLength
forall (f :: * -&gt; *). Expr f SlotNo -&gt; Expr f SlotLength
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f SlotNo
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015113"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span id="local-6989586621680015513"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier hs-type">slotToEpochExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015513"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-537"></span><span id="slotToEpochExpr%27"><span class="annot"><span class="annottext">slotToEpochExpr' :: SlotNo -&gt; Expr f (EpochNo, SlotInEpoch)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier hs-var hs-var">slotToEpochExpr'</span></a></span></span><span> </span><span id="local-6989586621680015112"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015112"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-538"></span><span>    </span><span class="annot"><span class="annottext">Expr f (EpochInEra, SlotInEpoch)
-&gt; (f (EpochInEra, SlotInEpoch) -&gt; Expr f (EpochNo, SlotInEpoch))
-&gt; Expr f (EpochNo, SlotInEpoch)
forall (f :: * -&gt; *) a b. Expr f a -&gt; (f a -&gt; Expr f b) -&gt; Expr f b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotInEra -&gt; Expr f (EpochInEra, SlotInEpoch)
forall (f :: * -&gt; *).
Expr f SlotInEra -&gt; Expr f (EpochInEra, SlotInEpoch)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-var">ERelSlotToEpoch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotNo -&gt; Expr f SlotInEra
forall (f :: * -&gt; *). Expr f SlotNo -&gt; Expr f SlotInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f SlotNo
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015112"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((f (EpochInEra, SlotInEpoch) -&gt; Expr f (EpochNo, SlotInEpoch))
 -&gt; Expr f (EpochNo, SlotInEpoch))
-&gt; (f (EpochInEra, SlotInEpoch) -&gt; Expr f (EpochNo, SlotInEpoch))
-&gt; Expr f (EpochNo, SlotInEpoch)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015111"><span class="annot"><span class="annottext">f (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015111"><span class="hs-identifier hs-var">epochSlot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><span class="annottext">Expr f EpochNo
-&gt; Expr f SlotInEpoch -&gt; Expr f (EpochNo, SlotInEpoch)
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f (EpochInEra, SlotInEpoch) -&gt; Expr f EpochNo
forall (f :: * -&gt; *).
Expr f (EpochInEra, SlotInEpoch) -&gt; Expr f EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-var">ERelToAbsEpoch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (EpochInEra, SlotInEpoch) -&gt; Expr f (EpochInEra, SlotInEpoch)
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015111"><span class="hs-identifier hs-var">epochSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f (EpochInEra, SlotInEpoch) -&gt; Expr f SlotInEpoch
forall (f :: * -&gt; *) a b. Expr f (a, b) -&gt; Expr f b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (EpochInEra, SlotInEpoch) -&gt; Expr f (EpochInEra, SlotInEpoch)
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015111"><span class="hs-identifier hs-var">epochSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span id="local-6989586621680015511"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr"><span class="hs-identifier hs-type">slotToEpochExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-542"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015511"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-544"></span><span id="slotToEpochExpr"><span class="annot"><span class="annottext">slotToEpochExpr :: SlotNo -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr"><span class="hs-identifier hs-var hs-var">slotToEpochExpr</span></a></span></span><span> </span><span id="local-6989586621680015110"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015110"><span class="hs-identifier hs-var">absSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-545"></span><span>    </span><span class="annot"><span class="annottext">Expr f (EpochNo, SlotInEpoch)
-&gt; (f (EpochNo, SlotInEpoch)
    -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize))
-&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize)
forall (f :: * -&gt; *) a b. Expr f a -&gt; (f a -&gt; Expr f b) -&gt; Expr f b
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Expr f (EpochNo, SlotInEpoch)
forall (f :: * -&gt; *). SlotNo -&gt; Expr f (EpochNo, SlotInEpoch)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier hs-var">slotToEpochExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680015110"><span class="hs-identifier hs-var">absSlot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((f (EpochNo, SlotInEpoch)
  -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize))
 -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize))
-&gt; (f (EpochNo, SlotInEpoch)
    -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize))
-&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015109"><span class="annot"><span class="annottext">f (EpochNo, SlotInEpoch)
</span><a href="#local-6989586621680015109"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><span class="annottext">Expr f (EpochNo, SlotInEpoch)
-&gt; Expr f EpochSize -&gt; Expr f ((EpochNo, SlotInEpoch), EpochSize)
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (EpochNo, SlotInEpoch) -&gt; Expr f (EpochNo, SlotInEpoch)
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f (EpochNo, SlotInEpoch)
</span><a href="#local-6989586621680015109"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f EpochNo -&gt; Expr f EpochSize
forall (f :: * -&gt; *). Expr f EpochNo -&gt; Expr f EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f (EpochNo, SlotInEpoch) -&gt; Expr f EpochNo
forall (f :: * -&gt; *) a b. Expr f (a, b) -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-var">EFst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (EpochNo, SlotInEpoch) -&gt; Expr f (EpochNo, SlotInEpoch)
forall (f :: * -&gt; *) a. f a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a></span><span> </span><span class="annot"><span class="annottext">f (EpochNo, SlotInEpoch)
</span><a href="#local-6989586621680015109"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span id="local-6989586621680015509"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier hs-type">epochToSlotExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015509"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span></span><span>
</span><span id="line-549"></span><span id="epochToSlotExpr%27"><span class="annot"><span class="annottext">epochToSlotExpr' :: EpochNo -&gt; Expr f SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier hs-var hs-var">epochToSlotExpr'</span></a></span></span><span> </span><span id="local-6989586621680015108"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015108"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><span class="annottext">Expr f (SlotInEra, TimeInSlot) -&gt; Expr f SlotNo
forall (f :: * -&gt; *).
Expr f (SlotInEra, TimeInSlot) -&gt; Expr f SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f SlotInEra
-&gt; Expr f TimeInSlot -&gt; Expr f (SlotInEra, TimeInSlot)
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f EpochInEra -&gt; Expr f SlotInEra
forall (f :: * -&gt; *). Expr f EpochInEra -&gt; Expr f SlotInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-var">ERelEpochToSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr f EpochNo -&gt; Expr f EpochInEra
forall (f :: * -&gt; *). Expr f EpochNo -&gt; Expr f EpochInEra
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-var">EAbsToRelEpoch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f EpochNo
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015108"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInSlot -&gt; Expr f TimeInSlot
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; TimeInSlot
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span id="local-6989586621680015507"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr"><span class="hs-identifier hs-type">epochToSlotExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015507"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-554"></span><span id="epochToSlotExpr"><span class="annot"><span class="annottext">epochToSlotExpr :: EpochNo -&gt; Expr f (SlotNo, EpochSize)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr"><span class="hs-identifier hs-var hs-var">epochToSlotExpr</span></a></span></span><span> </span><span id="local-6989586621680015107"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015107"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>    </span><span class="annot"><span class="annottext">Expr f SlotNo -&gt; Expr f EpochSize -&gt; Expr f (SlotNo, EpochSize)
forall (f :: * -&gt; *) a b. Expr f a -&gt; Expr f b -&gt; Expr f (a, b)
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f SlotNo
forall (f :: * -&gt; *). EpochNo -&gt; Expr f SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier hs-var">epochToSlotExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015107"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f EpochSize
forall (f :: * -&gt; *). EpochNo -&gt; Expr f EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier hs-var">epochToSizeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015107"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span id="local-6989586621680015505"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier hs-type">epochToSizeExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015505"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochSize</span></span></span><span>
</span><span id="line-558"></span><span id="epochToSizeExpr"><span class="annot"><span class="annottext">epochToSizeExpr :: EpochNo -&gt; Expr f EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier hs-var hs-var">epochToSizeExpr</span></a></span></span><span> </span><span id="local-6989586621680015106"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015106"><span class="hs-identifier hs-var">absEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><span class="annottext">Expr f EpochNo -&gt; Expr f EpochSize
forall (f :: * -&gt; *). Expr f EpochNo -&gt; Expr f EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; Expr f EpochNo
forall a (f :: * -&gt; *). Show a =&gt; a -&gt; Expr f a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680015106"><span class="hs-identifier hs-var">absEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  'Show' instances
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="hs-keyword">newtype</span><span> </span><span id="Var"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-var">Var</span></a></span></span><span> </span><span id="local-6989586621680015462"><span class="annot"><a href="#local-6989586621680015462"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Var"><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-var">Var</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680015099"><span id="local-6989586621680015101"><span id="local-6989586621680015103"><span class="annot"><span class="annottext">Int -&gt; Var a -&gt; ShowS
[Var a] -&gt; ShowS
Var a -&gt; String
(Int -&gt; Var a -&gt; ShowS)
-&gt; (Var a -&gt; String) -&gt; ([Var a] -&gt; ShowS) -&gt; Show (Var a)
forall a. Int -&gt; Var a -&gt; ShowS
forall a. [Var a] -&gt; ShowS
forall a. Var a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Var a] -&gt; ShowS
$cshowList :: forall a. [Var a] -&gt; ShowS
show :: Var a -&gt; String
$cshow :: forall a. Var a -&gt; String
showsPrec :: Int -&gt; Var a -&gt; ShowS
$cshowsPrec :: forall a. Int -&gt; Var a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span id="local-6989586621680015093"><span id="local-6989586621680015095"><span id="local-6989586621680015097"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-type">Some</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span id="local-6989586621680015092"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680015087"><span id="local-6989586621680015089"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015092"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-571"></span><span>  </span><span id="local-6989586621680015086"><span class="annot"><span class="annottext">showsPrec :: Int -&gt; ClosedExpr a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">showsPrec</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680015084"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015084"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a></span><span> </span><span id="local-6989586621680015083"><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Expr f a
</span><a href="#local-6989586621680015083"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var a -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015084"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var a
forall (f :: * -&gt; *). Expr f a
</span><a href="#local-6989586621680015083"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-573"></span><span>      </span><span id="local-6989586621680015466"><span class="annot"><a href="#local-6989586621680015082"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- How many variables are already in scope?</span><span>
</span><span id="line-574"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- Precedence</span><span>
</span><span id="line-575"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680015466"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShowS</span></span></span><span>
</span><span id="line-576"></span><span>      </span><span id="local-6989586621680015082"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680015081"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680015080"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015080"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><span class="hs-identifier hs-var">showParen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015080"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; ShowS) -&gt; (Expr Var b -&gt; ShowS) -&gt; Expr Var b -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>          </span><span class="hs-comment">-- Variables and let-binding</span><span>
</span><span id="line-579"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-580"></span><span>          </span><span class="hs-comment">-- We recover Haskell syntax here, e.g.</span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-582"></span><span>          </span><span class="hs-comment">-- &gt; ELet .. (\x -&gt; .... x ....)</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-type">EVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680015078"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680015078"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EVar &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680015078"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-585"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-type">ELet</span></a></span><span> </span><span id="local-6989586621680015076"><span class="annot"><span class="annottext">Expr Var a
</span><a href="#local-6989586621680015076"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015075"><span class="annot"><span class="annottext">Var a -&gt; Expr Var b
</span><a href="#local-6989586621680015075"><span class="hs-identifier hs-var">f</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680015074"><span class="annot"><span class="annottext">x :: String
</span><a href="#local-6989586621680015074"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-586"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ELet &quot;</span></span><span>
</span><span id="line-587"></span><span>                        </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var a -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var a
</span><a href="#local-6989586621680015076"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-588"></span><span>                        </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; (\\&quot;</span></span><span>
</span><span id="line-589"></span><span>                        </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680015074"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-590"></span><span>                        </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; -&gt; &quot;</span></span><span>
</span><span id="line-591"></span><span>                        </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var a -&gt; Expr Var b
</span><a href="#local-6989586621680015075"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var a
forall a. String -&gt; Var a
</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680015074"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>                        </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>          </span><span class="hs-comment">-- Literals</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-type">ELit</span></a></span><span> </span><span id="local-6989586621680015072"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680015072"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ELit &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680015072"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span>          </span><span class="hs-comment">-- Pairs</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-type">EPair</span></a></span><span> </span><span id="local-6989586621680015071"><span class="annot"><span class="annottext">Expr Var a
</span><a href="#local-6989586621680015071"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680015070"><span class="annot"><span class="annottext">Expr Var b
</span><a href="#local-6989586621680015070"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EPair &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var a -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var a
</span><a href="#local-6989586621680015071"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">showSpace</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var b
</span><a href="#local-6989586621680015070"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-601"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-type">EFst</span></a></span><span>  </span><span id="local-6989586621680015069"><span class="annot"><span class="annottext">Expr Var (b, b)
</span><a href="#local-6989586621680015069"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EFst &quot;</span></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var (b, b) -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var (b, b)
</span><a href="#local-6989586621680015069"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-602"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-type">ESnd</span></a></span><span>  </span><span id="local-6989586621680015068"><span class="annot"><span class="annottext">Expr Var (a, b)
</span><a href="#local-6989586621680015068"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ESnd &quot;</span></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var (a, b) -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var (a, b)
</span><a href="#local-6989586621680015068"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>          </span><span class="hs-comment">-- Domain specific</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-type">EAbsToRelTime</span></a></span><span>   </span><span id="local-6989586621680015067"><span class="annot"><span class="annottext">Expr Var RelativeTime
</span><a href="#local-6989586621680015067"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EAbsToRelTime &quot;</span></span><span>   </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var RelativeTime -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var RelativeTime
</span><a href="#local-6989586621680015067"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-607"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-type">EAbsToRelSlot</span></a></span><span>   </span><span id="local-6989586621680015066"><span class="annot"><span class="annottext">Expr Var SlotNo
</span><a href="#local-6989586621680015066"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EAbsToRelSlot &quot;</span></span><span>   </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var SlotNo -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var SlotNo
</span><a href="#local-6989586621680015066"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-608"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-type">EAbsToRelEpoch</span></a></span><span>  </span><span id="local-6989586621680015065"><span class="annot"><span class="annottext">Expr Var EpochNo
</span><a href="#local-6989586621680015065"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EAbsToRelEpoch &quot;</span></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var EpochNo -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var EpochNo
</span><a href="#local-6989586621680015065"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-609"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-type">ERelToAbsTime</span></a></span><span>   </span><span id="local-6989586621680015064"><span class="annot"><span class="annottext">Expr Var TimeInEra
</span><a href="#local-6989586621680015064"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelToAbsTime &quot;</span></span><span>   </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var TimeInEra -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var TimeInEra
</span><a href="#local-6989586621680015064"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-610"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-type">ERelToAbsSlot</span></a></span><span>   </span><span id="local-6989586621680015063"><span class="annot"><span class="annottext">Expr Var (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015063"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelToAbsSlot &quot;</span></span><span>   </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var (SlotInEra, TimeInSlot) -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var (SlotInEra, TimeInSlot)
</span><a href="#local-6989586621680015063"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-611"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-type">ERelToAbsEpoch</span></a></span><span>  </span><span id="local-6989586621680015062"><span class="annot"><span class="annottext">Expr Var (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015062"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelToAbsEpoch &quot;</span></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var (EpochInEra, SlotInEpoch) -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var (EpochInEra, SlotInEpoch)
</span><a href="#local-6989586621680015062"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-612"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-type">ERelTimeToSlot</span></a></span><span>  </span><span id="local-6989586621680015061"><span class="annot"><span class="annottext">Expr Var TimeInEra
</span><a href="#local-6989586621680015061"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelTimeToSlot &quot;</span></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var TimeInEra -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var TimeInEra
</span><a href="#local-6989586621680015061"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-613"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-type">ERelSlotToTime</span></a></span><span>  </span><span id="local-6989586621680015060"><span class="annot"><span class="annottext">Expr Var SlotInEra
</span><a href="#local-6989586621680015060"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelSlotToTime &quot;</span></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var SlotInEra -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var SlotInEra
</span><a href="#local-6989586621680015060"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-614"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-type">ERelSlotToEpoch</span></a></span><span> </span><span id="local-6989586621680015059"><span class="annot"><span class="annottext">Expr Var SlotInEra
</span><a href="#local-6989586621680015059"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelSlotToEpoch &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var SlotInEra -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var SlotInEra
</span><a href="#local-6989586621680015059"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-615"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-type">ERelEpochToSlot</span></a></span><span> </span><span id="local-6989586621680015058"><span class="annot"><span class="annottext">Expr Var EpochInEra
</span><a href="#local-6989586621680015058"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERelEpochToSlot &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var EpochInEra -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var EpochInEra
</span><a href="#local-6989586621680015058"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-616"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-type">ESlotLength</span></a></span><span>     </span><span id="local-6989586621680015057"><span class="annot"><span class="annottext">Expr Var SlotNo
</span><a href="#local-6989586621680015057"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ESlotLength &quot;</span></span><span>     </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var SlotNo -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var SlotNo
</span><a href="#local-6989586621680015057"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-617"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-type">EEpochSize</span></a></span><span>      </span><span id="local-6989586621680015056"><span class="annot"><span class="annottext">Expr Var EpochNo
</span><a href="#local-6989586621680015056"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EEpochSize &quot;</span></span><span>      </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Expr Var EpochNo -&gt; ShowS
forall b. Int -&gt; Int -&gt; Expr Var b -&gt; ShowS
</span><a href="#local-6989586621680015082"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680015081"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Expr Var EpochNo
</span><a href="#local-6989586621680015056"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-618"></span></pre></body></html>