<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE EmptyCase           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State.Infra</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Initialization</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#initHardForkState"><span class="hs-identifier">initHardForkState</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Lifting 'Telescope' operations</span></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#fromTZ"><span class="hs-identifier">fromTZ</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#match"><span class="hs-identifier">match</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#sequence"><span class="hs-identifier">sequence</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#tip"><span class="hs-identifier">tip</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Situated</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier">Situated</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#situate"><span class="hs-identifier">situate</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Aligning</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#align"><span class="hs-identifier">align</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * EpochInfo/Summary</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#reconstructSummary"><span class="hs-identifier">reconstructSummary</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">sequence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Data.Functor.Product</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.SOP.Strict.html"><span class="hs-identifier">Data.SOP.Strict</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shape</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier">Bound</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier">EraEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier">EraParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier">EraSummary</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#SafeZone"><span class="hs-identifier">SafeZone</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">History</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Counting</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Lift.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State.Lift</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State.Types</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier">InPairs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Requiring"><span class="hs-identifier">Requiring</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InPairs</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Match</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html#Mismatch"><span class="hs-identifier">Mismatch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Match</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Match</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Telescope</span></a></span><span>
</span><span id="line-49"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier">Extend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Telescope</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Telescope</span></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Initialization
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621680009608"><span id="local-6989586621680009609"><span id="local-6989586621680009610"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#initHardForkState"><span class="hs-identifier hs-type">initHardForkState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680009610"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009609"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009610"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009609"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009608"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-57"></span><span id="initHardForkState"><span class="annot"><span class="annottext">initHardForkState :: f x -&gt; HardForkState f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#initHardForkState"><span class="hs-identifier hs-var hs-var">initHardForkState</span></a></span></span><span> </span><span id="local-6989586621680009607"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680009607"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) (x : xs) -&gt; HardForkState f (x : xs)
forall (f :: * -&gt; *) (xs :: [*]).
Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-var">HardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current f) (x : xs)
 -&gt; HardForkState f (x : xs))
-&gt; Telescope (K Past) (Current f) (x : xs)
-&gt; HardForkState f (x : xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Current f x -&gt; Telescope (K Past) (Current f) (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="annot"><span class="annottext">(Current f x -&gt; Telescope (K Past) (Current f) (x : xs))
-&gt; Current f x -&gt; Telescope (K Past) (Current f) (x : xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Current :: forall (f :: * -&gt; *) blk. Bound -&gt; f blk -&gt; Current f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">currentStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentStart"><span class="hs-identifier hs-var">currentStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#initBound"><span class="hs-identifier hs-var">History.initBound</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentState :: f x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680009607"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Lift telescope operations
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span id="local-6989586621680009599"><span id="local-6989586621680009600"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#tip"><span class="hs-identifier hs-type">tip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680009600"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009599"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009600"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009599"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009600"><span class="hs-identifier hs-type">xs</span></a></span></span></span><span>
</span><span id="line-67"></span><span id="tip"><span class="annot"><span class="annottext">tip :: HardForkState f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#tip"><span class="hs-identifier hs-var hs-var">tip</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span id="local-6989586621680009598"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009598"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. Current f a -&gt; f a) -&gt; NS (Current f) xs -&gt; NS f xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Current f a -&gt; f a
forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var hs-var">currentState</span></a></span><span> </span><span class="annot"><span class="annottext">(NS (Current f) xs -&gt; NS f xs) -&gt; NS (Current f) xs -&gt; NS f xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs -&gt; NS (Current f) xs
forall k (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
Telescope g f xs -&gt; NS f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#tip"><span class="hs-identifier hs-var">Telescope.tip</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009598"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621680009593"><span id="local-6989586621680009594"><span id="local-6989586621680009595"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#match"><span class="hs-identifier hs-type">match</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680009595"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009594"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009595"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009593"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009595"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html#Mismatch"><span class="hs-identifier hs-type">Mismatch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009594"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009593"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009595"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009594"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009593"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009595"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-73"></span><span id="match"><span class="annot"><span class="annottext">match :: NS h xs
-&gt; HardForkState f xs
-&gt; Either
     (Mismatch h (Current f) xs) (HardForkState (Product h f) xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#match"><span class="hs-identifier hs-var hs-var">match</span></a></span></span><span> </span><span id="local-6989586621680009592"><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009592"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span id="local-6989586621680009591"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009591"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">Telescope (K Past) (Current (Product h f)) xs
-&gt; HardForkState (Product h f) xs
forall (f :: * -&gt; *) (xs :: [*]).
Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-var">HardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current (Product h f)) xs
 -&gt; HardForkState (Product h f) xs)
-&gt; (Telescope (K Past) (Product h (Current f)) xs
    -&gt; Telescope (K Past) (Current (Product h f)) xs)
-&gt; Telescope (K Past) (Product h (Current f)) xs
-&gt; HardForkState (Product h f) xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(forall a. Product h (Current f) a -&gt; Current (Product h f) a)
-&gt; Telescope (K Past) (Product h (Current f)) xs
-&gt; Telescope (K Past) (Current (Product h f)) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Product h (Current f) a -&gt; Current (Product h f) a
forall (h :: * -&gt; *) (f :: * -&gt; *) blk.
Product h (Current f) blk -&gt; Current (Product h f) blk
</span><a href="#local-6989586621680009589"><span class="hs-identifier hs-var">distrib</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Product h (Current f)) xs
 -&gt; HardForkState (Product h f) xs)
-&gt; Either
     (Mismatch h (Current f) xs)
     (Telescope (K Past) (Product h (Current f)) xs)
-&gt; Either
     (Mismatch h (Current f) xs) (HardForkState (Product h f) xs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NS h xs
-&gt; Telescope (K Past) (Current f) xs
-&gt; Either
     (Mismatch h (Current f) xs)
     (Telescope (K Past) (Product h (Current f)) xs)
forall k (h :: k -&gt; *) (xs :: [k]) (g :: k -&gt; *) (f :: k -&gt; *).
NS h xs
-&gt; Telescope g f xs
-&gt; Either (Mismatch h f xs) (Telescope g (Product h f) xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Match.html#matchTelescope"><span class="hs-identifier hs-var">Match.matchTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009592"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009591"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621680009822"><span id="local-6989586621680009823"><span id="local-6989586621680009824"><span class="annot"><a href="#local-6989586621680009589"><span class="hs-identifier hs-type">distrib</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009824"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009823"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009822"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009824"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009823"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009822"><span class="hs-identifier hs-type">blk</span></a></span></span></span></span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621680009589"><span class="annot"><span class="annottext">distrib :: Product h (Current f) blk -&gt; Current (Product h f) blk
</span><a href="#local-6989586621680009589"><span class="hs-identifier hs-var hs-var">distrib</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621680009585"><span class="annot"><span class="annottext">h blk
</span><a href="#local-6989586621680009585"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span id="local-6989586621680009584"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009584"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621680009583"><span class="annot"><span class="annottext">f blk
</span><a href="#local-6989586621680009583"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">Bound -&gt; Product h f blk -&gt; Current (Product h f) blk
forall (f :: * -&gt; *) blk. Bound -&gt; f blk -&gt; Current f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-var">Current</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009584"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">h blk -&gt; f blk -&gt; Product h f blk
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product f g a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">h blk
</span><a href="#local-6989586621680009585"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">f blk
</span><a href="#local-6989586621680009583"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#sequence"><span class="hs-identifier hs-type">sequence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680009582"><span class="annot"><a href="#local-6989586621680009582"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680009581"><span class="annot"><a href="#local-6989586621680009581"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680009580"><span class="annot"><a href="#local-6989586621680009580"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SListI</span></span><span> </span><span class="annot"><a href="#local-6989586621680009580"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009581"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009581"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680009582"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009580"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680009581"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009582"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009580"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span id="sequence"><span class="annot"><span class="annottext">sequence :: HardForkState (m :.: f) xs -&gt; m (HardForkState f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#sequence"><span class="hs-identifier hs-var hs-var">sequence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span id="local-6989586621680009579"><span class="annot"><span class="annottext">Telescope (K Past) (Current (m :.: f)) xs
</span><a href="#local-6989586621680009579"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
forall (f :: * -&gt; *) (xs :: [*]).
Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-var">HardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current f) xs -&gt; HardForkState f xs)
-&gt; m (Telescope (K Past) (Current f) xs) -&gt; m (HardForkState f xs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">Telescope (K Past) (m :.: Current f) xs
-&gt; m (Telescope (K Past) (Current f) xs)
forall k (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *) (xs :: [k]).
Functor m =&gt;
Telescope g (m :.: f) xs -&gt; m (Telescope g f xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#sequence"><span class="hs-identifier hs-var">Telescope.sequence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a. Current (m :.: f) a -&gt; (:.:) m (Current f) a)
-&gt; Telescope (K Past) (Current (m :.: f)) xs
-&gt; Telescope (K Past) (m :.: Current f) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Current (m :.: f) a -&gt; (:.:) m (Current f) a
</span><a href="#local-6989586621680009577"><span class="hs-identifier hs-var">distrib</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current (m :.: f)) xs
</span><a href="#local-6989586621680009579"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621680009576"><span class="annot"><a href="#local-6989586621680009577"><span class="hs-identifier hs-type">distrib</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009581"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="#local-6989586621680009582"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009576"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009581"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009582"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009576"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621680009577"><span class="annot"><span class="annottext">distrib :: Current (m :.: f) blk -&gt; (:.:) m (Current f) blk
</span><a href="#local-6989586621680009577"><span class="hs-identifier hs-var hs-var">distrib</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span id="local-6989586621680009575"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009575"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621680009574"><span class="annot"><span class="annottext">(:.:) m f blk
</span><a href="#local-6989586621680009574"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Current f blk) -&gt; (:.:) m (Current f) blk
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(m (Current f blk) -&gt; (:.:) m (Current f) blk)
-&gt; m (Current f blk) -&gt; (:.:) m (Current f) blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">Bound -&gt; f blk -&gt; Current f blk
forall (f :: * -&gt; *) blk. Bound -&gt; f blk -&gt; Current f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-var">Current</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009575"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">(f blk -&gt; Current f blk) -&gt; m (f blk) -&gt; m (Current f blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(:.:) m f blk -&gt; m (f blk)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">(:.:) m f blk
</span><a href="#local-6989586621680009574"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621680009570"><span id="local-6989586621680009571"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#fromTZ"><span class="hs-identifier hs-type">fromTZ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009571"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680009570"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680009571"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009570"><span class="hs-identifier hs-type">blk</span></a></span></span></span><span>
</span><span id="line-90"></span><span id="fromTZ"><span class="annot"><span class="annottext">fromTZ :: HardForkState f '[blk] -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#fromTZ"><span class="hs-identifier hs-var hs-var">fromTZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Current f blk -&gt; f blk
forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var hs-var">currentState</span></a></span><span> </span><span class="annot"><span class="annottext">(Current f blk -&gt; f blk)
-&gt; (HardForkState f '[blk] -&gt; Current f blk)
-&gt; HardForkState f '[blk]
-&gt; f blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) '[blk] -&gt; Current f blk
forall k (g :: k -&gt; *) (f :: k -&gt; *) (x :: k).
Telescope g f '[x] -&gt; f x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#fromTZ"><span class="hs-identifier hs-var">Telescope.fromTZ</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current f) '[blk] -&gt; Current f blk)
-&gt; (HardForkState f '[blk]
    -&gt; Telescope (K Past) (Current f) '[blk])
-&gt; HardForkState f '[blk]
-&gt; Current f blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState f '[blk] -&gt; Telescope (K Past) (Current f) '[blk]
forall (f :: * -&gt; *) (xs :: [*]).
HardForkState f xs -&gt; Telescope (K Past) (Current f) xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#getHardForkState"><span class="hs-identifier hs-var hs-var">getHardForkState</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Situated
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | A @h@ situated in time</span><span>
</span><span id="line-97"></span><span class="hs-keyword">data</span><span> </span><span id="Situated"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-var">Situated</span></a></span></span><span> </span><span id="local-6989586621680009567"><span class="annot"><a href="#local-6989586621680009567"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621680009566"><span class="annot"><a href="#local-6989586621680009566"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680009565"><span class="annot"><a href="#local-6989586621680009565"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621680009563"><span id="local-6989586621680009564"><span id="local-6989586621680009765"><span id="local-6989586621680009767"><span id="SituatedCurrent"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedCurrent"><span class="hs-identifier hs-var">SituatedCurrent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009767"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009564"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>    </span><span class="annot"><a href="#local-6989586621680009765"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009564"><span class="hs-identifier hs-type">x</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009765"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009767"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009564"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009563"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621680009559"><span id="local-6989586621680009560"><span id="local-6989586621680009561"><span id="local-6989586621680009757"><span id="local-6989586621680009759"><span id="SituatedNext"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedNext"><span class="hs-identifier hs-var">SituatedNext</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009759"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009561"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>    </span><span class="annot"><a href="#local-6989586621680009757"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009560"><span class="hs-identifier hs-type">y</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009757"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009759"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009561"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009560"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009559"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621680009555"><span id="local-6989586621680009556"><span id="local-6989586621680009557"><span id="local-6989586621680009749"><span id="local-6989586621680009750"><span id="SituatedFuture"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedFuture"><span class="hs-identifier hs-var">SituatedFuture</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009750"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009557"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009749"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009556"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009749"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009750"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009557"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009555"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009556"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621680009552"><span id="local-6989586621680009553"><span id="local-6989586621680009740"><span id="local-6989586621680009741"><span id="SituatedPast"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedPast"><span class="hs-identifier hs-var">SituatedPast</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621680009553"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>    </span><span class="annot"><a href="#local-6989586621680009741"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009553"><span class="hs-identifier hs-type">x</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009741"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009740"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009553"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009552"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680009549"><span id="local-6989586621680009550"><span id="local-6989586621680009733"><span id="local-6989586621680009734"><span id="SituatedShift"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedShift"><span class="hs-identifier hs-var">SituatedShift</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009734"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009733"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009550"><span class="hs-identifier hs-type">xs</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009734"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009733"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009549"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680009550"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span id="local-6989586621680009545"><span id="local-6989586621680009546"><span id="local-6989586621680009547"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#situate"><span class="hs-identifier hs-type">situate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009547"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009546"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009545"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009546"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009547"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009545"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009546"><span class="hs-identifier hs-type">xs</span></a></span></span></span></span><span>
</span><span id="line-105"></span><span id="situate"><span class="annot"><span class="annottext">situate :: NS h xs -&gt; HardForkState f xs -&gt; Situated h f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#situate"><span class="hs-identifier hs-var hs-var">situate</span></a></span></span><span> </span><span id="local-6989586621680009544"><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009544"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NS h xs -&gt; Telescope (K Past) (Current f) xs -&gt; Situated h f xs
forall (h :: * -&gt; *) (xs' :: [*]) (f :: * -&gt; *).
NS h xs' -&gt; Telescope (K Past) (Current f) xs' -&gt; Situated h f xs'
</span><a href="#local-6989586621680009543"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009544"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current f) xs -&gt; Situated h f xs)
-&gt; (HardForkState f xs -&gt; Telescope (K Past) (Current f) xs)
-&gt; HardForkState f xs
-&gt; Situated h f xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HardForkState f xs -&gt; Telescope (K Past) (Current f) xs
forall (f :: * -&gt; *) (xs :: [*]).
HardForkState f xs -&gt; Telescope (K Past) (Current f) xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#getHardForkState"><span class="hs-identifier hs-var hs-var">getHardForkState</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621680009774"><span id="local-6989586621680009775"><span id="local-6989586621680009776"><span class="annot"><a href="#local-6989586621680009543"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NS"><span class="hs-identifier hs-type">NS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009776"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009775"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-108"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009774"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009775"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-109"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#Situated"><span class="hs-identifier hs-type">Situated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009776"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009774"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009775"><span class="hs-identifier hs-type">xs'</span></a></span></span></span></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621680009543"><span class="annot"><span class="annottext">go :: NS h xs' -&gt; Telescope (K Past) (Current f) xs' -&gt; Situated h f xs'
</span><a href="#local-6989586621680009543"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#Z"><span class="hs-identifier hs-type">Z</span></a></span><span>    </span><span id="local-6989586621680009541"><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680009541"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680009540"><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009540"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Current f x -&gt; h x -&gt; Situated h f (x : xs)
forall (f :: * -&gt; *) x (h :: * -&gt; *) (xs :: [*]).
Current f x -&gt; h x -&gt; Situated h f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedCurrent"><span class="hs-identifier hs-var">SituatedCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009540"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">h x
h x
</span><a href="#local-6989586621680009541"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="#local-6989586621680009543"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#Z"><span class="hs-identifier hs-type">Z</span></a></span><span> </span><span id="local-6989586621680009538"><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680009538"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680009537"><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009537"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Current f x -&gt; h x -&gt; Situated h f (x : x : xs)
forall (f :: * -&gt; *) x (h :: * -&gt; *) y (x :: [*]).
Current f x -&gt; h y -&gt; Situated h f (x : y : x)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedNext"><span class="hs-identifier hs-var">SituatedNext</span></a></span><span>    </span><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009537"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680009538"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="#local-6989586621680009543"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621680009536"><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009536"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span id="local-6989586621680009535"><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009535"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Current f x -&gt; NS h xs -&gt; Situated h f (x : x : xs)
forall (f :: * -&gt; *) x (h :: * -&gt; *) (xs :: [*]) y.
Current f x -&gt; NS h xs -&gt; Situated h f (x : y : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedFuture"><span class="hs-identifier hs-var">SituatedFuture</span></a></span><span>  </span><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009535"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009536"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="#local-6989586621680009543"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#Z"><span class="hs-identifier hs-type">Z</span></a></span><span>    </span><span id="local-6989586621680009534"><span class="annot"><span class="annottext">h x
</span><a href="#local-6989586621680009534"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span id="local-6989586621680009532"><span class="annot"><span class="annottext">K Past x
</span><a href="#local-6989586621680009532"><span class="hs-identifier hs-var">past</span></a></span></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">K Past x -&gt; h x -&gt; Situated h f (x : xs)
forall x (h :: * -&gt; *) (f :: * -&gt; *) (xs :: [*]).
K Past x -&gt; h x -&gt; Situated h f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedPast"><span class="hs-identifier hs-var">SituatedPast</span></a></span><span>   </span><span class="annot"><span class="annottext">K Past x
</span><a href="#local-6989586621680009532"><span class="hs-identifier hs-var">past</span></a></span><span> </span><span class="annot"><span class="annottext">h x
h x
</span><a href="#local-6989586621680009534"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="#local-6989586621680009543"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SOP.Strict.html#S"><span class="hs-identifier hs-type">S</span></a></span><span>    </span><span id="local-6989586621680009531"><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009531"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span class="annot"><span class="annottext">K Past x
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680009530"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009530"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Situated h f xs -&gt; Situated h f (x : xs)
forall (h :: * -&gt; *) (f :: * -&gt; *) (xs :: [*]) x.
Situated h f xs -&gt; Situated h f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#SituatedShift"><span class="hs-identifier hs-var">SituatedShift</span></a></span><span> </span><span class="annot"><span class="annottext">(Situated h f xs -&gt; Situated h f (x : xs))
-&gt; Situated h f xs -&gt; Situated h f (x : xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NS h xs -&gt; Telescope (K Past) (Current f) xs -&gt; Situated h f xs
forall (h :: * -&gt; *) (xs' :: [*]) (f :: * -&gt; *).
NS h xs' -&gt; Telescope (K Past) (Current f) xs' -&gt; Situated h f xs'
</span><a href="#local-6989586621680009543"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">NS h xs
</span><a href="#local-6989586621680009531"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009530"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Aligning
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#align"><span class="hs-identifier hs-type">align</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680009529"><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span id="local-6989586621680009528"><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680009527"><span class="annot"><a href="#local-6989586621680009527"><span class="hs-identifier hs-type">f'</span></a></span></span><span> </span><span id="local-6989586621680009526"><span class="annot"><a href="#local-6989586621680009526"><span class="hs-identifier hs-type">f''</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#InPairs"><span class="hs-identifier hs-type">InPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Translate"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009527"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680009526"><span class="hs-identifier hs-type">f''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009527"><span class="hs-identifier hs-type">f'</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-comment">-- ^ State we are aligning with</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-comment">-- ^ State we are aligning</span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009526"><span class="hs-identifier hs-type">f''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009529"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-126"></span><span id="align"><span class="annot"><span class="annottext">align :: InPairs (Translate f) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; HardForkState f' xs
-&gt; HardForkState f xs
-&gt; HardForkState f'' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#align"><span class="hs-identifier hs-var hs-var">align</span></a></span></span><span> </span><span id="local-6989586621680009523"><span class="annot"><span class="annottext">InPairs (Translate f) xs
</span><a href="#local-6989586621680009523"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621680009522"><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680009522"><span class="hs-identifier hs-var">updTip</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span id="local-6989586621680009521"><span class="annot"><span class="annottext">Telescope (K Past) (Current f') xs
</span><a href="#local-6989586621680009521"><span class="hs-identifier hs-var">alignWith</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span id="local-6989586621680009520"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009520"><span class="hs-identifier hs-var">toAlign</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f'') xs -&gt; HardForkState f'' xs
forall (f :: * -&gt; *) (xs :: [*]).
Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-var">HardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current f'') xs -&gt; HardForkState f'' xs)
-&gt; (I (Telescope (K Past) (Current f'') xs)
    -&gt; Telescope (K Past) (Current f'') xs)
-&gt; I (Telescope (K Past) (Current f'') xs)
-&gt; HardForkState f'' xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">I (Telescope (K Past) (Current f'') xs)
-&gt; Telescope (K Past) (Current f'') xs
forall a. I a -&gt; a
</span><span class="hs-identifier hs-var">unI</span></span><span> </span><span class="annot"><span class="annottext">(I (Telescope (K Past) (Current f'') xs) -&gt; HardForkState f'' xs)
-&gt; I (Telescope (K Past) (Current f'') xs) -&gt; HardForkState f'' xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="annottext">InPairs (Requiring (K Past) (Extend I (K Past) (Current f))) xs
-&gt; NP (Current f' -.-&gt; (Current f -.-&gt; Current f'')) xs
-&gt; Telescope (K Past) (Current f') xs
-&gt; Telescope (K Past) (Current f) xs
-&gt; I (Telescope (K Past) (Current f'') xs)
forall k (m :: * -&gt; *) (g' :: k -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *)
       (xs :: [k]) (f' :: k -&gt; *) (f'' :: k -&gt; *).
(Monad m, HasCallStack) =&gt;
InPairs (Requiring g' (Extend m g f)) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; Telescope g' f' xs
-&gt; Telescope g f xs
-&gt; m (Telescope g f'' xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#alignExtend"><span class="hs-identifier hs-var">Telescope.alignExtend</span></a></span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x y.
 Translate f x y
 -&gt; Requiring (K Past) (Extend I (K Past) (Current f)) x y)
-&gt; InPairs (Translate f) xs
-&gt; InPairs (Requiring (K Past) (Extend I (K Past) (Current f))) xs
forall k (xs :: [k]) (f :: k -&gt; k -&gt; *) (g :: k -&gt; k -&gt; *).
SListI xs =&gt;
(forall (x :: k) (y :: k). f x y -&gt; g x y)
-&gt; InPairs f xs -&gt; InPairs g xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#hmap"><span class="hs-identifier hs-var">InPairs.hmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680009516"><span class="annot"><span class="annottext">Translate f x y
</span><a href="#local-6989586621680009516"><span class="hs-identifier hs-var">f</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(K Past x -&gt; Extend I (K Past) (Current f) x y)
-&gt; Requiring (K Past) (Extend I (K Past) (Current f)) x y
forall k k (h :: k -&gt; *) (f :: k -&gt; k -&gt; *) (x :: k) (y :: k).
(h x -&gt; f x y) -&gt; Requiring h f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#Require"><span class="hs-identifier hs-var">Require</span></a></span><span> </span><span class="annot"><span class="annottext">((K Past x -&gt; Extend I (K Past) (Current f) x y)
 -&gt; Requiring (K Past) (Extend I (K Past) (Current f)) x y)
-&gt; (K Past x -&gt; Extend I (K Past) (Current f) x y)
-&gt; Requiring (K Past) (Extend I (K Past) (Current f)) x y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-130"></span><span>                       </span><span class="hs-glyph">\</span><span id="local-6989586621680009514"><span class="annot"><span class="annottext">K Past x
</span><a href="#local-6989586621680009514"><span class="hs-identifier hs-var">past</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Current f x -&gt; I (K Past x, Current f y))
-&gt; Extend I (K Past) (Current f) x y
forall k (m :: * -&gt; *) (g :: k -&gt; *) (f :: k -&gt; *) (x :: k)
       (y :: k).
(f x -&gt; m (g x, f y)) -&gt; Extend m g f x y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Extend"><span class="hs-identifier hs-var">Extend</span></a></span><span>  </span><span class="annot"><span class="annottext">((Current f x -&gt; I (K Past x, Current f y))
 -&gt; Extend I (K Past) (Current f) x y)
-&gt; (Current f x -&gt; I (K Past x, Current f y))
-&gt; Extend I (K Past) (Current f) x y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-131"></span><span>                       </span><span class="hs-glyph">\</span><span id="local-6989586621680009512"><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009512"><span class="hs-identifier hs-var">cur</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(K Past x, Current f y) -&gt; I (K Past x, Current f y)
forall a. a -&gt; I a
</span><span class="hs-identifier hs-var">I</span></span><span>       </span><span class="annot"><span class="annottext">((K Past x, Current f y) -&gt; I (K Past x, Current f y))
-&gt; (K Past x, Current f y) -&gt; I (K Past x, Current f y)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-132"></span><span>                         </span><span class="annot"><span class="annottext">Translate f x y
-&gt; K Past x -&gt; Current f x -&gt; (K Past x, Current f y)
forall blk blk'.
Translate f blk blk'
-&gt; K Past blk -&gt; Current f blk -&gt; (K Past blk, Current f blk')
</span><a href="#local-6989586621680009510"><span class="hs-identifier hs-var">newCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">Translate f x y
</span><a href="#local-6989586621680009516"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">K Past x
</span><a href="#local-6989586621680009514"><span class="hs-identifier hs-var">past</span></a></span><span> </span><span class="annot"><span class="annottext">Current f x
</span><a href="#local-6989586621680009512"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InPairs (Translate f) xs
</span><a href="#local-6989586621680009523"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a.
 (-.-&gt;) f' (f -.-&gt; f'') a
 -&gt; (-.-&gt;) (Current f') (Current f -.-&gt; Current f'') a)
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; NP (Current f' -.-&gt; (Current f -.-&gt; Current f'')) xs
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Current f' a -&gt; Current f a -&gt; Current f'' a)
-&gt; (-.-&gt;) (Current f') (Current f -.-&gt; Current f'') a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *) (f'' :: k -&gt; *).
(f a -&gt; f' a -&gt; f'' a) -&gt; (-.-&gt;) f (f' -.-&gt; f'') a
</span><span class="hs-identifier hs-var">fn_2</span></span><span> </span><span class="annot"><span class="annottext">((Current f' a -&gt; Current f a -&gt; Current f'' a)
 -&gt; (-.-&gt;) (Current f') (Current f -.-&gt; Current f'') a)
-&gt; ((-.-&gt;) f' (f -.-&gt; f'') a
    -&gt; Current f' a -&gt; Current f a -&gt; Current f'' a)
-&gt; (-.-&gt;) f' (f -.-&gt; f'') a
-&gt; (-.-&gt;) (Current f') (Current f -.-&gt; Current f'') a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') a
-&gt; Current f' a -&gt; Current f a -&gt; Current f'' a
forall blk.
(-.-&gt;) f' (f -.-&gt; f'') blk
-&gt; Current f' blk -&gt; Current f blk -&gt; Current f'' blk
</span><a href="#local-6989586621680009508"><span class="hs-identifier hs-var">liftUpdTip</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP (f' -.-&gt; (f -.-&gt; f'')) xs
</span><a href="#local-6989586621680009522"><span class="hs-identifier hs-var">updTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f') xs
</span><a href="#local-6989586621680009521"><span class="hs-identifier hs-var">alignWith</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009520"><span class="hs-identifier hs-var">toAlign</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621680009679"><span class="annot"><a href="#local-6989586621680009508"><span class="hs-identifier hs-type">liftUpdTip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680009527"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">-.-&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680009526"><span class="hs-identifier hs-type">f''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009679"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-138"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009527"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009679"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009679"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009526"><span class="hs-identifier hs-type">f''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009679"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621680009508"><span class="annot"><span class="annottext">liftUpdTip :: (-.-&gt;) f' (f -.-&gt; f'') blk
-&gt; Current f' blk -&gt; Current f blk -&gt; Current f'' blk
</span><a href="#local-6989586621680009508"><span class="hs-identifier hs-var hs-var">liftUpdTip</span></a></span></span><span> </span><span id="local-6989586621680009507"><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') blk
</span><a href="#local-6989586621680009507"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(f blk -&gt; f'' blk) -&gt; Current f blk -&gt; Current f'' blk
forall (f :: * -&gt; *) blk (f' :: * -&gt; *).
(f blk -&gt; f' blk) -&gt; Current f blk -&gt; Current f' blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Lift.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">((f blk -&gt; f'' blk) -&gt; Current f blk -&gt; Current f'' blk)
-&gt; (Current f' blk -&gt; f blk -&gt; f'' blk)
-&gt; Current f' blk
-&gt; Current f blk
-&gt; Current f'' blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f f'' blk -&gt; f blk -&gt; f'' blk
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">((-.-&gt;) f f'' blk -&gt; f blk -&gt; f'' blk)
-&gt; (Current f' blk -&gt; (-.-&gt;) f f'' blk)
-&gt; Current f' blk
-&gt; f blk
-&gt; f'' blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') blk -&gt; f' blk -&gt; (-.-&gt;) f f'' blk
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
(-.-&gt;) f g a -&gt; f a -&gt; g a
</span><span class="hs-identifier hs-var hs-var">apFn</span></span><span> </span><span class="annot"><span class="annottext">(-.-&gt;) f' (f -.-&gt; f'') blk
</span><a href="#local-6989586621680009507"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(f' blk -&gt; (-.-&gt;) f f'' blk)
-&gt; (Current f' blk -&gt; f' blk) -&gt; Current f' blk -&gt; (-.-&gt;) f f'' blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Current f' blk -&gt; f' blk
forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var hs-var">currentState</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621680009686"><span id="local-6989586621680009687"><span class="annot"><a href="#local-6989586621680009510"><span class="hs-identifier hs-type">newCurrent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Translate"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009687"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009686"><span class="hs-identifier hs-type">blk'</span></a></span><span>
</span><span id="line-142"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009687"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-143"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009687"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-144"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009687"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009528"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009686"><span class="hs-identifier hs-type">blk'</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621680009510"><span class="annot"><span class="annottext">newCurrent :: Translate f blk blk'
-&gt; K Past blk -&gt; Current f blk -&gt; (K Past blk, Current f blk')
</span><a href="#local-6989586621680009510"><span class="hs-identifier hs-var hs-var">newCurrent</span></a></span></span><span> </span><span id="local-6989586621680009504"><span class="annot"><span class="annottext">Translate f blk blk'
</span><a href="#local-6989586621680009504"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span id="local-6989586621680009502"><span class="annot"><span class="annottext">Past
</span><a href="#local-6989586621680009502"><span class="hs-identifier hs-var">past</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680009501"><span class="annot"><span class="annottext">Current f blk
</span><a href="#local-6989586621680009501"><span class="hs-identifier hs-var">curF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><span class="annottext">Past -&gt; K Past blk
forall k a (b :: k). a -&gt; K a b
</span><span class="hs-identifier hs-var">K</span></span><span> </span><span class="annot"><span class="annottext">Past :: Bound -&gt; Bound -&gt; Past
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pastStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#pastStart"><span class="hs-identifier hs-var">pastStart</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Current f blk -&gt; Bound
forall (f :: * -&gt; *) blk. Current f blk -&gt; Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentStart"><span class="hs-identifier hs-var hs-var">currentStart</span></a></span><span> </span><span class="annot"><span class="annottext">Current f blk
</span><a href="#local-6989586621680009501"><span class="hs-identifier hs-var">curF</span></a></span><span>
</span><span id="line-147"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pastEnd :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#pastEnd"><span class="hs-identifier hs-var">pastEnd</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009497"><span class="hs-identifier hs-var">curEnd</span></a></span><span>
</span><span id="line-148"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Current :: forall (f :: * -&gt; *) blk. Bound -&gt; f blk -&gt; Current f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentStart"><span class="hs-identifier hs-var">currentStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009497"><span class="hs-identifier hs-var">curEnd</span></a></span><span>
</span><span id="line-150"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentState :: f blk'
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Translate f blk blk' -&gt; EpochNo -&gt; f blk -&gt; f blk'
forall (f :: * -&gt; *) x y. Translate f x y -&gt; EpochNo -&gt; f x -&gt; f y
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#translateWith"><span class="hs-identifier hs-var hs-var">translateWith</span></a></span><span> </span><span class="annot"><span class="annottext">Translate f blk blk'
</span><a href="#local-6989586621680009504"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-151"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundEpoch"><span class="hs-identifier hs-var hs-var">boundEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009497"><span class="hs-identifier hs-var">curEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Current f blk -&gt; f blk
forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var hs-var">currentState</span></a></span><span> </span><span class="annot"><span class="annottext">Current f blk
</span><a href="#local-6989586621680009501"><span class="hs-identifier hs-var">curF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><a href="#local-6989586621680009497"><span class="hs-identifier hs-type">curEnd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">Bound</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span id="local-6989586621680009497"><span class="annot"><span class="annottext">curEnd :: Bound
</span><a href="#local-6989586621680009497"><span class="hs-identifier hs-var hs-var">curEnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Past -&gt; Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#pastEnd"><span class="hs-identifier hs-var hs-var">pastEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Past
</span><a href="#local-6989586621680009502"><span class="hs-identifier hs-var">past</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Summary/EpochInfo
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span id="local-6989586621680009493"><span id="local-6989586621680009494"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#reconstructSummary"><span class="hs-identifier hs-type">reconstructSummary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Shape"><span class="hs-identifier hs-type">History.Shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009494"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-164"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#TransitionInfo"><span class="hs-identifier hs-type">TransitionInfo</span></a></span><span>         </span><span class="hs-comment">-- ^ At the tip</span><span>
</span><span id="line-165"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009493"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009494"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-166"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">History.Summary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009494"><span class="hs-identifier hs-type">xs</span></a></span></span></span><span>
</span><span id="line-167"></span><span id="reconstructSummary"><span class="annot"><span class="annottext">reconstructSummary :: Shape xs -&gt; TransitionInfo -&gt; HardForkState f xs -&gt; Summary xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#reconstructSummary"><span class="hs-identifier hs-var hs-var">reconstructSummary</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Shape"><span class="hs-identifier hs-type">History.Shape</span></a></span><span> </span><span id="local-6989586621680009491"><span class="annot"><span class="annottext">Exactly xs EraParams
</span><a href="#local-6989586621680009491"><span class="hs-identifier hs-var">shape</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680009490"><span class="annot"><span class="annottext">TransitionInfo
</span><a href="#local-6989586621680009490"><span class="hs-identifier hs-var">transition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span id="local-6989586621680009489"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009489"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">NonEmpty xs EraSummary -&gt; Summary xs
forall (xs :: [*]). NonEmpty xs EraSummary -&gt; Summary xs
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-var">History.Summary</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty xs EraSummary -&gt; Summary xs)
-&gt; NonEmpty xs EraSummary -&gt; Summary xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs EraParams
-&gt; Telescope (K Past) (Current f) xs -&gt; NonEmpty xs EraSummary
forall (xs' :: [*]) (f :: * -&gt; *).
Exactly xs' EraParams
-&gt; Telescope (K Past) (Current f) xs' -&gt; NonEmpty xs' EraSummary
</span><a href="#local-6989586621680009487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs EraParams
</span><a href="#local-6989586621680009491"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009489"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621680009650"><span id="local-6989586621680009651"><span class="annot"><a href="#local-6989586621680009487"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009651"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span>
</span><span id="line-171"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009650"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680009651"><span class="hs-identifier hs-type">xs'</span></a></span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680009651"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span></span></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621680009487"><span class="annot"><span class="annottext">go :: Exactly xs' EraParams
-&gt; Telescope (K Past) (Current f) xs' -&gt; NonEmpty xs' EraSummary
</span><a href="#local-6989586621680009487"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680009485"><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009485"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621680009484"><span class="annot"><span class="annottext">Exactly xs EraParams
</span><a href="#local-6989586621680009484"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-type">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">Past</span></a></span><span class="hs-special">{</span><span id="local-6989586621680009482"><span id="local-6989586621680009483"><span class="annot"><span class="annottext">Bound
pastEnd :: Bound
pastStart :: Bound
pastEnd :: Past -&gt; Bound
pastStart :: Past -&gt; Bound
</span><a href="#local-6989586621680009482"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680009481"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009481"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">EraSummary
-&gt; NonEmpty xs EraSummary -&gt; NonEmpty (x : xs) EraSummary
forall a (xs :: [*]) x. a -&gt; NonEmpty xs a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyCons"><span class="hs-identifier hs-var">NonEmptyCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; EraEnd -&gt; EraParams -&gt; EraSummary
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-var">EraSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009483"><span class="hs-identifier hs-var">pastStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-var">EraEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009482"><span class="hs-identifier hs-var">pastEnd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009485"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty xs EraSummary -&gt; NonEmpty (x : xs) EraSummary)
-&gt; NonEmpty xs EraSummary -&gt; NonEmpty (x : xs) EraSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs EraParams
-&gt; Telescope (K Past) (Current f) xs -&gt; NonEmpty xs EraSummary
forall (xs' :: [*]) (f :: * -&gt; *).
Exactly xs' EraParams
-&gt; Telescope (K Past) (Current f) xs' -&gt; NonEmpty xs' EraSummary
</span><a href="#local-6989586621680009487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs EraParams
</span><a href="#local-6989586621680009484"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs
Telescope (K Past) (Current f) xs
</span><a href="#local-6989586621680009481"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="#local-6989586621680009487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680009477"><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009477"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs EraParams
</span><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyNil"><span class="hs-identifier hs-var">ExactlyNil</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span class="hs-special">{</span><span id="local-6989586621680009474"><span id="local-6989586621680009475"><span class="annot"><span class="annottext">f x
Bound
currentState :: f x
currentStart :: Bound
currentState :: forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
currentStart :: forall (f :: * -&gt; *) blk. Current f blk -&gt; Bound
</span><a href="#local-6989586621680009474"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-comment">-- The current era is the last. We assume it lasts until all eternity.</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">EraSummary -&gt; NonEmpty '[x] EraSummary
forall a x (xs :: [*]). a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-var">NonEmptyOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; EraEnd -&gt; EraParams -&gt; EraSummary
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-var">EraSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009475"><span class="hs-identifier hs-var">currentStart</span></a></span><span> </span><span class="annot"><span class="annottext">EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraUnbounded"><span class="hs-identifier hs-var">EraUnbounded</span></a></span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009477"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="#local-6989586621680009487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680009471"><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680009470"><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009470"><span class="hs-identifier hs-var">nextParams</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs EraParams
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-type">TZ</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">Current</span></a></span><span class="hs-special">{</span><span id="local-6989586621680009468"><span id="local-6989586621680009469"><span class="annot"><span class="annottext">f x
Bound
currentState :: f x
currentStart :: Bound
currentState :: forall (f :: * -&gt; *) blk. Current f blk -&gt; f blk
currentStart :: forall (f :: * -&gt; *) blk. Current f blk -&gt; Bound
</span><a href="#local-6989586621680009468"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransitionInfo
</span><a href="#local-6989586621680009490"><span class="hs-identifier hs-var">transition</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-180"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#TransitionKnown"><span class="hs-identifier hs-type">TransitionKnown</span></a></span><span> </span><span id="local-6989586621680009466"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680009466"><span class="hs-identifier hs-var">epoch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-comment">-- We haven't reached the next era yet, but the transition is</span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-comment">-- already known. The safe zone applies from the start of the</span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-comment">-- next era.</span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680009465"><span class="annot"><span class="annottext">currentEnd :: Bound
</span><a href="#local-6989586621680009465"><span class="hs-identifier hs-var hs-var">currentEnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; EraParams -&gt; Bound -&gt; EpochNo -&gt; Bound
EraParams -&gt; Bound -&gt; EpochNo -&gt; Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#mkUpperBound"><span class="hs-identifier hs-var">History.mkUpperBound</span></a></span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621680009466"><span class="hs-identifier hs-var">epoch</span></a></span><span>
</span><span id="line-185"></span><span>                </span><span id="local-6989586621680009463"><span class="annot"><span class="annottext">nextStart :: Bound
</span><a href="#local-6989586621680009463"><span class="hs-identifier hs-var hs-var">nextStart</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009465"><span class="hs-identifier hs-var">currentEnd</span></a></span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">EraSummary
-&gt; NonEmpty (x : xs) EraSummary -&gt; NonEmpty (x : x : xs) EraSummary
forall a (xs :: [*]) x. a -&gt; NonEmpty xs a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyCons"><span class="hs-identifier hs-var">NonEmptyCons</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary :: Bound -&gt; EraEnd -&gt; EraParams -&gt; EraSummary
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-187"></span><span>                   </span><span class="annot"><span class="annottext">eraStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraStart"><span class="hs-identifier hs-var">eraStart</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span>
</span><span id="line-188"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraParams :: EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraParams"><span class="hs-identifier hs-var">eraParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-189"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraEnd :: EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraEnd"><span class="hs-identifier hs-var">eraEnd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound -&gt; EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-var">EraEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009465"><span class="hs-identifier hs-var">currentEnd</span></a></span><span>
</span><span id="line-190"></span><span>                 </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>             </span><span class="annot"><span class="annottext">(NonEmpty (x : xs) EraSummary -&gt; NonEmpty (x : x : xs) EraSummary)
-&gt; NonEmpty (x : xs) EraSummary -&gt; NonEmpty (x : x : xs) EraSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; NonEmpty (x : xs) EraSummary
forall a x (xs :: [*]). a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-var">NonEmptyOne</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary :: Bound -&gt; EraEnd -&gt; EraParams -&gt; EraSummary
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-192"></span><span>                   </span><span class="annot"><span class="annottext">eraStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraStart"><span class="hs-identifier hs-var">eraStart</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009463"><span class="hs-identifier hs-var">nextStart</span></a></span><span>
</span><span id="line-193"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraParams :: EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraParams"><span class="hs-identifier hs-var">eraParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009470"><span class="hs-identifier hs-var">nextParams</span></a></span><span>
</span><span id="line-194"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraEnd :: EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraEnd"><span class="hs-identifier hs-var">eraEnd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams -&gt; Bound -&gt; SlotNo -&gt; EraEnd
</span><a href="#local-6989586621680009459"><span class="hs-identifier hs-var">applySafeZone</span></a></span><span>
</span><span id="line-195"></span><span>                                 </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009470"><span class="hs-identifier hs-var">nextParams</span></a></span><span>
</span><span id="line-196"></span><span>                                 </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009463"><span class="hs-identifier hs-var">nextStart</span></a></span><span>
</span><span id="line-197"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009463"><span class="hs-identifier hs-var">nextStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>                 </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#TransitionUnknown"><span class="hs-identifier hs-type">TransitionUnknown</span></a></span><span> </span><span id="local-6989586621680009456"><span class="annot"><span class="annottext">WithOrigin SlotNo
</span><a href="#local-6989586621680009456"><span class="hs-identifier hs-var">ledgerTip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; NonEmpty (x : x : xs) EraSummary
forall a x (xs :: [*]). a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-var">NonEmptyOne</span></a></span><span> </span><span class="annot"><span class="annottext">(EraSummary -&gt; NonEmpty (x : x : xs) EraSummary)
-&gt; EraSummary -&gt; NonEmpty (x : x : xs) EraSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary :: Bound -&gt; EraEnd -&gt; EraParams -&gt; EraSummary
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-200"></span><span>                </span><span class="annot"><span class="annottext">eraStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraStart"><span class="hs-identifier hs-var">eraStart</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span>
</span><span id="line-201"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraParams :: EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraParams"><span class="hs-identifier hs-var">eraParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-202"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraEnd :: EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraEnd"><span class="hs-identifier hs-var">eraEnd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams -&gt; Bound -&gt; SlotNo -&gt; EraEnd
</span><a href="#local-6989586621680009459"><span class="hs-identifier hs-var">applySafeZone</span></a></span><span>
</span><span id="line-203"></span><span>                              </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-204"></span><span>                              </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span>
</span><span id="line-205"></span><span>                              </span><span class="hs-comment">-- Even if the safe zone is 0, the first slot at</span><span>
</span><span id="line-206"></span><span>                              </span><span class="hs-comment">-- which the next era could begin is the /next/</span><span>
</span><span id="line-207"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WithOrigin SlotNo -&gt; SlotNo
</span><a href="#local-6989586621680009455"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">WithOrigin SlotNo
</span><a href="#local-6989586621680009456"><span class="hs-identifier hs-var">ledgerTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>          </span><span class="hs-comment">-- 'TransitionImpossible' is used in one of two cases: we are in the</span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-comment">-- final era (clearly not the case here) or this era is a future era</span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-comment">-- that hasn't begun yet, in which case the safe zone must start at</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-comment">-- the beginning of this era.</span><span>
</span><span id="line-213"></span><span>          </span><span class="annot"><span class="annottext">TransitionInfo
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#TransitionImpossible"><span class="hs-identifier hs-var">TransitionImpossible</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; NonEmpty (x : x : xs) EraSummary
forall a x (xs :: [*]). a -&gt; NonEmpty (x : xs) a
</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-var">NonEmptyOne</span></a></span><span> </span><span class="annot"><span class="annottext">(EraSummary -&gt; NonEmpty (x : x : xs) EraSummary)
-&gt; EraSummary -&gt; NonEmpty (x : x : xs) EraSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary :: Bound -&gt; EraEnd -&gt; EraParams -&gt; EraSummary
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-214"></span><span>                </span><span class="annot"><span class="annottext">eraStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraStart"><span class="hs-identifier hs-var">eraStart</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span>
</span><span id="line-215"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraParams :: EraParams
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraParams"><span class="hs-identifier hs-var">eraParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-216"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraEnd :: EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#eraEnd"><span class="hs-identifier hs-var">eraEnd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraParams -&gt; Bound -&gt; SlotNo -&gt; EraEnd
</span><a href="#local-6989586621680009459"><span class="hs-identifier hs-var">applySafeZone</span></a></span><span>
</span><span id="line-217"></span><span>                              </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009471"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-218"></span><span>                              </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span>
</span><span id="line-219"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#boundSlot"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009469"><span class="hs-identifier hs-var">currentStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="#local-6989586621680009487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs' EraParams
</span><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyNil"><span class="hs-identifier hs-var">ExactlyNil</span></a></span><span> </span><span id="local-6989586621680009453"><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs'
</span><a href="#local-6989586621680009453"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs'
</span><a href="#local-6989586621680009453"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">-- Apply safe zone from the specified 'SlotNo'</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- All arguments must be referring to or in the same era.</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="#local-6989586621680009459"><span class="hs-identifier hs-type">applySafeZone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">Bound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-type">EraEnd</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621680009459"><span class="annot"><span class="annottext">applySafeZone :: EraParams -&gt; Bound -&gt; SlotNo -&gt; EraEnd
</span><a href="#local-6989586621680009459"><span class="hs-identifier hs-var hs-var">applySafeZone</span></a></span></span><span> </span><span id="local-6989586621680009452"><span class="annot"><span class="annottext">params :: EraParams
</span><a href="#local-6989586621680009452"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-type">EraParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680009448"><span id="local-6989586621680009449"><span id="local-6989586621680009450"><span class="annot"><span class="annottext">SlotLength
EpochSize
SafeZone
eraSafeZone :: EraParams -&gt; SafeZone
eraSlotLength :: EraParams -&gt; SlotLength
eraEpochSize :: EraParams -&gt; EpochSize
eraSafeZone :: SafeZone
eraSlotLength :: SlotLength
eraEpochSize :: EpochSize
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#eraSafeZone"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680009444"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009444"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SafeZone
</span><a href="#local-6989586621680009448"><span class="hs-identifier hs-var">eraSafeZone</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="annottext">SafeZone
</span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#UnsafeIndefiniteSafeZone"><span class="hs-identifier hs-var">UnsafeIndefiniteSafeZone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>              </span><span class="annot"><span class="annottext">EraEnd -&gt; SlotNo -&gt; EraEnd
forall a b. a -&gt; b -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraUnbounded"><span class="hs-identifier hs-var">EraUnbounded</span></a></span><span>
</span><span id="line-232"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#StandardSafeZone"><span class="hs-identifier hs-type">StandardSafeZone</span></a></span><span> </span><span id="local-6989586621680009440"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680009440"><span class="hs-identifier hs-var">safeFromTip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>              </span><span class="annot"><span class="annottext">Bound -&gt; EraEnd
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-var">EraEnd</span></a></span><span>
</span><span id="line-234"></span><span>            </span><span class="annot"><span class="annottext">(Bound -&gt; EraEnd) -&gt; (SlotNo -&gt; Bound) -&gt; SlotNo -&gt; EraEnd
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; EraParams -&gt; Bound -&gt; EpochNo -&gt; Bound
EraParams -&gt; Bound -&gt; EpochNo -&gt; Bound
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#mkUpperBound"><span class="hs-identifier hs-var">History.mkUpperBound</span></a></span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009452"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009444"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-235"></span><span>            </span><span class="annot"><span class="annottext">(EpochNo -&gt; Bound) -&gt; (SlotNo -&gt; EpochNo) -&gt; SlotNo -&gt; Bound
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">EraParams -&gt; Bound -&gt; SlotNo -&gt; EpochNo
</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#slotToEpochBound"><span class="hs-identifier hs-var">History.slotToEpochBound</span></a></span><span> </span><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621680009452"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680009444"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span class="annot"><span class="annottext">(SlotNo -&gt; EpochNo) -&gt; (SlotNo -&gt; SlotNo) -&gt; SlotNo -&gt; EpochNo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo -&gt; SlotNo
</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addSlots"><span class="hs-identifier hs-var">History.addSlots</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680009440"><span class="hs-identifier hs-var">safeFromTip</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621680009455"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WithOrigin</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621680009455"><span class="annot"><span class="annottext">next :: WithOrigin SlotNo -&gt; SlotNo
</span><a href="#local-6989586621680009455"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="annot"><span class="annottext">WithOrigin SlotNo
</span><span class="hs-identifier hs-var">Origin</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><span class="hs-identifier hs-var">SlotNo</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><a href="#local-6989586621680009455"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#NotOrigin"><span class="hs-identifier hs-type">NotOrigin</span></a></span><span> </span><span id="local-6989586621680009434"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680009434"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo
forall a. Enum a =&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680009434"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-241"></span></pre></body></html>