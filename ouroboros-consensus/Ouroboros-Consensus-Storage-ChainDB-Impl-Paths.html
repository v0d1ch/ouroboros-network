<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Consensus.Storage.ChainDB.Impl.Paths</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-consensus-0.1.0.0: Consensus layer for the Ouroboros blockchain protocol</span><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Consensus.Storage.ChainDB.Impl.Paths</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">LookupBlockInfo</a></li><li><a href="#g:2">Candidates</a></li><li><a href="#g:3">Path</a></li><li><a href="#g:4">Reverse path</a></li><li><a href="#g:5">Reachability</a></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:LookupBlockInfo">LookupBlockInfo</a> blk = <a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-VolatileDB-API.html#t:BlockInfo" title="Ouroboros.Consensus.Storage.VolatileDB.API">BlockInfo</a> blk)</li><li class="src short"><a href="#v:extendWithSuccessors">extendWithSuccessors</a> &#8759; &#8704; blk. <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk &#8658; (<a href="Ouroboros-Consensus-Block-Abstract.html#t:ChainHash" title="Ouroboros.Consensus.Block.Abstract">ChainHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/Data-Set.html#t:Set" title="Data.Set">Set</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk)) &#8594; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk &#8594; <a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk) &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> (<a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk))</li><li class="src short"><a href="#v:maximalCandidates">maximalCandidates</a> &#8759; &#8704; blk. (<a href="Ouroboros-Consensus-Block-Abstract.html#t:ChainHash" title="Ouroboros.Consensus.Block.Abstract">ChainHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/Data-Set.html#t:Set" title="Data.Set">Set</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk)) &#8594; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Point" title="Ouroboros.Consensus.Block.Abstract">Point</a> blk &#8594; [<a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk)]</li><li class="src short"><span class="keyword">data</span> <a href="#t:Path">Path</a> blk<ul class="subs"><li>= <a href="#v:NotInVolatileDB">NotInVolatileDB</a> (<a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk)</li><li>| <a href="#v:CompletelyInVolatileDB">CompletelyInVolatileDB</a> [<a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk]</li><li>| <a href="#v:PartiallyInVolatileDB">PartiallyInVolatileDB</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk) [<a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk]</li></ul></li><li class="src short"><a href="#v:computePath">computePath</a> &#8759; &#8704; blk. <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk &#8658; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:StreamFrom" title="Ouroboros.Consensus.Storage.Common">StreamFrom</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:StreamTo" title="Ouroboros.Consensus.Storage.Common">StreamTo</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk)</li><li class="src short"><span class="keyword">data</span> <a href="#t:ReversePath">ReversePath</a> blk<ul class="subs"><li>= <a href="#v:StoppedAtGenesis">StoppedAtGenesis</a></li><li>| <a href="#v:StoppedAt">StoppedAt</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk) <a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockNo" title="Ouroboros.Consensus.Block.Abstract">BlockNo</a></li><li>| (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:ReversePath" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">ReversePath</a> blk) <a href="#v:::-62-">::&gt;</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk, <a href="Ouroboros-Consensus-Block-EBB.html#t:IsEBB" title="Ouroboros.Consensus.Block.EBB">IsEBB</a>)</li></ul></li><li class="src short"><a href="#v:computeReversePath">computeReversePath</a> &#8759; &#8704; blk. <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk &#8594; <a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:ReversePath" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">ReversePath</a> blk)</li><li class="src short"><a href="#v:isReachable">isReachable</a> &#8759; &#8704; blk. (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk, <a href="Ouroboros-Consensus-Block-Abstract.html#t:GetHeader" title="Ouroboros.Consensus.Block.Abstract">GetHeader</a> blk) &#8658; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk &#8594; <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) &#8594; <a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk))</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>LookupBlockInfo</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LookupBlockInfo" class="def">LookupBlockInfo</a> blk = <a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-VolatileDB-API.html#t:BlockInfo" title="Ouroboros.Consensus.Storage.VolatileDB.API">BlockInfo</a> blk) <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#LookupBlockInfo" class="link">Source</a> <a href="#t:LookupBlockInfo" class="selflink">#</a></p><div class="doc"><p>Return the block info for the block with the given hash. Return <code><a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code>
 when not in the VolatileDB.</p></div></div><a href="#g:2" id="g:2"><h1>Candidates</h1></a><div class="top"><p class="src"><a id="v:extendWithSuccessors" class="def">extendWithSuccessors</a> &#8759; &#8704; blk. <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk &#8658; (<a href="Ouroboros-Consensus-Block-Abstract.html#t:ChainHash" title="Ouroboros.Consensus.Block.Abstract">ChainHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/Data-Set.html#t:Set" title="Data.Set">Set</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk)) &#8594; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk &#8594; <a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk) &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> (<a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk)) <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#extendWithSuccessors" class="link">Source</a> <a href="#v:extendWithSuccessors" class="selflink">#</a></p><div class="doc"><p>Extend the <code><a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a></code> with the successors found by <code><a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#v:maximalCandidates" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">maximalCandidates</a></code>.</p><p>In case no successors were found, the original <code><a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a></code> is returned as a
 singleton.</p><p>In case successors <em>were</em> found, the original <code><a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a></code> is <em>not</em>
 included, only its extensions.</p><p>Only the longest possible extensions are returned, no intermediary prefixes
 of extensions.</p></div></div><div class="top"><p class="src"><a id="v:maximalCandidates" class="def">maximalCandidates</a> <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#maximalCandidates" class="link">Source</a> <a href="#v:maximalCandidates" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; &#8704; blk. (<a href="Ouroboros-Consensus-Block-Abstract.html#t:ChainHash" title="Ouroboros.Consensus.Block.Abstract">ChainHash</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/Data-Set.html#t:Set" title="Data.Set">Set</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk))</td><td class="doc"><pre>filterByPredecessor</pre></td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Point" title="Ouroboros.Consensus.Block.Abstract">Point</a> blk</td><td class="doc"><pre>B</pre></td></tr><tr><td class="src">&#8594; [<a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk)]</td><td class="doc"><p>Each element in the list is a list of hashes from which we can
 construct a fragment anchored at the point <code>B</code>.</p></td></tr></table></div><div class="doc"><p>Compute the <em>maximal</em> candidates starting at the specified point</p><p>As discussed in the Consensus Report, the set of <em>maximal</em> candidates doesn't
 include prefixes.</p><p>PRECONDITION: the block to which the given point corresponds is part of the
 VolatileDB.</p><p>The first element in each list of hashes is the hash <em>after</em> the specified
 hash. Thus, when building fragments from these lists of hashes, they
 fragments must be <em>anchored</em> at the specified hash, but not contain it.</p><p>NOTE: it is possible that no candidates are found, but don't forget that
 the chain (fragment) ending with <code>B</code> is also a potential candidate.</p></div></div><a href="#g:3" id="g:3"><h1>Path</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Path" class="def">Path</a> blk <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#Path" class="link">Source</a> <a href="#t:Path" class="selflink">#</a></p><div class="doc"><p>A path through the VolatileDB from a <code><a href="Ouroboros-Consensus-Storage-Common.html#t:StreamFrom" title="Ouroboros.Consensus.Storage.Common">StreamFrom</a></code> to a <code><a href="Ouroboros-Consensus-Storage-Common.html#t:StreamTo" title="Ouroboros.Consensus.Storage.Common">StreamTo</a></code>.</p><p>Invariant: the <code>AnchoredFragment</code> (oldest first) constructed using the blocks
 corresponding to the points in the path will be valid, i.e., the blocks
 will fit onto each other.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:NotInVolatileDB" class="def">NotInVolatileDB</a> (<a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk)</td><td class="doc"><p>The <code>end</code> point (<code><code><a href="Ouroboros-Consensus-Storage-Common.html#v:StreamToInclusive" title="Ouroboros.Consensus.Storage.Common">StreamToInclusive</a></code> end</code>) was not part of the
 VolatileDB.</p></td></tr><tr><td class="src"><a id="v:CompletelyInVolatileDB" class="def">CompletelyInVolatileDB</a> [<a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk]</td><td class="doc"><p>A complete path, from start point to end point was constructed from
 the VolatileDB. The list contains the points from oldest to newest.</p><ul><li>If the lower bound was <code><code><a href="Ouroboros-Consensus-Storage-Common.html#v:StreamFromInclusive" title="Ouroboros.Consensus.Storage.Common">StreamFromInclusive</a></code> pt</code>, then <code>pt</code> will be
   the first element of the list.</li><li>If the lower bound was <code><code><a href="Ouroboros-Consensus-Storage-Common.html#v:StreamFromExclusive" title="Ouroboros.Consensus.Storage.Common">StreamFromExclusive</a></code> pt</code>, then the first
   element of the list will correspond to the first block after <code>pt</code>.</li><li>If the upper bound was <code><code><a href="Ouroboros-Consensus-Storage-Common.html#v:StreamToInclusive" title="Ouroboros.Consensus.Storage.Common">StreamToInclusive</a></code> pt</code>, then <code>pt</code> will be
   the last element of the list.</li></ul></td></tr><tr><td class="src"><a id="v:PartiallyInVolatileDB" class="def">PartiallyInVolatileDB</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk) [<a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk]</td><td class="doc"><p>Only a partial path could be constructed from the VolatileDB. The
 missing predecessor could still be in the ImmutableDB. The list
 contains the points from oldest to newest.</p><ul><li>The first element in the list is the point for which no predecessor
   is available in the VolatileDB. The block corresponding to the point
   itself, <em>is</em> available in the VolatileDB.</li><li>The first argument is the hash of predecessor, the block that is not
   available in the VolatileDB.</li></ul><p>Note: if the lower bound is exclusive, the block corresponding to it
 doesn't have to be part of the VolatileDB, it will result in a
 <code>StartToEnd</code>.</p><p>The same invariants hold for the upper bound as for <code>StartToEnd</code>.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Path">Instances</h4><details id="i:Path" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Path:Eq:1"></span> <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk &#8658; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk)</span> <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#line-241" class="link">Source</a> <a href="#t:Path" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Path:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html">Ouroboros.Consensus.Storage.ChainDB.Impl.Paths</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Path:Show:2"></span> <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk &#8658; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk)</span> <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#line-242" class="link">Source</a> <a href="#t:Path" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Path:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html">Ouroboros.Consensus.Storage.ChainDB.Impl.Paths</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk] &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:computePath" class="def">computePath</a> &#8759; &#8704; blk. <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk &#8658; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:StreamFrom" title="Ouroboros.Consensus.Storage.Common">StreamFrom</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:StreamTo" title="Ouroboros.Consensus.Storage.Common">StreamTo</a> blk &#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a> blk) <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#computePath" class="link">Source</a> <a href="#v:computePath" class="selflink">#</a></p><div class="doc"><p>Construct a path backwards through the VolatileDB.</p><p>We walk backwards through the VolatileDB, constructing a <code><a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a></code> from the
 <code><a href="Ouroboros-Consensus-Storage-Common.html#t:StreamTo" title="Ouroboros.Consensus.Storage.Common">StreamTo</a></code> to the <code><a href="Ouroboros-Consensus-Storage-Common.html#t:StreamFrom" title="Ouroboros.Consensus.Storage.Common">StreamFrom</a></code>.</p><p>If the range is invalid, <code><a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> is returned.</p><p>See the documentation of <code><a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:Path" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">Path</a></code>.</p></div></div><a href="#g:4" id="g:4"><h1>Reverse path</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ReversePath" class="def">ReversePath</a> blk <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#ReversePath" class="link">Source</a> <a href="#t:ReversePath" class="selflink">#</a></p><div class="doc"><p>A reverse path through the VolatileDB starting at a block in the
 VolatileDB until we reach genesis or leave the VolatileDB.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:StoppedAtGenesis" class="def">StoppedAtGenesis</a></td><td class="doc"><p>The path stopped at genesis</p></td></tr><tr><td class="src"><a id="v:StoppedAt" class="def">StoppedAt</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk) <a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockNo" title="Ouroboros.Consensus.Block.Abstract">BlockNo</a></td><td class="doc"><p>The path stopped at this hash, which is the hash of the predecessor
 of the last block in the path (that was still stored in the
 VolatileDB).</p><p>The block corresponding to the predecessor is <em>not</em> stored in the
 VolatileDB. Either because it is missing, or because it is old and
 has been garbage collected.</p><p>Since block numbers are consecutive, we subtract 1 from the block
 number of the last block to obtain the block number corresponding to
 this hash.</p><p>EBBs share their block number with their predecessor:</p><pre>block:         regular block 1 | EBB | regular block 2
block number:                X |   X | X + 1</pre><p>So when the hash refers to regular block 1, we see that the successor
 block is an EBB and use its block number without subtracting 1.</p><p>Edge case: if there are two or more consecutive EBBs, we might
 predict the wrong block number, but there are no consecutive EBBs in
 practice, they are one epoch apart.</p></td></tr><tr><td class="src">(<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:ReversePath" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">ReversePath</a> blk) <a id="v:::-62-" class="def">::&gt;</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk, <a href="Ouroboros-Consensus-Block-EBB.html#t:IsEBB" title="Ouroboros.Consensus.Block.EBB">IsEBB</a>)</td><td class="doc"><p>Snoc: the block with the given <code><a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a></code> is in the VolatileDB.
 We also track whether it is an EBB or not.</p><p>NOTE: we are intentionally lazy in the spine, as constructing the
 path requires lookups in the VolatileDB's in-memory indices, which
 are logarithmic in the size of the index.</p></td></tr></table></div></div><div class="top"><p class="src"><a id="v:computeReversePath" class="def">computeReversePath</a> <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#computeReversePath" class="link">Source</a> <a href="#v:computeReversePath" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; &#8704; blk. <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a> blk</td><td class="doc"><p>End hash</p></td></tr><tr><td class="src">&#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:ReversePath" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">ReversePath</a> blk)</td><td class="doc"><p>Reverse path from the end point to genesis or the first predecessor
 not in the VolatileDB. Nothing when the end hash is not in the
 VolatileDB.</p></td></tr></table></div><div class="doc"><p>Lazily compute the <code><a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:ReversePath" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">ReversePath</a></code> that starts (i.e., ends) with the given
 <code><a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderHash" title="Ouroboros.Consensus.Block.Abstract">HeaderHash</a></code>.</p></div></div><a href="#g:5" id="g:5"><h1>Reachability</h1></a><div class="top"><p class="src"><a id="v:isReachable" class="def">isReachable</a> <a href="src/Ouroboros.Consensus.Storage.ChainDB.Impl.Paths.html#isReachable" class="link">Source</a> <a href="#v:isReachable" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; &#8704; blk. (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> blk, <a href="Ouroboros-Consensus-Block-Abstract.html#t:GetHeader" title="Ouroboros.Consensus.Block.Abstract">GetHeader</a> blk)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; <a href="Ouroboros-Consensus-Storage-ChainDB-Impl-Paths.html#t:LookupBlockInfo" title="Ouroboros.Consensus.Storage.ChainDB.Impl.Paths">LookupBlockInfo</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk)</td><td class="doc"><p>Chain fragment to connect the point to</p></td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Block-RealPoint.html#t:RealPoint" title="Ouroboros.Consensus.Block.RealPoint">RealPoint</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a> blk))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Try to connect the point <code>P</code> to the chain fragment by chasing the
 predecessors.</p><p>When successful, return a <code><a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a></code>: the number of blocks to roll back
 the chain fragment to the intersection point and a fragment anchored at the
 intersection point containing the <code><a href="Ouroboros-Consensus-Block-Abstract.html#t:HeaderFields" title="Ouroboros.Consensus.Block.Abstract">HeaderFields</a></code> corresponding to the
 blocks needed to connect to <code>P</code>. The intersection point will be the most
 recent intersection point.</p><p>Returns <code><a href="file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> when <code>P</code> is not in the VolatileDB or when <code>P</code> is not
 connected to the given chain fragment.</p><p>POSTCONDITION: the returned number of blocks to roll back is less than or
 equal to the length of the given chain fragment.</p><p>Note that the number of returned points can be smaller than the number of
 blocks to roll back. This means <code>P</code> is on a fork shorter than the given
 chain fragment.</p><p>A <code><a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a></code> is returned iff <code>P</code> is on the chain fragment. Moreover, when
 the number of blocks to roll back is also 0, it must be that <code>P</code> is the tip
 of the chain fragment.</p><p>When the suffix of the <code><a href="Ouroboros-Consensus-Fragment-Diff.html#t:ChainDiff" title="Ouroboros.Consensus.Fragment.Diff">ChainDiff</a></code> is non-empty, <code>P</code> will be the last point
 in the suffix.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.0</p></div></body></html>