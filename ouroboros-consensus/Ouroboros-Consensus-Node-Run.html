<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ouroboros.Consensus.Node.Run</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Consensus.Node.Run.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ouroboros-consensus-0.1.0.0: Consensus layer for the Ouroboros blockchain protocol</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Consensus.Node.Run</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Infrastructure required to run a node</p><p>The definitions in this module are independent from any specific protocol.</p></div></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">class</span> (<a href="Ouroboros-Consensus-Ledger-SupportsProtocol.html#t:LedgerSupportsProtocol" title="Ouroboros.Consensus.Ledger.SupportsProtocol">LedgerSupportsProtocol</a> blk, <a href="Ouroboros-Consensus-HardFork-Abstract.html#t:HasHardForkHistory" title="Ouroboros.Consensus.HardFork.Abstract">HasHardForkHistory</a> blk, <a href="Ouroboros-Consensus-Mempool-API.html#t:ApplyTx" title="Ouroboros.Consensus.Mempool.API">ApplyTx</a> blk, <a href="Ouroboros-Consensus-Mempool-API.html#t:HasTxId" title="Ouroboros.Consensus.Mempool.API">HasTxId</a> (<a href="Ouroboros-Consensus-Mempool-API.html#t:GenTx" title="Ouroboros.Consensus.Mempool.API">GenTx</a> blk), <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:QueryLedger" title="Ouroboros.Consensus.Ledger.Abstract">QueryLedger</a> blk, <a href="Ouroboros-Consensus-Node-NetworkProtocolVersion.html#t:HasNetworkProtocolVersion" title="Ouroboros.Consensus.Node.NetworkProtocolVersion">HasNetworkProtocolVersion</a> blk, <a href="Ouroboros-Consensus-Block-Forge.html#t:CanForge" title="Ouroboros.Consensus.Block.Forge">CanForge</a> blk, Serialise (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> blk)) &#8658; <a id="t:RunNode" class="def">RunNode</a> blk <span class="keyword">where</span> <a href="src/Ouroboros.Consensus.Node.Run.html#RunNode" class="link">Source</a> <a href="#t:RunNode" class="selflink">#</a></p><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Ouroboros-Consensus-Node-Run.html#v:nodeBlockMatchesHeader" title="Ouroboros.Consensus.Node.Run">nodeBlockMatchesHeader</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeBlockFetchSize" title="Ouroboros.Consensus.Node.Run">nodeBlockFetchSize</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeIsEBB" title="Ouroboros.Consensus.Node.Run">nodeIsEBB</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeImmDbChunkInfo" title="Ouroboros.Consensus.Node.Run">nodeImmDbChunkInfo</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeStartTime" title="Ouroboros.Consensus.Node.Run">nodeStartTime</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeNetworkMagic" title="Ouroboros.Consensus.Node.Run">nodeNetworkMagic</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeProtocolMagicId" title="Ouroboros.Consensus.Node.Run">nodeProtocolMagicId</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeHashInfo" title="Ouroboros.Consensus.Node.Run">nodeHashInfo</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeMaxBlockSize" title="Ouroboros.Consensus.Node.Run">nodeMaxBlockSize</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeMaxTxSize" title="Ouroboros.Consensus.Node.Run">nodeMaxTxSize</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeBlockEncodingOverhead" title="Ouroboros.Consensus.Node.Run">nodeBlockEncodingOverhead</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeCheckIntegrity" title="Ouroboros.Consensus.Node.Run">nodeCheckIntegrity</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeTxInBlockSize" title="Ouroboros.Consensus.Node.Run">nodeTxInBlockSize</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeBlockWithInfo" title="Ouroboros.Consensus.Node.Run">nodeEncodeBlockWithInfo</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeHeader" title="Ouroboros.Consensus.Node.Run">nodeEncodeHeader</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeWrappedHeader" title="Ouroboros.Consensus.Node.Run">nodeEncodeWrappedHeader</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeGenTx" title="Ouroboros.Consensus.Node.Run">nodeEncodeGenTx</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeGenTxId" title="Ouroboros.Consensus.Node.Run">nodeEncodeGenTxId</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeHeaderHash" title="Ouroboros.Consensus.Node.Run">nodeEncodeHeaderHash</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeLedgerState" title="Ouroboros.Consensus.Node.Run">nodeEncodeLedgerState</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeConsensusState" title="Ouroboros.Consensus.Node.Run">nodeEncodeConsensusState</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeApplyTxError" title="Ouroboros.Consensus.Node.Run">nodeEncodeApplyTxError</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeAnnTip" title="Ouroboros.Consensus.Node.Run">nodeEncodeAnnTip</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeQuery" title="Ouroboros.Consensus.Node.Run">nodeEncodeQuery</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeEncodeResult" title="Ouroboros.Consensus.Node.Run">nodeEncodeResult</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeHeader" title="Ouroboros.Consensus.Node.Run">nodeDecodeHeader</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeWrappedHeader" title="Ouroboros.Consensus.Node.Run">nodeDecodeWrappedHeader</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeBlock" title="Ouroboros.Consensus.Node.Run">nodeDecodeBlock</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeGenTx" title="Ouroboros.Consensus.Node.Run">nodeDecodeGenTx</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeGenTxId" title="Ouroboros.Consensus.Node.Run">nodeDecodeGenTxId</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeHeaderHash" title="Ouroboros.Consensus.Node.Run">nodeDecodeHeaderHash</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeLedgerState" title="Ouroboros.Consensus.Node.Run">nodeDecodeLedgerState</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeConsensusState" title="Ouroboros.Consensus.Node.Run">nodeDecodeConsensusState</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeApplyTxError" title="Ouroboros.Consensus.Node.Run">nodeDecodeApplyTxError</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeAnnTip" title="Ouroboros.Consensus.Node.Run">nodeDecodeAnnTip</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeQuery" title="Ouroboros.Consensus.Node.Run">nodeDecodeQuery</a>, <a href="Ouroboros-Consensus-Node-Run.html#v:nodeDecodeResult" title="Ouroboros.Consensus.Node.Run">nodeDecodeResult</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:nodeBlockMatchesHeader" class="def">nodeBlockMatchesHeader</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk &#8594; blk &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeBlockMatchesHeader" class="link">Source</a> <a href="#v:nodeBlockMatchesHeader" class="selflink">#</a></p><p class="src"><a id="v:nodeBlockFetchSize" class="def">nodeBlockFetchSize</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:SizeInBytes" title="Ouroboros.Consensus.Storage.Common">SizeInBytes</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeBlockFetchSize" class="link">Source</a> <a href="#v:nodeBlockFetchSize" class="selflink">#</a></p><p class="src"><a id="v:nodeIsEBB" class="def">nodeIsEBB</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:EpochNo" title="Cardano.Slotting.Slot">EpochNo</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeIsEBB" class="link">Source</a> <a href="#v:nodeIsEBB" class="selflink">#</a></p><p class="src"><a id="v:nodeImmDbChunkInfo" class="def">nodeImmDbChunkInfo</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-ImmutableDB-Chunks-Internal.html#t:ChunkInfo" title="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal">ChunkInfo</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeImmDbChunkInfo" class="link">Source</a> <a href="#v:nodeImmDbChunkInfo" class="selflink">#</a></p><p class="src"><a id="v:nodeStartTime" class="def">nodeStartTime</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="Ouroboros-Consensus-BlockchainTime-WallClock-Types.html#t:SystemStart" title="Ouroboros.Consensus.BlockchainTime.WallClock.Types">SystemStart</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeStartTime" class="link">Source</a> <a href="#v:nodeStartTime" class="selflink">#</a></p><p class="src"><a id="v:nodeNetworkMagic" class="def">nodeNetworkMagic</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Magic.html#t:NetworkMagic" title="Ouroboros.Network.Magic">NetworkMagic</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeNetworkMagic" class="link">Source</a> <a href="#v:nodeNetworkMagic" class="selflink">#</a></p><p class="src"><a id="v:nodeProtocolMagicId" class="def">nodeProtocolMagicId</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-wrapper-1.3.0/noopt/doc/html/cardano-crypto-wrapper/Cardano-Crypto-ProtocolMagic.html#t:ProtocolMagicId" title="Cardano.Crypto.ProtocolMagic">ProtocolMagicId</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeProtocolMagicId" class="link">Source</a> <a href="#v:nodeProtocolMagicId" class="selflink">#</a></p><p class="src"><a id="v:nodeHashInfo" class="def">nodeHashInfo</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-ImmutableDB-Types.html#t:HashInfo" title="Ouroboros.Consensus.Storage.ImmutableDB.Types">HashInfo</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeHashInfo" class="link">Source</a> <a href="#v:nodeHashInfo" class="selflink">#</a></p><div class="doc"><p>Hash serialisation</p></div><p class="src"><a id="v:nodeMaxBlockSize" class="def">nodeMaxBlockSize</a> &#8759; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:LedgerState" title="Ouroboros.Consensus.Ledger.Abstract">LedgerState</a> blk &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeMaxBlockSize" class="link">Source</a> <a href="#v:nodeMaxBlockSize" class="selflink">#</a></p><div class="doc"><p>The maximum block size in bytes according to the currently adopted
 protocol parameters of the ledger state.</p></div><p class="src"><a id="v:nodeMaxTxSize" class="def">nodeMaxTxSize</a> &#8759; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:LedgerState" title="Ouroboros.Consensus.Ledger.Abstract">LedgerState</a> blk &#8594; <a href="Ouroboros-Consensus-Mempool-API.html#t:TxSizeInBytes" title="Ouroboros.Consensus.Mempool.API">TxSizeInBytes</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeMaxTxSize" class="link">Source</a> <a href="#v:nodeMaxTxSize" class="selflink">#</a></p><div class="doc"><p>The maximum transaction size in bytes according to the currently
 adopted protocol parameters of the ledger state.</p></div><p class="src"><a id="v:nodeBlockEncodingOverhead" class="def">nodeBlockEncodingOverhead</a> &#8759; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:LedgerState" title="Ouroboros.Consensus.Ledger.Abstract">LedgerState</a> blk &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeBlockEncodingOverhead" class="link">Source</a> <a href="#v:nodeBlockEncodingOverhead" class="selflink">#</a></p><div class="doc"><p>The block encoding overhead size in bytes.</p><p>This encompasses the overhead in bytes for everything that is encoded
 within a block, excluding the actual generalized transactions. Given
 this, along with the <code><a href="Ouroboros-Consensus-Node-Run.html#v:nodeMaxBlockSize" title="Ouroboros.Consensus.Node.Run">nodeMaxBlockSize</a></code>, it is possible to determine the
 amount of generalized transactions that we can include in a block.</p></div><p class="src"><a id="v:nodeCheckIntegrity" class="def">nodeCheckIntegrity</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; blk &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeCheckIntegrity" class="link">Source</a> <a href="#v:nodeCheckIntegrity" class="selflink">#</a></p><div class="doc"><p>Check the integrity of a block, i.e., that it has not been corrupted by
 a bitflip.</p><p>Check this by, e.g., verifying whether the block has a valid signature
 and that the hash of the body matches the body hash stores in the header.</p><p>This does not check the validity of the contents of the block, e.g.,
 whether the transactions are valid w.r.t. the ledger, or whether it's
 sent by a malicious node.</p></div><p class="src"><a id="v:nodeAddHeaderEnvelope" class="def">nodeAddHeaderEnvelope</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeAddHeaderEnvelope" class="link">Source</a> <a href="#v:nodeAddHeaderEnvelope" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Block-EBB.html#t:IsEBB" title="Ouroboros.Consensus.Block.EBB">IsEBB</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:SizeInBytes" title="Ouroboros.Consensus.Storage.Common">SizeInBytes</a></td><td class="doc"><p>Block size</p></td></tr><tr><td class="src">&#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/bytestring-0.10.8.2/Data-ByteString-Lazy.html#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/bytestring-0.10.8.2/Data-ByteString-Lazy.html#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>When extracting the bytes corresponding to header from a serialised
 block, it may be necessary to add an envelope to it to obtain a
 bytestring that can actually be decoded as a header.</p><p>For example, a CBOR tag may have to be added in front.</p></div><p class="src"><a id="v:nodeTxInBlockSize" class="def">nodeTxInBlockSize</a> &#8759; <a href="Ouroboros-Consensus-Mempool-API.html#t:GenTx" title="Ouroboros.Consensus.Mempool.API">GenTx</a> blk &#8594; <a href="Ouroboros-Consensus-Mempool-API.html#t:TxSizeInBytes" title="Ouroboros.Consensus.Mempool.API">TxSizeInBytes</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeTxInBlockSize" class="link">Source</a> <a href="#v:nodeTxInBlockSize" class="selflink">#</a></p><div class="doc"><p>Return the post-serialisation size in bytes of a <code><a href="Ouroboros-Consensus-Mempool-API.html#t:GenTx" title="Ouroboros.Consensus.Mempool.API">GenTx</a></code> /when it is
 embedded in a block/. This size might differ from the size of the
 serialisation used to send and receive the transaction across the
 network.</p><p>This size is used to compute how many transaction we can put in a block
 when forging one.</p><p>For example, CBOR-in-CBOR could be used when sending the transaction
 across the network, requiring a few extra bytes compared to the actual
 in-block serialisation. Another example is the transaction of the
 hard-fork combinator which will include an envelope indicating its era
 when sent across the network. However, when embedded in the respective
 era's block, there is no need for such envelope.</p><p>Can be implemented by serialising the <code><a href="Ouroboros-Consensus-Mempool-API.html#t:GenTx" title="Ouroboros.Consensus.Mempool.API">GenTx</a></code>, but, ideally, this is
 implement more efficiently. E.g., by returning the length of the
 annotation.</p></div><p class="src"><a id="v:nodeInitChainDB" class="def">nodeInitChainDB</a> &#8759; <a href="Ouroboros-Consensus-Util-IOLike.html#t:IOLike" title="Ouroboros.Consensus.Util.IOLike">IOLike</a> m &#8658; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Storage-ChainDB-Init.html#t:InitChainDB" title="Ouroboros.Consensus.Storage.ChainDB.Init">InitChainDB</a> m blk &#8594; m () <a href="src/Ouroboros.Consensus.Node.Run.html#nodeInitChainDB" class="link">Source</a> <a href="#v:nodeInitChainDB" class="selflink">#</a></p><div class="doc"><p>This function is called when starting up the node, right after the
 ChainDB was opened, and before we connect to other nodes and start block
 production.</p><p>This function can be used to, for example, create the genesis EBB in case
 the chain(DB) is empty.</p><p>We only provide a limited interface to the chain DB. This is primarily
 useful for the definition of combinators (which may need to turn a
 <code><a href="Ouroboros-Consensus-Storage-ChainDB-Init.html#t:InitChainDB" title="Ouroboros.Consensus.Storage.ChainDB.Init">InitChainDB</a></code> for one type of block into an <code><a href="Ouroboros-Consensus-Storage-ChainDB-Init.html#t:InitChainDB" title="Ouroboros.Consensus.Storage.ChainDB.Init">InitChainDB</a></code> for a closely
 related type of block).</p></div><p class="src"><a id="v:nodeExceptionIsFatal" class="def">nodeExceptionIsFatal</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; <a href="Ouroboros-Consensus-Util-IOLike.html#t:SomeException" title="Ouroboros.Consensus.Util.IOLike">SomeException</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Ouroboros-Consensus-Node-Exit.html#t:ExitReason" title="Ouroboros.Consensus.Node.Exit">ExitReason</a> <a href="src/Ouroboros.Consensus.Node.Run.html#nodeExceptionIsFatal" class="link">Source</a> <a href="#v:nodeExceptionIsFatal" class="selflink">#</a></p><div class="doc"><p>This function is called to determine whether a thrown exception is
 fatal and should shut down the node or not. If fatal, it should return a
 precise reason why. See <code><a href="Ouroboros-Consensus-Node.html#v:Exit" title="Ouroboros.Consensus.Node">Exit</a></code> for more details.</p><p>One only has to handle exceptions specific to this <code>blk</code>.</p><p>Return <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Nothing" title="GHC.Maybe">Nothing</a></code> for exceptions not related to <code>blk</code>, they will be
 classified by the existing error policy.</p><p>Also return <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Nothing" title="GHC.Maybe">Nothing</a></code> for exceptions <em>related</em> to <code>blk</code> that are /not
 fatal/, they will fall through to the default policy.</p><p>NOTE: this is not about header<em>block</em>transaction validation errors, etc.
 These will not shut down the node and are handled already.</p><p>For example, if some exception indicates database corruption which could
 not be detected by the database, one could classify that exception as
 <code>DatabaseCorruption</code>, which would trigger an automatic database
 validation on the next startup.</p><p>In case you have no exceptions to handle specially, return <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Nothing" title="GHC.Maybe">Nothing</a></code>.
 This is what the default implementation does.</p></div><p class="src"><a id="v:nodeEncodeBlockWithInfo" class="def">nodeEncodeBlockWithInfo</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; blk &#8594; <a href="Ouroboros-Consensus-Storage-Common.html#t:BinaryInfo" title="Ouroboros.Consensus.Storage.Common">BinaryInfo</a> Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeBlockWithInfo" class="link">Source</a> <a href="#v:nodeEncodeBlockWithInfo" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeBlock" class="def">nodeEncodeBlock</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeBlock" class="link">Source</a> <a href="#v:nodeEncodeBlock" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeHeader" class="def">nodeEncodeHeader</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Node-NetworkProtocolVersion.html#t:SerialisationVersion" title="Ouroboros.Consensus.Node.NetworkProtocolVersion">SerialisationVersion</a> blk &#8594; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeHeader" class="link">Source</a> <a href="#v:nodeEncodeHeader" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeWrappedHeader" class="def">nodeEncodeWrappedHeader</a> &#8759; <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Node-NetworkProtocolVersion.html#t:SerialisationAcrossNetwork" title="Ouroboros.Consensus.Node.NetworkProtocolVersion">SerialisationAcrossNetwork</a> blk &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Block.html#t:Serialised" title="Ouroboros.Network.Block">Serialised</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeWrappedHeader" class="link">Source</a> <a href="#v:nodeEncodeWrappedHeader" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeGenTx" class="def">nodeEncodeGenTx</a> &#8759; <a href="Ouroboros-Consensus-Mempool-API.html#t:GenTx" title="Ouroboros.Consensus.Mempool.API">GenTx</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeGenTx" class="link">Source</a> <a href="#v:nodeEncodeGenTx" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeGenTxId" class="def">nodeEncodeGenTxId</a> &#8759; <a href="Ouroboros-Consensus-Mempool-API.html#t:GenTxId" title="Ouroboros.Consensus.Mempool.API">GenTxId</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeGenTxId" class="link">Source</a> <a href="#v:nodeEncodeGenTxId" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeHeaderHash" class="def">nodeEncodeHeaderHash</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeHeaderHash" class="link">Source</a> <a href="#v:nodeEncodeHeaderHash" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeLedgerState" class="def">nodeEncodeLedgerState</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:LedgerState" title="Ouroboros.Consensus.Ledger.Abstract">LedgerState</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeLedgerState" class="link">Source</a> <a href="#v:nodeEncodeLedgerState" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeConsensusState" class="def">nodeEncodeConsensusState</a> &#8759; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:ConsensusState" title="Ouroboros.Consensus.Protocol.Abstract">ConsensusState</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockProtocol" title="Ouroboros.Consensus.Block.Abstract">BlockProtocol</a> blk) &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeConsensusState" class="link">Source</a> <a href="#v:nodeEncodeConsensusState" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeApplyTxError" class="def">nodeEncodeApplyTxError</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; <a href="Ouroboros-Consensus-Mempool-API.html#t:ApplyTxErr" title="Ouroboros.Consensus.Mempool.API">ApplyTxErr</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeApplyTxError" class="link">Source</a> <a href="#v:nodeEncodeApplyTxError" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeAnnTip" class="def">nodeEncodeAnnTip</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; <a href="Ouroboros-Consensus-HeaderValidation.html#t:AnnTip" title="Ouroboros.Consensus.HeaderValidation">AnnTip</a> blk &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeAnnTip" class="link">Source</a> <a href="#v:nodeEncodeAnnTip" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeQuery" class="def">nodeEncodeQuery</a> &#8759; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:Query" title="Ouroboros.Consensus.Ledger.Abstract">Query</a> blk result &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeQuery" class="link">Source</a> <a href="#v:nodeEncodeQuery" class="selflink">#</a></p><p class="src"><a id="v:nodeEncodeResult" class="def">nodeEncodeResult</a> &#8759; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:Query" title="Ouroboros.Consensus.Ledger.Abstract">Query</a> blk result &#8594; result &#8594; Encoding <a href="src/Ouroboros.Consensus.Node.Run.html#nodeEncodeResult" class="link">Source</a> <a href="#v:nodeEncodeResult" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeHeader" class="def">nodeDecodeHeader</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Node-NetworkProtocolVersion.html#t:SerialisationVersion" title="Ouroboros.Consensus.Node.NetworkProtocolVersion">SerialisationVersion</a> blk &#8594; Decoder s (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/bytestring-0.10.8.2/Data-ByteString-Lazy.html#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> &#8594; <a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeHeader" class="link">Source</a> <a href="#v:nodeDecodeHeader" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeWrappedHeader" class="def">nodeDecodeWrappedHeader</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Node-NetworkProtocolVersion.html#t:SerialisationAcrossNetwork" title="Ouroboros.Consensus.Node.NetworkProtocolVersion">SerialisationAcrossNetwork</a> blk &#8594; Decoder s (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Block.html#t:Serialised" title="Ouroboros.Network.Block">Serialised</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk)) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeWrappedHeader" class="link">Source</a> <a href="#v:nodeDecodeWrappedHeader" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeBlock" class="def">nodeDecodeBlock</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Block-Abstract.html#t:CodecConfig" title="Ouroboros.Consensus.Block.Abstract">CodecConfig</a> blk &#8594; Decoder s (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/bytestring-0.10.8.2/Data-ByteString-Lazy.html#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> &#8594; blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeBlock" class="link">Source</a> <a href="#v:nodeDecodeBlock" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeGenTx" class="def">nodeDecodeGenTx</a> &#8759; &#8704; s. Decoder s (<a href="Ouroboros-Consensus-Mempool-API.html#t:GenTx" title="Ouroboros.Consensus.Mempool.API">GenTx</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeGenTx" class="link">Source</a> <a href="#v:nodeDecodeGenTx" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeGenTxId" class="def">nodeDecodeGenTxId</a> &#8759; &#8704; s. Decoder s (<a href="Ouroboros-Consensus-Mempool-API.html#t:GenTxId" title="Ouroboros.Consensus.Mempool.API">GenTxId</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeGenTxId" class="link">Source</a> <a href="#v:nodeDecodeGenTxId" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeHeaderHash" class="def">nodeDecodeHeaderHash</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; Decoder s (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeHeaderHash" class="link">Source</a> <a href="#v:nodeDecodeHeaderHash" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeLedgerState" class="def">nodeDecodeLedgerState</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; Decoder s (<a href="Ouroboros-Consensus-Ledger-Abstract.html#t:LedgerState" title="Ouroboros.Consensus.Ledger.Abstract">LedgerState</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeLedgerState" class="link">Source</a> <a href="#v:nodeDecodeLedgerState" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeConsensusState" class="def">nodeDecodeConsensusState</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; Decoder s (<a href="Ouroboros-Consensus-Protocol-Abstract.html#t:ConsensusState" title="Ouroboros.Consensus.Protocol.Abstract">ConsensusState</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockProtocol" title="Ouroboros.Consensus.Block.Abstract">BlockProtocol</a> blk)) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeConsensusState" class="link">Source</a> <a href="#v:nodeDecodeConsensusState" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeApplyTxError" class="def">nodeDecodeApplyTxError</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; Decoder s (<a href="Ouroboros-Consensus-Mempool-API.html#t:ApplyTxErr" title="Ouroboros.Consensus.Mempool.API">ApplyTxErr</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeApplyTxError" class="link">Source</a> <a href="#v:nodeDecodeApplyTxError" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeAnnTip" class="def">nodeDecodeAnnTip</a> &#8759; &#8704; s. <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> blk &#8594; Decoder s (<a href="Ouroboros-Consensus-HeaderValidation.html#t:AnnTip" title="Ouroboros.Consensus.HeaderValidation">AnnTip</a> blk) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeAnnTip" class="link">Source</a> <a href="#v:nodeDecodeAnnTip" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeQuery" class="def">nodeDecodeQuery</a> &#8759; &#8704; s. Decoder s (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/Ouroboros-Network-Protocol-LocalStateQuery-Codec.html#t:Some" title="Ouroboros.Network.Protocol.LocalStateQuery.Codec">Some</a> (<a href="Ouroboros-Consensus-Ledger-Abstract.html#t:Query" title="Ouroboros.Consensus.Ledger.Abstract">Query</a> blk)) <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeQuery" class="link">Source</a> <a href="#v:nodeDecodeQuery" class="selflink">#</a></p><p class="src"><a id="v:nodeDecodeResult" class="def">nodeDecodeResult</a> &#8759; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:Query" title="Ouroboros.Consensus.Ledger.Abstract">Query</a> blk result &#8594; &#8704; s. Decoder s result <a href="src/Ouroboros.Consensus.Node.Run.html#nodeDecodeResult" class="link">Source</a> <a href="#v:nodeDecodeResult" class="selflink">#</a></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>