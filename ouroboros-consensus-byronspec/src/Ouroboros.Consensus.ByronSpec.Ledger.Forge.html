<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Forge</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Forge.html#forgeByronSpecBlock"><span class="hs-identifier">forgeByronSpecBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Chain.STS.Block</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.Core</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.Update</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Abstract</span></a></span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Accessors</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Block</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Conversions.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Conversions</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.GenTx.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.GenTx</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GenTx</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Ledger.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Ledger</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Mempool.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Mempool</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Orphans.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Forging
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Forge.html#forgeByronSpecBlock"><span class="hs-identifier hs-type">forgeByronSpecBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span>
</span><span id="line-23"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-24"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#ByronSpecBlock"><span class="hs-identifier hs-type">ByronSpecBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Validated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#ByronSpecBlock"><span class="hs-identifier hs-type">ByronSpecBlock</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-26"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.VKey</span></span><span>
</span><span id="line-27"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#ByronSpecBlock"><span class="hs-identifier hs-type">ByronSpecBlock</span></a></span><span>
</span><span id="line-28"></span><span id="forgeByronSpecBlock"><span class="annot"><span class="annottext">forgeByronSpecBlock :: BlockNo
-&gt; SlotNo
-&gt; Ticked (LedgerState ByronSpecBlock)
-&gt; [Validated (GenTx ByronSpecBlock)]
-&gt; VKey
-&gt; ByronSpecBlock
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Forge.html#forgeByronSpecBlock"><span class="hs-identifier hs-var hs-var">forgeByronSpecBlock</span></a></span></span><span> </span><span id="local-6989586621679216645"><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679216645"><span class="hs-identifier hs-var">curBlockNo</span></a></span></span><span> </span><span id="local-6989586621679216644"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679216644"><span class="hs-identifier hs-var">curSlotNo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Ledger.html#TickedByronSpecLedgerState"><span class="hs-identifier hs-type">TickedByronSpecLedgerState</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679216642"><span class="annot"><a href="#local-6989586621679216642"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216641"><span class="annot"><span class="annottext">[Validated (GenTx ByronSpecBlock)]
</span><a href="#local-6989586621679216641"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span id="local-6989586621679216640"><span class="annot"><span class="annottext">VKey
</span><a href="#local-6989586621679216640"><span class="hs-identifier hs-var">vkey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="annottext">ByronSpecBlock :: Block -&gt; BlockNo -&gt; Hash -&gt; ByronSpecBlock
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#ByronSpecBlock"><span class="hs-identifier hs-type">ByronSpecBlock</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><span class="annottext">byronSpecBlock :: Block
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#byronSpecBlock"><span class="hs-identifier hs-var">byronSpecBlock</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679216637"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-31"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">byronSpecBlockNo :: BlockNo
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#byronSpecBlockNo"><span class="hs-identifier hs-var">byronSpecBlockNo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679216645"><span class="hs-identifier hs-var">curBlockNo</span></a></span><span>
</span><span id="line-32"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">byronSpecBlockHash :: Hash
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Block.html#byronSpecBlockHash"><span class="hs-identifier hs-var">byronSpecBlockHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Hash
</span><span class="hs-identifier hs-var">Spec.bhHash</span></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; Hash) -&gt; BlockHeader -&gt; Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; BlockHeader
</span><span class="hs-identifier hs-var hs-var">Spec._bHeader</span></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679216637"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-33"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679216632"><span class="annot"><span class="annottext">[DCert]
</span><a href="#local-6989586621679216632"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216631"><span class="annot"><span class="annottext">[Tx]
</span><a href="#local-6989586621679216631"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216630"><span class="annot"><span class="annottext">[UProp]
</span><a href="#local-6989586621679216630"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216629"><span class="annot"><span class="annottext">[Vote]
</span><a href="#local-6989586621679216629"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><span class="annottext">[ByronSpecGenTx] -&gt; ([DCert], [Tx], [UProp], [Vote])
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.GenTx.html#partition"><span class="hs-identifier hs-var">GenTx.partition</span></a></span><span>
</span><span id="line-37"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Validated (GenTx ByronSpecBlock) -&gt; ByronSpecGenTx)
-&gt; [Validated (GenTx ByronSpecBlock)] -&gt; [ByronSpecGenTx]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenTx ByronSpecBlock -&gt; ByronSpecGenTx
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Mempool.html#unByronSpecGenTx"><span class="hs-identifier hs-var hs-var">unByronSpecGenTx</span></a></span><span> </span><span class="annot"><span class="annottext">(GenTx ByronSpecBlock -&gt; ByronSpecGenTx)
-&gt; (Validated (GenTx ByronSpecBlock) -&gt; GenTx ByronSpecBlock)
-&gt; Validated (GenTx ByronSpecBlock)
-&gt; ByronSpecGenTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Validated (GenTx ByronSpecBlock) -&gt; GenTx ByronSpecBlock
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Mempool.html#forgetValidatedByronSpecGenTx"><span class="hs-identifier hs-var hs-var">forgetValidatedByronSpecGenTx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Validated (GenTx ByronSpecBlock)]
</span><a href="#local-6989586621679216641"><span class="hs-identifier hs-var">txs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-comment">-- TODO: Don't take protocol version from ledger state</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-comment">-- &lt;https://github.com/input-output-hk/ouroboros-network/issues/1495&gt;</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="#local-6989586621679216637"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.Block</span></span><span>
</span><span id="line-42"></span><span>    </span><span id="local-6989586621679216637"><span class="annot"><span class="annottext">block :: Block
</span><a href="#local-6989586621679216637"><span class="hs-identifier hs-var hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash
-&gt; Slot
-&gt; VKey
-&gt; ProtVer
-&gt; [DCert]
-&gt; Maybe UProp
-&gt; [Vote]
-&gt; [Tx]
-&gt; Block
</span><span class="hs-identifier hs-var">Spec.mkBlock</span></span><span>
</span><span id="line-43"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetChainState Hash
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateHash"><span class="hs-identifier hs-var">getChainStateHash</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679216642"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Slot
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Conversions.html#toByronSpecSlotNo"><span class="hs-identifier hs-var">toByronSpecSlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679216644"><span class="hs-identifier hs-var">curSlotNo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>              </span><span class="annot"><span class="annottext">VKey
</span><a href="#local-6989586621679216640"><span class="hs-identifier hs-var">vkey</span></a></span><span>
</span><span id="line-46"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UPIState -&gt; ProtVer
</span><span class="hs-identifier hs-var">Spec.protocolVersion</span></span><span> </span><span class="annot"><span class="annottext">(UPIState -&gt; ProtVer) -&gt; UPIState -&gt; ProtVer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GetChainState UPIState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateUPIState"><span class="hs-identifier hs-var">getChainStateUPIState</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679216642"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>              </span><span class="annot"><span class="annottext">[DCert]
</span><a href="#local-6989586621679216632"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-48"></span><span>              </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[UProp]
</span><a href="#local-6989586621679216630"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-49"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe UProp
forall a. Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-50"></span><span>                 </span><span class="hs-special">[</span><span id="local-6989586621679216619"><span class="annot"><span class="annottext">UProp
</span><a href="#local-6989586621679216619"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UProp -&gt; Maybe UProp
forall a. a -&gt; Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UProp
</span><a href="#local-6989586621679216619"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-51"></span><span>                 </span><span class="annot"><span class="annottext">[UProp]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe UProp
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;forgeByronSpecBlock: multiple update proposals&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>              </span><span class="annot"><span class="annottext">[Vote]
</span><a href="#local-6989586621679216629"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-53"></span><span>              </span><span class="annot"><span class="annottext">[Tx]
</span><a href="#local-6989586621679216631"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-54"></span></pre></body></html>