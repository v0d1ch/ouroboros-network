<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- | Genesis config for the spec</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Intended for qualified import</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- &gt; import           Ouroboros.Consensus.ByronSpec.Ledger.Genesis (ByronSpecGenesis)</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- &gt; import qualified Ouroboros.Consensus.ByronSpec.Ledger.Genesis as Genesis</span><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Genesis</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>    </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPBftThreshold"><span class="hs-identifier hs-var">modPBftThreshold</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modFeeParams"><span class="hs-identifier hs-var">modFeeParams</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modUtxo"><span class="hs-identifier hs-var">modUtxo</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modUtxoValues"><span class="hs-identifier hs-var">modUtxoValues</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParams"><span class="hs-identifier hs-var">modPParams</span></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- * Conversions</span><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#toChainEnv"><span class="hs-identifier hs-var">toChainEnv</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#fromChainEnv"><span class="hs-identifier hs-var">fromChainEnv</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Coerce</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coerce</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-blockchain-0.1.0.0/noopt/doc/html/cs-blockchain/src/Cardano.Spec.Chain.STS.Rule.Chain.html"><span class="hs-identifier">Cardano.Spec.Chain.STS.Rule.Chain</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Spec</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/small-steps-0.1.0.0/noopt/doc/html/small-steps/src/Control.State.Transition.html"><span class="hs-identifier">Control.State.Transition</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Spec</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Core.html"><span class="hs-identifier">Ledger.Core</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Spec</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html"><span class="hs-identifier">Ledger.Update</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Spec</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.UTxO.html"><span class="hs-identifier">Ledger.UTxO</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Spec</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Orphans.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Orphans</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Genesis config
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">-- | The equivalent of the genesis config for the abstract ledger</span><span>
</span><a name="line-37"></a><span class="hs-keyword">data</span><span> </span><a name="ByronSpecGenesis"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier">ByronSpecGenesis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ByronSpecGenesis"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier">ByronSpecGenesis</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-38"></a><span>      </span><a name="byronSpecGenesisDelegators"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#byronSpecGenesisDelegators"><span class="hs-identifier">byronSpecGenesisDelegators</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Core.html#VKeyGenesis"><span class="hs-identifier hs-type">Spec.VKeyGenesis</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="byronSpecGenesisInitUtxo"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#byronSpecGenesisInitUtxo"><span class="hs-identifier">byronSpecGenesisInitUtxo</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.UTxO.html#UTxO"><span class="hs-identifier hs-type">Spec.UTxO</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="byronSpecGenesisInitPParams"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#byronSpecGenesisInitPParams"><span class="hs-identifier">byronSpecGenesisInitPParams</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="byronSpecGenesisSecurityParam"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#byronSpecGenesisSecurityParam"><span class="hs-identifier">byronSpecGenesisSecurityParam</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Core.html#BlockCount"><span class="hs-identifier hs-type">Spec.BlockCount</span></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-43"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-identifier">modPBftThreshold</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span>
</span><a name="line-47"></a><a name="modPBftThreshold"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPBftThreshold"><span class="hs-identifier">modPBftThreshold</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParams"><span class="hs-identifier hs-var">modPParams</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParamsPBftThreshold"><span class="hs-identifier hs-var">modPParamsPBftThreshold</span></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- | Modify the @a@ and @b@ fee parameters</span><span>
</span><a name="line-50"></a><span class="hs-identifier">modFeeParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span>
</span><a name="line-52"></a><a name="modFeeParams"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modFeeParams"><span class="hs-identifier">modFeeParams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParams"><span class="hs-identifier hs-var">modPParams</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParamsFeeParams"><span class="hs-identifier hs-var">modPParamsFeeParams</span></a><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">-- | Adjust all values in the initial UTxO equally</span><span>
</span><a name="line-55"></a><span class="hs-identifier">modUtxoValues</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span>
</span><a name="line-56"></a><a name="modUtxoValues"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modUtxoValues"><span class="hs-identifier">modUtxoValues</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modUtxo"><span class="hs-identifier hs-var">modUtxo</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.UTxO.html#mapUTxOValues"><span class="hs-identifier hs-var">Spec.mapUTxOValues</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerce</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-identifier">modUtxo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.UTxO.html#UTxO"><span class="hs-identifier hs-type">Spec.UTxO</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.UTxO.html#UTxO"><span class="hs-identifier hs-type">Spec.UTxO</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span>
</span><a name="line-59"></a><a name="modUtxo"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modUtxo"><span class="hs-identifier">modUtxo</span></a></a><span> </span><a name="local-6989586621679176886"><a href="#local-6989586621679176886"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679176887"><a href="#local-6989586621679176887"><span class="hs-identifier">genesis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176887"><span class="hs-identifier hs-var">genesis</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-60"></a><span>      </span><span class="hs-identifier">byronSpecGenesisInitUtxo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176886"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">byronSpecGenesisInitUtxo</span><span> </span><a href="#local-6989586621679176887"><span class="hs-identifier hs-var">genesis</span></a><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-identifier">modPParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span>
</span><a name="line-65"></a><a name="modPParams"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParams"><span class="hs-identifier">modPParams</span></a></a><span> </span><a name="local-6989586621679176888"><a href="#local-6989586621679176888"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679176889"><a href="#local-6989586621679176889"><span class="hs-identifier">genesis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176889"><span class="hs-identifier hs-var">genesis</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-66"></a><span>      </span><span class="hs-identifier">byronSpecGenesisInitPParams</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176888"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">byronSpecGenesisInitPParams</span><span> </span><a href="#local-6989586621679176889"><span class="hs-identifier hs-var">genesis</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Internal: accessors for the protocol parameters
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-identifier">modPParamsPBftThreshold</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span>
</span><a name="line-75"></a><a name="modPParamsPBftThreshold"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParamsPBftThreshold"><span class="hs-identifier">modPParamsPBftThreshold</span></a></a><span> </span><a name="local-6989586621679176890"><a href="#local-6989586621679176890"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679176891"><a href="#local-6989586621679176891"><span class="hs-identifier">pparams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176891"><span class="hs-identifier hs-var">pparams</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-76"></a><span>      </span><span class="hs-identifier">Spec._bkSgnCntT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#BkSgnCntT"><span class="hs-identifier hs-var">Spec.BkSgnCntT</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679176890"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679176892"><span class="hs-identifier hs-var">threshold</span></a><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-79"></a><span>    </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#BkSgnCntT"><span class="hs-identifier hs-var">Spec.BkSgnCntT</span></a><span> </span><a name="local-6989586621679176892"><a href="#local-6989586621679176892"><span class="hs-identifier">threshold</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Spec._bkSgnCntT</span><span> </span><a href="#local-6989586621679176891"><span class="hs-identifier hs-var">pparams</span></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">modPParamsFeeParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Spec.PParams</span></a><span>
</span><a name="line-83"></a><a name="modPParamsFeeParams"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#modPParamsFeeParams"><span class="hs-identifier">modPParamsFeeParams</span></a></a><span> </span><a name="local-6989586621679176893"><a href="#local-6989586621679176893"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679176894"><a href="#local-6989586621679176894"><span class="hs-identifier">pparams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176894"><span class="hs-identifier hs-var">pparams</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-84"></a><span>      </span><span class="hs-identifier">Spec._factorA</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#FactorA"><span class="hs-identifier hs-var">Spec.FactorA</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679176893"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679176895"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176896"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Spec._factorB</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#FactorB"><span class="hs-identifier hs-var">Spec.FactorB</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679176893"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679176895"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176896"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-88"></a><span>    </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#FactorA"><span class="hs-identifier hs-var">Spec.FactorA</span></a><span> </span><a name="local-6989586621679176895"><a href="#local-6989586621679176895"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Spec._factorA</span><span> </span><a href="#local-6989586621679176894"><span class="hs-identifier hs-var">pparams</span></a><span>
</span><a name="line-89"></a><span>    </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#FactorB"><span class="hs-identifier hs-var">Spec.FactorB</span></a><span> </span><a name="local-6989586621679176896"><a href="#local-6989586621679176896"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Spec._factorB</span><span> </span><a href="#local-6989586621679176894"><span class="hs-identifier hs-var">pparams</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Conversions
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | Derive CHAIN rule environment</span><span>
</span><a name="line-96"></a><span class="hs-identifier">toChainEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/small-steps-0.1.0.0/noopt/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Spec.Environment</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-blockchain-0.1.0.0/noopt/doc/html/cs-blockchain/src/Cardano.Spec.Chain.STS.Rule.Chain.html#CHAIN"><span class="hs-identifier hs-type">Spec.CHAIN</span></a><span>
</span><a name="line-97"></a><a name="toChainEnv"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#toChainEnv"><span class="hs-identifier">toChainEnv</span></a></a><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-var">ByronSpecGenesis</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679176916"><span class="hs-identifier hs-var">disableConsensusChecks</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-98"></a><span>      </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Core.html#Slot"><span class="hs-identifier hs-var">Spec.Slot</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-comment">-- current slot</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176913"><span class="hs-identifier hs-var">byronSpecGenesisInitUtxo</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176912"><span class="hs-identifier hs-var">byronSpecGenesisDelegators</span></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176914"><span class="hs-identifier hs-var">byronSpecGenesisInitPParams</span></a><span>
</span><a name="line-102"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176915"><span class="hs-identifier hs-var">byronSpecGenesisSecurityParam</span></a><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-comment">-- We are only interested in updating the /ledger state/, not the /consensus</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-comment">-- chain state/. Unfortunately, the Byron spec does not make that</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-comment">-- distinction, and so when we call the CHAIN rule, we might get some errors</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-comment">-- here that the implementation does not report (because it would only find</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-comment">-- them when we update the chain state). There are at least two possible</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-comment">-- proper solutions for this:</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-comment">-- 1. Modify the spec so that we /do/ have the separation. Note that if we</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-comment">--    did, we would not use the chain state part of the spec, since the</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-comment">--    chain state part of the dual ledger is determined entirely by the</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-comment">--    concrete Byron block.</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-comment">-- 2. Turn 'applyExtLedger' and related types into a type class of their</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-comment">--    own, so that we can override it specifically for the dual ledger.</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-comment">-- Either way, we are only testing the /ledger/ part of the two blocks here,</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-comment">-- not the consensus part. For now we just override some parameters in the</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-comment">-- environment to work around the problem and make sure that none of the</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-comment">-- consensus checks in the spec can fail.</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-identifier">disableConsensusChecks</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/small-steps-0.1.0.0/noopt/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Spec.Environment</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-blockchain-0.1.0.0/noopt/doc/html/cs-blockchain/src/Cardano.Spec.Chain.STS.Rule.Chain.html#CHAIN"><span class="hs-identifier hs-type">Spec.CHAIN</span></a><span>
</span><a name="line-124"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/small-steps-0.1.0.0/noopt/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Spec.Environment</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-blockchain-0.1.0.0/noopt/doc/html/cs-blockchain/src/Cardano.Spec.Chain.STS.Rule.Chain.html#CHAIN"><span class="hs-identifier hs-type">Spec.CHAIN</span></a><span>
</span><a name="line-125"></a><span>    </span><a name="local-6989586621679176916"><a href="#local-6989586621679176916"><span class="hs-identifier">disableConsensusChecks</span></a></a><span> </span><span class="hs-special">(</span><span> </span><a name="local-6989586621679176917"><a href="#local-6989586621679176917"><span class="hs-identifier">_currentSlot</span></a></a><span>
</span><a name="line-126"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679176918"><a href="#local-6989586621679176918"><span class="hs-identifier">utx0</span></a></a><span>
</span><a name="line-127"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679176919"><a href="#local-6989586621679176919"><span class="hs-identifier">delegators</span></a></a><span>
</span><a name="line-128"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679176920"><a href="#local-6989586621679176920"><span class="hs-identifier">pparams</span></a></a><span>
</span><a name="line-129"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679176921"><a href="#local-6989586621679176921"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-130"></a><span>                           </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-131"></a><span>          </span><span class="hs-comment">-- Disable 'SlotInTheFuture' failure</span><span>
</span><a name="line-132"></a><span>          </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Core.html#Slot"><span class="hs-identifier hs-var">Spec.Slot</span></a><span> </span><span class="hs-identifier hs-var">maxBound</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176918"><span class="hs-identifier hs-var">utx0</span></a><span>
</span><a name="line-134"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176919"><span class="hs-identifier hs-var">delegators</span></a><span>
</span><a name="line-135"></a><span>          </span><span class="hs-comment">-- Disable 'TooManyIssuedBlocks' failure</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176920"><span class="hs-identifier hs-var">pparams</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">Spec._bkSgnCntT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-ledger-0.1.0.0/noopt/doc/html/cs-ledger/src/Ledger.Update.html#BkSgnCntT"><span class="hs-identifier hs-var">Spec.BkSgnCntT</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-137"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679176921"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-138"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- | Construct genesis config from CHAIN environment</span><span>
</span><a name="line-141"></a><span class="hs-comment">--</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- This doesn't make an awful lot of sense, but the abstract spec doesn't /have/</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- a concept of a genesis config, and instead the CHAIN environment fulfills</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- that role. In order to be able to reuse the test generators, we therefore</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- also define a translation in the opposite direction.</span><span>
</span><a name="line-146"></a><span class="hs-identifier">fromChainEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/small-steps-0.1.0.0/noopt/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Spec.Environment</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cs-blockchain-0.1.0.0/noopt/doc/html/cs-blockchain/src/Cardano.Spec.Chain.STS.Rule.Chain.html#CHAIN"><span class="hs-identifier hs-type">Spec.CHAIN</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a><span>
</span><a name="line-147"></a><a name="fromChainEnv"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#fromChainEnv"><span class="hs-identifier">fromChainEnv</span></a></a><span> </span><span class="hs-special">(</span><span> </span><a name="local-6989586621679177458"><a href="#local-6989586621679177458"><span class="hs-identifier">_currentSlot</span></a></a><span>
</span><a name="line-148"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679177459"><a href="#local-6989586621679177459"><span class="hs-identifier">byronSpecGenesisInitUtxo</span></a></a><span>
</span><a name="line-149"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679177460"><a href="#local-6989586621679177460"><span class="hs-identifier">byronSpecGenesisDelegators</span></a></a><span>
</span><a name="line-150"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679177461"><a href="#local-6989586621679177461"><span class="hs-identifier">byronSpecGenesisInitPParams</span></a></a><span>
</span><a name="line-151"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679177462"><a href="#local-6989586621679177462"><span class="hs-identifier">byronSpecGenesisSecurityParam</span></a></a><span>
</span><a name="line-152"></a><span>             </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-var">ByronSpecGenesis</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-153"></a></pre></body></html>