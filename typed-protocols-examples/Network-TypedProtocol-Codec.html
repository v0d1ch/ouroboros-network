<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Network.TypedProtocol.Codec</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Network.TypedProtocol.Codec.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="&quot;../doc-index.html&quot;">Index</a></li></ul><p class="caption">typed-protocols-examples-0.1.0.0: Examples and tests for the typed-protocols framework</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Network.TypedProtocol.Codec</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Defining and using Codecs</a><ul><li><a href="#g:2">Related types</a></li><li><a href="#g:3">Incremental decoding</a></li><li><a href="#g:4">Codec properties</a></li></ul></li></ul></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Codec">Codec</a> ps failure m bytes = <a href="#v:Codec">Codec</a> {<ul class="subs"><li><a href="#v:encode">encode</a> &#8759; &#8704; (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) (st' &#8759; ps). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st' &#8594; bytes</li><li><a href="#v:decode">decode</a> &#8759; &#8704; (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; m (<a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m (<a href="Network-TypedProtocol-Codec.html#t:SomeMessage" title="Network.TypedProtocol.Codec">SomeMessage</a> st))</li></ul>}</li><li class="src short"><a href="#v:hoistCodec">hoistCodec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> n &#8658; (&#8704; x. m x &#8594; n x) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure n bytes</li><li class="src short"><a href="#v:isoCodec">isoCodec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; (bytes &#8594; bytes') &#8594; (bytes' &#8594; bytes) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes'</li><li class="src short"><a href="#v:mapFailureCodec">mapFailureCodec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; (failure &#8594; failure') &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure' m bytes</li><li class="src short"><span class="keyword">data</span> <a href="#t:PeerRole">PeerRole</a><ul class="subs"><li>= <a href="#v:AsClient">AsClient</a></li><li>| <a href="#v:AsServer">AsServer</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:PeerHasAgency">PeerHasAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) &#8759; &#8704; ps. <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a> &#8594; ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <span class="keyword">where</span><ul class="subs"><li><a href="#v:ClientAgency">ClientAgency</a> &#8759; &#8704; ps (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). !(<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:ClientHasAgency" title="Network.TypedProtocol.Core">ClientHasAgency</a> st) &#8594; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> <a href="Network-TypedProtocol-Codec.html#v:AsClient" title="Network.TypedProtocol.Codec">AsClient</a> st</li><li><a href="#v:ServerAgency">ServerAgency</a> &#8759; &#8704; ps (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). !(<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:ServerHasAgency" title="Network.TypedProtocol.Core">ServerHasAgency</a> st) &#8594; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> <a href="Network-TypedProtocol-Codec.html#v:AsServer" title="Network.TypedProtocol.Codec">AsServer</a> st</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:WeHaveAgency">WeHaveAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) = <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st</li><li class="src short"><span class="keyword">type</span> <a href="#t:TheyHaveAgency">TheyHaveAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) = <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:FlipAgency" title="Network.TypedProtocol.Core">FlipAgency</a> pr) st</li><li class="src short"><span class="keyword">data</span> <a href="#t:SomeMessage">SomeMessage</a> (st &#8759; ps) &#8759; &#8704; ps. ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <span class="keyword">where</span><ul class="subs"><li><a href="#v:SomeMessage">SomeMessage</a> &#8759; &#8704; ps (st &#8759; ps) (st' &#8759; ps). <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st' &#8594; <a href="Network-TypedProtocol-Codec.html#t:SomeMessage" title="Network.TypedProtocol.Codec">SomeMessage</a> st</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:CodecFailure">CodecFailure</a><ul class="subs"><li>= <a href="#v:CodecFailureOutOfInput">CodecFailureOutOfInput</a></li><li>| <a href="#v:CodecFailure">CodecFailure</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:DecodeStep">DecodeStep</a> bytes failure m a<ul class="subs"><li>= <a href="#v:DecodePartial">DecodePartial</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> bytes &#8594; m (<a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m a))</li><li>| <a href="#v:DecodeDone">DecodeDone</a> a (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> bytes)</li><li>| <a href="#v:DecodeFail">DecodeFail</a> failure</li></ul></li><li class="src short"><a href="#v:runDecoder">runDecoder</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; [bytes] &#8594; <a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m a &#8594; m (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> failure a)</li><li class="src short"><a href="#v:runDecoderPure">runDecoderPure</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; (&#8704; b. m b &#8594; b) &#8594; m (<a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m a) &#8594; [bytes] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> failure a</li><li class="src short"><span class="keyword">data</span> <a href="#t:AnyMessage">AnyMessage</a> ps <span class="keyword">where</span><ul class="subs"><li><a href="#v:AnyMessage">AnyMessage</a> &#8759; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st' &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:AnyMessageAndAgency">AnyMessageAndAgency</a> ps <span class="keyword">where</span><ul class="subs"><li><a href="#v:AnyMessageAndAgency">AnyMessageAndAgency</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr (st &#8759; ps) &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps (st &#8759; ps) (st' &#8759; ps) &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps</li></ul></li><li class="src short"><a href="#v:prop_codecM">prop_codecM</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; m <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:prop_codec">prop_codec</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; (&#8704; a. m a &#8594; a) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:prop_codec_splitsM">prop_codec_splitsM</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; (bytes &#8594; [[bytes]]) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; m <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:prop_codec_splits">prop_codec_splits</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; (bytes &#8594; [[bytes]]) &#8594; (&#8704; a. m a &#8594; a) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:prop_codec_binary_compatM">prop_codec_binary_compatM</a> &#8759; &#8704; psA psB failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> psA)) &#8658; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psA failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psB failure m bytes &#8594; (&#8704; pr (stA &#8759; psA). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr stA &#8594; <a href="Network-TypedProtocol-Codec.html#t:SamePeerHasAgency" title="Network.TypedProtocol.Codec">SamePeerHasAgency</a> pr psB) &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> psA &#8594; m <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:prop_codec_binary_compat">prop_codec_binary_compat</a> &#8759; &#8704; psA psB failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> psA)) &#8658; (&#8704; a. m a &#8594; a) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psA failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psB failure m bytes &#8594; (&#8704; pr (stA &#8759; psA). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr stA &#8594; <a href="Network-TypedProtocol-Codec.html#t:SamePeerHasAgency" title="Network.TypedProtocol.Codec">SamePeerHasAgency</a> pr psB) &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> psA &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:SamePeerHasAgency">SamePeerHasAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (ps &#8759; &#9733;) <span class="keyword">where</span><ul class="subs"><li><a href="#v:SamePeerHasAgency">SamePeerHasAgency</a> &#8759; &#8704; (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; <a href="Network-TypedProtocol-Codec.html#t:SamePeerHasAgency" title="Network.TypedProtocol.Codec">SamePeerHasAgency</a> pr ps</li></ul></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Defining and using Codecs</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Codec" class="def">Codec</a> ps failure m bytes <a href="src/Network.TypedProtocol.Codec.html#Codec" class="link">Source</a> <a href="#t:Codec" class="selflink">#</a></p><div class="doc"><p>A codec for a <code><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Protocol" title="Network.TypedProtocol.Core">Protocol</a></code> handles the encoding and decoding of typed
 protocol messages. This is typically used when sending protocol messages
 over untyped channels. The codec chooses the exact encoding, for example
 encoding in some text-based syntax, or some choice of binary format.</p><p>The codec is parametrised by:</p><ul><li>The protocol</li><li>The peer role (client/server)</li><li>the type of decoding failures</li><li>the monad in which the decoder runs</li><li>the type of the encoded data (typically strings or bytes)</li></ul><p>It is expected that typical codec implementations will be polymorphic in
 the peer role. For example a codec for the ping/pong protocol might have
 type:</p><pre>codecPingPong :: forall m. Monad m =&gt; Codec PingPong String m String</pre><p>A codec consists of a message encoder and a decoder.</p><p>The encoder is supplied both with the message to encode and the current
 protocol state (matching the message). The protocol state can be either
 a client or server state, but for either peer role it is a protocol state
 in which the peer has agency, since those are the only states where a
 peer needs to encode a message to be able to send it.</p><p>For example a simple text encoder for the ping/pong protocol could be:</p><pre>encode :: WeHaveAgency pr st
       -&gt; Message PingPong st st'
       -&gt; String
 encode (ClientAgency TokIdle) MsgPing = &quot;ping\n&quot;
 encode (ClientAgency TokIdle) MsgDone = &quot;done\n&quot;
 encode (ServerAgency TokBusy) MsgPong = &quot;pong\n&quot;</pre><p>The decoder is also given the current protocol state and it is expected to
 be able to decode <em>any</em> message that is valid in that state, but <em>only</em>
 messages that are valid in that state. Messages that are unexpected for the
 current state should be treated like any other decoding format error.</p><p>While the current protocol state is known, the state that the message will
 have the peer transition to is not known. For this reason the decoded
 message is wrapped in the <code><a href="Network-TypedProtocol-Codec.html#t:SomeMessage" title="Network.TypedProtocol.Codec">SomeMessage</a></code> constructor which hides the &quot;to&quot;
 state.</p><p>The decoder uses an incremental decoding interface <code><a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a></code> so that
 input can be supplied (e.g. from a Channel) bit by bit. This style of
 decoder allows but does not require a format with message framing where the
 decoder input matches exactly with the message boundaries.</p><pre>decode :: TheyHaveAgency pr st
       -&gt; m (DecodeStep String String m (SomeMessage st))
decode stok =
  decodeTerminatedFrame '\n' $ \str trailing -&gt;
    case (stok, str) of
      (ServerAgency TokBusy, &quot;pong&quot;) -&gt;
           DecodeDone (SomeMessage MsgPong) trailing
      (ClientAgency TokIdle, &quot;ping&quot;) -&gt;
           DecodeDone (SomeMessage MsgPing) trailing
      (ClientAgency TokIdle, &quot;done&quot;) -&gt;
           DecodeDone (SomeMessage MsgDone) trailing
      _ -&gt; DecodeFail (&quot;unexpected message: &quot; ++ str)</pre><p>The main thing to note is the pattern matching on the combination of the
 message string and the protocol state. This neatly fulfils the requirement
 that we only return messages that are of the correct type for the given
 protocol state.</p><p>This toy example format uses newlines <code>n</code> as a framing format. See
 <code><a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a></code> for suggestions on how to use it for more realistic formats.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Codec" class="def">Codec</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:encode" class="def">encode</a> &#8759; &#8704; (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) (st' &#8759; ps). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st' &#8594; bytes</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:decode" class="def">decode</a> &#8759; &#8704; (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; m (<a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m (<a href="Network-TypedProtocol-Codec.html#t:SomeMessage" title="Network.TypedProtocol.Codec">SomeMessage</a> st))</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:hoistCodec" class="def">hoistCodec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> n &#8658; (&#8704; x. m x &#8594; n x) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure n bytes <a href="src/Network.TypedProtocol.Codec.html#hoistCodec" class="link">Source</a> <a href="#v:hoistCodec" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:isoCodec" class="def">isoCodec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; (bytes &#8594; bytes') &#8594; (bytes' &#8594; bytes) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes' <a href="src/Network.TypedProtocol.Codec.html#isoCodec" class="link">Source</a> <a href="#v:isoCodec" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:mapFailureCodec" class="def">mapFailureCodec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; (failure &#8594; failure') &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure' m bytes <a href="src/Network.TypedProtocol.Codec.html#mapFailureCodec" class="link">Source</a> <a href="#v:mapFailureCodec" class="selflink">#</a></p></div><a href="#g:2" id="g:2"><h2>Related types</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:PeerRole" class="def">PeerRole</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/src" class="link">Source</a> <a href="#t:PeerRole" class="selflink">#</a></p><div class="doc"><p>Types for client and server peer roles. As protocol can be viewed from
 either client or server side.</p><p>Note that technically &quot;client&quot; and &quot;server&quot; are arbitrary labels. The
 framework is completely symmetric between the two peers.</p><p>This definition is only used as promoted types and kinds, never as values.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AsClient" class="def">AsClient</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:AsServer" class="def">AsServer</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:PeerHasAgency" class="def">PeerHasAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) &#8759; &#8704; ps. <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a> &#8594; ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <span class="keyword">where</span> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/src" class="link">Source</a> <a href="#t:PeerHasAgency" class="selflink">#</a></p><div class="doc"><p>This data type is used to hold state tokens for states with either client
 or server agency. This GADT shows up when writing protocol peers, when
 <code><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#v:Yield" title="Network.TypedProtocol.Core">Yield</a></code>ing or <code><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#v:Await" title="Network.TypedProtocol.Core">Await</a></code>ing, and when writing message encoders/decoders.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ClientAgency" class="def">ClientAgency</a> &#8759; &#8704; ps (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). !(<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:ClientHasAgency" title="Network.TypedProtocol.Core">ClientHasAgency</a> st) &#8594; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> <a href="Network-TypedProtocol-Codec.html#v:AsClient" title="Network.TypedProtocol.Codec">AsClient</a> st</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:ServerAgency" class="def">ServerAgency</a> &#8759; &#8704; ps (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). !(<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:ServerHasAgency" title="Network.TypedProtocol.Core">ServerHasAgency</a> st) &#8594; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> <a href="Network-TypedProtocol-Codec.html#v:AsServer" title="Network.TypedProtocol.Codec">AsServer</a> st</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:PeerHasAgency" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:PeerHasAgency:Show:1"></span> (&#8704; (st' &#8759; ps). <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:ClientHasAgency" title="Network.TypedProtocol.Core">ClientHasAgency</a> st'), &#8704; (st' &#8759; ps). <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:ServerHasAgency" title="Network.TypedProtocol.Core">ServerHasAgency</a> st')) &#8658; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:PeerHasAgency:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:WeHaveAgency" class="def">WeHaveAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) = <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/src" class="link">Source</a> <a href="#t:WeHaveAgency" class="selflink">#</a></p><div class="doc"><p>A synonym for an state token in which &quot;our&quot; peer has agency. This is
 parametrised over the client or server roles. In either case the peer in
 question has agency.</p><p>This shows up when we are sending messages, or dealing with encoding
 outgoing messages.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:TheyHaveAgency" class="def">TheyHaveAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps) = <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:FlipAgency" title="Network.TypedProtocol.Core">FlipAgency</a> pr) st <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/src" class="link">Source</a> <a href="#t:TheyHaveAgency" class="selflink">#</a></p><div class="doc"><p>A synonym for an state token in which the other peer has agency. This is
 parametrised over the client or server roles. In either case the other peer
 has agency.</p><p>This shows up when we are receiving messages, or dealing with decoding
 incoming messages.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SomeMessage" class="def">SomeMessage</a> (st &#8759; ps) &#8759; &#8704; ps. ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <span class="keyword">where</span> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/src" class="link">Source</a> <a href="#t:SomeMessage" class="selflink">#</a></p><div class="doc"><p>When decoding a <code><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a></code> we only know the expected &quot;from&quot; state. We
 cannot know the &quot;to&quot; state as this depends on the message we decode. To
 resolve this we use the <code><a href="Network-TypedProtocol-Codec.html#t:SomeMessage" title="Network.TypedProtocol.Codec">SomeMessage</a></code> wrapper which uses an existential
 type to hide the &quot;to&quot; state.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SomeMessage" class="def">SomeMessage</a> &#8759; &#8704; ps (st &#8759; ps) (st' &#8759; ps). <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st' &#8594; <a href="Network-TypedProtocol-Codec.html#t:SomeMessage" title="Network.TypedProtocol.Codec">SomeMessage</a> st</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:CodecFailure" class="def">CodecFailure</a> <a href="src/Network.TypedProtocol.Codec.html#CodecFailure" class="link">Source</a> <a href="#t:CodecFailure" class="selflink">#</a></p><div class="doc"><p>Each <code><a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a></code> can use whatever <code>failure</code> type is appropriate. This simple
 exception type is provided for use by simple codecs (e.g. &quot;identity&quot;) when
 nothing more than a <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a></code> is needed. It is an instance of <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Exception-Base.html#t:Exception" title="Control.Exception.Base">Exception</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:CodecFailureOutOfInput" class="def">CodecFailureOutOfInput</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:CodecFailure" class="def">CodecFailure</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:CodecFailure" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:CodecFailure:Eq:1"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a></span> <a href="src/Network.TypedProtocol.Codec.html#line-237" class="link">Source</a> <a href="#t:CodecFailure" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:CodecFailure:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Codec.html">Network.TypedProtocol.Codec</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:CodecFailure:Show:2"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a></span> <a href="src/Network.TypedProtocol.Codec.html#line-237" class="link">Source</a> <a href="#t:CodecFailure" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:CodecFailure:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Codec.html">Network.TypedProtocol.Codec</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a>] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:CodecFailure:Exception:3"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Exception-Base.html#t:Exception" title="Control.Exception.Base">Exception</a> <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a></span> <a href="src/Network.TypedProtocol.Codec.html#line-240" class="link">Source</a> <a href="#t:CodecFailure" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:CodecFailure:Exception:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Codec.html">Network.TypedProtocol.Codec</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toException">toException</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> <a href="#v:toException" class="selflink">#</a></p><p class="src"><a href="#v:fromException">fromException</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> <a href="#v:fromException" class="selflink">#</a></p><p class="src"><a href="#v:displayException">displayException</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:CodecFailure" title="Network.TypedProtocol.Codec">CodecFailure</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:displayException" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:3" id="g:3"><h2>Incremental decoding</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DecodeStep" class="def">DecodeStep</a> bytes failure m a <a href="src/Network.TypedProtocol.Codec.html#DecodeStep" class="link">Source</a> <a href="#t:DecodeStep" class="selflink">#</a></p><div class="doc"><p>An incremental decoder with return a value of type <code>a</code>.</p><p>This interface is not designed to be used directly for implementing
 decoders, only for running them. In real applications it is expected to use
 libraries for text or binary decoding and to implement appropriate wrappers
 to match up with this incremental decoder interface.</p><p>This style of interface already closely matches that provided by libraries
 such as <code>attoparsec</code> for text formats, and <code>binary</code>, <code>cereal</code> and <code>cborg</code>
 for binary formats.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DecodePartial" class="def">DecodePartial</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> bytes &#8594; m (<a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m a))</td><td class="doc"><p>The decoder has consumed the available input and needs more
 to continue. Provide <code><code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a></code></code> if more input is available and
 <code><code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Nothing" title="GHC.Maybe">Nothing</a></code></code> otherwise, and you will get a new <code><code><a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a></code></code>.</p></td></tr><tr><td class="src"><a id="v:DecodeDone" class="def">DecodeDone</a> a (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> bytes)</td><td class="doc"><p>The decoder has successfully finished. This provides the decoded
 result value plus any unused input.</p></td></tr><tr><td class="src"><a id="v:DecodeFail" class="def">DecodeFail</a> failure</td><td class="doc"><p>The decoder ran into an error. The decoder either used
 <code><code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#v:fail" title="Control.Monad">fail</a></code></code> or was not provided enough input.</p></td></tr></table></div></div><div class="top"><p class="src"><a id="v:runDecoder" class="def">runDecoder</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; [bytes] &#8594; <a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m a &#8594; m (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> failure a) <a href="src/Network.TypedProtocol.Codec.html#runDecoder" class="link">Source</a> <a href="#v:runDecoder" class="selflink">#</a></p><div class="doc"><p>Run a codec incremental decoder <code><a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a></code> against a list of input.</p><p>It ignores any unused trailing data. This is useful for demos, quick
 experiments and tests.</p><p>See also <code><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Driver.html#v:runDecoderWithChannel" title="Network.TypedProtocol.Driver">runDecoderWithChannel</a></code></p></div></div><div class="top"><p class="src"><a id="v:runDecoderPure" class="def">runDecoderPure</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; (&#8704; b. m b &#8594; b) &#8594; m (<a href="Network-TypedProtocol-Codec.html#t:DecodeStep" title="Network.TypedProtocol.Codec">DecodeStep</a> bytes failure m a) &#8594; [bytes] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> failure a <a href="src/Network.TypedProtocol.Codec.html#runDecoderPure" class="link">Source</a> <a href="#v:runDecoderPure" class="selflink">#</a></p><div class="doc"><p>A variant of <code><a href="Network-TypedProtocol-Codec.html#v:runDecoder" title="Network.TypedProtocol.Codec">runDecoder</a></code> that is suitable for &quot;pure&quot; monads that have
 a run function. This includes <code>ST</code>, using <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad-ST.html#v:runST" title="Control.Monad.ST">runST</a></code>.</p></div></div><a href="#g:4" id="g:4"><h2>Codec properties</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:AnyMessage" class="def">AnyMessage</a> ps <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Codec.html#AnyMessage" class="link">Source</a> <a href="#t:AnyMessage" class="selflink">#</a></p><div class="doc"><p>Any message for a protocol, without knowing the protocol state.</p><p>Used at least for <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a></code> instances for messages, but also as a target for an
 identity codec `Codec ps failure m (AnyMessage ps)` .</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AnyMessage" class="def">AnyMessage</a> &#8759; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st' &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:AnyMessage" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:AnyMessage:Show:1"></span> (&#8704; (st &#8759; ps) (st' &#8759; ps). <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps st st')) &#8658; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)</span> <a href="src/Network.TypedProtocol.Codec.html#line-288" class="link">Source</a> <a href="#t:AnyMessage" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:AnyMessage:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Codec.html">Network.TypedProtocol.Codec</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:AnyMessageAndAgency" class="def">AnyMessageAndAgency</a> ps <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Codec.html#AnyMessageAndAgency" class="link">Source</a> <a href="#t:AnyMessageAndAgency" class="selflink">#</a></p><div class="doc"><p>Used to hold the <code><a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a></code> state token and a corresponding <code><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a></code>.</p><p>Used where we don't know statically what the state type is, but need the
 agency and message to match each other.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AnyMessageAndAgency" class="def">AnyMessageAndAgency</a> &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr (st &#8759; ps) &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/typed-protocols-0.1.0.0/noopt/doc/html/typed-protocols/Network-TypedProtocol-Core.html#t:Message" title="Network.TypedProtocol.Core">Message</a> ps (st &#8759; ps) (st' &#8759; ps) &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:prop_codecM" class="def">prop_codecM</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; m <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Network.TypedProtocol.Codec.html#prop_codecM" class="link">Source</a> <a href="#v:prop_codecM" class="selflink">#</a></p><div class="doc"><p>The <code><a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a></code> round-trip property: decode after encode gives the same
 message. Every codec must satisfy this property.</p></div></div><div class="top"><p class="src"><a id="v:prop_codec" class="def">prop_codec</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; (&#8704; a. m a &#8594; a) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Network.TypedProtocol.Codec.html#prop_codec" class="link">Source</a> <a href="#v:prop_codec" class="selflink">#</a></p><div class="doc"><p>The <code><a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a></code> round-trip property in a pure monad.</p></div></div><div class="top"><p class="src"><a id="v:prop_codec_splitsM" class="def">prop_codec_splitsM</a> <a href="src/Network.TypedProtocol.Codec.html#prop_codec_splitsM" class="link">Source</a> <a href="#v:prop_codec_splitsM" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps))</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; (bytes &#8594; [[bytes]])</td><td class="doc"><p>alternative re-chunkings of serialised form</p></td></tr><tr><td class="src">&#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; m <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>A variant on the codec round-trip property: given the encoding of a
 message, check that decode always gives the same result irrespective
 of how the chunks of input are fed to the incremental decoder.</p><p>This property guards against boundary errors in incremental decoders.
 It is not necessary to check this for every message type, just for each
 generic codec construction. For example given some binary serialisation
 library one would write a generic adaptor to the codec interface. This
 adaptor has to deal with the incremental decoding and this is what needs
 to be checked.</p></div></div><div class="top"><p class="src"><a id="v:prop_codec_splits" class="def">prop_codec_splits</a> &#8759; &#8704; ps failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> ps)) &#8658; (bytes &#8594; [[bytes]]) &#8594; (&#8704; a. m a &#8594; a) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> ps failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> ps &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Network.TypedProtocol.Codec.html#prop_codec_splits" class="link">Source</a> <a href="#v:prop_codec_splits" class="selflink">#</a></p><div class="doc"><p>Like <code><code><a href="Network-TypedProtocol-Codec.html#v:prop_codec_splitsM" title="Network.TypedProtocol.Codec">prop_codec_splitsM</a></code></code> but run in a pure monad <code>m</code>, e.g. <code>Identity</code>.</p></div></div><div class="top"><p class="src"><a id="v:prop_codec_binary_compatM" class="def">prop_codec_binary_compatM</a> <a href="src/Network.TypedProtocol.Codec.html#prop_codec_binary_compatM" class="link">Source</a> <a href="#v:prop_codec_binary_compatM" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> psA))</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psA failure m bytes</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psB failure m bytes</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; (&#8704; pr (stA &#8759; psA). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr stA &#8594; <a href="Network-TypedProtocol-Codec.html#t:SamePeerHasAgency" title="Network.TypedProtocol.Codec">SamePeerHasAgency</a> pr psB)</td><td class="doc"><p>The states of A map directly of states of B.</p></td></tr><tr><td class="src">&#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> psA</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; m <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Binary compatibility of two protocols</p><p>We check the following property:</p><ol><li>Using codec A, we encode a message of protocol <code>psA</code> to <code>bytes</code>.</li><li>When we decode those <code>bytes</code> using codec B, we get a message of protocol
 <code>ps</code>B.</li><li>When we encode that message again using codec B, we get <code>bytes</code>.</li><li>When we decode those <code>bytes</code> using codec A, we get the original message
 again.</li></ol></div></div><div class="top"><p class="src"><a id="v:prop_codec_binary_compat" class="def">prop_codec_binary_compat</a> &#8759; &#8704; psA psB failure m bytes. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Network-TypedProtocol-Codec.html#t:AnyMessage" title="Network.TypedProtocol.Codec">AnyMessage</a> psA)) &#8658; (&#8704; a. m a &#8594; a) &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psA failure m bytes &#8594; <a href="Network-TypedProtocol-Codec.html#t:Codec" title="Network.TypedProtocol.Codec">Codec</a> psB failure m bytes &#8594; (&#8704; pr (stA &#8759; psA). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr stA &#8594; <a href="Network-TypedProtocol-Codec.html#t:SamePeerHasAgency" title="Network.TypedProtocol.Codec">SamePeerHasAgency</a> pr psB) &#8594; <a href="Network-TypedProtocol-Codec.html#t:AnyMessageAndAgency" title="Network.TypedProtocol.Codec">AnyMessageAndAgency</a> psA &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Network.TypedProtocol.Codec.html#prop_codec_binary_compat" class="link">Source</a> <a href="#v:prop_codec_binary_compat" class="selflink">#</a></p><div class="doc"><p>Like <code><code><a href="Network-TypedProtocol-Codec.html#v:prop_codec_splitsM" title="Network.TypedProtocol.Codec">prop_codec_splitsM</a></code></code> but run in a pure monad <code>m</code>, e.g. <code>Identity</code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SamePeerHasAgency" class="def">SamePeerHasAgency</a> (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (ps &#8759; &#9733;) <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Codec.html#SamePeerHasAgency" class="link">Source</a> <a href="#t:SamePeerHasAgency" class="selflink">#</a></p><div class="doc"><p>Auxiliary definition for <code><a href="Network-TypedProtocol-Codec.html#v:prop_codec_binary_compatM" title="Network.TypedProtocol.Codec">prop_codec_binary_compatM</a></code>.</p><p>Used for the existential <code>st :: ps</code> parameter when expressing that for each
 value of <code><a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a></code> for protocol A, there is a corresponding
 <code><a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a></code> for protocol B of some <code>st :: ps</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SamePeerHasAgency" class="def">SamePeerHasAgency</a> &#8759; &#8704; (pr &#8759; <a href="Network-TypedProtocol-Codec.html#t:PeerRole" title="Network.TypedProtocol.Codec">PeerRole</a>) (st &#8759; ps). <a href="Network-TypedProtocol-Codec.html#t:PeerHasAgency" title="Network.TypedProtocol.Codec">PeerHasAgency</a> pr st &#8594; <a href="Network-TypedProtocol-Codec.html#t:SamePeerHasAgency" title="Network.TypedProtocol.Codec">SamePeerHasAgency</a> pr ps</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>