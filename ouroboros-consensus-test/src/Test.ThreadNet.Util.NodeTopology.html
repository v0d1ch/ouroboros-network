<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric       #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia         #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.ThreadNet.Util.NodeTopology</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Node Topology</span></span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier">NodeTopology</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#coreNodeIdNeighbors"><span class="hs-identifier">coreNodeIdNeighbors</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#edgesNodeTopology"><span class="hs-identifier">edgesNodeTopology</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#genNodeTopology"><span class="hs-identifier">genNodeTopology</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#mapNodeTopology"><span class="hs-identifier">mapNodeTopology</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#meshNodeTopology"><span class="hs-identifier">meshNodeTopology</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#minimumDegreeNodeTopology"><span class="hs-identifier">minimumDegreeNodeTopology</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#shrinkNodeTopology"><span class="hs-identifier">shrinkNodeTopology</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#unionNodeTopology"><span class="hs-identifier">unionNodeTopology</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Quiet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Quiet</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Node.ProtocolInfo</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.NodeId</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util.Condense</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Node Topologies
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- | Which /lesser/ nodes each node connects to</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- INVARIANT: for each mapping @n -&gt; ms@, @n &gt; m@ for each @m@ in @ms@</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- INVARIANT: only the mapping for @n = CoreNodeId 0@ is empty</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- INVARIANT: there is a mapping for each @CoreNodeId@ in the test, @0 .. n -</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- 1@</span><span>
</span><span id="line-45"></span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- Note that every node is connected to every other but not necessarily</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- directly. In other words, the topology is always a single network of nodes,</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- which is realistic. With other test configuration components, such as</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- network partitions, the network may split (temporarily or not) into separate</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- connected components during the execution, but the base topology is</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- connected.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span id="local-6989586621679252071"><span id="local-6989586621679252072"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="NodeTopology"><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-var">NodeTopology</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-54"></span><span>    </span><span id="NodeTopology"><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-var">NodeTopology</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unNodeTopology"><span class="annot"><span class="annottext">NodeTopology -&gt; Map CoreNodeId (Set CoreNodeId)
</span><a href="Test.ThreadNet.Util.NodeTopology.html#unNodeTopology"><span class="hs-identifier hs-var hs-var">unNodeTopology</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252065"><span id="local-6989586621679252067"><span class="annot"><span class="annottext">NodeTopology -&gt; NodeTopology -&gt; Bool
(NodeTopology -&gt; NodeTopology -&gt; Bool)
-&gt; (NodeTopology -&gt; NodeTopology -&gt; Bool) -&gt; Eq NodeTopology
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: NodeTopology -&gt; NodeTopology -&gt; Bool
$c/= :: NodeTopology -&gt; NodeTopology -&gt; Bool
== :: NodeTopology -&gt; NodeTopology -&gt; Bool
$c== :: NodeTopology -&gt; NodeTopology -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. NodeTopology -&gt; Rep NodeTopology x)
-&gt; (forall x. Rep NodeTopology x -&gt; NodeTopology)
-&gt; Generic NodeTopology
forall x. Rep NodeTopology x -&gt; NodeTopology
forall x. NodeTopology -&gt; Rep NodeTopology x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep NodeTopology x -&gt; NodeTopology
$cfrom :: forall x. NodeTopology -&gt; Rep NodeTopology x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252055"><span id="local-6989586621679252057"><span id="local-6989586621679252059"><span class="annot"><span class="annottext">Int -&gt; NodeTopology -&gt; ShowS
[NodeTopology] -&gt; ShowS
NodeTopology -&gt; String
(Int -&gt; NodeTopology -&gt; ShowS)
-&gt; (NodeTopology -&gt; String)
-&gt; ([NodeTopology] -&gt; ShowS)
-&gt; Show NodeTopology
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [NodeTopology] -&gt; ShowS
$cshowList :: [NodeTopology] -&gt; ShowS
show :: NodeTopology -&gt; String
$cshow :: NodeTopology -&gt; String
showsPrec :: Int -&gt; NodeTopology -&gt; ShowS
$cshowsPrec :: Int -&gt; NodeTopology -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quiet</span></span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Condense</span></a></span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621679252051"><span class="annot"><span class="annottext">condense :: NodeTopology -&gt; String
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">condense</span></a></span></span><span> </span><span id="local-6989586621679252049"><span class="annot"><span class="annottext">top :: NodeTopology
</span><a href="#local-6989586621679252049"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679252048"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252048"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679252049"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">NodeTopology -&gt; NodeTopology -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679252047"><span class="hs-identifier hs-var">mesh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;meshNodeTopology (NumCoreNodes &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252048"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(NodeId, Set NodeId)] -&gt; String
forall a. Condense a =&gt; a -&gt; String
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">condense</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreNodeId -&gt; NodeId
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">fromCoreNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252043"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(CoreNodeId -&gt; NodeId) -&gt; Set CoreNodeId -&gt; Set NodeId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">CoreNodeId -&gt; NodeId
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">fromCoreNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId
</span><a href="#local-6989586621679252041"><span class="hs-identifier hs-var">nids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252043"><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252043"><span class="hs-identifier hs-var">nid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252041"><span class="annot"><span class="annottext">Set CoreNodeId
</span><a href="#local-6989586621679252041"><span class="hs-identifier hs-var">nids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; [(CoreNodeId, Set CoreNodeId)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252048"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>      </span><span id="local-6989586621679252047"><span class="annot"><span class="annottext">mesh :: NodeTopology
</span><a href="#local-6989586621679252047"><span class="hs-identifier hs-var hs-var">mesh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NumCoreNodes -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#meshNodeTopology"><span class="hs-identifier hs-var">meshNodeTopology</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; NumCoreNodes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">NumCoreNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252048"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | Connect every pair of nodes</span><span>
</span><span id="line-68"></span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#meshNodeTopology"><span class="hs-identifier hs-type">meshNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-70"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NumCoreNodes</span></a></span><span>
</span><span id="line-71"></span><span>     </span><span class="hs-comment">-- ^ PRECONDITION: non-negative</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span>
</span><span id="line-73"></span><span id="meshNodeTopology"><span class="annot"><span class="annottext">meshNodeTopology :: NumCoreNodes -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#meshNodeTopology"><span class="hs-identifier hs-var hs-var">meshNodeTopology</span></a></span></span><span> </span><span id="local-6989586621679252038"><span class="annot"><span class="annottext">NumCoreNodes
</span><a href="#local-6989586621679252038"><span class="hs-identifier hs-var">numCoreNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-var">NodeTopology</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology)
-&gt; Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">[(CoreNodeId, Set CoreNodeId)] -&gt; Map CoreNodeId (Set CoreNodeId)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(CoreNodeId, Set CoreNodeId)] -&gt; Map CoreNodeId (Set CoreNodeId))
-&gt; [(CoreNodeId, Set CoreNodeId)]
-&gt; Map CoreNodeId (Set CoreNodeId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252036"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreNodeId] -&gt; Set CoreNodeId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([CoreNodeId] -&gt; Set CoreNodeId) -&gt; [CoreNodeId] -&gt; Set CoreNodeId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NumCoreNodes -&gt; [CoreNodeId]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">enumCoreNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; NumCoreNodes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">NumCoreNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252033"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679252036"><span class="annot"><span class="annottext">nid :: CoreNodeId
</span><a href="#local-6989586621679252036"><span class="hs-identifier hs-var">nid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span> </span><span id="local-6989586621679252033"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252033"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NumCoreNodes -&gt; [CoreNodeId]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">enumCoreNodes</span></a></span><span> </span><span class="annot"><span class="annottext">NumCoreNodes
</span><a href="#local-6989586621679252038"><span class="hs-identifier hs-var">numCoreNodes</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | Generate a 'NodeTopology' consistent with the given properties</span><span>
</span><span id="line-80"></span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#genNodeTopology"><span class="hs-identifier hs-type">genNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-82"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NumCoreNodes</span></a></span><span>
</span><span id="line-84"></span><span>     </span><span class="hs-comment">-- ^ PRECONDITION: non-negative</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span>
</span><span id="line-86"></span><span id="genNodeTopology"><span class="annot"><span class="annottext">genNodeTopology :: NumCoreNodes -&gt; Gen NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#genNodeTopology"><span class="hs-identifier hs-var hs-var">genNodeTopology</span></a></span></span><span> </span><span id="local-6989586621679252031"><span class="annot"><span class="annottext">numCoreNodes :: NumCoreNodes
</span><a href="#local-6989586621679252031"><span class="hs-identifier hs-var">numCoreNodes</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NumCoreNodes</span></a></span><span> </span><span id="local-6989586621679252030"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252030"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252030"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Gen NodeTopology
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Gen NodeTopology) -&gt; String -&gt; Gen NodeTopology
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsatisfiable parameters: &quot;</span></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NumCoreNodes -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NumCoreNodes
</span><a href="#local-6989586621679252031"><span class="hs-identifier hs-var">numCoreNodes</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679252027"><span class="annot"><span class="annottext">genNeighbors :: CoreNodeId -&gt; Gen (CoreNodeId, Set CoreNodeId)
</span><a href="#local-6989586621679252027"><span class="hs-identifier hs-var hs-var">genNeighbors</span></a></span></span><span> </span><span id="local-6989586621679252026"><span class="annot"><span class="annottext">me :: CoreNodeId
</span><a href="#local-6989586621679252026"><span class="hs-identifier hs-var">me</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span> </span><span id="local-6989586621679252025"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252025"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252025"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-92"></span><span>          </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreNodeId, Set CoreNodeId) -&gt; Gen (CoreNodeId, Set CoreNodeId)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252026"><span class="hs-identifier hs-var">me</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>          </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>            </span><span class="annot"><span class="annottext">([CoreNodeId] -&gt; (CoreNodeId, Set CoreNodeId))
-&gt; Gen [CoreNodeId] -&gt; Gen (CoreNodeId, Set CoreNodeId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252026"><span class="hs-identifier hs-var">me</span></a></span><span> </span><span class="annot"><span class="annottext">(Set CoreNodeId -&gt; (CoreNodeId, Set CoreNodeId))
-&gt; ([CoreNodeId] -&gt; Set CoreNodeId)
-&gt; [CoreNodeId]
-&gt; (CoreNodeId, Set CoreNodeId)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[CoreNodeId] -&gt; Set CoreNodeId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Gen [CoreNodeId] -&gt; Gen (CoreNodeId, Set CoreNodeId))
-&gt; Gen [CoreNodeId] -&gt; Gen (CoreNodeId, Set CoreNodeId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><span class="annottext">(Gen [CoreNodeId] -&gt; ([CoreNodeId] -&gt; Bool) -&gt; Gen [CoreNodeId])
-&gt; ([CoreNodeId] -&gt; Bool) -&gt; Gen [CoreNodeId] -&gt; Gen [CoreNodeId]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Gen [CoreNodeId] -&gt; ([CoreNodeId] -&gt; Bool) -&gt; Gen [CoreNodeId]
forall a. Gen a -&gt; (a -&gt; Bool) -&gt; Gen a
</span><span class="hs-identifier hs-var">suchThat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ([CoreNodeId] -&gt; Bool) -&gt; [CoreNodeId] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[CoreNodeId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Gen [CoreNodeId] -&gt; Gen [CoreNodeId])
-&gt; Gen [CoreNodeId] -&gt; Gen [CoreNodeId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><span class="annottext">[CoreNodeId] -&gt; Gen [CoreNodeId]
forall a. [a] -&gt; Gen [a]
</span><span class="hs-identifier hs-var">sublistOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NumCoreNodes -&gt; [CoreNodeId]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">enumCoreNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; NumCoreNodes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">NumCoreNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679252025"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">([(CoreNodeId, Set CoreNodeId)] -&gt; NodeTopology)
-&gt; Gen [(CoreNodeId, Set CoreNodeId)] -&gt; Gen NodeTopology
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-var">NodeTopology</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology)
-&gt; ([(CoreNodeId, Set CoreNodeId)]
    -&gt; Map CoreNodeId (Set CoreNodeId))
-&gt; [(CoreNodeId, Set CoreNodeId)]
-&gt; NodeTopology
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(CoreNodeId, Set CoreNodeId)] -&gt; Map CoreNodeId (Set CoreNodeId)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Gen [(CoreNodeId, Set CoreNodeId)] -&gt; Gen NodeTopology)
-&gt; Gen [(CoreNodeId, Set CoreNodeId)] -&gt; Gen NodeTopology
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><span class="annottext">(CoreNodeId -&gt; Gen (CoreNodeId, Set CoreNodeId))
-&gt; [CoreNodeId] -&gt; Gen [(CoreNodeId, Set CoreNodeId)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CoreNodeId -&gt; Gen (CoreNodeId, Set CoreNodeId)
</span><a href="#local-6989586621679252027"><span class="hs-identifier hs-var">genNeighbors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NumCoreNodes -&gt; [CoreNodeId]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">enumCoreNodes</span></a></span><span> </span><span class="annot"><span class="annottext">NumCoreNodes
</span><a href="#local-6989586621679252031"><span class="hs-identifier hs-var">numCoreNodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Shrink a node topology</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- The new topologies must be usable with the same number of nodes and slots as</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- the old topology</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#shrinkNodeTopology"><span class="hs-identifier hs-type">shrinkNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span id="shrinkNodeTopology"><span class="annot"><span class="annottext">shrinkNodeTopology :: NodeTopology -&gt; [NodeTopology]
</span><a href="Test.ThreadNet.Util.NodeTopology.html#shrinkNodeTopology"><span class="hs-identifier hs-var hs-var">shrinkNodeTopology</span></a></span></span><span> </span><span id="local-6989586621679252016"><span class="annot"><span class="annottext">top :: NodeTopology
</span><a href="#local-6989586621679252016"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679252015"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252015"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679252016"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">NodeTopology -&gt; NodeTopology -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679252014"><span class="hs-identifier hs-var">mesh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679252014"><span class="hs-identifier hs-var">mesh</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679252014"><span class="annot"><span class="annottext">mesh :: NodeTopology
</span><a href="#local-6989586621679252014"><span class="hs-identifier hs-var hs-var">mesh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NumCoreNodes -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#meshNodeTopology"><span class="hs-identifier hs-var">meshNodeTopology</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; NumCoreNodes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">NumCoreNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252015"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- TODO more sophisticated shrinks. I anticipate that they'll need to use</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- 'Test.QuickCheck.Shrinking' or else risk very slow responses</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | The neighbors of this node</span><span>
</span><span id="line-116"></span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#coreNodeIdNeighbors"><span class="hs-identifier hs-type">coreNodeIdNeighbors</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-118"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span id="coreNodeIdNeighbors"><span class="annot"><span class="annottext">coreNodeIdNeighbors :: NodeTopology -&gt; CoreNodeId -&gt; [CoreNodeId]
</span><a href="Test.ThreadNet.Util.NodeTopology.html#coreNodeIdNeighbors"><span class="hs-identifier hs-var hs-var">coreNodeIdNeighbors</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679252013"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252013"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679252012"><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252012"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Set CoreNodeId)
</span><a href="#local-6989586621679252011"><span class="hs-identifier hs-var">hit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Set CoreNodeId)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; [CoreNodeId]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [CoreNodeId]) -&gt; String -&gt; [CoreNodeId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-124"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invariant violated: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-125"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;could not find &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(CoreNodeId, [(CoreNodeId, Set CoreNodeId)]) -&gt; String
forall a. Condense a =&gt; a -&gt; String
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">condense</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252012"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; [(CoreNodeId, Set CoreNodeId)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252013"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679252009"><span class="annot"><span class="annottext">Set CoreNodeId
</span><a href="#local-6989586621679252009"><span class="hs-identifier hs-var">lessers</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId -&gt; [CoreNodeId]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId
</span><a href="#local-6989586621679252009"><span class="hs-identifier hs-var">lessers</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreNodeId] -&gt; [CoreNodeId] -&gt; [CoreNodeId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CoreNodeId]
</span><a href="#local-6989586621679252007"><span class="hs-identifier hs-var">greaters</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252011"><span class="annot"><span class="annottext">Maybe (Set CoreNodeId)
</span><a href="#local-6989586621679252011"><span class="hs-identifier hs-var">hit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252006"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252006"><span class="hs-identifier hs-var">greaters0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreNodeId
-&gt; Map CoreNodeId (Set CoreNodeId)
-&gt; (Map CoreNodeId (Set CoreNodeId), Maybe (Set CoreNodeId),
    Map CoreNodeId (Set CoreNodeId))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; (Map k a, Maybe a, Map k a)
</span><span class="hs-identifier hs-var">Map.splitLookup</span></span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252012"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252013"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679252007"><span class="annot"><span class="annottext">greaters :: [CoreNodeId]
</span><a href="#local-6989586621679252007"><span class="hs-identifier hs-var hs-var">greaters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; [CoreNodeId]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set CoreNodeId -&gt; Bool)
-&gt; Map CoreNodeId (Set CoreNodeId)
-&gt; Map CoreNodeId (Set CoreNodeId)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679252012"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId -&gt; Set CoreNodeId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252006"><span class="hs-identifier hs-var">greaters0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | The edges in this topology</span><span>
</span><span id="line-132"></span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#edgesNodeTopology"><span class="hs-identifier hs-type">edgesNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span id="edgesNodeTopology"><span class="annot"><span class="annottext">edgesNodeTopology :: NodeTopology -&gt; [(CoreNodeId, CoreNodeId)]
</span><a href="Test.ThreadNet.Util.NodeTopology.html#edgesNodeTopology"><span class="hs-identifier hs-var hs-var">edgesNodeTopology</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679252001"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252001"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">(((CoreNodeId, Set CoreNodeId) -&gt; [(CoreNodeId, CoreNodeId)])
 -&gt; [(CoreNodeId, Set CoreNodeId)] -&gt; [(CoreNodeId, CoreNodeId)])
-&gt; [(CoreNodeId, Set CoreNodeId)]
-&gt; ((CoreNodeId, Set CoreNodeId) -&gt; [(CoreNodeId, CoreNodeId)])
-&gt; [(CoreNodeId, CoreNodeId)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((CoreNodeId, Set CoreNodeId) -&gt; [(CoreNodeId, CoreNodeId)])
-&gt; [(CoreNodeId, Set CoreNodeId)] -&gt; [(CoreNodeId, CoreNodeId)]
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; [(CoreNodeId, Set CoreNodeId)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679252001"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((CoreNodeId, Set CoreNodeId) -&gt; [(CoreNodeId, CoreNodeId)])
 -&gt; [(CoreNodeId, CoreNodeId)])
-&gt; ((CoreNodeId, Set CoreNodeId) -&gt; [(CoreNodeId, CoreNodeId)])
-&gt; [(CoreNodeId, CoreNodeId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679251999"><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251999"><span class="hs-identifier hs-var">greater</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679251998"><span class="annot"><span class="annottext">Set CoreNodeId
</span><a href="#local-6989586621679251998"><span class="hs-identifier hs-var">lessers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">(CoreNodeId -&gt; (CoreNodeId, CoreNodeId))
-&gt; [CoreNodeId] -&gt; [(CoreNodeId, CoreNodeId)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreNodeId -&gt; CoreNodeId -&gt; (CoreNodeId, CoreNodeId))
-&gt; CoreNodeId -&gt; CoreNodeId -&gt; (CoreNodeId, CoreNodeId)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251999"><span class="hs-identifier hs-var">greater</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CoreNodeId -&gt; [CoreNodeId]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId
</span><a href="#local-6989586621679251998"><span class="hs-identifier hs-var">lessers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | The neighbor count of the node with the fewest neighbors, unless there are</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- zero nodes</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#minimumDegreeNodeTopology"><span class="hs-identifier hs-type">minimumDegreeNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-142"></span><span id="minimumDegreeNodeTopology"><span class="annot"><span class="annottext">minimumDegreeNodeTopology :: NodeTopology -&gt; Maybe Int
</span><a href="Test.ThreadNet.Util.NodeTopology.html#minimumDegreeNodeTopology"><span class="hs-identifier hs-var hs-var">minimumDegreeNodeTopology</span></a></span></span><span> </span><span id="local-6989586621679251997"><span class="annot"><span class="annottext">top :: NodeTopology
</span><a href="#local-6989586621679251997"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679251996"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679251996"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">[Int] -&gt; Maybe Int
</span><a href="#local-6989586621679251995"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[CoreNodeId] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; NodeTopology -&gt; CoreNodeId -&gt; [CoreNodeId]
NodeTopology -&gt; CoreNodeId -&gt; [CoreNodeId]
</span><a href="Test.ThreadNet.Util.NodeTopology.html#coreNodeIdNeighbors"><span class="hs-identifier hs-var">coreNodeIdNeighbors</span></a></span><span> </span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679251997"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251993"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679251993"><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251993"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; [CoreNodeId]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679251996"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679251995"><span class="annot"><span class="annottext">check :: [Int] -&gt; Maybe Int
</span><a href="#local-6989586621679251995"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-147"></span><span>        </span><span id="local-6989586621679251992"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679251992"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679251991"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679251991"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; Int -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; Int
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679251992"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679251991"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#unionNodeTopology"><span class="hs-identifier hs-type">unionNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span>
</span><span id="line-150"></span><span id="unionNodeTopology"><span class="annot"><span class="annottext">unionNodeTopology :: NodeTopology -&gt; NodeTopology -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#unionNodeTopology"><span class="hs-identifier hs-var hs-var">unionNodeTopology</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679251988"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679251988"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span id="local-6989586621679251987"><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679251987"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-var">NodeTopology</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology)
-&gt; Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Set CoreNodeId -&gt; Set CoreNodeId -&gt; Set CoreNodeId)
-&gt; Map CoreNodeId (Set CoreNodeId)
-&gt; Map CoreNodeId (Set CoreNodeId)
-&gt; Map CoreNodeId (Set CoreNodeId)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId -&gt; Set CoreNodeId -&gt; Set CoreNodeId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679251988"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId)
</span><a href="#local-6989586621679251987"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#mapNodeTopology"><span class="hs-identifier hs-type">mapNodeTopology</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CoreNodeId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-type">NodeTopology</span></a></span><span>
</span><span id="line-154"></span><span id="mapNodeTopology"><span class="annot"><span class="annottext">mapNodeTopology :: (CoreNodeId -&gt; CoreNodeId) -&gt; NodeTopology -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#mapNodeTopology"><span class="hs-identifier hs-var hs-var">mapNodeTopology</span></a></span></span><span> </span><span id="local-6989586621679251984"><span class="annot"><span class="annottext">CoreNodeId -&gt; CoreNodeId
</span><a href="#local-6989586621679251984"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679251983"><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679251983"><span class="hs-identifier hs-var">topo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
</span><a href="Test.ThreadNet.Util.NodeTopology.html#NodeTopology"><span class="hs-identifier hs-var">NodeTopology</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology)
-&gt; Map CoreNodeId (Set CoreNodeId) -&gt; NodeTopology
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Set CoreNodeId -&gt; Set CoreNodeId -&gt; Set CoreNodeId)
-&gt; [(CoreNodeId, Set CoreNodeId)]
-&gt; Map CoreNodeId (Set CoreNodeId)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Set CoreNodeId -&gt; Set CoreNodeId -&gt; Set CoreNodeId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">([(CoreNodeId, Set CoreNodeId)] -&gt; Map CoreNodeId (Set CoreNodeId))
-&gt; [(CoreNodeId, Set CoreNodeId)]
-&gt; Map CoreNodeId (Set CoreNodeId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreNodeId -&gt; CoreNodeId
</span><a href="#local-6989586621679251984"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251981"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId -&gt; CoreNodeId -&gt; (CoreNodeId, Set CoreNodeId)
forall a. Ord a =&gt; a -&gt; a -&gt; (a, Set a)
</span><a href="#local-6989586621679251980"><span class="hs-operator hs-var">`sortedSingleton`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId -&gt; CoreNodeId
</span><a href="#local-6989586621679251984"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251979"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679251981"><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251981"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679251979"><span class="annot"><span class="annottext">CoreNodeId
</span><a href="#local-6989586621679251979"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeTopology -&gt; [(CoreNodeId, CoreNodeId)]
</span><a href="Test.ThreadNet.Util.NodeTopology.html#edgesNodeTopology"><span class="hs-identifier hs-var">edgesNodeTopology</span></a></span><span> </span><span class="annot"><span class="annottext">NodeTopology
</span><a href="#local-6989586621679251983"><span class="hs-identifier hs-var">topo</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679251980"><span class="annot"><span class="annottext">sortedSingleton :: a -&gt; a -&gt; (a, Set a)
</span><a href="#local-6989586621679251980"><span class="hs-identifier hs-var hs-var">sortedSingleton</span></a></span></span><span> </span><span id="local-6989586621679251978"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251978"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679251977"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251977"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251978"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251977"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251978"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251977"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251977"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679251978"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span></pre></body></html>