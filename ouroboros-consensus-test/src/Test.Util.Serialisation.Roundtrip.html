<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds     #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor       #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances   #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving  #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Util.Serialisation.Roundtrip</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Basic test helpers</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier">roundtrip</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip%27"><span class="hs-identifier">roundtrip'</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Test skeleton</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier">Arbitrary'</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_all"><span class="hs-identifier">roundtrip_all</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseDisk"><span class="hs-identifier">roundtrip_SerialiseDisk</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToNode"><span class="hs-identifier">roundtrip_SerialiseNodeToNode</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToClient"><span class="hs-identifier">roundtrip_SerialiseNodeToClient</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_envelopes"><span class="hs-identifier">roundtrip_envelopes</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_ConvertRawHash"><span class="hs-identifier">roundtrip_ConvertRawHash</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#prop_hashSize"><span class="hs-identifier">prop_hashSize</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier">SomeResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decoder</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">deserialiseFromBytes</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Write</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toLazyByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Base16</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lazy</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Char8</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Short</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Serialised</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">fromSerialised</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>                     </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">mkSerialised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HeaderValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">AnnTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">LedgerState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.SupportsMempool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ApplyTxErr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">GenTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>                     </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">GenTxId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Node.NetworkProtocolVersion</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Node.Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">SerialiseNodeToClientConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>                     </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">SerialiseNodeToNodeConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Node.Serialisation</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ChainDepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">SerialiseDiskConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.Serialisation</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Dict</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.Tasty</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.Tasty.QuickCheck</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">{------------------------------------------------------------------------------
  Basic test helpers
------------------------------------------------------------------------------}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621679252690"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-type">roundtrip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252690"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252690"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252690"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252793"><span class="annot"><a href="#local-6989586621679252793"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252793"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252690"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252690"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-69"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span></span><span>
</span><span id="line-70"></span><span id="roundtrip"><span class="annot"><span class="annottext">roundtrip :: (a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var hs-var">roundtrip</span></a></span></span><span> </span><span id="local-6989586621679252531"><span class="annot"><span class="annottext">a -&gt; Encoding
</span><a href="#local-6989586621679252531"><span class="hs-identifier hs-var">enc</span></a></span></span><span> </span><span id="local-6989586621679252530"><span class="annot"><span class="annottext">forall s. Decoder s a
</span><a href="#local-6989586621679252530"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; a)) -&gt; a -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; a)) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip%27"><span class="hs-identifier hs-var">roundtrip'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Encoding
</span><a href="#local-6989586621679252531"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ByteString -&gt; a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ByteString -&gt; a)
-&gt; Decoder s a -&gt; Decoder s (ByteString -&gt; a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s a
forall s. Decoder s a
</span><a href="#local-6989586621679252530"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Roundtrip property for values annotated with their serialized form</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- NOTE: Suppose @a@ consists of a pair of the unannotated value @a'@ and some</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- 'Lazy.ByteString'. The roundtrip property will fail if that</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- 'Lazy.ByteString' encoding is not equal to @enc a'@. One way in which this</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- might happen is if the annotation is not canonical CBOR, but @enc@ does</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- produce canonical CBOR.</span><span>
</span><span id="line-79"></span><span id="local-6989586621679252788"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip%27"><span class="hs-identifier hs-type">roundtrip'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @enc@</span><span>
</span><span id="line-81"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252790"><span class="annot"><a href="#local-6989586621679252790"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252790"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-83"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span></span><span>
</span><span id="line-84"></span><span id="roundtrip%27"><span class="annot"><span class="annottext">roundtrip' :: (a -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; a)) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip%27"><span class="hs-identifier hs-var hs-var">roundtrip'</span></a></span></span><span> </span><span id="local-6989586621679252527"><span class="annot"><span class="annottext">a -&gt; Encoding
</span><a href="#local-6989586621679252527"><span class="hs-identifier hs-var">enc</span></a></span></span><span> </span><span id="local-6989586621679252526"><span class="annot"><span class="annottext">forall s. Decoder s (ByteString -&gt; a)
</span><a href="#local-6989586621679252526"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span id="local-6989586621679252525"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252525"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s (ByteString -&gt; a))
-&gt; ByteString
-&gt; Either DeserialiseFailure (ByteString, ByteString -&gt; a)
forall a.
(forall s. Decoder s a)
-&gt; ByteString -&gt; Either DeserialiseFailure (ByteString, a)
</span><span class="hs-identifier hs-var">deserialiseFromBytes</span></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s (ByteString -&gt; a)
</span><a href="#local-6989586621679252526"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252524"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252523"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252523"><span class="hs-identifier hs-var">bs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252522"><span class="annot"><span class="annottext">ByteString -&gt; a
</span><a href="#local-6989586621679252522"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">Lazy.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252523"><span class="hs-identifier hs-var">bs'</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252525"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Property
forall a. (Eq a, Show a) =&gt; a -&gt; a -&gt; Property
</span><span class="hs-operator hs-var">===</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; a
</span><a href="#local-6989586621679252522"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252524"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;left-over bytes: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252523"><span class="hs-identifier hs-var">bs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679252517"><span class="annot"><span class="annottext">DeserialiseFailure
</span><a href="#local-6989586621679252517"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-91"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeserialiseFailure -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DeserialiseFailure
</span><a href="#local-6989586621679252517"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679252524"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679252524"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><span class="hs-identifier hs-var">toLazyByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Encoding
</span><a href="#local-6989586621679252527"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252525"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">{------------------------------------------------------------------------------
  Test skeleton
------------------------------------------------------------------------------}</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Constraints needed in practice for something to be passed in as an</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- 'Arbitrary' argument to a QuickCheck property.</span><span>
</span><span id="line-101"></span><span class="hs-keyword">type</span><span> </span><span id="Arbitrary%27"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-var">Arbitrary'</span></a></span></span><span> </span><span id="local-6989586621679252516"><span class="annot"><a href="#local-6989586621679252516"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="#local-6989586621679252516"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252516"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252516"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | All roundtrip tests</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_all"><span class="hs-identifier hs-type">roundtrip_all</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252515"><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-106"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseDiskConstraints</span></a></span><span>         </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-107"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNodeConstraints</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-108"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToClientConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">StandardHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-114"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GetHeader</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-117"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">AnnTip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ChainDepState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-124"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-130"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ApplyTxErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252768"><span class="annot"><a href="#local-6989586621679252768"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252768"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Dict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252768"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252768"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span>
</span><span id="line-138"></span><span id="roundtrip_all"><span class="annot"><span class="annottext">roundtrip_all :: CodecConfig blk
-&gt; (forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a))
-&gt; TestTree
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_all"><span class="hs-identifier hs-var hs-var">roundtrip_all</span></a></span></span><span> </span><span id="local-6989586621679252514"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252514"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span id="local-6989586621679252513"><span class="annot"><span class="annottext">forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a)
</span><a href="#local-6989586621679252513"><span class="hs-identifier hs-var">dictNestedHdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; [TestTree] -&gt; TestTree
</span><span class="hs-identifier hs-var">testGroup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Roundtrip&quot;</span></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; [TestTree] -&gt; TestTree
</span><span class="hs-identifier hs-var">testGroup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SerialiseDisk&quot;</span></span><span>         </span><span class="annot"><span class="annottext">([TestTree] -&gt; TestTree) -&gt; [TestTree] -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; (forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a))
-&gt; [TestTree]
forall blk.
(SerialiseDiskConstraints blk, Arbitrary' blk,
 Arbitrary' (Header blk), Arbitrary' (LedgerState blk),
 Arbitrary' (AnnTip blk),
 Arbitrary' (ChainDepState (BlockProtocol blk))) =&gt;
CodecConfig blk
-&gt; (forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a))
-&gt; [TestTree]
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseDisk"><span class="hs-identifier hs-var">roundtrip_SerialiseDisk</span></a></span><span>         </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252514"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a)
</span><a href="#local-6989586621679252513"><span class="hs-identifier hs-var">dictNestedHdr</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; [TestTree] -&gt; TestTree
</span><span class="hs-identifier hs-var">testGroup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SerialiseNodeToNode&quot;</span></span><span>   </span><span class="annot"><span class="annottext">([TestTree] -&gt; TestTree) -&gt; [TestTree] -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk -&gt; [TestTree]
forall blk.
(SerialiseNodeToNodeConstraints blk,
 Show (BlockNodeToNodeVersion blk),
 ArbitraryWithVersion (BlockNodeToNodeVersion blk) blk,
 ArbitraryWithVersion (BlockNodeToNodeVersion blk) (Header blk),
 ArbitraryWithVersion (BlockNodeToNodeVersion blk) (GenTx blk),
 ArbitraryWithVersion (BlockNodeToNodeVersion blk) (GenTxId blk),
 EncodeDisk blk blk, DecodeDisk blk (ByteString -&gt; blk),
 HasNestedContent Header blk, EncodeDiskDep (NestedCtxt Header) blk,
 DecodeDiskDep (NestedCtxt Header) blk) =&gt;
CodecConfig blk -&gt; [TestTree]
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToNode"><span class="hs-identifier hs-var">roundtrip_SerialiseNodeToNode</span></a></span><span>   </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252514"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; [TestTree] -&gt; TestTree
</span><span class="hs-identifier hs-var">testGroup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SerialiseNodeToClient&quot;</span></span><span> </span><span class="annot"><span class="annottext">([TestTree] -&gt; TestTree) -&gt; [TestTree] -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk -&gt; [TestTree]
forall blk.
(SerialiseNodeToClientConstraints blk,
 Show (BlockNodeToClientVersion blk),
 ArbitraryWithVersion (BlockNodeToClientVersion blk) blk,
 ArbitraryWithVersion (BlockNodeToClientVersion blk) (GenTx blk),
 ArbitraryWithVersion
   (BlockNodeToClientVersion blk) (ApplyTxErr blk),
 ArbitraryWithVersion
   (BlockNodeToClientVersion blk) (SomeSecond Query blk),
 ArbitraryWithVersion
   (BlockNodeToClientVersion blk) (SomeResult blk),
 EncodeDisk blk blk, DecodeDisk blk (ByteString -&gt; blk)) =&gt;
CodecConfig blk -&gt; [TestTree]
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToClient"><span class="hs-identifier hs-var">roundtrip_SerialiseNodeToClient</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252514"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion
      (BlockNodeToNodeVersion blk) (SomeSecond (NestedCtxt Header) blk)
    -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;envelopes&quot;</span></span><span>          </span><span class="annot"><span class="annottext">((WithVersion
    (BlockNodeToNodeVersion blk) (SomeSecond (NestedCtxt Header) blk)
  -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion
      (BlockNodeToNodeVersion blk) (SomeSecond (NestedCtxt Header) blk)
    -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; WithVersion
     (BlockNodeToNodeVersion blk) (SomeSecond (NestedCtxt Header) blk)
-&gt; Property
forall blk.
(SerialiseNodeToNode blk (SerialisedHeader blk),
 HasNestedContent Header blk) =&gt;
CodecConfig blk
-&gt; WithVersion
     (BlockNodeToNodeVersion blk) (SomeSecond (NestedCtxt Header) blk)
-&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_envelopes"><span class="hs-identifier hs-var">roundtrip_envelopes</span></a></span><span>             </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252514"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; (HeaderHash blk -&gt; Property) -&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ConvertRawHash&quot;</span></span><span>     </span><span class="annot"><span class="annottext">((HeaderHash blk -&gt; Property) -&gt; TestTree)
-&gt; (HeaderHash blk -&gt; Property) -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Property
forall blk.
(StandardHash blk, ConvertRawHash blk) =&gt;
Proxy blk -&gt; HeaderHash blk -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_ConvertRawHash"><span class="hs-identifier hs-var">roundtrip_ConvertRawHash</span></a></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; (HeaderHash blk -&gt; Property) -&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hashSize&quot;</span></span><span>           </span><span class="annot"><span class="annottext">((HeaderHash blk -&gt; Property) -&gt; TestTree)
-&gt; (HeaderHash blk -&gt; Property) -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; Property
forall blk.
ConvertRawHash blk =&gt;
Proxy blk -&gt; HeaderHash blk -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#prop_hashSize"><span class="hs-identifier hs-var">prop_hashSize</span></a></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;estimateBlockSize&quot;</span></span><span>  </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property
forall blk.
(SerialiseNodeToNodeConstraints blk, GetHeader blk) =&gt;
CodecConfig blk
-&gt; WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#prop_estimateBlockSize"><span class="hs-identifier hs-var">prop_estimateBlockSize</span></a></span><span>         </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252514"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- TODO how can we ensure that we have a test for each constraint listed in</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- 'SerialiseDiskConstraints'?</span><span>
</span><span id="line-151"></span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseDisk"><span class="hs-identifier hs-type">roundtrip_SerialiseDisk</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252761"><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-153"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseDiskConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-156"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">AnnTip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ChainDepState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252754"><span class="annot"><a href="#local-6989586621679252754"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252754"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Dict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252754"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252754"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span id="roundtrip_SerialiseDisk"><span class="annot"><span class="annottext">roundtrip_SerialiseDisk :: CodecConfig blk
-&gt; (forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a))
-&gt; [TestTree]
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseDisk"><span class="hs-identifier hs-var hs-var">roundtrip_SerialiseDisk</span></a></span></span><span> </span><span id="local-6989586621679252508"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span id="local-6989586621679252507"><span class="annot"><span class="annottext">forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a)
</span><a href="#local-6989586621679252507"><span class="hs-identifier hs-var">dictNestedHdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; (blk -&gt; Property) -&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip block&quot;</span></span><span> </span><span class="annot"><span class="annottext">((blk -&gt; Property) -&gt; TestTree) -&gt; (blk -&gt; Property) -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">(blk -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; blk)) -&gt; blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; a)) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip%27"><span class="hs-identifier hs-var">roundtrip'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; blk -&gt; Encoding
forall blk a. EncodeDisk blk a =&gt; CodecConfig blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s (ByteString -&gt; blk)
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Header blk -&gt; Property) -&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Header&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Header blk -&gt; Property) -&gt; TestTree)
-&gt; (Header blk -&gt; Property) -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679252504"><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252504"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Header blk -&gt; DepPair (NestedCtxt Header blk)
forall (f :: * -&gt; *) blk.
HasNestedContent f blk =&gt;
f blk -&gt; DepPair (NestedCtxt f blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">unnest</span></a></span><span> </span><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252504"><span class="hs-identifier hs-var">hdr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>          </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">DepPair</span></a></span><span> </span><span id="local-6989586621679252501"><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252501"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621679252500"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252500"><span class="hs-identifier hs-var">nestedHdr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a)
forall a. NestedCtxt_ blk Header a -&gt; Dict (Eq a, Show a)
</span><a href="#local-6989586621679252507"><span class="hs-identifier hs-var">dictNestedHdr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NestedCtxt Header blk a -&gt; NestedCtxt_ blk Header a
forall (f :: * -&gt; *) blk a.
NestedCtxt f blk a -&gt; NestedCtxt_ blk f a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">flipNestedCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252501"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><span class="annottext">Dict (Eq a, Show a)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>              </span><span class="annot"><span class="annottext">(a -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; a)) -&gt; a -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding)
-&gt; (forall s. Decoder s (ByteString -&gt; a)) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip%27"><span class="hs-identifier hs-var">roundtrip'</span></a></span><span>
</span><span id="line-172"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; NestedCtxt Header blk a -&gt; a -&gt; Encoding
forall (f :: * -&gt; * -&gt; *) blk a.
EncodeDiskDep f blk =&gt;
CodecConfig blk -&gt; f blk a -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDiskDep</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252501"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; NestedCtxt Header blk a -&gt; forall s. Decoder s (ByteString -&gt; a)
forall (f :: * -&gt; * -&gt; *) blk a.
DecodeDiskDep f blk =&gt;
CodecConfig blk -&gt; f blk a -&gt; forall s. Decoder s (ByteString -&gt; a)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDiskDep</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252501"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>                </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252500"><span class="hs-identifier hs-var">nestedHdr</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-comment">-- Since the 'LedgerState' is a large data structure, we lower the</span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-comment">-- number of tests to avoid slowing down the testsuite too much</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(QuickCheckTests -&gt; QuickCheckTests) -&gt; TestTree -&gt; TestTree
forall v. IsOption v =&gt; (v -&gt; v) -&gt; TestTree -&gt; TestTree
</span><span class="hs-identifier hs-var">adjustOption</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">QuickCheckTests</span></span><span> </span><span id="local-6989586621679252493"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252493"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; QuickCheckTests
</span><span class="hs-identifier hs-var">QuickCheckTests</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`max`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">div</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252493"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TestTree -&gt; TestTree) -&gt; TestTree -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><span class="annottext">Proxy (LedgerState blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary' a, EncodeDisk blk a, DecodeDisk blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252490"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (LedgerState blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LedgerState&quot;</span></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (AnnTip blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary' a, EncodeDisk blk a, DecodeDisk blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252490"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (AnnTip blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">AnnTip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AnnTip&quot;</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (ChainDepState (BlockProtocol blk)) -&gt; String -&gt; TestTree
forall a.
(Arbitrary' a, EncodeDisk blk a, DecodeDisk blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252490"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ChainDepState (BlockProtocol blk))
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ChainDepState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockProtocol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ChainDepState&quot;</span></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="#local-6989586621679252490"><span class="hs-identifier hs-type">rt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252692"><span class="annot"><a href="#local-6989586621679252692"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Arbitrary%27"><span class="hs-identifier hs-type">Arbitrary'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">EncodeDisk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">DecodeDisk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252761"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679252692"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679252490"><span class="annot"><span class="annottext">rt :: Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252490"><span class="hs-identifier hs-var hs-var">rt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679252489"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679252489"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; (a -&gt; Property) -&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679252489"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((a -&gt; Property) -&gt; TestTree) -&gt; (a -&gt; Property) -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252692"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; a -&gt; Encoding
forall blk a. EncodeDisk blk a =&gt; CodecConfig blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s a
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252508"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | Used to generate arbitrary values for the serialisation roundtrip tests.</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- As the serialisation format can change with the version, not all arbitrary</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- values of the type might be valid for each version.</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- For example, a certain constructor can only be used after a certain version</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- and can thus not be generated for any prior versions.</span><span>
</span><span id="line-197"></span><span class="hs-keyword">data</span><span> </span><span id="WithVersion"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-var">WithVersion</span></a></span></span><span> </span><span id="local-6989586621679252669"><span class="annot"><a href="#local-6989586621679252669"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679252668"><span class="annot"><a href="#local-6989586621679252668"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WithVersion"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-var">WithVersion</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679252669"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252668"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252484"><span id="local-6989586621679252486"><span class="annot"><span class="annottext">WithVersion v a -&gt; WithVersion v a -&gt; Bool
(WithVersion v a -&gt; WithVersion v a -&gt; Bool)
-&gt; (WithVersion v a -&gt; WithVersion v a -&gt; Bool)
-&gt; Eq (WithVersion v a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a.
(Eq v, Eq a) =&gt;
WithVersion v a -&gt; WithVersion v a -&gt; Bool
/= :: WithVersion v a -&gt; WithVersion v a -&gt; Bool
$c/= :: forall v a.
(Eq v, Eq a) =&gt;
WithVersion v a -&gt; WithVersion v a -&gt; Bool
== :: WithVersion v a -&gt; WithVersion v a -&gt; Bool
$c== :: forall v a.
(Eq v, Eq a) =&gt;
WithVersion v a -&gt; WithVersion v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252477"><span id="local-6989586621679252479"><span id="local-6989586621679252481"><span class="annot"><span class="annottext">Int -&gt; WithVersion v a -&gt; String -&gt; String
[WithVersion v a] -&gt; String -&gt; String
WithVersion v a -&gt; String
(Int -&gt; WithVersion v a -&gt; String -&gt; String)
-&gt; (WithVersion v a -&gt; String)
-&gt; ([WithVersion v a] -&gt; String -&gt; String)
-&gt; Show (WithVersion v a)
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
forall v a.
(Show v, Show a) =&gt;
Int -&gt; WithVersion v a -&gt; String -&gt; String
forall v a.
(Show v, Show a) =&gt;
[WithVersion v a] -&gt; String -&gt; String
forall v a. (Show v, Show a) =&gt; WithVersion v a -&gt; String
showList :: [WithVersion v a] -&gt; String -&gt; String
$cshowList :: forall v a.
(Show v, Show a) =&gt;
[WithVersion v a] -&gt; String -&gt; String
show :: WithVersion v a -&gt; String
$cshow :: forall v a. (Show v, Show a) =&gt; WithVersion v a -&gt; String
showsPrec :: Int -&gt; WithVersion v a -&gt; String -&gt; String
$cshowsPrec :: forall v a.
(Show v, Show a) =&gt;
Int -&gt; WithVersion v a -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252472"><span id="local-6989586621679252474"><span class="annot"><span class="annottext">a -&gt; WithVersion v b -&gt; WithVersion v a
(a -&gt; b) -&gt; WithVersion v a -&gt; WithVersion v b
(forall a b. (a -&gt; b) -&gt; WithVersion v a -&gt; WithVersion v b)
-&gt; (forall a b. a -&gt; WithVersion v b -&gt; WithVersion v a)
-&gt; Functor (WithVersion v)
forall a b. a -&gt; WithVersion v b -&gt; WithVersion v a
forall a b. (a -&gt; b) -&gt; WithVersion v a -&gt; WithVersion v b
forall v a b. a -&gt; WithVersion v b -&gt; WithVersion v a
forall v a b. (a -&gt; b) -&gt; WithVersion v a -&gt; WithVersion v b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; WithVersion v b -&gt; WithVersion v a
$c&lt;$ :: forall v a b. a -&gt; WithVersion v b -&gt; WithVersion v a
fmap :: (a -&gt; b) -&gt; WithVersion v a -&gt; WithVersion v b
$cfmap :: forall v a b. (a -&gt; b) -&gt; WithVersion v a -&gt; WithVersion v b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621679252470"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679252467"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="#local-6989586621679252470"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252470"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621679252465"><span class="annot"><span class="annottext">arbitrary :: Gen (WithVersion () a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; a -&gt; WithVersion () a
forall v a. v -&gt; a -&gt; WithVersion v a
</span><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-var">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; WithVersion () a) -&gt; Gen a -&gt; Gen (WithVersion () a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen a
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- | Similar to @Arbitrary'@, but with an 'Arbitrary' instasnce for</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- @('WithVersion' v a)@.</span><span>
</span><span id="line-205"></span><span class="hs-keyword">type</span><span> </span><span id="ArbitraryWithVersion"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-var">ArbitraryWithVersion</span></a></span></span><span> </span><span id="local-6989586621679252463"><span class="annot"><a href="#local-6989586621679252463"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679252462"><span class="annot"><a href="#local-6989586621679252462"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252463"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252462"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252462"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252462"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- TODO how can we ensure that we have a test for each constraint listed in</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- 'SerialiseNodeToNodeConstraints'?</span><span>
</span><span id="line-209"></span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToNode"><span class="hs-identifier hs-type">roundtrip_SerialiseNodeToNode</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252753"><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-211"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNodeConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-212"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-214"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-comment">-- Needed for testing the @Serialised blk@</span><span>
</span><span id="line-219"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">EncodeDisk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-220"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">DecodeDisk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>       </span><span class="hs-comment">-- Needed for testing the @Serialised (Header blk)@</span><span>
</span><span id="line-222"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasNestedContent</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-223"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">EncodeDiskDep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-224"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">DecodeDiskDep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-225"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span id="roundtrip_SerialiseNodeToNode"><span class="annot"><span class="annottext">roundtrip_SerialiseNodeToNode :: CodecConfig blk -&gt; [TestTree]
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToNode"><span class="hs-identifier hs-var hs-var">roundtrip_SerialiseNodeToNode</span></a></span></span><span> </span><span id="local-6989586621679252461"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToNodeVersion blk) a), Eq a,
 Show a, SerialiseNodeToNode blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;blk&quot;</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (Header blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToNodeVersion blk) a), Eq a,
 Show a, SerialiseNodeToNode blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (Header blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Header&quot;</span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (GenTx blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToNodeVersion blk) a), Eq a,
 Show a, SerialiseNodeToNode blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (GenTx blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GenTx&quot;</span></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (GenTxId blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToNodeVersion blk) a), Eq a,
 Show a, SerialiseNodeToNode blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (GenTxId blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTxId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GenTxId&quot;</span></span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-comment">-- Roundtrip a @'Serialised' blk@</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-comment">-- We generate a random @blk@, convert it to 'Serialised' (using</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-comment">-- 'encodeDisk', which doesn't add CBOR-in-CBOR), encode it (adding</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-comment">-- CBOR-in-CBOR), decode that 'Serialised' and convert (using</span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-comment">-- 'decodeNodeToNode') it to a @blk@ again.</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised blk&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252459"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252459"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252458"><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252458"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">(blk -&gt; Encoding) -&gt; (forall s. Decoder s blk) -&gt; blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-242"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(blk -&gt; Encoding)
-&gt; (Serialised blk -&gt; Encoding) -&gt; blk -&gt; Encoding
forall a.
(a -&gt; Encoding) -&gt; (Serialised a -&gt; Encoding) -&gt; a -&gt; Encoding
</span><a href="Test.Util.Serialisation.Roundtrip.html#encodeThroughSerialised"><span class="hs-identifier hs-var">encodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; blk -&gt; Encoding
forall blk a. EncodeDisk blk a =&gt; CodecConfig blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; Serialised blk -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252459"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (ByteString -&gt; blk))
-&gt; (forall s. Decoder s (Serialised blk))
-&gt; forall s. Decoder s blk
forall a.
(forall s. Decoder s (ByteString -&gt; a))
-&gt; (forall s. Decoder s (Serialised a)) -&gt; forall s. Decoder s a
</span><a href="Test.Util.Serialisation.Roundtrip.html#decodeThroughSerialised"><span class="hs-identifier hs-var">decodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s (ByteString -&gt; blk)
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; forall s. Decoder s (Serialised blk)
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252459"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>            </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252458"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-comment">-- Same as above but for 'Header'</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) (Header blk)
    -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised Header&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) (Header blk)
  -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) (Header blk)
    -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252453"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252453"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252452"><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252452"><span class="hs-identifier hs-var">hdr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>          </span><span class="annot"><span class="annottext">(Header blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Header blk)) -&gt; Header blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; SerialisedHeader blk -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252453"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk -&gt; Encoding)
-&gt; (Header blk -&gt; SerialisedHeader blk) -&gt; Header blk -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
forall blk.
GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SerialisedHeaderFromDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk)
 -&gt; SerialisedHeader blk)
-&gt; (Header blk -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; Header blk
-&gt; SerialisedHeader blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; DepPair (NestedCtxt Header blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall (f :: * -&gt; * -&gt; *) blk.
EncodeDiskDep f blk =&gt;
CodecConfig blk -&gt; DepPair (f blk) -&gt; GenDepPair Serialised (f blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">(DepPair (NestedCtxt Header blk)
 -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; (Header blk -&gt; DepPair (NestedCtxt Header blk))
-&gt; Header blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Header blk -&gt; DepPair (NestedCtxt Header blk)
forall (f :: * -&gt; *) blk.
HasNestedContent f blk =&gt;
f blk -&gt; DepPair (NestedCtxt f blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">unnest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DepPair (NestedCtxt Header blk) -&gt; Header blk
forall (f :: * -&gt; *) blk.
HasNestedContent f blk =&gt;
DepPair (NestedCtxt f blk) -&gt; f blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">(DepPair (NestedCtxt Header blk) -&gt; Header blk)
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
-&gt; Decoder s (Header blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
forall (f :: * -&gt; * -&gt; *) blk s.
DecodeDiskDep f blk =&gt;
CodecConfig blk
-&gt; GenDepPair Serialised (f blk) -&gt; Decoder s (DepPair (f blk))
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk)
 -&gt; Decoder s (DepPair (NestedCtxt Header blk)))
-&gt; (SerialisedHeader blk
    -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; SerialisedHeader blk
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall blk.
SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">serialisedHeaderToDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk
 -&gt; Decoder s (DepPair (NestedCtxt Header blk)))
-&gt; Decoder s (SerialisedHeader blk)
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; forall s. Decoder s (SerialisedHeader blk)
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252453"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252452"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-comment">-- Check the compatibility between 'encodeNodeToNode' for @'Serialised'</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-comment">-- blk@ and 'decodeNodeToNode' for @blk@.</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised blk compat 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252444"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252443"><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252443"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>          </span><span class="annot"><span class="annottext">(blk -&gt; Encoding) -&gt; (forall s. Decoder s blk) -&gt; blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-257"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(blk -&gt; Encoding)
-&gt; (Serialised blk -&gt; Encoding) -&gt; blk -&gt; Encoding
forall a.
(a -&gt; Encoding) -&gt; (Serialised a -&gt; Encoding) -&gt; a -&gt; Encoding
</span><a href="Test.Util.Serialisation.Roundtrip.html#encodeThroughSerialised"><span class="hs-identifier hs-var">encodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; blk -&gt; Encoding
forall blk a. EncodeDisk blk a =&gt; CodecConfig blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; Serialised blk -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; forall s. Decoder s blk
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>            </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252443"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-comment">-- Check the compatibility between 'encodeNodeToNode' for @blk@ and</span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-comment">-- 'decodeNodeToNode' for @'Serialised' blk@.</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised blk compat 2&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252442"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252442"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252441"><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252441"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>          </span><span class="annot"><span class="annottext">(blk -&gt; Encoding) -&gt; (forall s. Decoder s blk) -&gt; blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; blk -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252442"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (ByteString -&gt; blk))
-&gt; (forall s. Decoder s (Serialised blk))
-&gt; forall s. Decoder s blk
forall a.
(forall s. Decoder s (ByteString -&gt; a))
-&gt; (forall s. Decoder s (Serialised a)) -&gt; forall s. Decoder s a
</span><a href="Test.Util.Serialisation.Roundtrip.html#decodeThroughSerialised"><span class="hs-identifier hs-var">decodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s (ByteString -&gt; blk)
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; forall s. Decoder s (Serialised blk)
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252442"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>            </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252441"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-comment">-- Same as above but for 'Header'</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) (Header blk)
    -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised Header compat 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) (Header blk)
  -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) (Header blk)
    -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252440"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252440"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252439"><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252439"><span class="hs-identifier hs-var">hdr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="annottext">(Header blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Header blk)) -&gt; Header blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; SerialisedHeader blk -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252440"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk -&gt; Encoding)
-&gt; (Header blk -&gt; SerialisedHeader blk) -&gt; Header blk -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
forall blk.
GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SerialisedHeaderFromDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk)
 -&gt; SerialisedHeader blk)
-&gt; (Header blk -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; Header blk
-&gt; SerialisedHeader blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; DepPair (NestedCtxt Header blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall (f :: * -&gt; * -&gt; *) blk.
EncodeDiskDep f blk =&gt;
CodecConfig blk -&gt; DepPair (f blk) -&gt; GenDepPair Serialised (f blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">(DepPair (NestedCtxt Header blk)
 -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; (Header blk -&gt; DepPair (NestedCtxt Header blk))
-&gt; Header blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Header blk -&gt; DepPair (NestedCtxt Header blk)
forall (f :: * -&gt; *) blk.
HasNestedContent f blk =&gt;
f blk -&gt; DepPair (NestedCtxt f blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">unnest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; forall s. Decoder s (Header blk)
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252440"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>            </span><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252439"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) (Header blk)
    -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised Header compat 2&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) (Header blk)
  -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) (Header blk)
    -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252438"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252438"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252437"><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252437"><span class="hs-identifier hs-var">hdr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>          </span><span class="annot"><span class="annottext">(Header blk -&gt; Encoding)
-&gt; (forall s. Decoder s (Header blk)) -&gt; Header blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; Header blk -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252438"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DepPair (NestedCtxt Header blk) -&gt; Header blk
forall (f :: * -&gt; *) blk.
HasNestedContent f blk =&gt;
DepPair (NestedCtxt f blk) -&gt; f blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">(DepPair (NestedCtxt Header blk) -&gt; Header blk)
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
-&gt; Decoder s (Header blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
forall (f :: * -&gt; * -&gt; *) blk s.
DecodeDiskDep f blk =&gt;
CodecConfig blk
-&gt; GenDepPair Serialised (f blk) -&gt; Decoder s (DepPair (f blk))
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk)
 -&gt; Decoder s (DepPair (NestedCtxt Header blk)))
-&gt; (SerialisedHeader blk
    -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; SerialisedHeader blk
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall blk.
SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">serialisedHeaderToDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk
 -&gt; Decoder s (DepPair (NestedCtxt Header blk)))
-&gt; Decoder s (SerialisedHeader blk)
-&gt; Decoder s (DepPair (NestedCtxt Header blk))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; forall s. Decoder s (SerialisedHeader blk)
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252438"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>            </span><span class="annot"><span class="annottext">Header blk
</span><a href="#local-6989586621679252437"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679252663"><span class="annot"><a href="#local-6989586621679252456"><span class="hs-identifier hs-type">enc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252663"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252663"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span></span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621679252456"><span class="annot"><span class="annottext">enc :: BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679252655"><span class="annot"><a href="#local-6989586621679252454"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252655"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252654"><span class="annot"><a href="#local-6989586621679252654"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252654"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252655"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679252454"><span class="annot"><span class="annottext">dec :: BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk
-&gt; BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="#local-6989586621679252460"><span class="hs-identifier hs-type">rt</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252666"><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-293"></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-295"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-296"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252753"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-297"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621679252460"><span class="annot"><span class="annottext">rt :: Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var hs-var">rt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679252434"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679252434"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToNodeVersion blk) a -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679252434"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToNodeVersion blk) a -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToNodeVersion blk) a -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252433"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252433"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252432"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252432"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252433"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
forall a.
SerialiseNodeToNode blk a =&gt;
BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252454"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252433"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252432"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- TODO how can we ensure that we have a test for each constraint listed in</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- 'SerialiseNodeToClientConstraints'?</span><span>
</span><span id="line-305"></span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToClient"><span class="hs-identifier hs-type">roundtrip_SerialiseNodeToClient</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252741"><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-307"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToClientConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-308"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-310"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ApplyTxErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#ArbitraryWithVersion"><span class="hs-identifier hs-type">ArbitraryWithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>       </span><span class="hs-comment">-- Needed for testing the @Serialised blk@</span><span>
</span><span id="line-316"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">EncodeDisk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-317"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">DecodeDisk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span class="hs-special">]</span><span>
</span><span id="line-321"></span><span id="roundtrip_SerialiseNodeToClient"><span class="annot"><span class="annottext">roundtrip_SerialiseNodeToClient :: CodecConfig blk -&gt; [TestTree]
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_SerialiseNodeToClient"><span class="hs-identifier hs-var hs-var">roundtrip_SerialiseNodeToClient</span></a></span></span><span> </span><span id="local-6989586621679252431"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToClientVersion blk) a), Eq a,
 Show a, SerialiseNodeToClient blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252430"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>                    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;blk&quot;</span></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (GenTx blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToClientVersion blk) a), Eq a,
 Show a, SerialiseNodeToClient blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252430"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (GenTx blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GenTx&quot;</span></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (ApplyTxErr blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToClientVersion blk) a), Eq a,
 Show a, SerialiseNodeToClient blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252430"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ApplyTxErr blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ApplyTxErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ApplyTxErr&quot;</span></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy (SomeSecond Query blk) -&gt; String -&gt; TestTree
forall a.
(Arbitrary (WithVersion (BlockNodeToClientVersion blk) a), Eq a,
 Show a, SerialiseNodeToClient blk a) =&gt;
Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252430"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (SomeSecond Query blk)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Query&quot;</span></span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-comment">-- See roundtrip_SerialiseNodeToNode for more info</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToClientVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised blk&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToClientVersion blk) blk -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToClientVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252429"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252429"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252428"><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252428"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>          </span><span class="annot"><span class="annottext">(blk -&gt; Encoding) -&gt; (forall s. Decoder s blk) -&gt; blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(blk -&gt; Encoding)
-&gt; (Serialised blk -&gt; Encoding) -&gt; blk -&gt; Encoding
forall a.
(a -&gt; Encoding) -&gt; (Serialised a -&gt; Encoding) -&gt; a -&gt; Encoding
</span><a href="Test.Util.Serialisation.Roundtrip.html#encodeThroughSerialised"><span class="hs-identifier hs-var">encodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; blk -&gt; Encoding
forall blk a. EncodeDisk blk a =&gt; CodecConfig blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk -&gt; Serialised blk -&gt; Encoding
forall a.
SerialiseNodeToClient blk a =&gt;
BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252427"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252429"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall s. Decoder s (ByteString -&gt; blk))
-&gt; (forall s. Decoder s (Serialised blk))
-&gt; forall s. Decoder s blk
forall a.
(forall s. Decoder s (ByteString -&gt; a))
-&gt; (forall s. Decoder s (Serialised a)) -&gt; forall s. Decoder s a
</span><a href="Test.Util.Serialisation.Roundtrip.html#decodeThroughSerialised"><span class="hs-identifier hs-var">decodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s (ByteString -&gt; blk)
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; forall s. Decoder s (Serialised blk)
forall a.
SerialiseNodeToClient blk a =&gt;
BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252426"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252429"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252428"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-comment">-- See roundtrip_SerialiseNodeToNode for more info</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToClientVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Serialised blk compat&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToClientVersion blk) blk -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToClientVersion blk) blk -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252425"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252425"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252424"><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252424"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-336"></span><span>          </span><span class="annot"><span class="annottext">(blk -&gt; Encoding) -&gt; (forall s. Decoder s blk) -&gt; blk -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-337"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(blk -&gt; Encoding)
-&gt; (Serialised blk -&gt; Encoding) -&gt; blk -&gt; Encoding
forall a.
(a -&gt; Encoding) -&gt; (Serialised a -&gt; Encoding) -&gt; a -&gt; Encoding
</span><a href="Test.Util.Serialisation.Roundtrip.html#encodeThroughSerialised"><span class="hs-identifier hs-var">encodeThroughSerialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; blk -&gt; Encoding
forall blk a. EncodeDisk blk a =&gt; CodecConfig blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk -&gt; Serialised blk -&gt; Encoding
forall a.
SerialiseNodeToClient blk a =&gt;
BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252427"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252425"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk -&gt; forall s. Decoder s blk
forall a.
SerialiseNodeToClient blk a =&gt;
BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252426"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252425"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252424"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToClientVersion blk) (SomeResult blk)
    -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip Result&quot;</span></span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToClientVersion blk) (SomeResult blk)
  -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToClientVersion blk) (SomeResult blk)
    -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252423"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252423"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span id="local-6989586621679252421"><span class="annot"><span class="annottext">Query blk result
</span><a href="#local-6989586621679252421"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621679252420"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252420"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>          </span><span class="annot"><span class="annottext">(result -&gt; Encoding)
-&gt; (forall s. Decoder s result) -&gt; result -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span>
</span><span id="line-343"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; Query blk result
-&gt; result
-&gt; Encoding
forall blk (query :: * -&gt; *) result.
SerialiseResult blk query =&gt;
CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; query result
-&gt; result
-&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeResult</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252423"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Query blk result
</span><a href="#local-6989586621679252421"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; Query blk result
-&gt; forall s. Decoder s result
forall blk (query :: * -&gt; *) result.
SerialiseResult blk query =&gt;
CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; query result
-&gt; forall s. Decoder s result
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeResult</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252423"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Query blk result
</span><a href="#local-6989586621679252421"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>            </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252420"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621679252621"><span class="annot"><a href="#local-6989586621679252427"><span class="hs-identifier hs-type">enc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252621"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252621"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621679252427"><span class="annot"><span class="annottext">enc :: BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252427"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecConfig blk -&gt; BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
forall blk a.
SerialiseNodeToClient blk a =&gt;
CodecConfig blk -&gt; BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeNodeToClient</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679252617"><span class="annot"><a href="#local-6989586621679252426"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252617"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252616"><span class="annot"><a href="#local-6989586621679252616"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252616"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252617"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621679252426"><span class="annot"><span class="annottext">dec :: BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252426"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
forall blk a.
SerialiseNodeToClient blk a =&gt;
CodecConfig blk
-&gt; BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeNodeToClient</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252431"><span class="hs-identifier hs-var">ccfg</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="#local-6989586621679252430"><span class="hs-identifier hs-type">rt</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252623"><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-358"></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-360"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-361"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252741"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-362"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621679252430"><span class="annot"><span class="annottext">rt :: Proxy a -&gt; String -&gt; TestTree
</span><a href="#local-6989586621679252430"><span class="hs-identifier hs-var hs-var">rt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679252415"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679252415"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; (WithVersion (BlockNodeToClientVersion blk) a -&gt; Property)
-&gt; TestTree
forall a. Testable a =&gt; String -&gt; a -&gt; TestTree
</span><span class="hs-identifier hs-var">testProperty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roundtrip &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679252415"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((WithVersion (BlockNodeToClientVersion blk) a -&gt; Property)
 -&gt; TestTree)
-&gt; (WithVersion (BlockNodeToClientVersion blk) a -&gt; Property)
-&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252414"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252414"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252413"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252413"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><span class="annottext">(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252623"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
forall a.
SerialiseNodeToClient blk a =&gt;
BlockNodeToClientVersion blk -&gt; a -&gt; Encoding
</span><a href="#local-6989586621679252427"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252414"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
forall a.
SerialiseNodeToClient blk a =&gt;
BlockNodeToClientVersion blk -&gt; forall s. Decoder s a
</span><a href="#local-6989586621679252426"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679252414"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679252413"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Checking envelopes
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">-- | This is similar to the roundtrip tests for headers, except we don't</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- start with a header but some fixed bytestring in the payload. This makes</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- debugging a bit easier as we can focus on just the envelope.</span><span>
</span><span id="line-376"></span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_envelopes"><span class="hs-identifier hs-type">roundtrip_envelopes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-377"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252732"><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-378"></span><span>       </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasNestedContent</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-380"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span><span>
</span><span id="line-384"></span><span id="roundtrip_envelopes"><span class="annot"><span class="annottext">roundtrip_envelopes :: CodecConfig blk
-&gt; WithVersion
     (BlockNodeToNodeVersion blk) (SomeSecond (NestedCtxt Header) blk)
-&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_envelopes"><span class="hs-identifier hs-var hs-var">roundtrip_envelopes</span></a></span></span><span> </span><span id="local-6989586621679252412"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252412"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252411"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252411"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span id="local-6989586621679252409"><span class="annot"><span class="annottext">NestedCtxt Header blk b
</span><a href="#local-6989586621679252409"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="annottext">(Base16 (SerialisedHeader blk) -&gt; Encoding)
-&gt; (forall s. Decoder s (Base16 (SerialisedHeader blk)))
-&gt; Base16 (SerialisedHeader blk)
-&gt; Property
forall a.
(Eq a, Show a) =&gt;
(a -&gt; Encoding) -&gt; (forall s. Decoder s a) -&gt; a -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip"><span class="hs-identifier hs-var">roundtrip</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToNodeVersion blk -&gt; SerialisedHeader blk -&gt; Encoding
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252412"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252411"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk -&gt; Encoding)
-&gt; (Base16 (SerialisedHeader blk) -&gt; SerialisedHeader blk)
-&gt; Base16 (SerialisedHeader blk)
-&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Base16 (SerialisedHeader blk) -&gt; SerialisedHeader blk
forall a. Base16 a -&gt; a
</span><a href="Test.Util.Serialisation.Roundtrip.html#unBase16"><span class="hs-identifier hs-var hs-var">unBase16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerialisedHeader blk -&gt; Base16 (SerialisedHeader blk)
forall a. a -&gt; Base16 a
</span><a href="Test.Util.Serialisation.Roundtrip.html#Base16"><span class="hs-identifier hs-var">Base16</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk -&gt; Base16 (SerialisedHeader blk))
-&gt; Decoder s (SerialisedHeader blk)
-&gt; Decoder s (Base16 (SerialisedHeader blk))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToNodeVersion blk
-&gt; forall s. Decoder s (SerialisedHeader blk)
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk
-&gt; BlockNodeToNodeVersion blk -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252412"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252411"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerialisedHeader blk -&gt; Base16 (SerialisedHeader blk)
forall a. a -&gt; Base16 a
</span><a href="Test.Util.Serialisation.Roundtrip.html#Base16"><span class="hs-identifier hs-var">Base16</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedHeader blk
</span><a href="#local-6989586621679252406"><span class="hs-identifier hs-var">serialisedHeader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><a href="#local-6989586621679252406"><span class="hs-identifier hs-type">serialisedHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252732"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621679252406"><span class="annot"><span class="annottext">serialisedHeader :: SerialisedHeader blk
</span><a href="#local-6989586621679252406"><span class="hs-identifier hs-var hs-var">serialisedHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
forall blk.
GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SerialisedHeaderFromDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk)
 -&gt; SerialisedHeader blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
-&gt; SerialisedHeader blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">NestedCtxt Header blk b
-&gt; Serialised b -&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall (f :: * -&gt; *) a (g :: * -&gt; *). f a -&gt; g a -&gt; GenDepPair g f
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">GenDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk b
</span><a href="#local-6989586621679252409"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Serialised b
forall a. ByteString -&gt; Serialised a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">Serialised</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252403"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><a href="#local-6989586621679252403"><span class="hs-identifier hs-type">bs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621679252403"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679252403"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&lt;PAYLOAD&gt;&quot;</span></span><span> </span><span class="hs-comment">-- Something we can easily recognize in test failures</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-keyword">newtype</span><span> </span><span id="Base16"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Base16"><span class="hs-identifier hs-var">Base16</span></a></span></span><span> </span><span id="local-6989586621679252595"><span class="annot"><a href="#local-6989586621679252595"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Base16"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Base16"><span class="hs-identifier hs-var">Base16</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unBase16"><span class="annot"><span class="annottext">Base16 a -&gt; a
</span><a href="Test.Util.Serialisation.Roundtrip.html#unBase16"><span class="hs-identifier hs-var hs-var">unBase16</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252595"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span id="local-6989586621679252402"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679252397"><span id="local-6989586621679252400"><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasNestedContent</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252402"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Base16"><span class="hs-identifier hs-type">Base16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252402"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-400"></span><span>  </span><span id="local-6989586621679252396"><span class="annot"><span class="annottext">show :: Base16 (SerialisedHeader blk) -&gt; String
</span><a href="#local-6989586621679252396"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenDepPair Serialised (NestedCtxt Header blk) -&gt; String
</span><a href="#local-6989586621679252395"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk) -&gt; String)
-&gt; (Base16 (SerialisedHeader blk)
    -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; Base16 (SerialisedHeader blk)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall blk.
SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">serialisedHeaderToDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk
 -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; (Base16 (SerialisedHeader blk) -&gt; SerialisedHeader blk)
-&gt; Base16 (SerialisedHeader blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Base16 (SerialisedHeader blk) -&gt; SerialisedHeader blk
forall a. Base16 a -&gt; a
</span><a href="Test.Util.Serialisation.Roundtrip.html#unBase16"><span class="hs-identifier hs-var hs-var">unBase16</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-402"></span><span>      </span><span class="annot"><a href="#local-6989586621679252395"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenDepPair</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252402"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-403"></span><span>      </span><span id="local-6989586621679252395"><span class="annot"><span class="annottext">aux :: GenDepPair Serialised (NestedCtxt Header blk) -&gt; String
</span><a href="#local-6989586621679252395"><span class="hs-identifier hs-var hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenDepPair</span></a></span><span> </span><span id="local-6989586621679252394"><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252394"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span id="local-6989586621679252393"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252393"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252394"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">Char8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">Base16.encode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679252393"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span id="local-6989586621679252390"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679252387"><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasNestedContent</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252390"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#Base16"><span class="hs-identifier hs-type">Base16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252390"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621679252386"><span class="annot"><span class="annottext">== :: Base16 (SerialisedHeader blk)
-&gt; Base16 (SerialisedHeader blk) -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(==)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenDepPair Serialised (NestedCtxt Header blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk) -&gt; Bool
</span><a href="#local-6989586621679252385"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(GenDepPair Serialised (NestedCtxt Header blk)
 -&gt; GenDepPair Serialised (NestedCtxt Header blk) -&gt; Bool)
-&gt; (Base16 (SerialisedHeader blk)
    -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; Base16 (SerialisedHeader blk)
-&gt; Base16 (SerialisedHeader blk)
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall blk.
SerialisedHeader blk
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">serialisedHeaderToDepPair</span></a></span><span> </span><span class="annot"><span class="annottext">(SerialisedHeader blk
 -&gt; GenDepPair Serialised (NestedCtxt Header blk))
-&gt; (Base16 (SerialisedHeader blk) -&gt; SerialisedHeader blk)
-&gt; Base16 (SerialisedHeader blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Base16 (SerialisedHeader blk) -&gt; SerialisedHeader blk
forall a. Base16 a -&gt; a
</span><a href="Test.Util.Serialisation.Roundtrip.html#unBase16"><span class="hs-identifier hs-var hs-var">unBase16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>      </span><span class="annot"><a href="#local-6989586621679252385"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenDepPair</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252390"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenDepPair</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NestedCtxt</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252390"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-412"></span><span>      </span><span id="local-6989586621679252385"><span class="annot"><span class="annottext">aux :: GenDepPair Serialised (NestedCtxt Header blk)
-&gt; GenDepPair Serialised (NestedCtxt Header blk) -&gt; Bool
</span><a href="#local-6989586621679252385"><span class="hs-identifier hs-var hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenDepPair</span></a></span><span> </span><span id="local-6989586621679252384"><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252384"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621679252383"><span class="annot"><span class="annottext">Serialised a
</span><a href="#local-6989586621679252383"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenDepPair</span></a></span><span> </span><span id="local-6989586621679252382"><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252382"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span id="local-6989586621679252381"><span class="annot"><span class="annottext">Serialised a
</span><a href="#local-6989586621679252381"><span class="hs-identifier hs-var">bs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-413"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
-&gt; NestedCtxt Header blk a -&gt; Maybe (a :~: a)
forall (f :: * -&gt; *) a b.
SameDepIndex f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">sameDepIndex</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252384"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt Header blk a
</span><a href="#local-6989586621679252382"><span class="hs-identifier hs-var">ctxt'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a :~: a
</span><span class="hs-identifier hs-var">Refl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Serialised a
</span><a href="#local-6989586621679252383"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Serialised a -&gt; Serialised a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Serialised a
Serialised a
</span><a href="#local-6989586621679252381"><span class="hs-identifier hs-var">bs'</span></a></span><span>
</span><span id="line-415"></span><span>            </span><span class="annot"><span class="annottext">Maybe (a :~: a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  ConvertRawHash
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span id="local-6989586621679252727"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_ConvertRawHash"><span class="hs-identifier hs-type">roundtrip_ConvertRawHash</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">StandardHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ConvertRawHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span></span><span>
</span><span id="line-424"></span><span id="roundtrip_ConvertRawHash"><span class="annot"><span class="annottext">roundtrip_ConvertRawHash :: Proxy blk -&gt; HeaderHash blk -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#roundtrip_ConvertRawHash"><span class="hs-identifier hs-var hs-var">roundtrip_ConvertRawHash</span></a></span></span><span> </span><span id="local-6989586621679252378"><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679252378"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679252377"><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679252377"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679252377"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash blk -&gt; HeaderHash blk -&gt; Property
forall a. (Eq a, Show a) =&gt; a -&gt; a -&gt; Property
</span><span class="hs-operator hs-var">===</span></span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; ShortByteString -&gt; HeaderHash blk
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; ShortByteString -&gt; HeaderHash blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">fromShortRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679252378"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; ShortByteString
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; ShortByteString
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">toShortRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679252378"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679252377"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span id="local-6989586621679252722"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#prop_hashSize"><span class="hs-identifier hs-type">prop_hashSize</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ConvertRawHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252722"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679252722"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252722"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span></span><span>
</span><span id="line-430"></span><span id="prop_hashSize"><span class="annot"><span class="annottext">prop_hashSize :: Proxy blk -&gt; HeaderHash blk -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#prop_hashSize"><span class="hs-identifier hs-var hs-var">prop_hashSize</span></a></span></span><span> </span><span id="local-6989586621679252374"><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679252374"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679252373"><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679252373"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">Proxy blk -&gt; Word32
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; Word32
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">hashSize</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679252374"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Property
forall a. (Eq a, Show a) =&gt; a -&gt; a -&gt; Property
</span><span class="hs-operator hs-var">===</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><span class="hs-identifier hs-var">Short.length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; HeaderHash blk -&gt; ShortByteString
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; ShortByteString
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">toShortRawHash</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679252374"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679252373"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  estimateBlockSize
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span id="local-6989586621679252721"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#prop_estimateBlockSize"><span class="hs-identifier hs-type">prop_estimateBlockSize</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-438"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SerialiseNodeToNodeConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252721"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GetHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252721"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252721"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252721"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252721"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span></span><span>
</span><span id="line-442"></span><span id="prop_estimateBlockSize"><span class="annot"><span class="annottext">prop_estimateBlockSize :: CodecConfig blk
-&gt; WithVersion (BlockNodeToNodeVersion blk) blk -&gt; Property
</span><a href="Test.Util.Serialisation.Roundtrip.html#prop_estimateBlockSize"><span class="hs-identifier hs-var hs-var">prop_estimateBlockSize</span></a></span></span><span> </span><span id="local-6989586621679252370"><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252370"><span class="hs-identifier hs-var">ccfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#WithVersion"><span class="hs-identifier hs-type">WithVersion</span></a></span><span> </span><span id="local-6989586621679252369"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252369"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679252368"><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252368"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var">actualBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var">expectedBlockSize</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;actualBlockSize &gt; expectedBlockSize: &quot;</span></span><span>
</span><span id="line-446"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var">actualBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &gt; &quot;</span></span><span>
</span><span id="line-447"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var">expectedBlockSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var">actualBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var">expectedBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252362"><span class="hs-identifier hs-var">allowedUnderestimate</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;actualBlockSize &lt; expectedBlockSize - allowedUnderestimate: &quot;</span></span><span>
</span><span id="line-452"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var">actualBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &gt; &quot;</span></span><span>
</span><span id="line-453"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var">expectedBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; - &quot;</span></span><span>
</span><span id="line-454"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252362"><span class="hs-identifier hs-var">allowedUnderestimate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">classify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var">actualBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var">expectedBlockSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exact&quot;</span></span><span>
</span><span id="line-458"></span><span>  </span><span class="annot"><span class="annottext">(Property -&gt; Property) -&gt; Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">classify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var">actualBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span>  </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var">expectedBlockSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;underestimate&quot;</span></span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><span class="annottext">(Property -&gt; Property) -&gt; Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><a href="#local-6989586621679252362"><span class="hs-identifier hs-type">allowedUnderestimate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">SizeInBytes</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621679252362"><span class="annot"><span class="annottext">allowedUnderestimate :: Word32
</span><a href="#local-6989586621679252362"><span class="hs-identifier hs-var hs-var">allowedUnderestimate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">10</span></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><a href="#local-6989586621679252367"><span class="hs-identifier hs-type">actualBlockSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">SizeInBytes</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621679252367"><span class="annot"><span class="annottext">actualBlockSize :: Word32
</span><a href="#local-6989586621679252367"><span class="hs-identifier hs-var hs-var">actualBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>          </span><span class="annot"><span class="annottext">Int64 -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span>
</span><span id="line-467"></span><span>        </span><span class="annot"><span class="annottext">(Int64 -&gt; Word32) -&gt; (blk -&gt; Int64) -&gt; blk -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">Lazy.length</span></span><span>
</span><span id="line-468"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Int64) -&gt; (blk -&gt; ByteString) -&gt; blk -&gt; Int64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><span class="hs-identifier hs-var">toLazyByteString</span></span><span>
</span><span id="line-469"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; (blk -&gt; Encoding) -&gt; blk -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; blk -&gt; Encoding
forall blk a.
SerialiseNodeToNode blk a =&gt;
CodecConfig blk -&gt; BlockNodeToNodeVersion blk -&gt; a -&gt; Encoding
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">encodeNodeToNode</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679252370"><span class="hs-identifier hs-var">ccfg</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679252369"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">(blk -&gt; Word32) -&gt; blk -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252368"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><a href="#local-6989586621679252365"><span class="hs-identifier hs-type">expectedBlockSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">SizeInBytes</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span id="local-6989586621679252365"><span class="annot"><span class="annottext">expectedBlockSize :: Word32
</span><a href="#local-6989586621679252365"><span class="hs-identifier hs-var hs-var">expectedBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-474"></span><span>          </span><span class="annot"><span class="annottext">Header blk -&gt; Word32
forall blk.
SerialiseNodeToNodeConstraints blk =&gt;
Header blk -&gt; Word32
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">estimateBlockSize</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">(Header blk -&gt; Word32) -&gt; (blk -&gt; Header blk) -&gt; blk -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">blk -&gt; Header blk
forall blk. GetHeader blk =&gt; blk -&gt; Header blk
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">getHeader</span></a></span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">(blk -&gt; Word32) -&gt; blk -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">blk
</span><a href="#local-6989586621679252368"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Serialised helpers
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span id="local-6989586621679252664"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#encodeThroughSerialised"><span class="hs-identifier hs-type">encodeThroughSerialised</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252664"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252664"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252664"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Encoding</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-486"></span><span id="encodeThroughSerialised"><span class="annot"><span class="annottext">encodeThroughSerialised :: (a -&gt; Encoding) -&gt; (Serialised a -&gt; Encoding) -&gt; a -&gt; Encoding
</span><a href="Test.Util.Serialisation.Roundtrip.html#encodeThroughSerialised"><span class="hs-identifier hs-var hs-var">encodeThroughSerialised</span></a></span></span><span> </span><span id="local-6989586621679252356"><span class="annot"><span class="annottext">a -&gt; Encoding
</span><a href="#local-6989586621679252356"><span class="hs-identifier hs-var">enc</span></a></span></span><span> </span><span id="local-6989586621679252355"><span class="annot"><span class="annottext">Serialised a -&gt; Encoding
</span><a href="#local-6989586621679252355"><span class="hs-identifier hs-var">encSerialised</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Serialised a -&gt; Encoding
</span><a href="#local-6989586621679252355"><span class="hs-identifier hs-var">encSerialised</span></a></span><span> </span><span class="annot"><span class="annottext">(Serialised a -&gt; Encoding) -&gt; (a -&gt; Serialised a) -&gt; a -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Encoding) -&gt; a -&gt; Serialised a
forall a. (a -&gt; Encoding) -&gt; a -&gt; Serialised a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">mkSerialised</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Encoding
</span><a href="#local-6989586621679252356"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621679252659"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#decodeThroughSerialised"><span class="hs-identifier hs-type">decodeThroughSerialised</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252661"><span class="annot"><a href="#local-6989586621679252661"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252661"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252659"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252660"><span class="annot"><a href="#local-6989586621679252660"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252660"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Serialised</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252659"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252658"><span class="annot"><a href="#local-6989586621679252658"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252658"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252659"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-492"></span><span id="decodeThroughSerialised"><span class="annot"><span class="annottext">decodeThroughSerialised :: (forall s. Decoder s (ByteString -&gt; a))
-&gt; (forall s. Decoder s (Serialised a)) -&gt; forall s. Decoder s a
</span><a href="Test.Util.Serialisation.Roundtrip.html#decodeThroughSerialised"><span class="hs-identifier hs-var hs-var">decodeThroughSerialised</span></a></span></span><span> </span><span id="local-6989586621679252354"><span class="annot"><span class="annottext">forall s. Decoder s (ByteString -&gt; a)
</span><a href="#local-6989586621679252354"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span id="local-6989586621679252353"><span class="annot"><span class="annottext">forall s. Decoder s (Serialised a)
</span><a href="#local-6989586621679252353"><span class="hs-identifier hs-var">decSerialised</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621679252352"><span class="annot"><span class="annottext">Serialised a
</span><a href="#local-6989586621679252352"><span class="hs-identifier hs-var">serialised</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s (Serialised a)
forall s. Decoder s (Serialised a)
</span><a href="#local-6989586621679252353"><span class="hs-identifier hs-var">decSerialised</span></a></span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">(forall s. Decoder s (ByteString -&gt; a))
-&gt; Serialised a -&gt; forall s. Decoder s a
forall a.
(forall s. Decoder s (ByteString -&gt; a))
-&gt; Serialised a -&gt; forall s. Decoder s a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">fromSerialised</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s (ByteString -&gt; a)
</span><a href="#local-6989586621679252354"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Serialised a
</span><a href="#local-6989586621679252352"><span class="hs-identifier hs-var">serialised</span></a></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  SomeResult
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-comment">-- | To easily generate all the possible @result@s of the 'Query' GADT, we</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- introduce an existential that also bundles the corresponding 'Query' as</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- evidence. We also capture 'Eq', 'Show', and 'Typeable' constraints, as we</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- need them in the tests.</span><span>
</span><span id="line-504"></span><span class="hs-keyword">data</span><span> </span><span id="SomeResult"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-var">SomeResult</span></a></span></span><span> </span><span id="local-6989586621679252351"><span class="annot"><a href="#local-6989586621679252351"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-505"></span><span>  </span><span id="local-6989586621679252349"><span id="local-6989586621679252350"><span id="SomeResult"><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-var">SomeResult</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679252350"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679252350"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679252350"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252349"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252350"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252350"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252349"><span class="hs-identifier hs-type">blk</span></a></span></span></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span id="local-6989586621679252348"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679252343"><span id="local-6989586621679252346"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252348"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>  </span><span id="local-6989586621679252342"><span class="annot"><span class="annottext">show :: SomeResult blk -&gt; String
</span><a href="#local-6989586621679252342"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Query blk result
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679252341"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252341"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">result -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252341"><span class="hs-identifier hs-var">result</span></a></span></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span id="local-6989586621679252340"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679252337"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252340"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-512"></span><span>  </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Query blk result
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252336"><span id="local-6989586621679252335"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252335"><span class="hs-identifier hs-var">res1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252336"><span class="hs-identifier hs-type">result1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679252334"><span class="annot"><span class="annottext">== :: SomeResult blk -&gt; SomeResult blk -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Test.Util.Serialisation.Roundtrip.html#SomeResult"><span class="hs-identifier hs-type">SomeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Query blk result
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252333"><span id="local-6989586621679252332"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252332"><span class="hs-identifier hs-var">res2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252333"><span class="hs-identifier hs-type">result2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Typeable result, Typeable result) =&gt; Maybe (result :~: result)
forall k (a :: k) (b :: k).
(Typeable a, Typeable b) =&gt;
Maybe (a :~: b)
</span><span class="hs-identifier hs-var">eqT</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252336"><span class="hs-identifier hs-type">result1</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679252333"><span class="hs-identifier hs-type">result2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-514"></span><span>      </span><span class="annot"><span class="annottext">Maybe (result :~: result)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-515"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">result :~: result
</span><span class="hs-identifier hs-var">Refl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679252335"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">result -&gt; result -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">result
result
</span><a href="#local-6989586621679252332"><span class="hs-identifier hs-var">res2</span></a></span></span><span>
</span><span id="line-516"></span></pre></body></html>