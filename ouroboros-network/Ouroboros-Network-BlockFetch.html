<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ouroboros.Network.BlockFetch</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link href="xhaddock.css" rel="alternate stylesheet" type="text/css" title="Classic" /><link href="ocean.css" rel="alternate stylesheet" type="text/css" title="Ocean" /><link href="xhaddock.css" rel="alternate stylesheet" type="text/css" title="Classic" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Network.BlockFetch.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ouroboros-network-0.1.0.0: A networking layer for the Ouroboros blockchain protocol</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Network.BlockFetch</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Tracer types</a></li><li><a href="#g:2">The <code>FetchClientRegistry</code></a></li><li><a href="#g:3">Re-export types used by <code>BlockFetchConsensusInterface</code></a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Let's start with the big picture...</p><pre>Key:  &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;  &#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;  &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;   &#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;
      &#9475; STM-based  &#9475;  &#9553;active thread&#9553;  &#9475;state instance&#9475;&#9491;  &#9553; one thread &#9553;&#9559;
      &#9475;shared state&#9475;  &#9553;             &#9553;  &#9475;   per peer   &#9475;&#9475;  &#9553;  per peer  &#9553;&#9553;
      &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;  &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;  &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;&#9475;  &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9553;
                                        &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;   &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;
</pre><pre>  &#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;     &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;
  &#9553; Chain sync  &#9553;&#9559;    &#9475;   Ledger    &#9475;
  &#9553;  protocol   &#9553;&#9553;&#9664;&#9472;&#9472;&#9472;&#9512;   state     &#9475;&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9582;
  &#9553;(client side)&#9553;&#9553;    &#9475;             &#9475;            &#9474;
  &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9553;    &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;            &#9474;
   &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;                               &#9474;
         &#9660;                                       &#9474;
  &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;     &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;     &#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;
  &#9475;  Candidate  &#9475;     &#9475;   Set of    &#9475;     &#9553;  Chain and  &#9553;
  &#9475;  chains     &#9475;     &#9475;  downloaded &#9504;&#9472;&#9472;&#9472;&#9472;&#9654;&#9553;   ledger    &#9553;
  &#9475;  (headers)  &#9475;     &#9475;   blocks    &#9475;     &#9553;  validation &#9553;
  &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9519;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;     &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9519;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;     &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;
        &#9474;                   &#9474; &#9650;                  &#9474;
        &#9474; &#9581;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9583; &#9474;                  &#9474;
&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9660;&#9617;&#9660;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;           &#9474;                  &#9660;
&#9617;&#9617;&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;&#9617;&#9617;           &#9474;           &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;     &#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;
&#9617;&#9617;&#9553;    Block    &#9553;&#9617;&#9617;           &#9474;           &#9475;   Current   &#9475;     &#9553; Block fetch &#9553;&#9559;
&#9617;&#9617;&#9570;    fetch    &#9553;&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9532;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9512;    chain    &#9504;&#9472;&#9472;&#9472;&#9472;&#9654;&#9553; protocol    &#9553;&#9553;
&#9617;&#9617;&#9553;    logic    &#9553;&#9617;&#9617;           &#9474;           &#9475;  (blocks)   &#9475;     &#9553;(server side)&#9553;&#9553;
&#9617;&#9617;&#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9617;&#9617;           &#9474;           &#9504;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9512;     &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9553;
&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9650;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;           &#9474;           &#9475;  Tentative  &#9475;      &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;
&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9660;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9474;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;   &#9475;    chain    &#9504;&#9472;&#9472;&#9582;
&#9617;&#9617;&#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;&#9617;&#9617;&#9617;&#9617;&#9617;&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;&#9617;&#9617;   &#9475;  (headers)  &#9475;  &#9474;  &#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;
&#9617;&#9617;&#9475; Block fetch &#9475;&#9491;&#9617;&#9617;&#9617;&#9617;&#9553; block fetch &#9553;&#9559;&#9617;   &#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;  &#9474;  &#9553; Chain sync  &#9553;&#9559;
&#9617;&#9617;&#9475;  state and  &#9475;&#9475;&#9664;&#9472;&#9472;&#9654;&#9553;  protocol   &#9553;&#9553;&#9617;                    &#9584;&#9472;&#9654;&#9553; protocol    &#9553;&#9553;
&#9617;&#9617;&#9475;  requests   &#9475;&#9475;&#9617;&#9617;&#9617;&#9617;&#9553;(client side)&#9553;&#9553;&#9617;                       &#9553;(server side)&#9553;&#9553;
&#9617;&#9617;&#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;&#9475;&#9617;&#9617;&#9617;&#9617;&#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9553;&#9617;                       &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9553;
&#9617;&#9617;&#9617;&#9495;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;&#9617;&#9617;&#9617;&#9617;&#9617;&#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;&#9617;                        &#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;
&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;
</pre><p>Notes:</p><ul><li>Thread communication is via STM based state.</li><li>Outbound: threads update STM state.</li><li>Inbound: threads wait on STM state changing (using retry).</li><li>These are no queues: there is only the current state, not all change events.</li></ul><p>We consider the block fetch logic and the policy for the block fetch protocol
client together as one unit of functionality. This is the shaded area in the
diagram.</p><p>Looking at the diagram we see that these two threads interact with each other
and other threads via the following shared state</p><table><thead><tr><th>  State                      </th><th>  Interactions  </th><th> Internal/External </th></tr></thead><tbody><tr><td>  Candidate chains (headers) </td><td>  Read          </td><td>  External          </td></tr><tr><td>  Current chain (blocks)     </td><td>  Read          </td><td>  External          </td></tr><tr><td>  Set of downloaded blocks   </td><td>  Read &amp; Write  </td><td>  External          </td></tr><tr><td>  Block fetch requests       </td><td>  Read &amp; Write  </td><td>  Internal          </td></tr></tbody></table><p>The block fetch requests state is private between the block fetch logic
and the block fetch protocol client, so it is implemented here.</p><p>The other state is managed by the consensus layer and is considered external
here. So here we define interfaces for interacting with the external state.
These have to be provided when instantiating the block fetch logic.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:blockFetchLogic">blockFetchLogic</a> &#8759; &#8704; peer header block m. (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer, <a href="Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> header, <a href="Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> block, <a href="Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> header ~ <a href="Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> block) &#8658; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a> m [<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peer (<a href="Ouroboros-Network-BlockFetch.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch">FetchDecision</a> [<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> header])] &#8594; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a> m (<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peer (<a href="Ouroboros-Network-BlockFetch.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch">TraceFetchClientState</a> header)) &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:BlockFetchConsensusInterface" title="Ouroboros.Network.BlockFetch">BlockFetchConsensusInterface</a> peer header block m &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:BlockFetchConfiguration" title="Ouroboros.Network.BlockFetch">BlockFetchConfiguration</a> &#8594; m <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Void.html#t:Void" title="Data.Void">Void</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:BlockFetchConfiguration">BlockFetchConfiguration</a> = <a href="#v:BlockFetchConfiguration">BlockFetchConfiguration</a> {<ul class="subs"><li><a href="#v:bfcMaxConcurrencyBulkSync">bfcMaxConcurrencyBulkSync</a> &#8759; !<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li><li><a href="#v:bfcMaxConcurrencyDeadline">bfcMaxConcurrencyDeadline</a> &#8759; !<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li><li><a href="#v:bfcMaxRequestsInflight">bfcMaxRequestsInflight</a> &#8759; !<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:BlockFetchConsensusInterface">BlockFetchConsensusInterface</a> peer header block m = <a href="#v:BlockFetchConsensusInterface">BlockFetchConsensusInterface</a> {<ul class="subs"><li><a href="#v:readCandidateChains">readCandidateChains</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-Base.html#t:Map" title="Cardano.Prelude.Base">Map</a> peer (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header))</li><li><a href="#v:readCurrentChain">readCurrentChain</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header)</li><li><a href="#v:readFetchMode">readFetchMode</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a></li><li><a href="#v:readFetchedBlocks">readFetchedBlocks</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>)</li><li><a href="#v:addFetchedBlock">addFetchedBlock</a> &#8759; <a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block &#8594; block &#8594; m ()</li><li><a href="#v:readFetchedMaxSlotNo">readFetchedMaxSlotNo</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m <a href="Ouroboros-Network-Block.html#t:MaxSlotNo" title="Ouroboros.Network.Block">MaxSlotNo</a></li><li><a href="#v:plausibleCandidateChain">plausibleCandidateChain</a> &#8759; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li><a href="#v:compareCandidateChains">compareCandidateChains</a> &#8759; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></li><li><a href="#v:blockFetchSize">blockFetchSize</a> &#8759; header &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:SizeInBytes" title="Ouroboros.Network.BlockFetch">SizeInBytes</a></li><li><a href="#v:blockMatchesHeader">blockMatchesHeader</a> &#8759; header &#8594; block &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:FetchDecision">FetchDecision</a> result = <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> result</li><li class="src short"><span class="keyword">data</span> <a href="#t:TraceFetchClientState">TraceFetchClientState</a> header<ul class="subs"><li>= <a href="#v:AddedFetchRequest">AddedFetchRequest</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</li><li>| <a href="#v:AcknowledgedFetchRequest">AcknowledgedFetchRequest</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header)</li><li>| <a href="#v:StartedFetchBatch">StartedFetchBatch</a> (<a href="Ouroboros-Network-Protocol-BlockFetch-Type.html#t:ChainRange" title="Ouroboros.Network.Protocol.BlockFetch.Type">ChainRange</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</li><li>| <a href="#v:CompletedBlockFetch">CompletedBlockFetch</a> (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</li><li>| <a href="#v:CompletedFetchBatch">CompletedFetchBatch</a> (<a href="Ouroboros-Network-Protocol-BlockFetch-Type.html#t:ChainRange" title="Ouroboros.Network.Protocol.BlockFetch.Type">ChainRange</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</li><li>| <a href="#v:RejectedFetchBatch">RejectedFetchBatch</a> (<a href="Ouroboros-Network-Protocol-BlockFetch-Type.html#t:ChainRange" title="Ouroboros.Network.Protocol.BlockFetch.Type">ChainRange</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:TraceLabelPeer">TraceLabelPeer</a> peerid a = <a href="#v:TraceLabelPeer">TraceLabelPeer</a> peerid a</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchClientRegistry">FetchClientRegistry</a> peer header block m</li><li class="src short"><a href="#v:newFetchClientRegistry">newFetchClientRegistry</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m &#8658; m (<a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m)</li><li class="src short"><a href="#v:bracketFetchClient">bracketFetchClient</a> &#8759; &#8704; m a peer header block. (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadThrow.html#t:MonadThrow" title="Control.Monad.Class.MonadThrow">MonadThrow</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadFork.html#t:MonadFork" title="Control.Monad.Class.MonadFork">MonadFork</a> m, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) &#8658; <a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m &#8594; peer &#8594; (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.ClientState">FetchClientContext</a> header block m &#8594; m a) &#8594; m a</li><li class="src short"><a href="#v:bracketSyncWithFetchClient">bracketSyncWithFetchClient</a> &#8759; &#8704; m a peer header block. (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadThrow.html#t:MonadThrow" title="Control.Monad.Class.MonadThrow">MonadThrow</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadFork.html#t:MonadFork" title="Control.Monad.Class.MonadFork">MonadFork</a> m, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) &#8658; <a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m &#8594; peer &#8594; m a &#8594; m a</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchMode">FetchMode</a><ul class="subs"><li>= <a href="#v:FetchModeBulkSync">FetchModeBulkSync</a></li><li>| <a href="#v:FetchModeDeadline">FetchModeDeadline</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:SizeInBytes">SizeInBytes</a> = <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:blockFetchLogic" class="def">blockFetchLogic</a> &#8759; &#8704; peer header block m. (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer, <a href="Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> header, <a href="Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> block, <a href="Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> header ~ <a href="Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> block) &#8658; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a> m [<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peer (<a href="Ouroboros-Network-BlockFetch.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch">FetchDecision</a> [<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> header])] &#8594; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a> m (<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peer (<a href="Ouroboros-Network-BlockFetch.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch">TraceFetchClientState</a> header)) &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:BlockFetchConsensusInterface" title="Ouroboros.Network.BlockFetch">BlockFetchConsensusInterface</a> peer header block m &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:BlockFetchConfiguration" title="Ouroboros.Network.BlockFetch">BlockFetchConfiguration</a> &#8594; m <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Void.html#t:Void" title="Data.Void">Void</a> <a href="src/Ouroboros.Network.BlockFetch.html#blockFetchLogic" class="link">Source</a> <a href="#v:blockFetchLogic" class="selflink">#</a></p><div class="doc"><p>Execute the block fetch logic. It monitors the current chain and candidate
 chains. It decided which block bodies to fetch and manages the process of
 fetching them, including making alternative decisions based on timeouts and
 failures.</p><p>This runs forever and should be shut down using mechanisms such as async.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BlockFetchConfiguration" class="def">BlockFetchConfiguration</a> <a href="src/Ouroboros.Network.BlockFetch.html#BlockFetchConfiguration" class="link">Source</a> <a href="#t:BlockFetchConfiguration" class="selflink">#</a></p><div class="doc"><p>Configuration for FetchDecisionPolicy.
 Should be determined by external local node config.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BlockFetchConfiguration" class="def">BlockFetchConfiguration</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:bfcMaxConcurrencyBulkSync" class="def">bfcMaxConcurrencyBulkSync</a> &#8759; !<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word" title="Data.Word">Word</a></dfn><div class="doc"><p>Maximum concurrent downloads during bulk syncing.</p></div></li><li><dfn class="src"><a id="v:bfcMaxConcurrencyDeadline" class="def">bfcMaxConcurrencyDeadline</a> &#8759; !<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word" title="Data.Word">Word</a></dfn><div class="doc"><p>Maximum concurrent downloads during deadline syncing.</p></div></li><li><dfn class="src"><a id="v:bfcMaxRequestsInflight" class="def">bfcMaxRequestsInflight</a> &#8759; !<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word" title="Data.Word">Word</a></dfn><div class="doc"><p>Maximum requests in flight per each peer.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BlockFetchConsensusInterface" class="def">BlockFetchConsensusInterface</a> peer header block m <a href="src/Ouroboros.Network.BlockFetch.html#BlockFetchConsensusInterface" class="link">Source</a> <a href="#t:BlockFetchConsensusInterface" class="selflink">#</a></p><div class="doc"><p>The consensus layer functionality that the block fetch logic requires.</p><p>These are provided as input to the block fetch by the consensus layer.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BlockFetchConsensusInterface" class="def">BlockFetchConsensusInterface</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:readCandidateChains" class="def">readCandidateChains</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-Base.html#t:Map" title="Cardano.Prelude.Base">Map</a> peer (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header))</dfn><div class="doc"><p>Read the K-suffixes of the candidate chains.</p><p>Assumptions:
 * They must be already validated.
 * They may contain <em>fewer</em> than <code>K</code> blocks.
 * Their anchor does not have to intersect with the current chain.</p></div></li><li><dfn class="src"><a id="v:readCurrentChain" class="def">readCurrentChain</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header)</dfn><div class="doc"><p>Read the K-suffix of the current chain.</p><p>This must contain info on the last <code>K</code> blocks (unless we're near
 the chain genesis of course).</p></div></li><li><dfn class="src"><a id="v:readFetchMode" class="def">readFetchMode</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a></dfn><div class="doc"><p>Read the current fetch mode that the block fetch logic should use.</p><p>The fetch mode is a dynamic part of the block fetch policy. In
 <code><a href="Ouroboros-Network-BlockFetch.html#v:FetchModeBulkSync" title="Ouroboros.Network.BlockFetch">FetchModeBulkSync</a></code> it follows a policy that optimises for expected
 bandwidth over latency to fetch any particular block, whereas in
 <code><a href="Ouroboros-Network-BlockFetch.html#v:FetchModeDeadline" title="Ouroboros.Network.BlockFetch">FetchModeDeadline</a></code> it follows a policy optimises for the latency
 to fetch blocks, at the expense of wasting bandwidth.</p><p>This mode should be set so that when the node's current chain is near
 to &quot;now&quot; it uses the deadline mode, and when it is far away it uses
 the bulk sync mode.</p></div></li><li><dfn class="src"><a id="v:readFetchedBlocks" class="def">readFetchedBlocks</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>)</dfn><div class="doc"><p>Recent, only within last K</p></div></li><li><dfn class="src"><a id="v:addFetchedBlock" class="def">addFetchedBlock</a> &#8759; <a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block &#8594; block &#8594; m ()</dfn><div class="doc"><p>This and <code><a href="Ouroboros-Network-BlockFetch.html#v:readFetchedBlocks" title="Ouroboros.Network.BlockFetch">readFetchedBlocks</a></code> are required to be linked. Upon
 successful completion of <code><a href="Ouroboros-Network-BlockFetch.html#t:BlockFetchConsensusInterface" title="Ouroboros.Network.BlockFetch">BlockFetchConsensusInterface</a></code> it must be the case that
 <code><a href="Ouroboros-Network-BlockFetch.html#v:readFetchedBlocks" title="Ouroboros.Network.BlockFetch">readFetchedBlocks</a></code> reports the block.</p></div></li><li><dfn class="src"><a id="v:readFetchedMaxSlotNo" class="def">readFetchedMaxSlotNo</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:STM" title="Control.Monad.Class.MonadSTM">STM</a> m <a href="Ouroboros-Network-Block.html#t:MaxSlotNo" title="Ouroboros.Network.Block">MaxSlotNo</a></dfn><div class="doc"><p>The highest stored/downloaded slot number.</p><p>This is used to optimise the filtering of fragments in the block
 fetch logic: when removing already downloaded blocks from a
 fragment, the filtering (with a linear cost) is stopped as soon as a
 block has a slot number higher than this slot number, as it cannot
 have been downloaded anyway.</p></div></li><li><dfn class="src"><a id="v:plausibleCandidateChain" class="def">plausibleCandidateChain</a> &#8759; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc"><p>Given the current chain, is the given chain plausible as a
 candidate chain. Classically for Ouroboros this would simply
 check if the candidate is strictly longer, but for Ouroboros
 with operational key certificates there are also cases where
 we would consider a chain of equal length to the current chain.</p></div></li><li><dfn class="src"><a id="v:compareCandidateChains" class="def">compareCandidateChains</a> &#8759; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></dfn><div class="doc"><p>Compare two candidate chains and return a preference ordering.
 This is used as part of selecting which chains to prioritise for
 downloading block bodies.</p></div></li><li><dfn class="src"><a id="v:blockFetchSize" class="def">blockFetchSize</a> &#8759; header &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:SizeInBytes" title="Ouroboros.Network.BlockFetch">SizeInBytes</a></dfn><div class="doc"><p>Much of the logic for deciding which blocks to download from which
 peer depends on making estimates based on recent performance metrics.
 These estimates of course depend on the amount of data we will be
 downloading.</p></div></li><li><dfn class="src"><a id="v:blockMatchesHeader" class="def">blockMatchesHeader</a> &#8759; header &#8594; block &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc"><p>Given a block header, validate the supposed corresponding block
 body.</p></div></li></ul></div></td></tr></table></div></div><a href="#g:1" id="g:1"><h2>Tracer types</h2></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FetchDecision" class="def">FetchDecision</a> result = <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> result <a href="src/Ouroboros.Network.BlockFetch.Decision.html#FetchDecision" class="link">Source</a> <a href="#t:FetchDecision" class="selflink">#</a></p><div class="doc"><p>Throughout the decision making process we accumulate reasons to decline
 to fetch any blocks. This type is used to wrap intermediate and final
 results.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:TraceFetchClientState" class="def">TraceFetchClientState</a> header <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#TraceFetchClientState" class="link">Source</a> <a href="#t:TraceFetchClientState" class="selflink">#</a></p><div class="doc"><p>Tracing types for the various events that change the state
 (i.e. <code><a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchClientStateVars" title="Ouroboros.Network.BlockFetch.ClientState">FetchClientStateVars</a></code>) for a block fetch client.</p><p>Note that while these are all state changes, the <code><a href="Ouroboros-Network-BlockFetch.html#v:AddedFetchRequest" title="Ouroboros.Network.BlockFetch">AddedFetchRequest</a></code> occurs
 in the decision thread while the other state changes occur in the block
 fetch client threads.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AddedFetchRequest" class="def">AddedFetchRequest</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</td><td class="doc"><p>The block fetch decision thread has added a new fetch instruction
 consisting of one or more individual request ranges.</p></td></tr><tr><td class="src"><a id="v:AcknowledgedFetchRequest" class="def">AcknowledgedFetchRequest</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header)</td><td class="doc"><p>Mark the point when the fetch client picks up the request added
 by the block fetch decision thread. Note that this event can happen
 fewer times than the <code><a href="Ouroboros-Network-BlockFetch.html#v:AddedFetchRequest" title="Ouroboros.Network.BlockFetch">AddedFetchRequest</a></code> due to fetch request merging.</p></td></tr><tr><td class="src"><a id="v:StartedFetchBatch" class="def">StartedFetchBatch</a> (<a href="Ouroboros-Network-Protocol-BlockFetch-Type.html#t:ChainRange" title="Ouroboros.Network.Protocol.BlockFetch.Type">ChainRange</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</td><td class="doc"><p>Mark the start of receiving a streaming batch of blocks. This will
 be followed by one or more <code><a href="Ouroboros-Network-BlockFetch.html#v:CompletedBlockFetch" title="Ouroboros.Network.BlockFetch">CompletedBlockFetch</a></code> and a final
 <code><a href="Ouroboros-Network-BlockFetch.html#v:CompletedFetchBatch" title="Ouroboros.Network.BlockFetch">CompletedFetchBatch</a></code>.</p></td></tr><tr><td class="src"><a id="v:CompletedBlockFetch" class="def">CompletedBlockFetch</a> (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</td><td class="doc"><p>Mark the completion of of receiving a single block within a
 streaming batch of blocks.</p></td></tr><tr><td class="src"><a id="v:CompletedFetchBatch" class="def">CompletedFetchBatch</a> (<a href="Ouroboros-Network-Protocol-BlockFetch-Type.html#t:ChainRange" title="Ouroboros.Network.Protocol.BlockFetch.Type">ChainRange</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</td><td class="doc"><p>Mark the successful end of receiving a streaming batch of blocks</p></td></tr><tr><td class="src"><a id="v:RejectedFetchBatch" class="def">RejectedFetchBatch</a> (<a href="Ouroboros-Network-Protocol-BlockFetch-Type.html#t:ChainRange" title="Ouroboros.Network.Protocol.BlockFetch.Type">ChainRange</a> header) (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header) <a href="Ouroboros-Network-BlockFetch-DeltaQ.html#t:PeerFetchInFlightLimits" title="Ouroboros.Network.BlockFetch.DeltaQ">PeerFetchInFlightLimits</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header)</td><td class="doc"><p>If the other peer rejects our request then we have this event
 instead of <code><a href="Ouroboros-Network-BlockFetch.html#v:StartedFetchBatch" title="Ouroboros.Network.BlockFetch">StartedFetchBatch</a></code> and <code><a href="Ouroboros-Network-BlockFetch.html#v:CompletedFetchBatch" title="Ouroboros.Network.BlockFetch">CompletedFetchBatch</a></code>.</p></td></tr></table></div><div class="subs instances"><details id="i:TraceFetchClientState" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:TraceFetchClientState:Show:1"></span> (<a href="Ouroboros-Network-Block.html#t:StandardHash" title="Ouroboros.Network.Block">StandardHash</a> header, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> header) &#8658; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Network-BlockFetch.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch">TraceFetchClientState</a> header)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-401" class="link">Source</a> <a href="#t:TraceFetchClientState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:TraceFetchClientState:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch">TraceFetchClientState</a> header &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch">TraceFetchClientState</a> header &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-BlockFetch.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch">TraceFetchClientState</a> header] &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:TraceLabelPeer" class="def">TraceLabelPeer</a> peerid a <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#TraceLabelPeer" class="link">Source</a> <a href="#t:TraceLabelPeer" class="selflink">#</a></p><div class="doc"><p>A peer label for use in <code><a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a></code>s. This annotates tracer output as being
 associated with a given peer identifier.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:TraceLabelPeer" class="def">TraceLabelPeer</a> peerid a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:TraceLabelPeer" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:TraceLabelPeer:Functor:1"></span> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> (<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-407" class="link">Source</a> <a href="#t:TraceLabelPeer" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:TraceLabelPeer:Functor:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> &#8759; (a &#8594; b) &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid b <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:fmap" class="selflink">#</a></p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> &#8759; a &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid b &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:-60--36-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:TraceLabelPeer:Eq:2"></span> (<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> peerid, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> a) &#8658; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-407" class="link">Source</a> <a href="#t:TraceLabelPeer" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:TraceLabelPeer:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/ghc-prim-0.5.3/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/ghc-prim-0.5.3/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:TraceLabelPeer:Show:3"></span> (<a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> peerid, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a) &#8658; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-407" class="link">Source</a> <a href="#t:TraceLabelPeer" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:TraceLabelPeer:Show:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-BlockFetch.html#t:TraceLabelPeer" title="Ouroboros.Network.BlockFetch">TraceLabelPeer</a> peerid a] &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:2" id="g:2"><h1>The <code><a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a></code></h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchClientRegistry" class="def">FetchClientRegistry</a> peer header block m <a href="src/Ouroboros.Network.BlockFetch.ClientRegistry.html#FetchClientRegistry" class="link">Source</a> <a href="#t:FetchClientRegistry" class="selflink">#</a></p><div class="doc"><p>A registry for the threads that are executing the client side of the
 <code>BlockFetch</code> protocol to communicate with our peers.</p><p>The registry contains the shared variables we use to communicate with these
 threads, both to track their status and to provide instructions.</p><p>The threads add/remove themselves to/from this registry when they start up
 and shut down.</p></div></div><div class="top"><p class="src"><a id="v:newFetchClientRegistry" class="def">newFetchClientRegistry</a> &#8759; <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m &#8658; m (<a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m) <a href="src/Ouroboros.Network.BlockFetch.ClientRegistry.html#newFetchClientRegistry" class="link">Source</a> <a href="#v:newFetchClientRegistry" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:bracketFetchClient" class="def">bracketFetchClient</a> &#8759; &#8704; m a peer header block. (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadThrow.html#t:MonadThrow" title="Control.Monad.Class.MonadThrow">MonadThrow</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadFork.html#t:MonadFork" title="Control.Monad.Class.MonadFork">MonadFork</a> m, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) &#8658; <a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m &#8594; peer &#8594; (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.ClientState">FetchClientContext</a> header block m &#8594; m a) &#8594; m a <a href="src/Ouroboros.Network.BlockFetch.ClientRegistry.html#bracketFetchClient" class="link">Source</a> <a href="#v:bracketFetchClient" class="selflink">#</a></p><div class="doc"><p>This is needed to start a block fetch client. It provides the required
 <code><a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.ClientState">FetchClientContext</a></code>. It registers and unregisters the fetch client on
 start and end.</p><p>It also manages synchronisation with the corresponding chain sync client.</p></div></div><div class="top"><p class="src"><a id="v:bracketSyncWithFetchClient" class="def">bracketSyncWithFetchClient</a> &#8759; &#8704; m a peer header block. (<a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadThrow.html#t:MonadThrow" title="Control.Monad.Class.MonadThrow">MonadThrow</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadSTM.html#t:MonadSTM" title="Control.Monad.Class.MonadSTM">MonadSTM</a> m, <a href="file:///home/coot/clients/iohk/cardano-haskell/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/Control-Monad-Class-MonadFork.html#t:MonadFork" title="Control.Monad.Class.MonadFork">MonadFork</a> m, <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) &#8658; <a href="Ouroboros-Network-BlockFetch.html#t:FetchClientRegistry" title="Ouroboros.Network.BlockFetch">FetchClientRegistry</a> peer header block m &#8594; peer &#8594; m a &#8594; m a <a href="src/Ouroboros.Network.BlockFetch.ClientRegistry.html#bracketSyncWithFetchClient" class="link">Source</a> <a href="#v:bracketSyncWithFetchClient" class="selflink">#</a></p><div class="doc"><p>The block fetch and chain sync clients for each peer need to synchronise
 their startup and shutdown. This bracket operation provides that
 synchronisation for the chain sync client.</p><p>This must be used for the chain sync client <em>outside</em> of its own state
 registration and deregistration.</p></div></div><a href="#g:3" id="g:3"><h1>Re-export types used by <code><a href="Ouroboros-Network-BlockFetch.html#t:BlockFetchConsensusInterface" title="Ouroboros.Network.BlockFetch">BlockFetchConsensusInterface</a></code></h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchMode" class="def">FetchMode</a> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#FetchMode" class="link">Source</a> <a href="#t:FetchMode" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FetchModeBulkSync" class="def">FetchModeBulkSync</a></td><td class="doc"><p>Use this mode when we are catching up on the chain but are stil
 well behind. In this mode the fetch logic will optimise for
 throughput rather than latency.</p></td></tr><tr><td class="src"><a id="v:FetchModeDeadline" class="def">FetchModeDeadline</a></td><td class="doc"><p>Use this mode for block-producing nodes that have a known deadline
 to produce a block and need to get the best chain before that. In
 this mode the fetch logic will optimise for picking the best chain
 within the given deadline.</p></td></tr></table></div><div class="subs instances"><details id="i:FetchMode" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchMode:Eq:1"></span> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a></span> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#line-92" class="link">Source</a> <a href="#t:FetchMode" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchMode:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Decision.html">Ouroboros.Network.BlockFetch.Decision</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a> &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a> &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/ghc-prim-0.5.3/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a> &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a> &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/ghc-prim-0.5.3/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchMode:Show:2"></span> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a></span> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#line-92" class="link">Source</a> <a href="#t:FetchMode" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchMode:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Decision.html">Ouroboros.Network.BlockFetch.Decision</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a> &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a> &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-BlockFetch.html#t:FetchMode" title="Ouroboros.Network.BlockFetch">FetchMode</a>] &#8594; <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:SizeInBytes" class="def">SizeInBytes</a> = <a href="file:///home/coot/.ghcup/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> <a href="src/Ouroboros.Network.DeltaQ.html#SizeInBytes" class="link">Source</a> <a href="#t:SizeInBytes" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>