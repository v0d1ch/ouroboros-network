<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Mux.DeltaQ.TraceStats</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#step"><span class="hs-identifier">step</span></a></span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#OneWayDeltaQSample"><span class="hs-identifier">OneWayDeltaQSample</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#constructSample"><span class="hs-identifier">constructSample</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier">StatsA</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#initialStatsA"><span class="hs-identifier">initialStatsA</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier">Data.IntMap.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier">IntMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier">Data.IntMap.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IM</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier">Word32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStatsSupport.html"><span class="hs-identifier">Network.Mux.DeltaQ.TraceStatsSupport</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html"><span class="hs-identifier">Network.Mux.DeltaQ.TraceTypes</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Network.Mux.Types.html"><span class="hs-identifier">Network.Mux.Types</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-comment">-- the per observation procesing step</span><span>
</span><span id="line-20"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#step"><span class="hs-identifier hs-type">step</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Mux.Types.html#RemoteClockModel"><span class="hs-identifier hs-type">RemoteClockModel</span></a></span><span>        </span><span class="hs-comment">-- ^ Remote clock timestamp</span><span>
</span><span id="line-21"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span>                    </span><span class="hs-comment">-- ^ Local clock timestamp</span><span>
</span><span id="line-22"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>                     </span><span class="hs-comment">-- ^ the number of octets in the</span><span>
</span><span id="line-23"></span><span>                                </span><span class="hs-comment">--   observed outcome</span><span>
</span><span id="line-24"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span>                  </span><span class="hs-comment">-- ^ accumulation state</span><span>
</span><span id="line-25"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#OneWayDeltaQSample"><span class="hs-identifier hs-type">OneWayDeltaQSample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span id="step"><span class="annot"><span class="annottext">step :: RemoteClockModel
-&gt; Time -&gt; Int -&gt; StatsA -&gt; (Maybe OneWayDeltaQSample, StatsA)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#step"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679103068"><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103068"><span class="hs-identifier hs-var">remoteTS</span></a></span></span><span> </span><span id="local-6989586621679103067"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span></span><span> </span><span id="local-6989586621679103066"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103066"><span class="hs-identifier hs-var">obsSize</span></a></span></span><span> </span><span id="local-6989586621679103065"><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-27"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (Word32, Time) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; Maybe (Word32, Time)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#referenceTimePoint"><span class="hs-identifier hs-var hs-var">referenceTimePoint</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- first observation this sample period</span><span>
</span><span id="line-28"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
-&gt; Time -&gt; Int -&gt; StatsA -&gt; (Maybe OneWayDeltaQSample, StatsA)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#step"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103068"><span class="hs-identifier hs-var">remoteTS</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103066"><span class="hs-identifier hs-var">obsSize</span></a></span><span>
</span><span id="line-29"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">referenceTimePoint :: Maybe (Word32, Time)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#referenceTimePoint"><span class="hs-identifier hs-var">referenceTimePoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word32, Time) -&gt; Maybe (Word32, Time)
forall a. a -&gt; Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Word32, Time) -&gt; Maybe (Word32, Time))
-&gt; (Word32, Time) -&gt; Maybe (Word32, Time)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteClockModel -&gt; Word32
</span><a href="Network.Mux.Types.html#unRemoteClockModel"><span class="hs-identifier hs-var hs-var">unRemoteClockModel</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103068"><span class="hs-identifier hs-var">remoteTS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nextSampleAt :: Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#nextSampleAt"><span class="hs-identifier hs-var">nextSampleAt</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sampleInterval"><span class="hs-identifier hs-var">sampleInterval</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Time -&gt; Time
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-operator hs-var">`addTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span>
</span><span id="line-31"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">timeLastObs :: Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#timeLastObs"><span class="hs-identifier hs-var">timeLastObs</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span> </span><span class="hs-comment">-- for single observation in sample case</span><span>
</span><span id="line-32"></span><span>             </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#nextSampleAt"><span class="hs-identifier hs-var hs-var">nextSampleAt</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span><span>    </span><span class="hs-comment">-- still in a sample period</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679103055"><span class="annot"><span class="annottext">refTimePoint :: (Word32, Time)
</span><a href="#local-6989586621679103055"><span class="hs-identifier hs-var hs-var">refTimePoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; Maybe (Word32, Time)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#referenceTimePoint"><span class="hs-identifier hs-var hs-var">referenceTimePoint</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-36"></span><span>          </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679103054"><span class="annot"><span class="annottext">(Word32, Time)
</span><a href="#local-6989586621679103054"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word32, Time)
</span><a href="#local-6989586621679103054"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-37"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Word32, Time)
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; (Word32, Time)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;step: missing referenceTimePoint&quot;</span></span><span>
</span><span id="line-38"></span><span>        </span><span id="local-6989586621679103052"><span class="annot"><span class="annottext">transitTime :: SISec
</span><a href="#local-6989586621679103052"><span class="hs-identifier hs-var hs-var">transitTime</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word32, Time) -&gt; RemoteClockModel -&gt; Time -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#calcTransitTime"><span class="hs-identifier hs-var">calcTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32, Time)
</span><a href="#local-6989586621679103055"><span class="hs-identifier hs-var">refTimePoint</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103068"><span class="hs-identifier hs-var">remoteTS</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe OneWayDeltaQSample
forall a. Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; Time -&gt; Int -&gt; SISec -&gt; StatsA
</span><a href="Network.Mux.DeltaQ.TraceStats.html#recordObservation"><span class="hs-identifier hs-var">recordObservation</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103066"><span class="hs-identifier hs-var">obsSize</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679103052"><span class="hs-identifier hs-var">transitTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                    </span><span class="hs-comment">-- need to start next sample period</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679103049"><span class="annot"><span class="annottext">sample :: OneWayDeltaQSample
</span><a href="#local-6989586621679103049"><span class="hs-identifier hs-var hs-var">sample</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; OneWayDeltaQSample
</span><a href="Network.Mux.DeltaQ.TraceStats.html#constructSample"><span class="hs-identifier hs-var">constructSample</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103065"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe OneWayDeltaQSample
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679103048"><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103048"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
-&gt; Time -&gt; Int -&gt; StatsA -&gt; (Maybe OneWayDeltaQSample, StatsA)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#step"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103068"><span class="hs-identifier hs-var">remoteTS</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103067"><span class="hs-identifier hs-var">localTS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103066"><span class="hs-identifier hs-var">obsSize</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="Network.Mux.DeltaQ.TraceStats.html#initialStatsA"><span class="hs-identifier hs-var">initialStatsA</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Maybe OneWayDeltaQSample
forall a. a -&gt; Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">OneWayDeltaQSample
</span><a href="#local-6989586621679103049"><span class="hs-identifier hs-var">sample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103048"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- Calculate the transit time by transforming the remotely reported</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- emit time into local clock domain then calculating differences.</span><span>
</span><span id="line-47"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#calcTransitTime"><span class="hs-identifier hs-type">calcTransitTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.Types.html#RemoteClockModel"><span class="hs-identifier hs-type">RemoteClockModel</span></a></span><span>
</span><span id="line-49"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span>
</span><span id="line-50"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec"><span class="hs-identifier hs-type">SISec</span></a></span><span>
</span><span id="line-51"></span><span id="calcTransitTime"><span class="annot"><span class="annottext">calcTransitTime :: (Word32, Time) -&gt; RemoteClockModel -&gt; Time -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#calcTransitTime"><span class="hs-identifier hs-var hs-var">calcTransitTime</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679103047"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103047"><span class="hs-identifier hs-var">remoteRefTS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679103046"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103046"><span class="hs-identifier hs-var">localRefTS</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679103045"><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103045"><span class="hs-identifier hs-var">remoteTS'</span></a></span></span><span> </span><span id="local-6989586621679103044"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103044"><span class="hs-identifier hs-var">localTS</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679103043"><span class="annot"><span class="annottext">remoteTS :: Word32
</span><a href="#local-6989586621679103043"><span class="hs-identifier hs-var hs-var">remoteTS</span></a></span></span><span>
</span><span id="line-53"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteClockModel -&gt; Word32
</span><a href="Network.Mux.Types.html#unRemoteClockModel"><span class="hs-identifier hs-var hs-var">unRemoteClockModel</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
</span><a href="#local-6989586621679103045"><span class="hs-identifier hs-var">remoteTS'</span></a></span><span>
</span><span id="line-54"></span><span>        </span><span id="local-6989586621679103042"><span class="annot"><span class="annottext">remoteClockDiffAsTimeDiff :: Word32 -&gt; DiffTime
</span><a href="#local-6989586621679103042"><span class="hs-identifier hs-var hs-var">remoteClockDiffAsTimeDiff</span></a></span></span><span>
</span><span id="line-55"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime
</span><a href="Network.Mux.Types.html#remoteClockPrecision"><span class="hs-identifier hs-var">remoteClockPrecision</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; DiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; DiffTime)
-&gt; (Word32 -&gt; DiffTime) -&gt; Word32 -&gt; DiffTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; DiffTime
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; DiffTime)
-&gt; (Word32 -&gt; Rational) -&gt; Word32 -&gt; DiffTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Rational
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span>
</span><span id="line-56"></span><span>        </span><span id="local-6989586621679103038"><span class="annot"><span class="annottext">correctedEmitTime :: Time
</span><a href="#local-6989586621679103038"><span class="hs-identifier hs-var hs-var">correctedEmitTime</span></a></span></span><span>
</span><span id="line-57"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103043"><span class="hs-identifier hs-var">remoteTS</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103047"><span class="hs-identifier hs-var">remoteRefTS</span></a></span><span>
</span><span id="line-58"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DiffTime
</span><a href="#local-6989586621679103042"><span class="hs-identifier hs-var">remoteClockDiffAsTimeDiff</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DiffTime) -&gt; Word32 -&gt; DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103043"><span class="hs-identifier hs-var">remoteTS</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103047"><span class="hs-identifier hs-var">remoteRefTS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>            </span><span class="annot"><span class="annottext">DiffTime -&gt; Time -&gt; Time
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-operator hs-var">`addTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103046"><span class="hs-identifier hs-var">localRefTS</span></a></span><span>
</span><span id="line-60"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-comment">-- wrap has occurred</span><span>
</span><span id="line-61"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DiffTime
</span><a href="#local-6989586621679103042"><span class="hs-identifier hs-var">remoteClockDiffAsTimeDiff</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DiffTime) -&gt; Word32 -&gt; DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Bounded a =&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103047"><span class="hs-identifier hs-var">remoteRefTS</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679103043"><span class="hs-identifier hs-var">remoteTS</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>            </span><span class="annot"><span class="annottext">DiffTime -&gt; Time -&gt; Time
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-operator hs-var">`addTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103046"><span class="hs-identifier hs-var">localRefTS</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Float -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceTypes.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="annot"><span class="annottext">(Float -&gt; SISec) -&gt; Float -&gt; SISec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Float
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103044"><span class="hs-identifier hs-var">localTS</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; DiffTime
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-operator hs-var">`diffTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103038"><span class="hs-identifier hs-var">correctedEmitTime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#recordObservation"><span class="hs-identifier hs-type">recordObservation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec"><span class="hs-identifier hs-type">SISec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span>
</span><span id="line-66"></span><span id="recordObservation"><span class="annot"><span class="annottext">recordObservation :: StatsA -&gt; Time -&gt; Int -&gt; SISec -&gt; StatsA
</span><a href="Network.Mux.DeltaQ.TraceStats.html#recordObservation"><span class="hs-identifier hs-var hs-var">recordObservation</span></a></span></span><span> </span><span id="local-6989586621679103034"><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103034"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679103033"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103033"><span class="hs-identifier hs-var">obsTime</span></a></span></span><span> </span><span id="local-6989586621679103032"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103032"><span class="hs-identifier hs-var">obsSize</span></a></span></span><span> </span><span id="local-6989586621679103031"><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679103031"><span class="hs-identifier hs-var">transitTime</span></a></span></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679103030"><span class="annot"><span class="annottext">f :: Maybe PerSizeRecord -&gt; Maybe PerSizeRecord
</span><a href="#local-6989586621679103030"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe PerSizeRecord
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Maybe PerSizeRecord
forall a. a -&gt; Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(PerSizeRecord -&gt; Maybe PerSizeRecord)
-&gt; PerSizeRecord -&gt; Maybe PerSizeRecord
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#makePerSizeRecord"><span class="hs-identifier hs-var">makePerSizeRecord</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679103031"><span class="hs-identifier hs-var">transitTime</span></a></span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="#local-6989586621679103030"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679103028"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679103028"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Maybe PerSizeRecord
forall a. a -&gt; Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(PerSizeRecord -&gt; Maybe PerSizeRecord)
-&gt; PerSizeRecord -&gt; Maybe PerSizeRecord
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#makePerSizeRecord"><span class="hs-identifier hs-var">makePerSizeRecord</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679103031"><span class="hs-identifier hs-var">transitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; PerSizeRecord -&gt; PerSizeRecord
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679103028"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103034"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">timeLastObs :: Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#timeLastObs"><span class="hs-identifier hs-var">timeLastObs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103033"><span class="hs-identifier hs-var">obsTime</span></a></span><span>
</span><span id="line-70"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">numObservations :: Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#numObservations"><span class="hs-identifier hs-var">numObservations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#numObservations"><span class="hs-identifier hs-var hs-var">numObservations</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103034"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">observables :: IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var">observables</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe PerSizeRecord -&gt; Maybe PerSizeRecord)
-&gt; Int -&gt; IntMap PerSizeRecord -&gt; IntMap PerSizeRecord
forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.alter</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PerSizeRecord -&gt; Maybe PerSizeRecord
</span><a href="#local-6989586621679103030"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103032"><span class="hs-identifier hs-var">obsSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var hs-var">observables</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103034"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- This might benefit from some strictness analysis, what are the</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- likely usage patterns?, do we want a single use collapse the</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- collective set of thunks or not?</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- There is the issue of &quot;bias&quot; (in its statistical meaning) here. The</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- approach here is pragmatic, we are going to use the uncorrected</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- sample standard deviation here as it has a defined solution for a</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- single sample.</span><span>
</span><span id="line-82"></span><span class="hs-comment">--</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- Given that the consumer of this statistic also has access to the</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- population size, they could reconstruct the underlying measures and</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- take it from there.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- We return `NaN` for the appropraiate satistics when the population</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- is empty.</span><span>
</span><span id="line-89"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#constructSample"><span class="hs-identifier hs-type">constructSample</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#OneWayDeltaQSample"><span class="hs-identifier hs-type">OneWayDeltaQSample</span></a></span><span>
</span><span id="line-90"></span><span id="constructSample"><span class="annot"><span class="annottext">constructSample :: StatsA -&gt; OneWayDeltaQSample
</span><a href="Network.Mux.DeltaQ.TraceStats.html#constructSample"><span class="hs-identifier hs-var hs-var">constructSample</span></a></span></span><span> </span><span id="local-6989586621679103023"><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneWaySample :: Double
-&gt; Int
-&gt; Int
-&gt; Double
-&gt; Double
-&gt; Double
-&gt; Double
-&gt; [Char]
-&gt; OneWayDeltaQSample
</span><a href="Network.Mux.DeltaQ.TraceStats.html#OneWaySample"><span class="hs-identifier hs-type">OneWaySample</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">duration :: Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#duration"><span class="hs-identifier hs-var">duration</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Double)
-&gt; (DiffTime -&gt; Rational) -&gt; DiffTime -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; Double) -&gt; DiffTime -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-92"></span><span>                     </span><span class="annot"><span class="annottext">DiffTime
-&gt; ((Word32, Time) -&gt; DiffTime) -&gt; Maybe (Word32, Time) -&gt; DiffTime
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679103019"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103019"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#timeLastObs"><span class="hs-identifier hs-var hs-var">timeLastObs</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; DiffTime
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-operator hs-var">`diffTime`</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679103019"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; Maybe (Word32, Time)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#referenceTimePoint"><span class="hs-identifier hs-var hs-var">referenceTimePoint</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumPackets :: Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumPackets"><span class="hs-identifier hs-var">sumPackets</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103017"><span class="hs-identifier hs-var">population</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTotalSDU :: Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTotalSDU"><span class="hs-identifier hs-var">sumTotalSDU</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103015"><span class="hs-identifier hs-var">totalSDUOctets</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">estDeltaQS :: Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estDeltaQS"><span class="hs-identifier hs-var">estDeltaQS</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="#local-6989586621679103013"><span class="hs-identifier hs-var">normCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103012"><span class="hs-identifier hs-var">dQSEst</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">estDeltaQVMean :: Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estDeltaQVMean"><span class="hs-identifier hs-var">estDeltaQVMean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="#local-6989586621679103013"><span class="hs-identifier hs-var">normCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103010"><span class="hs-identifier hs-var">vSum</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103008"><span class="hs-identifier hs-var">pop</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">estDeltaQVVar :: Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estDeltaQVVar"><span class="hs-identifier hs-var">estDeltaQVVar</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="#local-6989586621679103013"><span class="hs-identifier hs-var">normCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103006"><span class="hs-identifier hs-var">vSum2</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103010"><span class="hs-identifier hs-var">vSum</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103010"><span class="hs-identifier hs-var">vSum</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103008"><span class="hs-identifier hs-var">pop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103008"><span class="hs-identifier hs-var">pop</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">estR :: Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estR"><span class="hs-identifier hs-var">estR</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="#local-6989586621679103013"><span class="hs-identifier hs-var">normCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103004"><span class="hs-identifier hs-var">rEst</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sizeDist :: [Char]
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sizeDist"><span class="hs-identifier hs-var">sizeDist</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Float)] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103001"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102999"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679102998"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102998"><span class="hs-identifier hs-var">mtt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var hs-var">minTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102999"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102998"><span class="hs-identifier hs-var">mtt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679103001"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103001"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679102999"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102999"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntMap PerSizeRecord -&gt; [(Int, PerSizeRecord)]
forall a. IntMap a -&gt; [(Int, a)]
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.toAscList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var hs-var">observables</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102999"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- the sample population size</span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621679103017"><span class="annot"><span class="annottext">population :: Int
</span><a href="#local-6989586621679103017"><span class="hs-identifier hs-var hs-var">population</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#numObservations"><span class="hs-identifier hs-var hs-var">numObservations</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679103008"><span class="annot"><span class="annottext">pop :: Double
</span><a href="#local-6989586621679103008"><span class="hs-identifier hs-var hs-var">pop</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103017"><span class="hs-identifier hs-var">population</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- Handle the empty population condition</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679103013"><span class="annot"><span class="annottext">normCheck :: Double -&gt; Double
</span><a href="#local-6989586621679103013"><span class="hs-identifier hs-var hs-var">normCheck</span></a></span></span><span> </span><span id="local-6989586621679102994"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679102994"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IntMap PerSizeRecord -&gt; Int
forall a. IntMap a -&gt; Int
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.size</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var hs-var">observables</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679102994"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#nan"><span class="hs-identifier hs-var">nan</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- gather the data for the G,S estimations</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679103015"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679103015"><span class="hs-identifier hs-var">totalSDUOctets</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679102991"><span class="annot"><span class="annottext">[(Int, SISec)]
</span><a href="#local-6989586621679102991"><span class="hs-identifier hs-var">minSRev</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; PerSizeRecord -&gt; (Int, [(Int, SISec)]) -&gt; (Int, [(Int, SISec)]))
-&gt; (Int, [(Int, SISec)])
-&gt; IntMap PerSizeRecord
-&gt; (Int, [(Int, SISec)])
forall a b. (Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; IntMap a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.foldrWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; PerSizeRecord -&gt; (Int, [(Int, SISec)]) -&gt; (Int, [(Int, SISec)])
</span><a href="#local-6989586621679102989"><span class="hs-identifier hs-var">accum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IntMap PerSizeRecord -&gt; (Int, [(Int, SISec)]))
-&gt; IntMap PerSizeRecord -&gt; (Int, [(Int, SISec)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA -&gt; IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var hs-var">observables</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679102989"><span class="annot"><span class="annottext">accum :: Int
-&gt; PerSizeRecord -&gt; (Int, [(Int, SISec)]) -&gt; (Int, [(Int, SISec)])
</span><a href="#local-6989586621679102989"><span class="hs-identifier hs-var hs-var">accum</span></a></span></span><span> </span><span id="local-6989586621679102988"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102988"><span class="hs-identifier hs-var">nOctets</span></a></span></span><span> </span><span id="local-6989586621679102987"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102987"><span class="hs-identifier hs-var">psr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679102986"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102986"><span class="hs-identifier hs-var">sumSize</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679102985"><span class="annot"><span class="annottext">[(Int, SISec)]
</span><a href="#local-6989586621679102985"><span class="hs-identifier hs-var">minS</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102986"><span class="hs-identifier hs-var">sumSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102987"><span class="hs-identifier hs-var">psr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102988"><span class="hs-identifier hs-var">nOctets</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102988"><span class="hs-identifier hs-var">nOctets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var hs-var">minTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102987"><span class="hs-identifier hs-var">psr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, SISec) -&gt; [(Int, SISec)] -&gt; [(Int, SISec)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, SISec)]
</span><a href="#local-6989586621679102985"><span class="hs-identifier hs-var">minS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- fit a line to get the G,S estimation</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679102983"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679102983"><span class="hs-identifier hs-var">dQGEst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679103012"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103012"><span class="hs-identifier hs-var">dQSEst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679103004"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103004"><span class="hs-identifier hs-var">rEst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, SISec)] -&gt; (Double, Double, Double)
</span><a href="Network.Mux.DeltaQ.TraceStatsSupport.html#estimateGS"><span class="hs-identifier hs-var">estimateGS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, SISec)]
</span><a href="#local-6989586621679102991"><span class="hs-identifier hs-var">minSRev</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-comment">-- normalise all the observations</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679102981"><span class="annot"><span class="annottext">normalisedObservations :: IntMap PerSizeRecord
</span><a href="#local-6989586621679102981"><span class="hs-identifier hs-var hs-var">normalisedObservations</span></a></span></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679102980"><span class="annot"><span class="annottext">norm :: a -&gt; SISec
</span><a href="#local-6989586621679102980"><span class="hs-identifier hs-var hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621679102979"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679102979"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceTypes.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="annot"><span class="annottext">(Float -&gt; SISec) -&gt; (Double -&gt; Float) -&gt; Double -&gt; SISec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Float
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Float) -&gt; (Double -&gt; Rational) -&gt; Double -&gt; Float
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span>
</span><span id="line-123"></span><span>                     </span><span class="annot"><span class="annottext">(Double -&gt; SISec) -&gt; Double -&gt; SISec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679102983"><span class="hs-identifier hs-var">dQGEst</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679102979"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103012"><span class="hs-identifier hs-var">dQSEst</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PerSizeRecord -&gt; PerSizeRecord)
-&gt; IntMap PerSizeRecord -&gt; IntMap PerSizeRecord
forall a b. (Int -&gt; a -&gt; b) -&gt; IntMap a -&gt; IntMap b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.mapWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679102977"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102977"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SISec -&gt; PerSizeRecord -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#normalisePSR"><span class="hs-identifier hs-var">normalisePSR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SISec
forall a. Integral a =&gt; a -&gt; SISec
</span><a href="#local-6989586621679102980"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679102977"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatsA -&gt; IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var hs-var">observables</span></a></span><span> </span><span class="annot"><span class="annottext">StatsA
</span><a href="#local-6989586621679103023"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-comment">-- calculate the total population V stats</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679103010"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103010"><span class="hs-identifier hs-var">vSum</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679103006"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679103006"><span class="hs-identifier hs-var">vSum2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#S"><span class="hs-identifier hs-type">S</span></a></span><span>  </span><span id="local-6989586621679102975"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102975"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102974"><span class="hs-identifier hs-var">vSum'</span></a></span><span>
</span><span id="line-128"></span><span>            </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#S2"><span class="hs-identifier hs-type">S2</span></a></span><span> </span><span id="local-6989586621679102972"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102972"><span class="hs-identifier hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SISec2
</span><a href="#local-6989586621679102971"><span class="hs-identifier hs-var">vSum2'</span></a></span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Double) -&gt; (Float -&gt; Rational) -&gt; Float -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Float -&gt; Double) -&gt; Float -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102975"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Double) -&gt; (Float -&gt; Rational) -&gt; Float -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span> </span><span class="annot"><span class="annottext">(Float -&gt; Double) -&gt; Float -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102972"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679102974"><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102974"><span class="hs-identifier hs-var">vSum'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679102971"><span class="annot"><span class="annottext">SISec2
</span><a href="#local-6989586621679102971"><span class="hs-identifier hs-var">vSum2'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PerSizeRecord -&gt; (SISec, SISec2) -&gt; (SISec, SISec2))
-&gt; (SISec, SISec2) -&gt; IntMap PerSizeRecord -&gt; (SISec, SISec2)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; IntMap a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; (SISec, SISec2) -&gt; (SISec, SISec2)
</span><a href="#local-6989586621679102969"><span class="hs-identifier hs-var">vCalc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SISec
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SISec2
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap PerSizeRecord
</span><a href="#local-6989586621679102981"><span class="hs-identifier hs-var">normalisedObservations</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679102969"><span class="annot"><span class="annottext">vCalc :: PerSizeRecord -&gt; (SISec, SISec2) -&gt; (SISec, SISec2)
</span><a href="#local-6989586621679102969"><span class="hs-identifier hs-var hs-var">vCalc</span></a></span></span><span> </span><span id="local-6989586621679102968"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102968"><span class="hs-identifier hs-var">psr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679102967"><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102967"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679102966"><span class="annot"><span class="annottext">SISec2
</span><a href="#local-6989586621679102966"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102967"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var hs-var">sumTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102968"><span class="hs-identifier hs-var">psr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SISec2
</span><a href="#local-6989586621679102966"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">SISec2 -&gt; SISec2 -&gt; SISec2
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102968"><span class="hs-identifier hs-var">psr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | One way measurement for interval. Note that the fields are lazy</span><span>
</span><span id="line-136"></span><span class="hs-comment">--   here so that only calcuation necessary to satisfy strictness of</span><span>
</span><span id="line-137"></span><span class="hs-comment">--   use occurs.</span><span>
</span><span id="line-138"></span><span class="hs-keyword">data</span><span> </span><span id="OneWayDeltaQSample"><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#OneWayDeltaQSample"><span class="hs-identifier hs-var">OneWayDeltaQSample</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OneWaySample"><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#OneWaySample"><span class="hs-identifier hs-var">OneWaySample</span></a></span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="duration"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#duration"><span class="hs-identifier hs-var hs-var">duration</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-comment">-- SI Seconds of activity captured</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sumPackets"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumPackets"><span class="hs-identifier hs-var hs-var">sumPackets</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sumTotalSDU"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTotalSDU"><span class="hs-identifier hs-var hs-var">sumTotalSDU</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="estDeltaQS"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estDeltaQS"><span class="hs-identifier hs-var hs-var">estDeltaQS</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-comment">-- octets per second</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="estDeltaQVMean"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estDeltaQVMean"><span class="hs-identifier hs-var hs-var">estDeltaQVMean</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-comment">-- SI Seconds</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="estDeltaQVVar"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estDeltaQVVar"><span class="hs-identifier hs-var hs-var">estDeltaQVVar</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="estR"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#estR"><span class="hs-identifier hs-var hs-var">estR</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-comment">-- R estimate</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sizeDist"><span class="annot"><span class="annottext">OneWayDeltaQSample -&gt; [Char]
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sizeDist"><span class="hs-identifier hs-var hs-var">sizeDist</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- temporary to show size distribution</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- | Statistics accumulator. Strict evaluation used to keep the memory</span><span>
</span><span id="line-150"></span><span class="hs-comment">--   footprint strictly bounded.</span><span>
</span><span id="line-151"></span><span class="hs-keyword">data</span><span> </span><span id="StatsA"><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-var">StatsA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StatsA"><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-var">StatsA</span></a></span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- per sample</span><span>
</span><span id="line-153"></span><span>    </span><span id="referenceTimePoint"><span class="annot"><span class="annottext">StatsA -&gt; Maybe (Word32, Time)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#referenceTimePoint"><span class="hs-identifier hs-var hs-var">referenceTimePoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nextSampleAt"><span class="annot"><span class="annottext">StatsA -&gt; Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#nextSampleAt"><span class="hs-identifier hs-var hs-var">nextSampleAt</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- per observation</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="numObservations"><span class="annot"><span class="annottext">StatsA -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#numObservations"><span class="hs-identifier hs-var hs-var">numObservations</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="timeLastObs"><span class="annot"><span class="annottext">StatsA -&gt; Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#timeLastObs"><span class="hs-identifier hs-var hs-var">timeLastObs</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="observables"><span class="annot"><span class="annottext">StatsA -&gt; IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var hs-var">observables</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-type">IntMap</span></a></span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PerSizeRecord"><span class="hs-identifier hs-type">PerSizeRecord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- This _may_ not be the best representation, but it does appear to be</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- an adequate one. There are known issues with numerical stabilty for</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- this representation approach in floating point arithmetic where the</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- values being measured are &quot;large&quot; and the variablity in the sampled</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- population is &quot;small&quot; (i.e the inherent rounding effect of floating</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- point arithmetic has an effect).</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- This is very unlikely to cause an issue here as:</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-comment">--   a) the modulo model of the RemoteClockModel (and hence the</span><span>
</span><span id="line-171"></span><span class="hs-comment">--   establishment of a clock reference offset for a given sample)</span><span>
</span><span id="line-172"></span><span class="hs-comment">--   means that we are only ever recording differences - thus any</span><span>
</span><span id="line-173"></span><span class="hs-comment">--   absolute clock differences get factored out.</span><span>
</span><span id="line-174"></span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span class="hs-comment">--   b) the transit delay for a measurement will be small, (probablly</span><span>
</span><span id="line-176"></span><span class="hs-comment">--   not even credible) worst case ~10^3 / 10^4 seconds, the finite</span><span>
</span><span id="line-177"></span><span class="hs-comment">--   mantissa of IEEE754</span><span>
</span><span id="line-178"></span><span class="hs-comment">--   (https://en.wikipedia.org/wiki/IEEE_754#Representation_and_encoding_in_memory)</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   even for 32 bit representation (24bits / 7.22 decimal digits)</span><span>
</span><span id="line-180"></span><span class="hs-comment">--   represents an bound on the inherent measured population</span><span>
</span><span id="line-181"></span><span class="hs-comment">--   variability.</span><span>
</span><span id="line-182"></span><span class="hs-comment">--</span><span>
</span><span id="line-183"></span><span class="hs-comment">--   c) longer term clock drift is covered here by the restablishing</span><span>
</span><span id="line-184"></span><span class="hs-comment">--   of the clock reference offsets every sampling period. Given a</span><span>
</span><span id="line-185"></span><span class="hs-comment">--   reasonable sampling period (say 10 seconds) clock drift ( &lt;</span><span>
</span><span id="line-186"></span><span class="hs-comment">--   100ppm) can't amount to a significant error over such a period.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- To conclude, reasonable model of delay is &lt; 1second, the precision</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- of delay measurement is 10^-6 - this all fits nicely withing a</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- IEEE754 32bit representation with its 7.22 decimal digit</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- mantissa. Haskell `Float`s are adequate for this purpose.</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-keyword">data</span><span> </span><span id="PerSizeRecord"><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PerSizeRecord"><span class="hs-identifier hs-var">PerSizeRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PSR"><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PSR"><span class="hs-identifier hs-var">PSR</span></a></span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="minTransitTime"><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var hs-var">minTransitTime</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec"><span class="hs-identifier hs-type">SISec</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="count"><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sumTransitTime"><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var hs-var">sumTransitTime</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec"><span class="hs-identifier hs-type">SISec</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sumTransitTimeSq"><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var hs-var">sumTransitTimeSq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec2"><span class="hs-identifier hs-type">SISec2</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679102956"><span id="local-6989586621679102958"><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PerSizeRecord"><span class="hs-identifier hs-type">PerSizeRecord</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621679102954"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102954"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679102953"><span class="annot"><span class="annottext">&lt;&gt; :: PerSizeRecord -&gt; PerSizeRecord -&gt; PerSizeRecord
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621679102952"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102952"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PSR :: SISec -&gt; Int -&gt; SISec -&gt; SISec2 -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#PSR"><span class="hs-identifier hs-type">PSR</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">minTransitTime :: SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var">minTransitTime</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var hs-var">minTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102954"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">`min`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var hs-var">minTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102952"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">count :: Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var">count</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102954"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102952"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-203"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTransitTime :: SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var">sumTransitTime</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var hs-var">sumTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102954"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var hs-var">sumTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102952"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-204"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTransitTimeSq :: SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102954"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SISec2 -&gt; SISec2 -&gt; SISec2
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102952"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-205"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- | Normalise given the calculated G,S for the size</span><span>
</span><span id="line-208"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#normalisePSR"><span class="hs-identifier hs-type">normalisePSR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec"><span class="hs-identifier hs-type">SISec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PerSizeRecord"><span class="hs-identifier hs-type">PerSizeRecord</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PerSizeRecord"><span class="hs-identifier hs-type">PerSizeRecord</span></a></span><span>
</span><span id="line-209"></span><span id="normalisePSR"><span class="annot"><span class="annottext">normalisePSR :: SISec -&gt; PerSizeRecord -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#normalisePSR"><span class="hs-identifier hs-var hs-var">normalisePSR</span></a></span></span><span> </span><span id="local-6989586621679102950"><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102950"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621679102949"><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102949"><span class="hs-identifier hs-var">psr</span></a></span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679102948"><span class="annot"><span class="annottext">adj :: SISec
</span><a href="#local-6989586621679102948"><span class="hs-identifier hs-var hs-var">adj</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SISec
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PerSizeRecord -&gt; Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102949"><span class="hs-identifier hs-var">psr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102950"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>        </span><span id="local-6989586621679102947"><span class="annot"><span class="annottext">stt' :: SISec
</span><a href="#local-6989586621679102947"><span class="hs-identifier hs-var hs-var">stt'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var hs-var">sumTransitTime</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102949"><span class="hs-identifier hs-var">psr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102948"><span class="hs-identifier hs-var">adj</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span id="local-6989586621679102946"><span class="annot"><span class="annottext">ttt :: SISec -&gt; SISec -&gt; SISec2
</span><a href="#local-6989586621679102946"><span class="hs-identifier hs-var hs-var">ttt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679102945"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102945"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679102944"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102944"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceTypes.html#S2"><span class="hs-identifier hs-var">S2</span></a></span><span> </span><span class="annot"><span class="annottext">(Float -&gt; SISec2) -&gt; Float -&gt; SISec2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102945"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679102944"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102949"><span class="hs-identifier hs-var">psr</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">minTransitTime :: SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var">minTransitTime</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var hs-var">minTransitTime</span></a></span><span>   </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102949"><span class="hs-identifier hs-var">psr</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102950"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-215"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTransitTime :: SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var">sumTransitTime</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102947"><span class="hs-identifier hs-var">stt'</span></a></span><span>
</span><span id="line-216"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTransitTimeSq :: SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PerSizeRecord -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="annot"><span class="annottext">PerSizeRecord
</span><a href="#local-6989586621679102949"><span class="hs-identifier hs-var">psr</span></a></span><span>
</span><span id="line-217"></span><span>                                </span><span class="annot"><span class="annottext">SISec2 -&gt; SISec2 -&gt; SISec2
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102950"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec2
</span><a href="#local-6989586621679102946"><span class="hs-operator hs-var">`ttt`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SISec
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102947"><span class="hs-identifier hs-var">stt'</span></a></span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec -&gt; SISec
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102950"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Initial StatsA</span><span>
</span><span id="line-222"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#initialStatsA"><span class="hs-identifier hs-type">initialStatsA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span>
</span><span id="line-223"></span><span id="initialStatsA"><span class="annot"><span class="annottext">initialStatsA :: StatsA
</span><a href="Network.Mux.DeltaQ.TraceStats.html#initialStatsA"><span class="hs-identifier hs-var hs-var">initialStatsA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatsA :: Maybe (Word32, Time)
-&gt; Time -&gt; Int -&gt; Time -&gt; IntMap PerSizeRecord -&gt; StatsA
</span><a href="Network.Mux.DeltaQ.TraceStats.html#StatsA"><span class="hs-identifier hs-type">StatsA</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">referenceTimePoint :: Maybe (Word32, Time)
</span><a href="Network.Mux.DeltaQ.TraceStats.html#referenceTimePoint"><span class="hs-identifier hs-var">referenceTimePoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Word32, Time)
forall a. Maybe a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nextSampleAt :: Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#nextSampleAt"><span class="hs-identifier hs-var">nextSampleAt</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679102943"><span class="hs-identifier hs-var">noTime</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">numObservations :: Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#numObservations"><span class="hs-identifier hs-var">numObservations</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">timeLastObs :: Time
</span><a href="Network.Mux.DeltaQ.TraceStats.html#timeLastObs"><span class="hs-identifier hs-var">timeLastObs</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679102943"><span class="hs-identifier hs-var">noTime</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">observables :: IntMap PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#observables"><span class="hs-identifier hs-var">observables</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap PerSizeRecord
forall a. IntMap a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">IM.empty</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621679102943"><span class="annot"><span class="annottext">noTime :: Time
</span><a href="#local-6989586621679102943"><span class="hs-identifier hs-var hs-var">noTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Time
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-classes-0.2.0.0/noopt/doc/html/io-classes/src"><span class="hs-identifier hs-var">Time</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#makePerSizeRecord"><span class="hs-identifier hs-type">makePerSizeRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceTypes.html#SISec"><span class="hs-identifier hs-type">SISec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#PerSizeRecord"><span class="hs-identifier hs-type">PerSizeRecord</span></a></span><span>
</span><span id="line-234"></span><span id="makePerSizeRecord"><span class="annot"><span class="annottext">makePerSizeRecord :: SISec -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#makePerSizeRecord"><span class="hs-identifier hs-var hs-var">makePerSizeRecord</span></a></span></span><span> </span><span id="local-6989586621679102940"><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102940"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PSR :: SISec -&gt; Int -&gt; SISec -&gt; SISec2 -&gt; PerSizeRecord
</span><a href="Network.Mux.DeltaQ.TraceStats.html#PSR"><span class="hs-identifier hs-type">PSR</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">minTransitTime :: SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#minTransitTime"><span class="hs-identifier hs-var">minTransitTime</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102940"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">count :: Int
</span><a href="Network.Mux.DeltaQ.TraceStats.html#count"><span class="hs-identifier hs-var">count</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTransitTime :: SISec
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTime"><span class="hs-identifier hs-var">sumTransitTime</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102940"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sumTransitTimeSq :: SISec2
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sumTransitTimeSq"><span class="hs-identifier hs-var">sumTransitTimeSq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SISec -&gt; SISec2
</span><a href="Network.Mux.DeltaQ.TraceTypes.html#squareSISec"><span class="hs-identifier hs-var">squareSISec</span></a></span><span> </span><span class="annot"><span class="annottext">SISec
</span><a href="#local-6989586621679102940"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- May want to make this a configuration variable</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- NOTE this interval must be less than the wrap around time of the</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- `RemoteClockModel`. The remote clock model has a precision of</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- `remoteClockPrecision`.</span><span>
</span><span id="line-246"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#sampleInterval"><span class="hs-identifier hs-type">sampleInterval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-247"></span><span id="sampleInterval"><span class="annot"><span class="annottext">sampleInterval :: DiffTime
</span><a href="Network.Mux.DeltaQ.TraceStats.html#sampleInterval"><span class="hs-identifier hs-var hs-var">sampleInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime
</span><a href="#local-6989586621679102938"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">10</span></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679102938"><span class="annot"><span class="annottext">check :: DiffTime -&gt; DiffTime
</span><a href="#local-6989586621679102938"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621679102937"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679102937"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-250"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679102937"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679102937"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679102934"><span class="hs-identifier hs-var">wrapInterval</span></a></span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679102937"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-252"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-253"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DiffTime
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Infeasible sampleInterval&quot;</span></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679102934"><span class="annot"><span class="annottext">wrapInterval :: DiffTime
</span><a href="#local-6989586621679102934"><span class="hs-identifier hs-var hs-var">wrapInterval</span></a></span></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="Network.Mux.Types.html#remoteClockPrecision"><span class="hs-identifier hs-var">remoteClockPrecision</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; DiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DiffTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DiffTime) -&gt; Word32 -&gt; DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel -&gt; Word32
</span><a href="Network.Mux.Types.html#unRemoteClockModel"><span class="hs-identifier hs-var hs-var">unRemoteClockModel</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteClockModel
forall a. Bounded a =&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Network.Mux.DeltaQ.TraceStats.html#nan"><span class="hs-identifier hs-type">nan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span>
</span><span id="line-258"></span><span id="nan"><span class="annot"><span class="annottext">nan :: Double
</span><a href="Network.Mux.DeltaQ.TraceStats.html#nan"><span class="hs-identifier hs-var hs-var">nan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///home/runner/.ghcup/ghc/8.10.4/share/doc/ghc-8.10.4/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">/</span></a></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-259"></span></pre></body></html>